"use strict";var eL=Object.create;var Sl=Object.defineProperty;var _y=Object.getOwnPropertyDescriptor;var tL=Object.getOwnPropertyNames;var rL=Object.getPrototypeOf,oL=Object.prototype.hasOwnProperty;var m=(n,e)=>()=>(n&&(e=n(n=0)),e);var Dg=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Lg=(n,e)=>{for(var t in e)Sl(n,t,{get:e[t],enumerable:!0})},Ay=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of tL(e))!oL.call(n,o)&&o!==t&&Sl(n,o,{get:()=>e[o],enumerable:!(r=_y(e,o))||r.enumerable});return n};var y=(n,e,t)=>(t=n!=null?eL(rL(n)):{},Ay(e||!n||!n.__esModule?Sl(t,"default",{value:n,enumerable:!0}):t,n)),Eg=n=>Ay(Sl({},"__esModule",{value:!0}),n),h=(n,e,t,r)=>{for(var o=r>1?void 0:r?_y(e,t):e,i=n.length-1,s;i>=0;i--)(s=n[i])&&(o=(r?s(e,t,o):s(o))||o);return r&&o&&Sl(e,t,o),o},d=(n,e)=>(t,r)=>e(t,r,n);function yu(n,e){let t={};for(let r of Object.keys(n)){let o=n[r];e(o,r)&&(t[r]=o)}return t}function Ho(n,e){let t={};for(let r of Object.keys(n)){let o=n[r];t[r]=e(o,r)}return t}function My(n,e){let t={};for(let r of Object.keys(n))e(r,n[r])&&(t[r]=n[r]);return t}function Ny(...n){if(n.length===0)return{};let e={},t=Object.create(null);for(let r of n)if(r)for(let o of Object.keys(r)){let i=o.toLowerCase();t[i]?e[t[i]]=r[o]:(t[i]=o,e[o]=r[o])}return e}function Oy(n,e){if(n.hasOwnProperty(e))return n[e];let t=e.toLowerCase();for(let r of Object.keys(n))if(r.toLowerCase()===t)return n[r]}function B(n){let e=_g,t=(...r)=>(e===_g&&(t.value=e=n(...r)),e);return t.forget=()=>{e=_g,t.value=void 0},t.value=void 0,t}function zo(n){let e=new Map,t=r=>{if(e.has(r))return e.get(r);let o=n(r);return e.set(r,o),o};return t.clear=()=>e.clear(),t}function By(n){let e,t=r=>(e?.arg===r||(e={arg:r,val:n(r)}),e.val);return t.clear=()=>e=void 0,t}function jy(n,e){let t,r=()=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>{t=void 0,e()},n)};return r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}function Uy(n,e){let t,r=()=>{t===void 0&&(t=setTimeout(()=>{t=void 0,e()},n))};return r.queued=()=>!!t,r.clear=()=>{t&&(clearTimeout(t),t=void 0)},r}async function Wy(n,e){let t=[],r=[];for(let o of n)await e(o)?t.push(o):r.push(o);return[t,r]}function Go(n){let e=[];for(let t of n)e=e.concat(t);return e}var Me,Us,Fy,Ci,Ws,_g,hn,nL,vu,U=m(()=>{"use strict";Me=n=>!!n,Us=n=>yu(n,e=>e!==null),Fy=n=>yu(n,e=>e!==void 0),Ci=n=>e=>e instanceof n,Ws=(n,e)=>{debugger;throw new Error(e.replace("{value}",JSON.stringify(n)))};_g=Symbol("unset");hn=n=>n,nL=2**31-1,vu=()=>{let n=0;return()=>n++&nL}});var Vy,kl,Vs,Ag=m(()=>{"use strict";U();Vy=n=>{let e={};for(let t of n){let r=t.indexOf("=");r===-1?e[t]=null:e[t.slice(0,r)]=t.slice(r+1)}return e},kl=n=>{let e=[];for(let t of Object.keys(n)){let r=n[t];r!==void 0&&e.push(r===null?t:`${t}=${r}`)}return e},Vs=class n{constructor(e=[]){this.args=e;this.argMap=B(()=>Vy(this.args))}add(e,t=null){return this.newThis(kl({...this.argMap(),[e]:t}))}get(e){let t=this.argMap();return t.hasOwnProperty(e)?t[e]:void 0}remove(e){return this.newThis(kl({...this.argMap(),[e]:void 0}))}merge(e){return this.newThis(kl({...this.argMap(),...e instanceof n?e.argMap():Vy(e)}))}filter(e){let t=this.argMap(),r=[];for(let o of Object.keys(t)){let i=t[o];e(o,i)&&r.push(i===null?o:`${o}=${i}`)}return this.newThis(r)}toArray(){return this.args.slice()}newThis(e){return new this.constructor(e)}}});var $y,qy,wt,Iu=m(()=>{"use strict";Ag();$y="--remote-debugging-port",qy="--remote-debugging-pipe",wt=class n extends Vs{static{this.default=new n(["--disable-background-networking","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-client-side-phishing-detection","--disable-default-apps","--disable-dev-shm-usage","--disable-renderer-backgrounding","--disable-sync","--metrics-recording-only","--no-first-run","--no-default-browser-check"])}setConnection(e){return new n(kl({...this.argMap(),[qy]:e==="pipe"?null:void 0,[$y]:e!=="pipe"?String(e):void 0}))}getSuggestedConnection(){let e=this.argMap();if(e.hasOwnProperty(qy))return"pipe";let t=e[$y];if(t!==void 0)return t&&Number(t)||0}}});var iL={};var fo,Hy=m(()=>{"use strict";fo=require("chai");Iu();describe("BrowserArgs",()=>{it("merge",()=>{let n=new wt(["--a","--b=foo"]).merge(["--b=bar","--c"]);(0,fo.expect)(n.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("add",()=>{let n=new wt(["--a","--b=foo"]).add("--a").add("--b","bar").add("--c");(0,fo.expect)(n.toArray()).to.deep.equal(["--a","--b=bar","--c"])}),it("remove",()=>{let n=new wt(["--a","--b=foo"]).remove("--b");(0,fo.expect)(n.toArray()).to.deep.equal(["--a"])}),it("getSuggestedConnection",()=>{(0,fo.expect)(new wt(["--a","--b=foo"]).getSuggestedConnection()).to.be.undefined,(0,fo.expect)(new wt(["--a","--remote-debugging-port=42"]).getSuggestedConnection()).to.equal(42),(0,fo.expect)(new wt(["--a","--remote-debugging-pipe"]).getSuggestedConnection()).to.equal("pipe")}),it("setConnection",()=>{let n=new wt(["--a","--remote-debugging-port=42","--remote-debugging-pipe"]);(0,fo.expect)(n.setConnection("pipe").toArray()).to.deep.equal(["--a","--remote-debugging-pipe"]),(0,fo.expect)(n.setConnection(1337).toArray()).to.deep.equal(["--a","--remote-debugging-port=1337"])}),it("filter",()=>{let n=new wt(["--a","--b=42","--c=44"]).filter((e,t)=>e==="--b"||t==="44");(0,fo.expect)(n.toArray()).to.deep.equal(["--b=42","--c=44"])})})});function Vt(n,e,t){let r=zo(s=>{if(s)return new Fg.URL(s);throw new Error(`A valid url wasn't supplied: <${s}>`)}),o={"url.hostname":()=>{let s=r(e).hostname;return s.endsWith(".localhost")?"localhost":s},"url.port":()=>r(e).port,browserInspectUri:()=>encodeURIComponent(t),browserInspectUriPath:()=>new Fg.URL(t).pathname,wsProtocol:()=>r(e).protocol==="https:"?"wss":"ws"};return n.replace(/{([^\}]+)}/g,(s,a)=>o.hasOwnProperty(a)?o[a]():s)}var Fg,Su=m(()=>{"use strict";Fg=require("url");U()});var bn,q,st=m(()=>{"use strict";U();bn={dispose:()=>{}},q=class{constructor(e){this.disposed=!1;this.items=[];e&&(this.items=e.slice())}get isDisposed(){return this.disposed}callback(...e){for(let t of e)this.push({dispose:t})}push(...e){return this.disposed?(e.forEach(t=>t.dispose()),e[0]):(this.items.push(...e),e[0])}disposeObject(e){this.items=this.items.filter(t=>t!==e),e.dispose()}clear(){let e=Promise.all(this.items.map(t=>t.dispose()));return this.items=[],e}dispose(){let e=Promise.all(this.items.map(t=>t.dispose()));return this.items=[],this.disposed=!0,e}}});var Pu,zy,sL,ku,Gy=m(()=>{"use strict";Pu=require("fs"),zy=require("path"),sL=(n,e)=>e instanceof Error?{message:e.message,stack:e.stack}:typeof e=="bigint"?e.toString():e,ku=class{constructor(e,t){this.file=e;this.dap=t;try{(0,Pu.mkdirSync)((0,zy.dirname)(e),{recursive:!0})}catch{}this.stream=(0,Pu.createWriteStream)(e)}async setup(){this.dap?.output({category:"console",output:`Verbose logs are written to:
${this.file}
`})}dispose(){this.stream&&(this.stream.end(),this.stream=void 0)}write(e){this.stream&&this.stream.write(JSON.stringify(e,sL)+`
`)}}});function Mg(n,e=(0,Ky.tmpdir)()){if(n===!1)return{stdio:!1,logFile:null};let t={stdio:!0,logFile:Qy.join(e,`vscode-debugadapter-${(0,Jy.randomBytes)(4).toString("hex")}.json`)};return n===!0?t:{...t,...n}}function Xy(n,e){let t=Mg(e),r={sinks:[]};return t.logFile&&r.sinks.push(new ku(t.logFile,n)),r}var Jy,Ky,Qy,aL,j0,L,O=m(()=>{"use strict";Jy=require("crypto"),Ky=require("os"),Qy=y(require("path"));Gy();aL={runtime:null,"runtime.sourcecreate":null,"runtime.assertion":null,"runtime.launch":null,"runtime.target":null,"runtime.welcome":null,"runtime.exception":null,"runtime.sourcemap":null,"runtime.breakpoints":null,"sourcemap.parsing":null,"perf.function":null,"cdp.send":null,"cdp.receive":null,"dap.send":null,"dap.receive":null,internal:null,proxyActivity:null},j0=Object.keys(aL),L=Symbol("ILogger")});var Ae,Ne,$t,Pt,Pr=m(()=>{"use strict";Ae=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return this}get base1(){return new Ne(this.lineNumber+1,this.columnNumber+1)}get base01(){return new $t(this.lineNumber,this.columnNumber+1)}compare(e){let t=e.base0;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber}},Ne=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new Ae(this.lineNumber-1,this.columnNumber-1)}get base1(){return this}get base01(){return new $t(this.lineNumber-1,this.columnNumber)}compare(e){let t=e.base1;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber||0}},$t=class{constructor(e,t){this.lineNumber=e;this.columnNumber=t}get base0(){return new Ae(this.lineNumber-1,this.columnNumber)}get base1(){return new Ne(this.lineNumber,this.columnNumber+1)}get base01(){return this}compare(e){let t=e.base01;return this.lineNumber-t.lineNumber||this.columnNumber-t.columnNumber}},Pt=class n{constructor(e,t){this.begin=e;this.end=t}static{this.ZERO=new n(new Ae(0,0),new Ae(0,0))}static{this.INFINITE=new n(new Ae(0,0),new Ae(1/0,1/0))}static simplify(e){if(e.length===0)return[];let t=e.slice().sort((i,s)=>i.begin.compare(s.begin)),r=[],o=t[0];for(let i=1;i<t.length;i++){let s=t[i];o.end.compare(s.begin)>=0?o=new n(o.begin,s.end):(r.push(o),o=s)}return r.push(o),r}contains(e){return e.compare(this.begin)>=0&&e.compare(this.end)<=0}containsRange(e){return this.contains(e.begin)&&this.contains(e.end)}toString(){let e=this.begin.base0,t=this.end.base0;return`Range[${e.lineNumber}:${e.columnNumber} -> ${t.lineNumber}:${t.columnNumber}]`}}});function go(n){return new Promise((e,t)=>{let r=n.length;for(let o of n)o.then(i=>{i?(e(i),r=-1):--r===0&&e(void 0)}).catch(t)})}async function Zy(n,e){for(let t=0;t<n.length;t++)if(await e(n[t]))return t;return-1}function ye(){let n=null,e=null,t=!1,r,o=new Promise((i,s)=>{n=a=>{t=!0,r=a,i(a)},e=a=>{t=!0,s(a)}});return{resolve:n,reject:e,promise:o,get settledValue(){return r},hasSettled:()=>t}}var x,Yy,$=m(()=>{"use strict";x=n=>isFinite(n)?new Promise(e=>setTimeout(e,n)):new Promise(()=>{}),Yy=(n,e)=>{let t=setTimeout(n,e);return{dispose:()=>clearTimeout(t)}}});async function wn({access:n},e){if(!e)return!1;try{return await n(e),!0}catch{return!1}}async function Ft({stat:n},e){if(e)try{return await n(e)}catch{return}}async function tv({lstat:n},e){if(e)try{return await n(e)}catch{return}}async function rv({copyFile:n,rename:e,unlink:t},r,o){try{await e(r,o)}catch{await n(r,o),await t(r)}}function xr(n){return new Promise(e=>{Jo.readFile(n,"utf8",async(t,r)=>{e(t?"":r)})})}var Jo,ev,$0,xt,ve,Ng,xu,de=m(()=>{"use strict";Jo=y(require("fs")),ev=y(require("util"));$0=ev.promisify(Jo.writeFile),xt=Symbol("FsUtils"),ve=class{constructor(e){this.fs=e}realPath(e){return this.fs.realpath(e)}async exists(e){try{return await this.fs.access(e,Jo.constants.F_OK),!0}catch{return!1}}readFile(e){return this.fs.readFile(e)}},Ng=class{constructor(e){this.dap=e}async realPath(){throw new Error("not implemented")}async exists(e){try{let{doesExists:t}=await this.dap.remoteFileExistsRequest({localFilePath:e});return t}catch{return!1}}readFile(){throw new Error("not implemented")}},xu=class{constructor(e,t,r){this.remoteFilePrefix=e;this.localFsUtils=t;this.remoteFsUtils=r}static create(e,t,r){let o=new ve(t);return e!==void 0?new this(e.toLowerCase(),o,new Ng(r)):o}async exists(e){return this.selectFs(e).exists(e)}async readFile(e){return this.selectFs(e).readFile(e)}async realPath(e){return this.selectFs(e).realPath(e)}selectFs(e){return e.toLowerCase().startsWith(this.remoteFilePrefix)?this.remoteFsUtils:this.localFsUtils}}});function pL(n){return process.platform!=="win32"?[""]:n.lookup("PATHEXT")?.split(";")||[".exe"]}async function $s(n,e,t){let r;if(process.platform==="win32"){let o=t.WINDIR||"C:\\Windows";r=ce.join(o,"System32","where.exe")}else r="/usr/bin/which";try{if(await Ft(n,r)){let i=(await(0,nv.default)(r,[e],{env:Us(t)})).stdout.split(/\r?\n/);if(process.platform==="win32"){let s=String(t.PATHEXT||".exe").toUpperCase().split(";");for(let a of i){let c=ce.extname(a).toUpperCase();if(c&&s.includes(c))return a}}else if(i.length>0)return i[0];return}return e}catch{}}async function Og(n,e,t){if(e){if(process.platform==="win32"&&!ce.extname(e))for(let r of pL(t)){let o=e+r;if(await Ft(n,o))return o}if(await Ft(n,e))return e}}function yn(...n){return ce.posix.isAbsolute(n[0])?G(ce.posix.join(...n)):ce.win32.isAbsolute(n[0])?ce.win32.join(...n):ce.join(...n)}function ir(...n){return ce.posix.isAbsolute(n[0])?ce.posix.resolve(...n):ce.win32.isAbsolute(n[0])?ce.win32.resolve(...n):ce.resolve(...n)}function xl(n,e){return ce.posix.isAbsolute(n)?ce.posix.relative(n,e):ce.win32.isAbsolute(n)?ce.win32.relative(n,e):ce.relative(n,e)}function fe(n,e=!1){if(!n)return n;if(cv(n)){let t=Pl.length;n=Pl+n[t].toLowerCase()+n.substr(t+1)}else Tu(n)&&(n=(e?n[0].toUpperCase():n[0].toLowerCase())+n.substr(1));return n}function ee(n,e=!1){if(!n)return n;if(n=fe(n,e),cv(n)){let t=Pl.length;n=n.substr(0,t+1)+n.substr(t+1).replace(/\//g,"\\")}else Tu(n)&&(n=n.replace(/\//g,"\\"));return n}function G(n){return n.replace(/\\\//g,"/").replace(/\\/g,"/")}var ov,nv,iv,ce,cL,lL,sv,av,uL,Pl,cv,Bg,Cu,qs,jg,Tu,le=m(()=>{"use strict";ov=require("crypto"),nv=y(require("execa")),iv=require("os"),ce=y(require("path"));de();U();cL=process.platform==="win32"?"\\\\.\\pipe\\":(0,iv.tmpdir)(),lL=0,sv=()=>ce.join(cL,`node-cdp.${process.pid}-${(0,ov.randomBytes)(4).toString("hex")}-${lL++}.sock`);av=n=>n.includes(`.asar${ce.sep}`);uL=/\/|\\/,Pl="file:///",cv=n=>n.startsWith(Pl)&&n[Pl.length+1]===":",Bg=n=>n.split(uL);Cu=(n,e)=>{let t=ce.relative(n,e);return t.length&&!ce.isAbsolute(t)&&!t.startsWith("..")},qs=(n,e)=>{let t=ce.relative(n,e);return!ce.isAbsolute(t)&&!t.startsWith("..")},jg=n=>n.startsWith("\\\\"),Tu=n=>/^[A-Za-z]:/.test(n)||jg(n)});async function SL(n){switch(n.type){case 0:try{let e=await Ug.promises.readFile(n.file);return{id:n.id,hash:n.mode===0?(0,vn.hash)(e):n.mode===2?mL(e):(0,vn.shaHash)(e)}}catch{return{id:n.id}}case 1:try{return{id:n.id,hash:(0,vn.hash)(pv(n.data))}}catch{return{id:n.id}}case 2:try{let e=await Ug.promises.readFile(n.file);return{id:n.id,matches:lv(e,n.expected,n.checkNode)}}catch{return{id:n.id,matches:!1}}case 3:try{return{id:n.id,matches:lv(pv(n.data),n.expected,n.checkNode)}}catch{return{id:n.id,matches:!1}}}}function kL(n){n.on("message",e=>{SL(e).then(t=>n.postMessage(t))})}var vn,Du,Ug,Wg,mL,fL,gL,hL,bL,wL,yL,vL,IL,Ru,lv,pv,uv=m(()=>{"use strict";vn=require("@c4312/chromehash"),Du=require("crypto"),Ug=require("fs"),Wg=require("worker_threads"),mL=n=>(0,Du.createHash)("sha256").update(n).digest("hex"),fL=Buffer.from("(function (exports, require, module, __filename, __dirname) { "),gL=Buffer.from(`
});`),hL=Buffer.from("(function (exports, require, module, __filename, __dirname, process, global, Buffer) { return function (exports, require, module, __filename, __dirname) { "),bL=Buffer.from(`
}.call(this, exports, require, module, __filename, __dirname); });`),wL=Buffer.from("#!"),yL=Buffer.from("\r")[0],vL=Buffer.from(`
`)[0],IL=(n,e)=>n.slice(0,e.length).equals(e),Ru=(n,...e)=>{if(n.length!==64)return(0,vn.hash)(e.length===1?e[0]:Buffer.concat(e))===n;let t=(0,Du.createHash)("sha256");for(let i of e)t.update(i);if(t.digest("hex")===n)return!0;let r=e.length===1?e[0]:Buffer.concat(e),o=(0,vn.normalizeShaBuffer)(r);return r===o?!1:(0,Du.createHash)("sha256").update(o).digest("hex")===n},lv=(n,e,t)=>{if(Ru(e,n))return!0;if(t){if(IL(n,wL)){let r=n.indexOf(vL);return n[r-1]===yL&&r--,Ru(e,n.subarray(r))}if(Ru(e,fL,n,gL))return!0}return!!Ru(e,hL,n,bL)},pv=n=>n instanceof Buffer?n:Buffer.from(n,"utf-8");Wg.parentPort&&kL(Wg.parentPort)});var dv,mv,Lu,fv=m(()=>{"use strict";dv=require("path"),mv=require("worker_threads");U();$();uv();Lu=class{constructor(e=3,t=(0,dv.join)(__dirname,"hash.js")){this.maxFailures=e;this.hasherScriptPath=t;this.idCounter=0;this.failureCount=0;this.deferredMap=new Map;this.deferCleanup=jy(3e4,()=>this.cleanup())}async hashBytes(e,t){return(await this.send({type:1,data:t,mode:e,id:this.idCounter++})).hash}async hashFile(e,t){return(await this.send({type:0,file:t,mode:e,id:this.idCounter++})).hash}async verifyBytes(e,t,r){return(await this.send({type:3,data:e,id:this.idCounter++,expected:t,checkNode:r})).matches}async verifyFile(e,t,r){return(await this.send({type:2,file:e,id:this.idCounter++,expected:t,checkNode:r})).matches}dispose(){this.cleanup(),this.deferCleanup.clear()}send(e){let t=this.getProcess();if(!t)throw new Error("hash.js process unexpectedly exited");this.deferCleanup();let r=ye();return this.deferredMap.set(e.id,{deferred:r,request:e}),t.postMessage(e),r.promise}cleanup(){this.instance&&(this.instance.removeAllListeners("exit"),this.instance.terminate(),this.instance=void 0,this.failureCount=0)}getProcess(){if(this.instance)return this.instance;if(this.failureCount>this.maxFailures)return;let e=this.instance=new mv.Worker(this.hasherScriptPath);return e.setMaxListeners(1/0),e.on("message",t=>{let r=t,o=this.deferredMap.get(r.id);o&&(o.deferred.resolve(r),this.deferredMap.delete(r.id))}),e.on("exit",()=>{this.instance=void 0,this.failureCount++;let t=this.getProcess();if(t){this.deferCleanup();for(let{request:r}of this.deferredMap.values())t.postMessage(r)}else{for(let{deferred:r}of this.deferredMap.values())r.reject(new Error("hash.js process unexpectedly exited"));this.deferredMap.clear(),this.deferCleanup.clear()}}),e}}});async function bv(n,e,t){return!n||av(n)?void 0:e?(typeof t=="string"?await gv.verifyBytes(t,e,!0):await gv.verifyFile(n,e,!0))?n:void 0:await new ve(hv.promises).exists(n)?n:void 0}var hv,gv,wv=m(()=>{"use strict";hv=require("fs");de();le();fv();gv=new Lu});var Kr,Qr,Ti=m(()=>{"use strict";Kr="node:",Qr="<node_internals>"});function Sv(n,e,t){return e.length>1||e[0].type!=="FunctionDeclaration"?xv(n,e,!0,t):kv(n,[{type:"ReturnStatement",argument:{type:"CallExpression",optional:!1,arguments:[{type:"ThisExpression"},...n.map(r=>({type:"Identifier",name:r}))],callee:{type:"MemberExpression",property:{type:"Identifier",name:"call"},computed:!1,optional:!1,object:{type:"FunctionExpression",params:e[0].params,body:e[0].body}}}}],!0,t)}function xv(n,e,t,r){let o=e[e.length-1];if(o.type!=="ReturnStatement"){let i=xL(o);i&&(e=[...e.slice(0,-1),{type:"ReturnStatement",argument:i}])}return kv(n,e,t,r)}function xL(n){switch(n.type){case"ExpressionStatement":return n.expression;case"BlockStatement":return{type:"CallExpression",arguments:[],callee:{type:"ArrowFunctionExpression",params:[],expression:!1,body:n},optional:!1};case"ReturnStatement":return n.argument||void 0;default:return}}var yv,_u,vv,Vg,In,$g,Iv,ho,Cl,kv,PL,Pv,Sn,Au,Eu,Ri=m(()=>{"use strict";yv=require("./vendor/acorn.js"),_u=require("./vendor/acorn-loose.js"),vv=y(require("eslint-visitor-keys")),Vg={ecmaVersion:"latest",locations:!0,allowAwaitOutsideFunction:!0,allowImportExportEverywhere:!0,allowReserved:!0,allowReturnOutsideFunction:!0},In=n=>n.start,$g=n=>n.end,Iv=(n,e)=>n.slice(In(e),$g(e)),ho=(n,e=!1)=>(e?yv.parse:_u.parse)(n,Vg),Cl=n=>{let e=ho(n);for(let t of e.body)t.type==="FunctionDeclaration"&&t.id&&(0,_u.isDummy)(t.id)&&(t.id=null);return e.body};kv=(n,e,t,r)=>{let o={type:"Identifier",name:"e"},s=r?[{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:o,body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"LogicalExpression",left:{type:"LogicalExpression",left:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"stack"},computed:!1,optional:!1},operator:"||",right:{type:"MemberExpression",object:o,property:{type:"Identifier",name:"message"},computed:!1,optional:!1}},operator:"||",right:{type:"CallExpression",callee:{type:"Identifier",name:"String"},arguments:[o],optional:!1}}}]}}}]:e;return t?{type:"FunctionExpression",id:{type:"Identifier",name:"_generatedCode"},params:n.map(a=>({type:"Identifier",name:a})),body:{type:"BlockStatement",body:s}}:{type:"ArrowFunctionExpression",params:n.map(a=>({type:"Identifier",name:a})),expression:!1,body:{type:"BlockStatement",body:s}}},PL=(n,e)=>({type:"CallExpression",arguments:n.map(t=>({type:"Identifier",name:t})),callee:e,optional:!1}),Pv=(n,e,t)=>PL(n,xv(n,e,t,!0));Sn=(n,e)=>{Eu(n,e)},Au=(n,e)=>{let t=Eu(n,e);return t&&typeof t=="object"?t.replace:n},Eu=(n,e,t)=>{if(!n)return;let r=e.enter(n,t);if(r===0)return 0;if(r&&typeof r=="object")return r;if(r===1)return;let o=vv.KEYS[n.type];if(o)for(let i of o){let s=n[i];if(s instanceof Array)for(let[a,c]of s.entries()){let l=Eu(c,e,n);if(l===0)return 0;l&&typeof l=="object"&&(s[a]=l.replace)}else if(s){let a=Eu(s,e,n);if(a===0)return 0;a&&typeof a=="object"&&(n[i]=a.replace)}}e.leave?.(n)}});var S,Tl,H=m(()=>{"use strict";U();S=class{constructor(){this._listeners=new Set;this.event=(e,t,r)=>{let o={listener:e,thisArg:t};this._listeners.add(o);let i={dispose:()=>{i.dispose=()=>{},this._listeners.delete(o)}};return r&&r.push(i),i}}get size(){return this._listeners.size}fire(e){let t=!this._deliveryQueue;this._deliveryQueue||(this._deliveryQueue=[]);for(let r of this._listeners)this._deliveryQueue.push({data:r,event:e});if(t){for(let r=0;r<this._deliveryQueue.length;r++){let{data:o,event:i}=this._deliveryQueue[r];o.listener.call(o.thisArg,i)}this._deliveryQueue=void 0}}dispose(){this._listeners.clear(),this._deliveryQueue&&(this._deliveryQueue=[])}},Tl=class{constructor(){this.map=new Map;this.listeners=this.map}listen(e,t){let r=this.map.get(e);r||(r=new S,this.map.set(e,r));let o=r.event(t);return{dispose:B(()=>{o.dispose(),r?.size===0&&this.map.delete(e)})}}emit(e,t){this.listeners.get(e)?.fire(t)}}});function Ko(n,e){return CL(""+n,e)}function CL(n,e){let t=(0,Cv.parseExpressionAt)(n,0,{ecmaVersion:"latest",locations:!0});if(t.type!=="FunctionExpression")throw new Error(`Could not find function declaration for:

${n}`);let r=t.params.map(a=>{if(a.type!=="Identifier")throw new Error("Parameter must be identifier");return a.name}),{start:o,end:i}=t.body,s=(a,c,l)=>{let p=c,u=[];for(let[g,w]of a.entries())p+=`let ${r[g]}=`,u.push(new Pt(new Ae(0,p.length),new Ae(0,p.length+w.length))),p+=w,p+=";";return p+=n.slice(o+1,i-1),p+=l,p+=`
${Ue(e)}`,{out:p,argRanges:u}};return{expr:(...a)=>s(a,"(()=>{","})();").out,exprArgRanges:(...a)=>s(a,"(()=>{","})();").argRanges,decl:(...a)=>s(a,"function(...runtimeArgs){","}").out}}function Ye(n,e){let t=""+n,r=t.lastIndexOf("}");t=t.slice(0,r)+Ue(e)+t.slice(r);let o=async({cdp:i,args:s,...a})=>{let c=await i.Runtime.callFunctionOn({functionDeclaration:t,arguments:s.map(l=>l instanceof Rl?{objectId:l.objectId}:{value:l}),...a});if(!c)throw new Di({exceptionId:0,text:"No response from CDP",lineNumber:0,columnNumber:0});if(c.exceptionDetails)throw new Di(c.exceptionDetails);return c.result};return o.source=t,o}var Cv,Tv,Ue,qg,Di,Rl,Ze=m(()=>{"use strict";Cv=require("./vendor/acorn.js"),Tv=require("crypto");Pr();Mt();Ue=(n=qg())=>`
//# sourceURL=${n}
`,qg=()=>`eval-${(0,Tv.randomBytes)(4).toString("hex")}.cdp`;Di=class extends Error{constructor(t){super(t.text);this.details=t}},Rl=class{constructor(e){this.objectId=e}}});var Rv,Dv=m(()=>{"use strict";Ze();Rv=()=>"globalThis.__jsDebugIsReady = true; "+Ue()});var Lv,Dl,Mu,Hg,TL,Hs,kn=m(()=>{"use strict";Lv=require("url");H();V();Dv();Dl=new Set(["page","iframe","worker","service_worker"]),Mu=new Set(["page","iframe"]),Hg=new Set(["page","iframe"]),TL=Hg,Hs=class n{constructor(e,t,r,o,i,s,a,c,l){this._manager=e;this._targetInfo=t;this.launchConfig=s;this.sessionId=a;this.logger=c;this._attached=!1;this._onNameChangedEmitter=new S;this.onNameChanged=this._onNameChangedEmitter.event;this.entryBreakpoint=void 0;this._children=new Map;this.willWaitForDebugger=Promise.resolve();this.sourcePathResolver=this._manager._sourcePathResolver;this._cdp=r,r.pause(),this.parentTarget=o,this._waitingForDebugger=i,this._updateFromInfo(t),this._ondispose=l}get targetInfo(){return this._targetInfo}get targetId(){return this._targetInfo.targetId}get independentLifeycle(){return Hg.has(this.type())}get supplementalConfig(){let e=this.type();return{__browserTargetType:e,__usePerformanceFromParent:e!=="page"}}targetOrigin(){return this._manager._targetOrigin}id(){return this.sessionId}cdp(){return this._cdp}name(){return this._computeName()}fileName(){return this._targetInfo.url}type(){return this._targetInfo.type}afterBind(){return this._cdp.resume(),Promise.resolve()}initialize(){return Promise.resolve()}async runIfWaitingForDebugger(){await Promise.all([!this._targetInfo.canAccessOpener&&this._cdp.Runtime.runIfWaitingForDebugger({}),this._cdp.Runtime.evaluate({expression:Rv()})])}parent(){return this.parentTarget&&!Dl.has(this.parentTarget.type())?this.parentTarget.parentTarget:this.parentTarget}children(){let e=[];for(let t of this._children.values())Dl.has(t.type())?e.push(t):e.push(...t.children());return e}canStop(){return TL.has(this.type())}stop(){if(this._manager.targetList().includes(this))if(this.type()==="service_worker"){if(this._manager.serviceWorkerModel.stopWorker(this.id()),!this.parentTarget)return;this._manager.serviceWorkerModel.stopWorker(this.parentTarget.id())}else this._cdp.Target.closeTarget({targetId:this._targetInfo.targetId})}canRestart(){return Hg.has(this.type())}restart(){this._cdp.Page.reload({})}waitingForDebugger(){return this._waitingForDebugger}canAttach(){return!this._attached}async attach(){return this._waitingForDebugger=!1,this._attached=!0,Promise.resolve(this._cdp)}canDetach(){return this._attached}async detach(){this._attached=!1,this._manager._detachedFromTarget(this.sessionId)}executionContextName(e){let t=e.auxData,r=e.name;if(!t)return r;let o=t.frameId,i=o?this._manager.frameModel.frameForId(o):void 0;return i&&t.isDefault&&!i.parentFrame()?"top":i&&t.isDefault?i.displayName():i?`${r}`:r}supportsCustomBreakpoints(){return Mu.has(this.type())}supportsXHRBreakpoints(){return Mu.has(this.type())}scriptUrlToUrl(e){return Xr(this._targetInfo.url,e)||e}_updateFromInfo(e){this._targetInfo={...e,type:this._targetInfo.type},this._onNameChangedEmitter.fire()}setComputeNameFn(e){this._customNameComputeFn=e,this._onNameChangedEmitter.fire()}_computeName(){let e=this._customNameComputeFn?.(this);if(e)return e;if(this.type()==="service_worker"){let o=this._manager.serviceWorkerModel.version(this.id());if(o)return o.label()+" [Service Worker]"}let t=this._targetInfo.title;if(!(t&&this._manager.targetList().some(o=>o instanceof n&&o!==this&&o._targetInfo.title===this._targetInfo.title)))return t;try{let o=new Lv.URL(this._targetInfo.url);o.protocol==="data:"?t=" <data>":o?t+=` (${this._targetInfo.url.replace(/^[a-z]+:\/\/|\/$/gi,"")})`:t+=` (${this._targetInfo.url})`}catch{t+=` (${this._targetInfo.url})`}return t}async _detached(){await this._manager.serviceWorkerModel.detached(this._cdp),this._ondispose(this)}}});function Ll(n){return n instanceof Array?n:[n]}function Ev(n,e,t){let r=0,o=n.length-1;for(;r<=o;){let i=(r+o)/2|0,s=t(n[i],e);if(s<0)r=i+1;else if(s>0)o=i-1;else return i}return r}function _v(n,e){let t=new Map;for(let r of n){let o=e(r),i=t.get(o);i?i.push(r):t.set(o,[r])}return t}function Pn(n){return n.next().value}var xn=m(()=>{"use strict"});var Nu,Ct,zs=m(()=>{"use strict";Nu=class{constructor(e,t){this.key=e;this.value=t}toString(){return`${this.key}: ${this.value}`}},Ct=class{constructor(e,t){this.projection=e;this.initialContents=t;let r=Array.from(t||[]).map(o=>[this.projection(o[0]),new Nu(o[0],o[1])]);this.projectionToKeyAndValue=new Map(r)}clear(){this.projectionToKeyAndValue.clear()}delete(e){let t=this.projection(e);return this.projectionToKeyAndValue.delete(t)}forEach(e,t){this.projectionToKeyAndValue.forEach(r=>{e.call(t,r.value,r.key,this)},t)}get(e){let t=this.projection(e),r=this.projectionToKeyAndValue.get(t);return r?r.value:void 0}has(e){return this.projectionToKeyAndValue.has(this.projection(e))}set(e,t){return this.projectionToKeyAndValue.set(this.projection(e),new Nu(e,t)),this}get size(){return this.projectionToKeyAndValue.size}*entries(){for(let e of this.projectionToKeyAndValue.values())yield[e.key,e.value]}*keys(){for(let e of this.projectionToKeyAndValue.values())yield e.key}*values(){for(let e of this.projectionToKeyAndValue.values())yield e.value}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return JSON.stringify(Array.from(this.entries()))}toString(){return`MapUsingProjection<${JSON.stringify([...this.entries()])}>`}}});function bo(n,e){return n.length<=e?n:n.substr(0,e-1)+"\u2026"}function Gs(n,e){if(n.length<=e)return n;let t=e>>1,r=e-t-1,o=n.codePointAt(n.length-r-1);o&&o>=65536&&(--r,++t);let i=n.codePointAt(t-1);return t>0&&i&&i>=65536&&--t,n.substr(0,t)+"\u2026"+n.substr(n.length-r,r)}function yt(n,e){let t=Av.split("").filter(o=>!e||e.indexOf(o)<0).join("").replace(/[\\\]]/g,"\\$&"),r=new RegExp(`[${t}]`,"g");return n.replace(r,"\\$&")}var Av,Fv,Cn,Yr=m(()=>{"use strict";Av="/\\.?*()^${}|[]+",Fv=n=>Av.includes(n);Cn=class{constructor(e){this.source=e;this.lines=[];this.lines.push(0);for(let t=e.indexOf(`
`);t!==-1;t=e.indexOf(`
`,t+1))this.lines.push(t+1)}getLineOffset(e){return e>=this.lines.length?this.source.length:this.lines[e]}convert(e){let t=e.base0;if(t.lineNumber>this.lines.length)return this.source.length;let r=this.lines[t.lineNumber],o=this.lines[t.lineNumber+1]??this.source.length+1;return r+Math.min(o-r-1,t.columnNumber)}}});function Bu(){Js=process.platform!=="win32"}function ju(n){Js=n}function Fl(){return Js}function Uu(n){return Js?n:n.toLowerCase()}function Wu(n,e){return Js?n===e:n.toLowerCase()===e.toLowerCase()}function Li(){return Fl()?new Map:new Ct(Uu)}function Xr(n,e){try{return new wo.URL(e,n).href}catch{}}function Gg(n){try{return new wo.URL(n).pathname}catch{return}}function Vu(n,e){try{return new wo.URL(e),e}catch{}let t;try{t=new wo.URL(n||"")}catch{return e}let r=t.protocol+"//";return t.username&&(r+=t.username+":"+t.password+"@"),r+=t.host,r+=sr.dirname(t.pathname),r[r.length-1]!=="/"&&(r+="/"),r+=e,r}function $u(n){try{return new wo.URL(n),!0}catch{return!1}}function Uv(n){return n.replace(/\/$/,"").replace(/\\$/,"")}function We(n){let e=EL.exec(n);if(e)n=`${e[1]}:///${e[2]}`;else if(n.startsWith("vscode-webview-resource://"))n=new wo.URL(n).pathname.replace(/%2F/gi,"/").replace(/^\/([a-z0-9\-]+)(\/{1,2})/i,(r,o,i)=>i.length===1?`${o}:///`:`${o}://`);else if(n.startsWith(Nv))n=n.slice(Nv.length);else if(!Cr(n))return;return n=n.replace("file:///",""),n=decodeURIComponent(n),n.startsWith("/")&&process.platform==="win32"&&n[1]!=="/"&&(n="/"+n),n[0]!=="/"&&!n.match(/^[A-Za-z]:/)&&(n="/"+n),ee(n)}function Wv(n){return Cr(n)&&(n=n.replace("file:///","\\\\"),n=n.replace(/\//g,"\\"),n=decodeURIComponent(n)),n}function Q(n){return Jg==="win32"?"file:///"+Tn(n):"file://"+Tn(n)}function Qo(n){return n.startsWith("/")?"file://"+Tn(n):"file:///"+Tn(n)}function Tt(n){return sr.posix.isAbsolute(n)||sr.win32.isAbsolute(n)}function vt(n){return!!n&&n.startsWith("data:")}function _l(n,e,t,r,o=Js){let i="";for(let s of n.slice(e,t))o?zg(s,El,r):(zg(s.toLowerCase(),El,r),zg(s.toUpperCase(),El,r)),i+=_L(El),El.clear();return i}function at(n,[e,t]=[0,n.length]){if(t<=e)return n;let r=[],o=_l(n,0,e,!1),i=_l(n,t,n.length,!1),s=n.slice(e,t);for(let a of[decodeURIComponent(s),We(s)]){if(!a)continue;let c=_l(a,0,a.length,!0);r.push(AL(`${o}${c}${i}`).concat("($|\\?)"))}return r.join("|")}function Cr(n){return n.startsWith("file:///")}function Tn(n){return n=ar(n),Jg==="win32"?(jg(n)&&(n=n.slice(1)),n.split(/[\\//]/g).map((e,t)=>t>0?encodeURIComponent(e):e).join("/")):n.split("/").map(encodeURIComponent).join("/")}function ar(n){return n&&Jg==="win32"&&n[1]===":"?n[0].toUpperCase()+n.substring(1):n}function FL(n){return!!n&&!sr.isAbsolute(n)&&!!(0,wo.parse)(n).protocol}var Ov,sr,wo,Js,Mv,Ml,Ei,Ks,DL,LL,Ou,Bv,jv,Qs,EL,Nv,zg,_L,El,AL,Jg,Rn,Xs,ML,V=m(()=>{"use strict";Ov=require("dns"),sr=y(require("path")),wo=require("url");kn();xn();zs();U();le();Yr();Js=process.platform!=="win32";Mv=process.platform==="win32"?process.env.PATHEXT?.toLowerCase().split(";"):void 0,Ml=n=>{let e=Uu(sr.basename(n));if(Mv){for(let t of Mv)if(e.endsWith(t))return e.slice(0,-t.length)}return e},Ei=async(n,e)=>{for(;;){let t=await e(n);if(t!==void 0)return t;let r=sr.dirname(n);if(r===n)return;n=r}},Ks=(n,e,t)=>Ei(e,async r=>await n.exists(sr.join(r,t))?r:void 0),DL=new Set(["localhost","127.0.0.1","::1"]),LL=new Set(["0.0.0.0","::","0000:0000:0000:0000:0000:0000:0000:0000"]),Ou=n=>DL.has(n.toLowerCase()),Bv=n=>{try{return new wo.URL(n).hostname.replace(/^\[|\]$/g,"")}catch{return n}},jv=n=>LL.has(Bv(n)),Qs=zo(async n=>{let e=Bv(n);if(Ou(e))return!0;try{let t=await Ov.promises.lookup(e);return Ou(t.address)}catch{return!1}});EL=/^https:\/\/([a-z0-9\-]+)\+\.vscode-resource\.vscode-(?:webview|cdn)\.net\/(.+)/i,Nv="vscode-file://vscode-app/";zg=(n,e,t)=>{if(!t||n===":"){e.add(n);return}if(n==="/"){e.add(`\\${n}`);return}Fv(n)?e.add(`\\${n}`):e.add(n);let r=encodeURIComponent(n);n!=="\\"&&r!==n&&e.add(r)},_L=n=>{switch(n.size){case 0:return"";case 1:return Pn(n.values());default:let e=[...n];return e.some(t=>t.length>1)?`(?:${e.join("|")})`:`[${e.join("")}]`}},El=new Set;AL=n=>n.replace(/^(file:\\\/\\\/\\\/)?([a-z]):/i,(e,t="",r)=>`${t}[${r.toUpperCase()}${r.toLowerCase()}]:`);Jg=process.platform;Rn=(n,e=[])=>{let t=n.urlFilter||"file"in n&&n.file||n.url,r=t?ML(t,...e):void 0;return o=>!o.url.startsWith("devtools://")&&r?.(o.url)!==!1},Xs=n=>e=>e.type==="page"&&!e.url.startsWith("edge://force-signin")&&n(e);ML=(...n)=>{let e=o=>{o=o.toLowerCase();let i=We(o);i?o=i:FL(o)&&o.includes("://")&&(o=o.substr(o.indexOf("://")+3)),o.endsWith("/")&&(o=o.substr(0,o.length-1));let s=o.indexOf("#");return s!==-1&&(o=o.slice(0,o[s-1]==="/"?s-1:s)),o},t=n.map(o=>yt(e(o),"/*").replace(/(\/\*$)|\*/g,".*")),r=new RegExp("^("+t.join("|")+")$","g");return o=>(r.lastIndex=0,r.test(e(o)))}});var Tr,Ys,NL,Kg=m(()=>{"use strict";Tr=require("@jridgewell/trace-mapping");le();V();Ys=class n{constructor(e,t,r,o,i){this.original=e;this.metadata=t;this.actualRoot=r;this.actualSources=o;this.hasNames=i;this.sourceActualToOriginal=new Map;this.sourceOriginalToActual=new Map;this.id=n.idCounter++;if(o.length!==e.sources.length)throw new Error("Expected actualSources.length === original.source.length");for(let s=0;s<o.length;s++){let a=o[s],c=e.sources[s];a!==null&&c!==null&&(this.sourceActualToOriginal.set(a,c),this.sourceOriginalToActual.set(c,a))}}static{this.idCounter=0}get sources(){return this.actualSources.slice()}get sourceRoot(){return this.actualRoot}computedSourceUrl(e){return ee(Vu(vt(this.metadata.sourceMapUrl)?this.metadata.compiledPath:this.metadata.sourceMapUrl,this.sourceRoot+e))}originalPositionFor(e){let t=(0,Tr.originalPositionFor)(this.original,e);return t.source&&(t.source=this.sourceOriginalToActual.get(t.source)??t.source),t}generatedPositionFor(e){let t=this.sourceActualToOriginal.get(e.source)??e.source;if(!isFinite(e.line)){let r=e.bias||Tr.GREATEST_LOWER_BOUND;return this.getBestGeneratedForOriginal(t,(o,i)=>NL(o,i)*r)}return(0,Tr.generatedPositionFor)(this.original,{...e,source:t})}allGeneratedPositionsFor(e){return(0,Tr.allGeneratedPositionsFor)(this.original,{...e,source:this.sourceActualToOriginal.get(e.source)??e.source})}sourceContentFor(e){e=this.sourceActualToOriginal.get(e)??e;let t=this.original.sources.indexOf(e);return t===-1?null:this.original.sourcesContent?.[t]??null}eachMapping(e){(0,Tr.eachMapping)(this.original,e)}decodedMappings(){return(0,Tr.decodedMappings)(this.original)}names(){return this.original.names}getBestGeneratedForOriginal(e,t){let r;return this.eachMapping(o=>{o.source===e&&(!r||t(o,r)>0)&&(r=o)}),r?{column:r.generatedColumn,line:r.generatedLine}:{column:null,line:null}}},NL=({originalLine:n,originalColumn:e},{originalLine:t,originalColumn:r})=>(n||0)-(t||0)||(e||0)-(r||0)});async function $v(n,e,t,r){let o=Hu.Parser.parse(e,{locations:!0,ecmaVersion:"latest"}),i=new Dn.GenMapping({file:n}),s=(0,Qg.generate)(o,{sourceMap:{addMapping:a=>Dn.addSegment(i,a.original.line-1,a.original.column,n,a.generated.line-1,a.generated.column)}});return Dn.setSourceContent(i,n,s),new Ys(new qu.AnyMap(Dn.toDecodedMap(i)),{sourceMapUrl:r,compiledPath:t},"",[n],!1)}function qv(n){let e;try{e=ho(n)}catch{return}let t=(c,l)=>({type:"ExpressionStatement",expression:{type:"AssignmentExpression",operator:"=",left:c,right:l}}),r=!1,o=!1,i=Au(e,{enter(c,l){switch(c.type){case"ClassDeclaration":return{replace:t(c.id||{type:"Identifier",name:"_default"},{...c,type:"ClassExpression"})};case"FunctionDeclaration":return{replace:t(c.id||{type:"Identifier",name:"_default"},{...c,type:"FunctionExpression"})};case"FunctionExpression":case"ArrowFunctionExpression":case"MethodDefinition":return 1;case"AwaitExpression":r=!0;return;case"ForOfStatement":c.await&&(r=!0);return;case"ReturnStatement":o=!0;return;case"VariableDeclaration":if(!l||!("body"in l)||!(l.body instanceof Array))return;let p=l.body,u=c.declarations.map(g=>({type:"ExpressionStatement",expression:{type:"UnaryExpression",operator:"void",prefix:!0,argument:{type:"AssignmentExpression",operator:"=",left:g.id,right:g.init||{type:"Identifier",name:"undefined"}}}}));p.splice(p.indexOf(c),1,...u)}}});if(!r||o)return;let s=e.body[e.body.length-1];s.type==="ExpressionStatement"&&(e.body[e.body.length-1]={type:"ReturnStatement",argument:s.expression});let a={type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"ArrowFunctionExpression",params:[],generator:!1,expression:!1,async:!0,body:{type:"BlockStatement",body:i.body}},arguments:[],optional:!1}};return(0,Qg.generate)(a)}function Nl(n){try{let e=(0,Hu.parseExpressionAt)(n,0,Vg);return e.end<n.length||e.type!=="ObjectExpression"?n:`(${n})`}catch{return n}}function Zs(n){if(!n)return;let e="sourceMappingURL",t=n.length,r=e.length,o=t,i=0;for(;;){if(o=n.lastIndexOf(e,o),o===-1||o<4)return;if(o-=4,n[o]==="/"&&n[o+1]==="/"&&!(n[o+2]!=="#"&&n[o+2]!=="@")&&!(n[o+3]!==" "&&n[o+3]!=="	")&&(i=o+4+r,!(i<t&&n[i]!=="=")))break}let s=n.substring(i+1),a=s.indexOf(`
`);return a!==-1&&(s=s.substring(0,a)),s.trim()}function zu(n,e,t){let r=t.generatedPositionFor({source:n,line:e.lineNumber,column:e.columnNumber-1,bias:qu.GREATEST_LOWER_BOUND}),o=a=>{if(a.line===null||a.column===null)return 1e11;let c=t.originalPositionFor(a);return c.line!==null?Math.abs(e.lineNumber-c.line):1e11},i=o(r),s=t.allGeneratedPositionsFor({source:n,line:e.lineNumber,column:e.columnNumber-1}).filter(a=>a.line!==null&&a.column!==null).sort((a,c)=>a.line!==c.line?a.line-c.line:a.column-c.column).map(a=>[a,o(a)]);return s.push([r,i]),s.sort(([a,c],[l,p])=>c-p||a.line-l.line||a.column-l.column),s[0][0]}function Ln(n){try{new Function(n)}catch(e){return e}}function BL(n,e){let t=ho(n),r,o;return Sn(t,{enter:i=>{let s=i;e>=s.start&&e<s.end&&(i.type==="CallExpression"||i.type==="NewExpression"?o=i:r=i)}}),o||r}function Hv(n,e){try{let r=BL(n,e);if(r&&"callee"in r){let o=r.callee;return{text:`${n.slice(o.start,o.end)}(...)`,start:o.start,end:o.end}}else{let o=r;return{text:n.slice(o.start,o.end),start:o.start,end:o.end}}}catch{}Vv.lastIndex=e-1;let t=Vv.exec(n);if(t)return{text:t[0],start:e,end:e+t[0].length}}var Dn,qu,Hu,Qg,Xg,Vv,Mt=m(()=>{"use strict";Dn=y(require("@jridgewell/gen-mapping")),qu=require("@jridgewell/trace-mapping"),Hu=require("./vendor/acorn.js"),Qg=require("astring");Ri();Kg();Xg=(n,e)=>!!e&&((e.type==="FunctionExpression"||e.type==="FunctionDeclaration"||e.type==="ArrowFunctionExpression")&&e.params.includes(n)||(e.type==="ForInStatement"||e.type==="ForOfStatement")&&e.left===n||e.type==="VariableDeclarator"&&e.id===n||e.type==="AssignmentPattern"&&e.left===n||e.type==="CatchClause"&&e.param===n||"kind"in e&&e.kind==="init"&&e.value===n||e.type==="RestElement"&&e.argument===n||e.type==="AssignmentPattern"&&e.left===n);Vv=/^[^()]+/g});function Kv(n,e){if(!e)return n;let{lineNumber:t,columnNumber:r}=n;return e&&(t+=e.lineOffset,t<=1&&(r+=e.columnOffset)),{...n,lineNumber:t,columnNumber:r}}function Qv(n,e){if(!e)return n;let{lineNumber:t,columnNumber:r}=n;return e&&(t=Math.max(1,t-e.lineOffset),t<=1&&(r=Math.max(1,r-e.columnOffset))),{...n,lineNumber:t,columnNumber:r}}var zv,Gv,Jv,_i,Ol,Ge,Ju,Ot,Ai,Fi,Yg,Xv,Xo,Zr=m(()=>{"use strict";zv=y(require("@vscode/l10n")),Gv=require("path"),Jv=require("url");wv();Ti();U();le();$();Mt();Mt();V();_i=class{constructor(e,t,r,o,i,s,a,c){this.url=t;this.inlineScriptOffset=s;this.runtimeScriptOffset=a;this.contentHash=c;this._scripts=[];this.hasBeenAnnounced=!1;this.sourceReference=e.getSourceReference(t),this._contentGetter=B(o),this._container=e,this.absolutePath=r||"",this._fqname=this._fullyQualifiedName(),this._name=this._humanName(),this.setSourceMapUrl(i),this._existingAbsolutePath=this.checkContentHash(c)}get sendLazy(){return!this.url}checkContentHash(e){return bv(this.absolutePath,this.inlineScriptOffset||this.runtimeScriptOffset?void 0:e,this._container._fileContentOverridesForTest.get(this.absolutePath))}offsetScriptToSource(e){return this.runtimeScriptOffset?{...e,lineNumber:Math.max(1,e.lineNumber-this.runtimeScriptOffset.lineOffset),columnNumber:e.columnNumber-this.runtimeScriptOffset.columnOffset}:e}offsetSourceToScript(e){return this.runtimeScriptOffset?{...e,lineNumber:e.lineNumber+this.runtimeScriptOffset.lineOffset,columnNumber:e.columnNumber+this.runtimeScriptOffset.columnOffset}:e}async equalsDap(e){let t=await this._existingAbsolutePath;return t?!e.sourceReference&&t===e.path:e.sourceReference===this.sourceReference}setSourceMapUrl(e){if(!e){this.sourceMap=void 0;return}this.sourceMap={type:0,sourceByUrl:new Map,value:ye(),metadata:e}}addScript(e){this._scripts.push(e)}filterScripts(e){this._scripts=this._scripts.filter(e)}get scripts(){return this._scripts}get getSuggestedMimeType(){if(this.url.endsWith(".wat"))return"text/wat";if(!/\.[^/]+$/.test(this.url)||this.url.includes("?"))return"text/javascript"}async content(){let e=await this._contentGetter();return this.inlineScriptOffset?.lineOffset&&(e=`
`.repeat(this.inlineScriptOffset.lineOffset)+e),e}async prettyPrint(){if(!this._container)return;if(Ai(this)&&this.sourceMap.metadata.sourceMapUrl.endsWith("-pretty.map")){let c=this.sourceMap.value.settledValue;return c&&{map:c,source:[...this.sourceMap.sourceByUrl.values()][0]}}let e=await this.content();if(!e)return;let t=this.url||`eval://${this.sourceReference}.js`,r=t+"-pretty.map",i=t.split(/[\/\\]/).pop()+"-pretty.js",s=await $v(i,e,t,r);if(!s)return;this.setSourceMapUrl({compiledPath:this.absolutePath,sourceMapUrl:""}),this.sourceMap.value.resolve(s);let a=this;return await this._container._addSourceMapSources(a,s),{map:s,source:[...a.sourceMap.sourceByUrl.values()][0]}}async toDap(){let e=await this._existingAbsolutePath,t={name:this._name,path:this._fqname,sourceReference:this.sourceReference,presentationHint:this.blackboxed()?"deemphasize":void 0,origin:this.blackboxed()?zv.t("Skipped by skipFiles"):void 0};return e&&(t.sourceReference=0,t.path=e),this.hasBeenAnnounced||(this.hasBeenAnnounced=!0,this._container.emitLoadedSource(this)),t}existingAbsolutePath(){return this._existingAbsolutePath}async prettyName(){let e=await this._existingAbsolutePath;return e||this._fqname}_humanName(){if(Tt(this._fqname)){for(let e of this._container.rootPaths)if(Cu(e,this._fqname))return G((0,Gv.relative)(e,this._fqname))}return this._fqname}_fullyQualifiedName(){if(!this.url)return"<eval>/VM"+this.sourceReference;if(this.url.endsWith(".repl"))return"repl";if(this.url.startsWith(Kr))return Qr+"/"+this.url.slice(Kr.length);if(this.absolutePath.startsWith(Qr))return this.absolutePath;if(Tt(this.url))return this.url;let e=We(this.url);if(e)return e;let t=this.url;try{let r=[],o=new Jv.URL(this.url);if(o.protocol==="data:")return"<eval>/VM"+this.sourceReference;o.hostname&&r.push(o.hostname),o.port&&r.push("\uA789"+o.port),o.pathname&&r.push(/^\/[a-z]:/.test(o.pathname)?o.pathname.slice(1):o.pathname);let i=o.searchParams?.toString();i&&r.push("?"+i),t=r.join("")}catch{}return t.endsWith("/")&&(t+="(index)"),this.inlineScriptOffset&&(t+=`\uA789${this.inlineScriptOffset.lineOffset+1}:${this.inlineScriptOffset.columnOffset+1}`),t}blackboxed(){return this._container.isSourceSkipped(this.url)}};(r=>{async function n(o){return o.value.promise}r.waitForValue=n;function e(o,i){return o.type===0&&o.value.settledValue?Promise.resolve(o.value.settledValue):Promise.race([n(o),x(i)])}r.waitForValueWithTimeout=e;async function t(o){return await n(o),o.sourceByUrl}r.waitForSources=t})(Ol||={});Ge=class extends _i{constructor(){super(...arguments);this.compiledToSourceUrl=new Map}},Ju=class extends _i{constructor(t,r,o){super(t,r.url,o,()=>Promise.resolve("Binary content not shown, see the decompiled WAT file"),void 0,void 0,void 0,void 0);this.event=r;this.sourceMap={type:1,value:ye(),sourceByUrl:new Map}}checkContentHash(){return Promise.resolve(void 0)}offsetScriptToSource(t){return t}offsetSourceToScript(t){return t}},Ot=n=>!!n&&n instanceof _i&&!!n.sourceMap,Ai=n=>Ot(n)&&n.sourceMap.type===0,Fi=n=>Ot(n)&&n.sourceMap.type===1,Yg=n=>!!n&&typeof n.getDisassembly=="function";Xv=n=>({lineNumber:n.lineNumber+1,columnNumber:n.columnNumber+1}),Xo=n=>({lineNumber:n.lineNumber-1,columnNumber:n.columnNumber-1})});var Zg,En,jL,UL,ZF,WL,_n,Ku,Ce,qt,Ht,eh,An,W=m(()=>{"use strict";Zg=new Map([["pwa-node","node"],["pwa-chrome","chrome"],["pwa-extensionHost","extensionHost"],["pwa-msedge","msedge"]]),En=n=>Zg.get(n)||n,jL={"pwa-extensionHost":null,"node-terminal":null,"pwa-node":null,"pwa-chrome":null,"pwa-msedge":null},UL={"extension.js-debug.addCustomBreakpoints":null,"extension.js-debug.addXHRBreakpoints":null,"extension.js-debug.editXHRBreakpoints":null,"extension.pwa-node-debug.attachNodeProcess":null,"extension.js-debug.clearAutoAttachVariables":null,"extension.js-debug.setAutoAttachVariables":null,"extension.js-debug.autoAttachToProcess":null,"extension.js-debug.createDebuggerTerminal":null,"extension.js-debug.createDiagnostics":null,"extension.js-debug.getDiagnosticLogs":null,"extension.js-debug.debugLink":null,"extension.js-debug.npmScript":null,"extension.js-debug.pickNodeProcess":null,"extension.js-debug.prettyPrint":null,"extension.js-debug.removeXHRBreakpoint":null,"extension.js-debug.removeAllCustomBreakpoints":null,"extension.js-debug.revealPage":null,"extension.js-debug.startProfile":null,"extension.js-debug.stopProfile":null,"extension.js-debug.toggleSkippingFile":null,"extension.node-debug.startWithStopOnEntry":null,"extension.js-debug.requestCDPProxy":null,"extension.js-debug.openEdgeDevTools":null,"extension.js-debug.callers.add":null,"extension.js-debug.callers.goToCaller":null,"extension.js-debug.callers.gotToTarget":null,"extension.js-debug.callers.remove":null,"extension.js-debug.callers.removeAll":null,"extension.js-debug.enableSourceMapStepping":null,"extension.js-debug.disableSourceMapStepping":null,"extension.js-debug.network.viewRequest":null,"extension.js-debug.network.copyUri":null,"extension.js-debug.network.openBody":null,"extension.js-debug.network.openBodyInHex":null,"extension.js-debug.network.replayXHR":null,"extension.js-debug.network.clear":null,"extension.js-debug.completion.nodeTool":null},ZF=new Set(Object.keys(UL)),WL=new Set(Object.keys(jL)),_n=n=>WL.has(n),Ku="jsDebugNetworkFs",Ce=(n,e,t)=>n.registerCommand(e,t),qt=async(n,e,...t)=>await n.executeCommand(e,...t),Ht=(n,e,t)=>n.getConfiguration(void 0,t).get(e),eh=(n,e,t,r)=>n.getConfiguration().update(e,t,r),An=async(n,e,t)=>await n.executeCommand("setContext",e,t)});function Yo(n){return{"webpack:///./~/*":`${n}/node_modules/*`,"webpack:////*":"/*","webpack://@?:*/?:*/*":`${n}/*`,"webpack://?:*/*":`${n}/*`,"webpack:///([a-z]):/(.+)":"$1:/$2","meteor://\u{1F4BB}app/*":`${n}/*`,"turbopack://[project]/*":"${workspaceFolder}/*","turbopack:///[project]/*":"${workspaceFolder}/*"}}function oh({...n}){return Xu(n),n.request==="attach"?{...Fn,...n}:{...Ul,...n}}function $L(n,e){return n.request==="attach"?{...Wl,browserAttachLocation:e,...n}:{...ea,browserLaunchLocation:e,...n}}function qL(n,e){return n.request==="attach"?{...th,browserAttachLocation:e,...n}:{...rh,browserLaunchLocation:e,...n}}function HL(n){let e={...jl,...n};return e.skipFiles=[...e.skipFiles,"**/node_modules.asar/**","**/bootstrap-fork.js"],e}function nh(n){return Xu(n),n.request==="launch"?{...Zv,...n}:{...VL,...n}}function ta(n,e){let t,r=e==="remote"?"ui":"workspace";switch(n.type){case"pwa-node":t=oh(n);break;case"pwa-msedge":t=qL(n,r);break;case"pwa-chrome":t=$L(n,r);break;case"pwa-extensionHost":t=HL(n);break;case"node-terminal":t=nh(n);break;default:throw Ws(n,"Unknown config: {value}")}return sh(t)}function ih(n){let e="${workspaceFolder}",t={...n,rootPath:void 0,outFiles:n.outFiles.filter(r=>!r.includes(e)),sourceMapPathOverrides:yu(n.sourceMapPathOverrides,r=>!r.includes("${workspaceFolder}"))};return"vueComponentPaths"in t&&(t.vueComponentPaths=t.vueComponentPaths.filter(r=>!r.includes(e))),"resolveSourceMapLocations"in t&&(t.resolveSourceMapLocations=t.resolveSourceMapLocations?.filter(r=>!r.includes(e))??null),"cwd"in t&&t.cwd?.includes(e)&&(t.cwd=t.request==="launch"&&t.type==="pwa-node"?(0,Yv.homedir)():void 0),"webRoot"in t&&t.webRoot?.includes(e)&&(t.webRoot="/"),t}function sh(n){return n.__workspaceFolder||(n=ih(n)),n=yo(n,"workspaceFolder",n.__workspaceFolder),n=yo(n,"webRoot","webRoot"in n?n.webRoot:n.__workspaceFolder),n}function yo(n,e,t){let r;if(typeof n=="string")r=n.replace(new RegExp(`\\$\\{${e}\\}`,"g"),()=>{if(!t)throw new Error(`Unable to resolve \${${e}} in configuration (${JSON.stringify(e)})`);return t});else if(n instanceof Array)r=n.map(o=>yo(o,e,t));else if(typeof n=="object"&&n){let o={};for(let[i,s]of Object.entries(n))o[yo(i,e,t)]=yo(s,e,t);r=o}else r=n;return r}var Yv,re,Qu,Bl,Zv,VL,jl,Ul,Wl,th,ea,rh,Fn,Xu,Yu,Zu,Mi,zL,ed,nM,J=m(()=>{"use strict";Yv=require("os");W();Ti();U();re=Symbol("AnyLaunchConfiguration"),Qu={type:"",name:"",request:"",trace:!1,outputCapture:"console",timeout:1e4,timeouts:{},showAsyncStacks:!0,skipFiles:[],smartStep:!0,sourceMaps:!0,sourceMapRenames:!0,pauseForSourceMap:!0,resolveSourceMapLocations:null,rootPath:"${workspaceFolder}",outFiles:["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"],sourceMapPathOverrides:Yo("${workspaceFolder}"),enableContentValidation:!0,cascadeTerminateToConfigurations:[],enableDWARF:!0,__workspaceFolder:"",__remoteFilePrefix:void 0,__breakOnConditionalError:!1,customDescriptionGenerator:void 0,customPropertiesGenerator:void 0},Bl={...Qu,cwd:"${workspaceFolder}",env:{},envFile:null,pauseForSourceMap:!1,sourceMaps:!0,localRoot:null,remoteRoot:null,resolveSourceMapLocations:["**","!**/node_modules/**"],autoAttachChildProcesses:!0,runtimeSourcemapPausePatterns:[],skipFiles:[`${Qr}/**`]},Zv={...Bl,showAsyncStacks:{onceBreakpointResolved:16},type:"node-terminal",request:"launch",name:"JavaScript Debug Terminal"},VL={...Bl,type:"node-terminal",request:"attach",name:Zv.name,showAsyncStacks:{onceBreakpointResolved:16},delegateId:-1},jl={...Bl,type:"pwa-extensionHost",name:"Debug Extension",request:"launch",args:["--extensionDevelopmentPath=${workspaceFolder}"],outFiles:["${workspaceFolder}/out/**/*.js"],resolveSourceMapLocations:["${workspaceFolder}/**","!**/node_modules/**"],rendererDebugOptions:{},runtimeExecutable:"${execPath}",autoAttachChildProcesses:!1,debugWebviews:!1,debugWebWorkerHost:!1,__sessionId:""},Ul={...Bl,type:"pwa-node",request:"launch",program:"",cwd:"${workspaceFolder}",stopOnEntry:!1,console:"internalConsole",restart:!1,args:[],runtimeExecutable:"node",runtimeVersion:"default",runtimeArgs:[],profileStartup:!1,attachSimplePort:null,experimentalNetworking:"auto",killBehavior:"forceful"},Wl={...Qu,type:"pwa-chrome",request:"attach",address:"localhost",port:0,disableNetworkCache:!0,pathMapping:{},url:null,restart:!1,urlFilter:"",sourceMapPathOverrides:Yo("${webRoot}"),webRoot:"${workspaceFolder}",server:null,browserAttachLocation:"workspace",targetSelection:"automatic",vueComponentPaths:["${workspaceFolder}/**/*.vue","!**/node_modules/**"],perScriptSourcemaps:"auto"},th={...Wl,type:"pwa-msedge",useWebView:!1},ea={...Wl,type:"pwa-chrome",request:"launch",cwd:null,file:null,env:{},urlFilter:"*",includeDefaultArgs:!0,includeLaunchArgs:!0,runtimeArgs:null,runtimeExecutable:"*",userDataDir:!0,browserLaunchLocation:"workspace",profileStartup:!1,cleanUp:"wholeBrowser",killBehavior:"forceful"},rh={...ea,type:"pwa-msedge",useWebView:!1},Fn={...Bl,type:"pwa-node",attachExistingChildren:!0,address:"localhost",port:9229,restart:!1,request:"attach",continueOnAttach:!1};Xu=n=>{!n.sourceMapPathOverrides&&n.cwd&&(n.sourceMapPathOverrides=Yo(n.cwd)),n.resolveSourceMapLocations===void 0&&(n.resolveSourceMapLocations=n.outFiles)};Yu=["javascript","typescript","typescriptreact","javascriptreact","fsharp","html","wat","c","cpp","rust","zig"],Zu="js-debug",Mi="1.105.0",zL="ms-vscode",ed=Zu.includes("nightly"),nM=`${zL}.${Zu}`});function ah(n){let e=ho(n),t=[],r=(s,{loc:a}=s,{loc:c}=s)=>{if(!a||!c)throw new Error("should include locations");t.push({start:a.start,end:c.end,depth:i.length}),i.push(s)},o=new Set,i=[];return Sn(e,{enter:s=>{switch(s.type){case"FunctionDeclaration":case"ArrowFunctionExpression":r(s,s.params[0]||s.body,s.body),o.add(s.body);break;case"Program":r(s);break;case"ForStatement":case"ForOfStatement":case"ForInStatement":r(s),o.add(s.body);break;case"BlockStatement":o.has(s)||r(s);break}},leave:s=>{s===i[i.length-1]&&i.pop()}}),t}var ra,eI=m(()=>{"use strict";ra=require("worker_threads");Ri();ra.isMainThread||ra.parentPort?.postMessage(ah(ra.workerData))});function rI(n,e){return n.length<GL?oa.hydrate(ah(n),e):new Promise((t,r)=>{let o=new tI.Worker(`${__dirname}/renameWorker.js`,{workerData:n});o.on("message",i=>t(oa.hydrate(i,e))),o.on("error",r),o.on("exit",()=>r("rename worker exited"))})}var tI,oa,GL,ch=m(()=>{"use strict";tI=require("worker_threads");Pr();eI();oa=class n{constructor(e){this.range=e}static hydrate(e,t){let r=new n(new Pt(new $t(e[0].start.line,e[0].start.column),new $t(e[0].end.line,e[0].end.column))),o=[r],i=1;for(let s=1;s<e.length;s++){let a=e[s];for(;a.depth<i;)i--,o[i].data=t(o[i]);let c=new n(new Pt(new $t(a.start.line,a.start.column),new $t(a.end.line,a.end.column))),l=o[i-1];l.children??=[],l.children.push(c),o[i++]=c}for(let s=i-1;s>=0;s--)o[s].data=t(o[s]);return r}search(e){if(this.range.contains(e)){if(!this.children)return this;for(let t of this.children){let r=t.search(e);if(r)return r}return this}}findDeepest(e,t){if(this.range.contains(e)){if(this.children)for(let r of this.children){let o=r.findDeepest(e,t);if(o!==void 0)return o}return t(this)}}filterHoist(e){if(this.children)for(let t=0;t<this.children.length;t++){let r=this.children[t];if(r.filterHoist(e),!e(r)){let o=r.children||[];this.children.splice(t,1,...o),t--}}}forEach(e){e(this),this.children?.forEach(t=>t.forEach(e))}forEachDepthFirst(e){this.children?.forEach(t=>t.forEach(e)),e(this)}toJSON(){return{range:this.range,children:this.children}}},GL=1024*512});var oI,nI,iI=m(()=>{"use strict";Pr();Yr();ch();oI=/[$a-z_][$0-9A-Z_$]*/iy,nI=async(n,e)=>{let t=new Cn(n),r=new Set,o=e.decodedMappings(),i=e.names(),s=(l,p,u)=>{let g=l*2147483647+p;if(r.has(g))return;r.add(g);let w=new Ae(l,p),I=t.convert(w);oI.lastIndex=I;let v=oI.exec(n);if(!v)return;let A=v[0];if(A!==u)return A},c=await rI(n,l=>{let p=l.range.begin.base0,u=l.range.end.base0,g;for(let w=p.lineNumber;w<=u.lineNumber;w++){let I=o[w];if(I)for(let v=0;v<I.length;v++){let A=I[v];if(A.length<=4)continue;let z=w,De=A[0];if(z===p.lineNumber&&p.columnNumber>De||z===u.lineNumber&&u.columnNumber<De)continue;let R=i[A[4]],Z=s(z,De,R);Z&&(g??=[],g.some(M=>M.compiled==Z)||g.push({compiled:Z,original:R}))}}return g});return c.filterHoist(l=>!!l.data),c}});var td,Ni,Vl=m(()=>{"use strict";td=class extends Error{constructor(t,r,o){super(`Unexpected ${t} response from ${r}: ${o??"<empty body>"}`);this.statusCode=t;this.url=r;this.body=o}},Ni=Symbol("IResourceProvider")});var k,ge=m(()=>{"use strict";k=class extends Error{get cause(){return this._cause}constructor(e){super("__errorMarker"in e?e.error.format:e.format),this._cause="__errorMarker"in e?e.error:e}}});function sI(n,e){n.output({category:"console",output:e+`
`})}function he(n,e=9222){return{__errorMarker:!0,error:{id:e,format:n,showUser:!1}}}function be(n,e=9223){return{__errorMarker:!0,error:{id:e,format:n,showUser:!0}}}var Pe,lh,aI,cI,ph,lI,pI,uI,uh,dI,dh,na,mI,fI,rd,mh,$l,od,gI,Mn,fh,nd,hI,bI,wI,ql,yI,vI,II,SI,Ie=m(()=>{"use strict";Pe=y(require("@vscode/l10n"));ge();lh=()=>be(Pe.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvs', 'nvm' or 'fnm' to be installed."),9224),aI=()=>be(Pe.t("Attribute 'runtimeVersion' with a flavor/architecture requires 'nvs' to be installed."),9225),cI=()=>be(Pe.t("Attribute 'runtimeVersion' requires Node.js version manager 'nvm-windows' or 'nvs'."),9226),ph=(n,e)=>be(Pe.t("Node.js version '{0}' not installed using version manager {1}.",n,e),9226),lI=n=>be(Pe.t("Cannot launch debug target in terminal ({0}).",n),9227),pI=n=>be(Pe.t("Can't load environment variables from file ({0}).",n),9228),uI=n=>be(Pe.t("The configured `cwd` {0} does not exist.",n),9245),uh=(n,e)=>be(Pe.t(`Can't find Node.js binary "{0}": {1}. Make sure Node.js is installed and in your PATH, or set the "runtimeExecutable" in your launch.json`,n,e),9229),dI=(n,e)=>be(Pe.t('The Node version in "{0}" is outdated (version {1}), we require at least Node 8.x.',e,n),9230),dh=n=>be(Pe.t('Invalid hit condition "{0}". Expected an expression like "> 42" or "== 2".',n),9231),na=()=>be(Pe.t("An error occurred taking a profile from the target."),9235),mI=()=>be(Pe.t("Please stop the running profile before starting a new one."),9236),fI=n=>he(n,9238),rd=(n,e,t)=>be(e==="*"&&!t.length?Pe.t('Unable to find an installation of the browser on your system. Try installing it, or providing an absolute path to the browser in the "runtimeExecutable" in your launch.json.'):Pe.t('Unable to find {0} version {1}. Available auto-discovered versions are: {2}. You can set the "runtimeExecutable" in your launch.json to one of these, or provide an absolute path to the browser executable.',n,e,JSON.stringify([...new Set(t)])),9233),mh=n=>be(Pe.t('Unable to launch browser: "{0}"',n.message),9240),$l=n=>be(n??Pe.t("Unable to attach to browser"),9242),od=()=>be(Pe.t('Target page not found. You may need to update your "urlFilter" to match the page you want to debug.'),9241),gI=()=>he(Pe.t("Variables not available in async stacks"),9234),Mn=(n,e)=>be(Pe.t("Syntax error setting breakpoint with condition {0} on line {1}: {2}",JSON.stringify(n.condition),n.line,e),9237),fh=()=>he(Pe.t("Thread not found"),9244),nd=(n,e)=>be(Pe.t("Could not read source map for {0}: {1}",n,e)),hI=()=>be(Pe.t("UWP webview debugging is not available on your platform.")),bI=()=>be(Pe.t("Networking not available.")),wI=()=>be(Pe.t("Could not connect to any UWP Webview pipe. Make sure your webview is hosted in debug mode, and that the `pipeName` in your `launch.json` is correct.")),ql=()=>be(Pe.t("Could not find a location for the variable")),yI=()=>he(Pe.t('Missing source information. Did you set "originalUrl" or "source"?')),vI=n=>typeof n=="object"&&!!n&&"__errorMarker"in n,II=(n,e)=>n instanceof k&&n.cause.id===e,SI=n=>be(Pe.t("The browser process exited with code {0} before connecting to the debug server. Make sure the `runtimeExecutable` is configured correctly and that it can run without errors.",n))});var kI,PI=m(()=>{"use strict";kI=new WeakSet});var JL,KL,zt,sa,ia,eo=m(()=>{"use strict";O();$();Ie();PI();ge();JL="Request",KL=n=>n.endsWith("Request"),zt=Symbol("IDapApi"),sa=Symbol("IRootDapApi"),ia=class{constructor(e,t){this.transport=e;this.logger=t;this._pendingRequests=new Map;this._requestHandlers=new Map;this._eventListeners=new Map;this.disposables=[];this._initialized=ye();this.closed=!1;this._sequence=1,this.disposables.push(this.transport.messageReceived(r=>this._onMessage(r.message,r.receivedTime))),this._dap=this._createApi()}get initializedBlocker(){return this._initialized.promise}attachTelemetry(e){this.telemetryReporter=e,e.attachDap(this._dap)}dap(){return this._dap}_createApi(){return new Proxy({},{get:(e,t)=>{if(t!=="then")return t==="on"?(r,o)=>(this._requestHandlers.set(r,o),()=>this._requestHandlers.delete(r)):t==="off"?r=>this._requestHandlers.delete(r):r=>{if(KL(t))return this.enqueueRequest(t.slice(0,-JL.length),r);this._send({seq:0,type:"event",event:t,body:r})}}})}createTestApi(){let e=(o,i)=>{let s=this._eventListeners.get(o);s||(s=new Set,this._eventListeners.set(o,s)),s.add(i)},t=(o,i)=>{let s=this._eventListeners.get(o);s&&s.delete(i)},r=(o,i)=>new Promise(s=>{let a=c=>{i&&!i(c)||(t(o,a),s(c))};e(o,a)});return new Proxy({},{get:(o,i)=>i==="on"?e:i==="off"?t:i==="once"?r:s=>this.enqueueRequest(i,s)})}enqueueRequest(e,t){return new Promise(r=>{let o={seq:0,type:"request",command:e,arguments:t||{}};this._send(o),this._pendingRequests.set(o.seq,r)})}stop(){this.closed=!0,this.transport.close()}_send(e,t){if(this.closed)this.logger.warn("dap.send","Not sending message because the connection has ended",e),t?.();else{e.seq=this._sequence++;let r=e.type!=="event"||!kI.has(e.body);this.transport.send(e,r,t)}}async _onMessage(e,t){if(e.type==="request"){let r={seq:0,type:"response",request_seq:e.seq,command:e.command,success:!0};try{let o=this._requestHandlers.get(e.command);if(!o)console.error(`Unknown request: ${e.command}`);else{let i=await o(e.arguments);if(vI(i))this._send({...r,success:!1,message:i.error.format,body:{error:i.error}});else{let s={...r,body:i};r.command==="initialize"?(this._send(s),this._initialized.resolve(this)):r.command==="disconnect"?this._send({...r,body:i},()=>{this.stop()}):this._send(s)}}this.telemetryReporter?.reportOperation("dapOperation",e.command,t.elapsed().ms)}catch(o){o instanceof k?this._send({...r,success:!1,body:{error:o.cause}}):(console.error(o),this._send({...r,success:!1,body:{error:{id:9221,format:`Error processing ${e.command}: ${o.stack||o.message}`,showUser:!1,sendTelemetry:!1}}})),this.telemetryReporter?.reportOperation("dapOperation",e.command,t.elapsed().ms,o)}}if(e.type==="event"){let r=this._eventListeners.get(e.event)||new Set;for(let o of r)o(e.body)}if(e.type==="response"){let r=this._pendingRequests.get(e.request_seq);if(!this.logger.assert(r,`Expected callback for request sequence ID ${e.request_seq}`))return;if(this._pendingRequests.delete(e.request_seq),e.success)r(e.body);else{let o=e.body?.error?.format;r(o||e.message||"Unknown error")}}}}});var Te,Gt=m(()=>{"use strict";Te=Symbol("ISourcePathResolver")});var xI,vo,Io,gh,Oi,Hl,Nn,zl=m(()=>{"use strict";xI=require("@jridgewell/trace-mapping"),vo=require("inversify");Vl();eo();Ie();zs();O();U();Gt();V();Kg();Io=Symbol("ISourceMapFactory"),gh=Symbol("IRootSourceMapFactory"),Oi=class{constructor(e,t){this.root=e;this.resourceProvider=t}load(e){return this.root.load(this.resourceProvider,e)}guardSourceMapFn(e,t,r){return this.root.guardSourceMapFn(e,t,r)}};Oi=h([(0,vo.injectable)(),d(0,(0,vo.inject)(gh)),d(1,(0,vo.inject)(Ni))],Oi);Hl=class{constructor(e,t,r){this.pathResolve=e;this.dap=t;this.logger=r;this.hasWarnedAboutMaps=new WeakSet}async load(e,t){let r=await this.parseSourceMap(e,t.sourceMapUrl),o;"sourceRoot"in r&&(o=r.sourceRoot,r.sourceRoot=void 0);let i=!1,s=[];if("sections"in r){s=[];let a=0;for(let c of r.sections){let l=c.map;s.push(...l.sources),l.sources=l.sources.map(()=>`source${a++}.js`),i||=!!l.names?.length}}else"sources"in r&&Array.isArray(r.sources)&&(s=r.sources,r.sources=r.sources.map((a,c)=>`source${c}.js`),i=!!r.names?.length);return new Ys(new xI.AnyMap(r),t,o??"",s,i)}async parseSourceMap(e,t){let r;try{r=await this.parseSourceMapDirect(e,t)}catch(o){if(r=await this.parsePathMappedSourceMap(e,t),!r)throw o}if("sections"in r){let o=await Promise.all(r.sections.map((i,s)=>"url"in i?this.parseSourceMap(e,i.url).then(a=>({offset:i.offset,map:a})).catch(a=>{this.logger.warn("sourcemap.parsing",`Error parsing nested map ${s}: ${a}`)}):i));r.sections=o.filter(Me)}return r}async parsePathMappedSourceMap(e,t){if(vt(t))return;let r=await this.pathResolve.urlToAbsolutePath({url:t});if(r)try{return this.parseSourceMapDirect(e,r)}catch(o){this.logger.info("sourcemap.parsing","Parsing path mapped source map failed.",o)}}guardSourceMapFn(e,t,r){try{return t()}catch(o){if(!/error parsing/i.test(String(o.message)))throw o;if(!this.hasWarnedAboutMaps.has(e)){let i=nd(e.metadata.compiledPath,o.message).error;this.dap.output({output:i.format+`
`,category:"stderr"}),this.hasWarnedAboutMaps.add(e)}return r()}}dispose(){}async parseSourceMapDirect(e,t){let r=We(t);r&&(r=this.pathResolve.rebaseRemoteToLocal(r));let o=await e.fetch(r||t);if(!o.ok)throw o.error;let i=o.body;return i.slice(0,3)===")]}"&&(i=i.substring(i.indexOf(`
`))),JSON.parse(i)}};Hl=h([(0,vo.injectable)(),d(0,(0,vo.inject)(Te)),d(1,(0,vo.inject)(sa)),d(2,(0,vo.inject)(L))],Hl);Nn=class extends Hl{constructor(){super(...arguments);this.knownMaps=new Ct(t=>t.toLowerCase())}load(t,r){let o=this.knownMaps.get(r.sourceMapUrl);if(!o)return this.loadNewSourceMap(t,r);let i=r.cacheKey,s=o.metadata.cacheKey;return o.reloadIfNoMtime?i&&s&&i===s?(o.reloadIfNoMtime=!1,o.prom):this.loadNewSourceMap(t,r):s&&i&&i!==s?this.loadNewSourceMap(t,r):o.prom}loadNewSourceMap(t,r){let o=super.load(t,r);return this.knownMaps.set(r.sourceMapUrl,{metadata:r,reloadIfNoMtime:!1,prom:o}),o}dispose(){this.knownMaps.clear()}invalidateCache(){for(let t of this.knownMaps.values())t.reloadIfNoMtime=!0}};Nn=h([(0,vo.injectable)()],Nn)});var ca,On,aa,Rr,Gl=m(()=>{"use strict";ca=require("inversify");Zr();J();xn();O();Pr();iI();ch();zl();On=Symbol("IRenameProvider"),aa=class{constructor(e,t,r){this.logger=e;this.sourceMapFactory=t;this.launchConfig=r;this.renames=new Map}provideOnStackframe(e){if(!this.launchConfig.sourceMapRenames)return Rr.None;let t=e.uiLocation();return t===void 0?Rr.None:"then"in t?t.then(r=>this.provideForSource(r?.source)):this.provideForSource(t?.source)}provideForSource(e){if(!this.launchConfig.sourceMapRenames||!(e instanceof Ge))return Rr.None;let t=Pn(e.compiledToSourceUrl.keys());if(!t)throw new Error("unreachable");if(!Ai(t))return Rr.None;let r=this.renames.get(t.url);if(r)return r;let o=this.sourceMapFactory.load(t.sourceMap.metadata).then(async i=>{if(!i?.hasNames)return Rr.None;let s=await t.content();return s?await this.createFromSourceMap(i,s):Rr.None}).catch(()=>Rr.None);return this.renames.set(t.url,o),o}async createFromSourceMap(e,t){let r=Date.now(),o;try{o=await nI(t,e)}catch(s){return this.logger.info("runtime",`Error parsing content for source tree: ${s}}`,{url:e.metadata.compiledPath}),Rr.None}let i=Date.now();return this.logger.info("runtime",`renames calculated in ${i-r}ms`,{url:e.metadata.compiledPath}),new Rr(o)}};aa=h([(0,ca.injectable)(),d(0,(0,ca.inject)(L)),d(1,(0,ca.inject)(Io)),d(2,(0,ca.inject)(re))],aa);Rr=class n{constructor(e){this.renames=e}static{this.None=new n(new oa(Pt.ZERO))}getOriginalName(e,t){return this.getClosestRename(t,r=>r.compiled===e)?.original}getCompiledName(e,t){return this.getClosestRename(t,r=>r.original===e)?.compiled}getClosestRename(e,t){return this.renames.findDeepest(e,r=>r.data?.find(t))}}});var la,So,Jt,Kt,Bi,Oe,hh,bh,oe,to,ji,tN,ad,sd,Se,cd,Qt,pa,X=m(()=>{"use strict";la=Symbol("IContainer"),So=Symbol("StoragePath"),Jt=Symbol("IInitializeParams"),Kt=Symbol("VSCodeApi"),Bi=Symbol("IsVSCode"),Oe=Symbol("ExtensionContext"),hh=Symbol("ProcessEnv"),bh=Symbol("execa"),oe=Symbol("FS"),to="ExtensionLocation",ji=Symbol("IBrowserFinder"),tN=Symbol("DwarfDebugging"),ad=Symbol("SessionSubStates"),sd=new WeakMap,Se=(n,e)=>{if(!(typeof e=="object"&&e&&"dispose"in e))return e;let t=e,r=sd.get(n.container);return r?r.push(t):sd.set(n.container,[t]),e},cd=n=>{sd.get(n)?.forEach(e=>e.dispose()),sd.delete(n)},Qt=Symbol("IExtensionContribution"),pa=Symbol("IDebugTerminalOptionsProviders")});var lt,ua=m(()=>{"use strict";lt=Symbol("ITelemetryReporter")});var CI,Bn,da,Jl=m(()=>{"use strict";CI=require("inversify");st();Bn=Symbol("IShutdownParticipants"),da=class{constructor(){this.participants=[]}register(e,t){if(this.shutdownStage!==void 0&&this.shutdownStage>=e)return t(!0),bn;for(;this.participants.length<=e;)this.participants.push(new Set);return this.participants[e].add(t),{dispose:()=>this.participants[e].delete(t)}}async shutdownContext(){(this.shutdownStage===void 0||this.shutdownStage<0)&&await Promise.all([...this.participants[0]].map(e=>e(!1)))}async shutdownAll(){for(this.shutdownStage=0;this.shutdownStage<this.participants.length;this.shutdownStage++)await Promise.all([...this.participants[this.shutdownStage]].map(e=>e(!0)))}};da=h([(0,CI.injectable)()],da)});var ld,pd,TI=m(()=>{"use strict";ld=class{constructor(e=!1,t=!1){this.verified=e;this.hit=t}},pd=class{constructor(){this._statisticsById=new Map}registerBreakpoints(e){e.forEach(t=>{t.id!==void 0&&!this._statisticsById.has(t.id)&&this._statisticsById.set(t.id,new ld(t.verified,!1))})}registerResolvedBreakpoint(e){this.getStatistics(e).verified=!0}registerBreakpointHit(e){this.getStatistics(e).hit=!0}getStatistics(e){let t=this._statisticsById.get(e);if(t!==void 0)return t;{let r=new ld;return this._statisticsById.set(e,r),r}}statistics(){let e=0,t=0,r=0;for(let o of this._statisticsById.values())e++,o.hit&&r++,o.verified&&t++;return{set:e,verified:t,hit:r}}}});var ud,wh=m(()=>{"use strict";O();ud=async(n,e,t,r={})=>{let o=Date.now();try{return await t()}finally{n.verbose("perf.function","",{method:e,duration:Date.now()-o,...r})}}});var Ui,Kl,cr,ko,Zo,ma=m(()=>{"use strict";Ui=require("inversify"),Kl=y(require("path"));J();le();cr=class{get empty(){return this.patterns.length===0}constructor({rootPath:e,patterns:t}){!e||!t?(this.rootPath="",this.patterns=[]):(this.rootPath=e,this.patterns=t.map(r=>{let o=r.startsWith("!");return{negated:o,pattern:r.slice(o?1:0)}}))}*explode(){for(let e=0;e<this.patterns.length;e++){let{negated:t,pattern:r}=this.patterns[e];if(t)continue;let o=Kl.resolve(this.rootPath,r).split(/[\\/]/g),i=o.findIndex(c=>c.includes("*"));if(i===-1){yield{cwd:o.slice(0,-1).join("/"),pattern:o[o.length-1],negations:[]};continue}let s=o.slice(0,i).join("/"),a=[];for(let c=e+1;c<this.patterns.length;c++){let{negated:l,pattern:p}=this.patterns[c];if(l)if(p.startsWith("**"))a.push(G(p));else{let u=Kl.relative(s,Kl.resolve(this.rootPath,p));u.startsWith("..")||a.push(G(u))}}yield{cwd:s,negations:a,pattern:o.slice(i).join("/")}}}};cr=h([(0,Ui.injectable)()],cr);ko=class extends cr{constructor({rootPath:e,outFiles:t}){super({rootPath:e,patterns:t})}};ko=h([(0,Ui.injectable)(),d(0,(0,Ui.inject)(re))],ko);Zo=class extends cr{constructor(e){super({rootPath:e.rootPath,patterns:"vueComponentPaths"in e?e.vueComponentPaths:[]})}};Zo=h([(0,Ui.injectable)(),d(0,(0,Ui.inject)(re))],Zo)});var RI,fa,yN,DI,Ql=m(()=>{"use strict";RI=require("path");de();Mt();V();fa=Symbol("ISearchStrategy"),yN=Symbol("ISearchStrategyFallback"),DI=async(n,e,t)=>{let r,i=`${(0,RI.basename)(n)}.map`;if(e.siblings.includes(i)&&(r=i),r||(typeof t>"u"&&(t=await xr(n)),r=Zs(t)),!(!r||(vt(r)||(r=Xr(Q(n),r)),!r))&&!(!r.startsWith("data:")&&!r.startsWith("file://")))return{compiledPath:n,sourceMapUrl:r,cacheKey:e.mtime}}});var Xl,pt,dd,yh,LI,Wi,Po,ga,ha,$i,Vi,md=m(()=>{"use strict";Xl=require("fs"),pt=require("inversify"),dd=y(require("path"));H();ma();O();le();zl();Ql();Gt();Mt();V();J();wh();yh=Symbol("InlineSourceMapUrl"),LI=10*1e3,Wi=class{constructor(e){e.__workspaceCachePath&&(this.path=dd.join(e.__workspaceCachePath,"bp-predict.json"))}async load(){if(this.value||!this.path)return this.value;try{this.value=JSON.parse(await Xl.promises.readFile(this.path,"utf-8"))}catch{}return this.value}async store(e){this.value=e,this.path&&(await Xl.promises.mkdir(dd.dirname(this.path),{recursive:!0}),await Xl.promises.writeFile(this.path,JSON.stringify(e)))}};Wi=h([(0,pt.injectable)(),d(0,(0,pt.inject)(re))],Wi);Po=class{constructor(e,t,r,o,i,s){this.outFiles=e;this.repo=t;this.logger=r;this.sourceMapFactory=o;this.sourcePathResolver=i;this.state=s}async createMapping(e){if(this.outFiles.empty)return new Map;let t=Li(),r=await this.state.load();try{let{state:o}=await this.repo.streamChildrenWithSourcemaps({files:this.outFiles,processMap:async i=>{let s=[],a=await this.sourceMapFactory.load(i);for(let c of a.sources){if(c===null)continue;let l=this.sourcePathResolver?await this.sourcePathResolver.urlToAbsolutePath({url:c,map:a}):We(c);l&&s.push({...i,sourceMapUrl:vt(i.sourceMapUrl)?{[yh]:i.sourceMapUrl}:i.sourceMapUrl,resolvedPath:l,sourceUrl:c})}return{discovered:s,compiledPath:ee(i.compiledPath)}},onProcessedMap:({discovered:i})=>{for(let s of i){let a=t.get(s.resolvedPath);a||(a=new Set,t.set(s.resolvedPath,a)),a.add(s)}},lastState:r,...e});o&&this.state.store(o).catch(i=>this.logger.warn("runtime.exception","Error saving sourcemap cache",{error:i}))}catch(o){this.logger.warn("runtime.exception","Error reading sourcemaps from disk",{error:o})}return t}};Po=h([(0,pt.injectable)(),d(0,(0,pt.inject)(ko)),d(1,(0,pt.inject)(fa)),d(2,(0,pt.inject)(L)),d(3,(0,pt.inject)(Io)),d(4,(0,pt.inject)(Te)),d(5,(0,pt.inject)(Wi))],Po);ga=class extends Po{async getMetadataForPaths(e){this.sourcePathToCompiled||(this.sourcePathToCompiled=this.createInitialMapping());let t=await this.sourcePathToCompiled;return e.map(r=>t.get(r))}async createInitialMapping(){return ud(this.logger,"BreakpointsPredictor.createInitialMapping",()=>this.createMapping())}};ga=h([(0,pt.injectable)()],ga);ha=class extends Po{constructor(){super(...arguments);this.sourcePathToCompiled=new Map}async getMetadataForPaths(t){let r=t.map(s=>this.sourcePathToCompiled.get(s)),o=t.map((s,a)=>a).filter(s=>!r[s]);if(o.length){let s=new Set(o.map(c=>ee(t[c]))),a=this.createMapping({filter:(c,l)=>!l||l.discovered.some(p=>s.has(p.resolvedPath))});for(let c of o)this.sourcePathToCompiled.set(t[c],a),r[c]=a}return await Promise.all(r.map(async(s,a)=>(await s).get(t[a])))}};ha=h([(0,pt.injectable)()],ha);$i=Symbol("IBreakpointsPredictor"),Vi=class{constructor(e,t,r,o){this.bpSearch=e;this.outFiles=t;this.logger=r;this.sourceMapFactory=o;this.predictedLocations=new Map;this.longParseEmitter=new S;this.targetedMode=!1;this.onLongParse=this.longParseEmitter.event}async predictBreakpoints(e){if(!e.source.path||!e.breakpoints?.length)return;let t=await this.getMetadataForPaths([e.source.path]).then(o=>o[0]);if(!t)return;let r=async(o,i,s)=>{let a=typeof s.sourceMapUrl=="string"?s.sourceMapUrl:s.sourceMapUrl.hasOwnProperty(yh)?s.sourceMapUrl[yh]:await Xl.promises.readFile(s.compiledPath,"utf8").then(Zs);if(!a)return[];let c=await this.sourceMapFactory.load({...s,sourceMapUrl:a}),l=this.sourceMapFactory.guardSourceMapFn(c,()=>zu(s.sourceUrl,{lineNumber:o,columnNumber:i||1},c),()=>null);if(!l||l.line===null)return[];let p=await this.getMetadataForPaths([s.compiledPath]).then(u=>u[0]);return p?(await Promise.all([...p].map(g=>r(l.line,l.column,g)))).flat():[{absolutePath:s.compiledPath,lineNumber:l.line||1,columnNumber:l.column?l.column+1:1}]};for(let o of e.breakpoints??[]){let i=`${e.source.path}:${o.line}:${o.column||1}`;if(this.predictedLocations.has(i))return;let s=[];this.predictedLocations.set(i,s);for(let a of t)s.push(...await r(o.line,o.column||0,a))}}async getPredictionForSource(e){return this.getMetadataForPaths([e]).then(t=>t[0])}async getMetadataForPaths(e){let t=setTimeout(()=>{this.longParseEmitter.fire(),this.logger.warn("runtime.sourcemap","Long breakpoint predictor runtime",{longPredictionWarning:LI,patterns:[...this.outFiles.explode()].join(", ")})},LI),r=await this.bpSearch.getMetadataForPaths(e);return clearTimeout(t),r}predictedResolvedLocations(e){let t=`${e.absolutePath}:${e.lineNumber}:${e.columnNumber||1}`;return this.predictedLocations.get(t)??[]}};Vi=h([(0,pt.injectable)(),d(0,(0,pt.inject)(Po)),d(1,(0,pt.inject)(ko)),d(2,(0,pt.inject)(L)),d(3,(0,pt.inject)(Io))],Vi)});function YL(){if(parseInt(process.versions.node,10)>=11)return setImmediate;let n=!1,e=[],t=()=>{let r=e.shift();if(!r){n=!1;return}setImmediate(t),r()};return r=>{e.push(r),n||(n=!0,setImmediate(t))}}var QL,Be,qi,et,XL,fd,tt=m(()=>{"use strict";H();O();V();QL=0,Be=Symbol("ICdpApi"),qi=class extends Error{constructor(t){super("<<message>>");this.method=t}setCause(t,r){return this.cause={code:t,message:r},this.message=`CDP error ${t} calling method ${this.method}: ${r}`,this.stack=this.stack?.replace("<<message>>",this.message),this}},et=class{constructor(e,t,r){this.logger=t;this.telemetryReporter=r;this._connectionId=QL++;this._lastId=1e3;this._disposedSessions=new Map;this._onDisconnectedEmitter=new S;this.waitWrapper=YL();this.onDisconnected=this._onDisconnectedEmitter.event;this._transport=e,this._transport.onMessage(([o,i])=>this._onMessage(o,i)),this._transport.onEnd(()=>this._onTransportClose()),this._sessions=new Map,this._closed=!1,this._rootSession=new fd(this,"",this.logger),this._sessions.set("",this._rootSession)}rootSession(){return this._rootSession.cdp()}_send(e,t={},r){let o=++this._lastId,i={id:o,method:e,params:t};r&&(i.sessionId=r);let s=JSON.stringify(i);return this.logger.verbose("cdp.send",void 0,{connectionId:this._connectionId,message:i}),this._transport.send(s),o}_onMessage(e,t){let r=JSON.parse(e),o=r;r.result&&r.result.scriptSource?o={...r,result:{...r.result,scriptSource:"<script source>"}}:r.method==="Debugger.scriptParsed"&&r.params&&vt(r.params.sourceMapURL)&&(o={...r,params:{...r.params,sourceMapURL:"<data source map url>"}}),this.logger.verbose("cdp.receive",void 0,{connectionId:this._connectionId,message:o});let i=this._sessions.get(r.sessionId||"");if(!i){let c=this._disposedSessions.get(r.sessionId);if(c){let l=(Date.now()-c.getTime())/1e3;this.logger.warn("internal",`Got message for a session disposed ${l} seconds ago`,{sessionId:r.sessionId,disposeOn:c});return}else throw new Error(`Unknown session id: ${r.sessionId} while processing: ${r.method}`)}let s=r.method,a;try{i._onMessage(r)}catch(c){a=c}s&&this.telemetryReporter.reportOperation("cdpOperation",s,t.elapsed().ms,a)}_onTransportClose(){if(!this._closed){this._closed=!0,this._transport.dispose(),this.logger.info("cdp.receive","Connection closed",{connectionId:this._connectionId});for(let e of this._sessions.values())e._onClose();this._sessions.clear(),this._onDisconnectedEmitter.fire()}}close(){this._onTransportClose()}isClosed(){return this._closed}createSession(e){let t=new fd(this,e,this.logger);return this._sessions.set(e,t),t.cdp()}disposeSession(e){let t=this._sessions.get(e);t&&(t._onClose(),this._disposedSessions.set(t.sessionId(),new Date),this._sessions.delete(t.sessionId()))}},XL=+process.version.substring(1).split(".")[0]<11,fd=class{constructor(e,t,r){this.logger=r;this._queue=[];this._prefixListeners=new Tl;this._directListeners=new Tl;this.paused=!1;this._callbacks=new Map,this._connection=e,this._sessionId=t,this._cdp=this._createApi()}pause(){this.paused=!0}resume(){if(!this.paused)return;this.paused=!1;let e=this._queue;this._queue=[],this.logger.verbose("cdp.receive","Dequeue messages",{message:e});for(let t of e)this._processResponse(t)}cdp(){return this._cdp}sessionId(){return this._sessionId}_createApi(){return new Proxy({},{get:(e,t)=>t==="pause"?()=>this.pause():t==="resume"?()=>this.resume():t==="session"?this:new Proxy({},{get:(r,o)=>{if(o!=="then")return o==="on"?(i,s)=>this.on(`${t}.${i}`,s):i=>this.send(`${t}.${o}`,i)}})})}on(e,t){return this._directListeners.listen(e,t)}onPrefix(e,t){return this._prefixListeners.listen(e,t)}send(e,t={}){return this.sendOrDie(e,t).catch(()=>{})}sendOrDie(e,t={}){if(!this._connection)return Promise.reject(new qi(e).setCause(0,"Connection is closed"));let r=this._connection._send(e,t,this._sessionId);return new Promise((o,i)=>{this._callbacks.set(r,{resolve:o,reject:i,from:new qi(e),method:e})})}_onMessage(e){if(this.paused&&e.id){this._processResponse(e);return}if(this._queue.length>0){this._queue.push(e);return}if(!XL&&!this.paused){this._processResponse(e);return}this._queue.push(e),this.paused||this._processQueue()}_processQueue(){this._connection?.waitWrapper(()=>{if(this.paused)return;let e=this._queue.shift();e&&(this._processResponse(e),this._queue.length&&this._processQueue())})}_processResponse(e){if(e.id===void 0){let r=e;this._directListeners.emit(r.method,r.params);for(let[o,i]of this._prefixListeners.listeners)r.method.startsWith(o)&&i.fire(r);return}let t=this._callbacks.get(e.id);t&&(this._callbacks.delete(e.id),"error"in e?t.reject(t.from.setCause(e.error.code,e.error.message)):"result"in e&&t.resolve(e.result))}async detach(){if(!this._connection)throw new Error("Session already detached. Most likely the target has been closed.");this._connection._send("Target.detachFromTarget",{},this._sessionId)}isClosed(){return!this._connection}_onClose(){for(let e of this._callbacks.values())e.reject(e.from.setCause(0,"Connection is closed"));this._callbacks.clear(),this._connection=void 0}}});var _I,AI,wa,en,ZL,EI,Dr,ba,eE,Hi=m(()=>{"use strict";_I=require("astring"),AI=require("crypto"),wa=require("inversify");tt();O();Pr();$();Ri();Gl();Mt();Ze();en="$returnValue",ZL="__js_debug_hoisted_",EI=()=>ZL+(0,AI.randomBytes)(8).toString("hex"),Dr=Symbol("IEvaluator"),ba=class{constructor(e,t,r){this.cdp=e;this.renameProvider=t;this.logger=r}get hasReturnValue(){return!!this.returnValue}setReturnedValue(e){this.returnValue=e}prepare(e,{isInternalScript:t,hoist:r,renames:o,transformRanges:i}={}){t!==!1&&(e+=Ue());let s=new Map;s.set(en,EI());for(let l of r??[])s.set(l,EI());let{transformed:a,hoisted:c}=this.replaceVariableInExpression(e,s,o,i);return c.size?{canEvaluateDirectly:!1,invoke:(l,p)=>Promise.all([...s].map(async([u,g])=>{await this.hoistValue(u===en?this.returnValue:await p?.(u),g)||(a=a.replaceAll(g,u))})).then(()=>this.cdp.Debugger.evaluateOnCallFrame({...l,expression:a}))}:{canEvaluateDirectly:!0,invoke:l=>this.cdp.Debugger.evaluateOnCallFrame({...l,expression:a})}}async evaluate(e,t={}){if(!("callFrameId"in e))return this.cdp.Runtime.evaluate(e);let r={...t},{location:o,stackFrame:i}=t,s;if(o)await Promise.all([Promise.resolve(this.renameProvider.provideForSource(o.source)).then(a=>{r.renames={mapping:a,position:o.position}}),i&&this.setupShadowedVariableHoisting(o,i).then(a=>{a&&(s=a.doHoist,r.hoist=[...a.hoistable])})]);else if(i){let a=await this.renameProvider.provideOnStackframe(i);r.renames={mapping:a,position:i.rawPosition}}return this.prepare(e.expression,r).invoke(e,s)}async hoistValue(e,t){if(e===void 0)return!1;let r=e?.objectId,o=`setTimeout(() => { delete globalThis.${t} }, 0)`,i;return r?i=await this.cdp.Runtime.callFunctionOn({objectId:r,functionDeclaration:`function() { globalThis.${t} = this; ${o}; ${Ue()} }`}):i=await this.cdp.Runtime.evaluate({expression:`globalThis.${t} = ${JSON.stringify(e?.value)};${o};`+Ue()}),!!i&&!i.exceptionDetails}async setupShadowedVariableHoisting({position:e,source:t,variables:r},o){let{scopes:i}=await o.scopes(),s=await Zy(i,async l=>l.source&&l.line&&l.endLine&&new Pt(new Ne(l.line,l.column||1),new Ne(l.endLine,l.endColumn||1/0)).contains(e)&&await t.equalsDap(l.source));if(s===-1)return;this.logger.verbose("runtime",`Evaluating expression in scope ${i[s].name}`);let a=new Set;return await Promise.all(i.slice(0,s).map(async l=>{let p=await r.getVariableNames({variablesReference:l.variablesReference});for(let{name:u}of p)a.add(u)})),{hoistable:a,doHoist:async l=>{for(let p=s;p<i.length;p++)return(await r.getVariableNames({variablesReference:i[p].variablesReference})).find(g=>g.name===l)?.remoteObject}}}replaceVariableInExpression(e,t,r,o){let i=new Set,s=!1,a=(g,w)=>({type:"ConditionalExpression",test:{type:"BinaryExpression",left:{type:"UnaryExpression",operator:"typeof",prefix:!0,argument:{type:"Identifier",name:g}},operator:"!==",right:{type:"Literal",value:"undefined"}},consequent:{type:"Identifier",name:g},alternate:w}),c=[],l=ho(e),p=Au(l,{enter(g,w){let I=g;if(g.type!=="Identifier"||e[I.start-1]===".")return;if(o){if(!g.loc)throw new Error("Node should have location");let z=new Pt(new $t(g.loc.start.line,g.loc.start.column),new $t(g.loc.end.line,g.loc.end.column));if(!o.some(De=>De.containsRange(z)))return}let v=t.get(g.name);if(v)return i.add(g.name),s=!0,{replace:Xg(g,w)?{type:"Identifier",name:v}:a(v,eE)};let A=r?.mapping.getCompiledName(g.name,r.position);if(A)return s=!0,{replace:Xg(g,w)?{type:"Identifier",name:A}:a(A,g)}},leave:()=>{c.pop()}});if(!s)return{hoisted:i,transformed:e};let u=l.body[l.body.length-1].end;return{hoisted:i,transformed:(0,_I.generate)(p)+e.slice(u)}}};ba=h([(0,wa.injectable)(),d(0,(0,wa.inject)(Be)),d(1,(0,wa.inject)(On)),d(2,(0,wa.inject)(L))],ba);eE={type:"Identifier",name:"undefined"}});var gd,vh,Ih=m(()=>{"use strict";Mt();Ie();ge();gd=class n{static parse(e,t,r,o){t=vh(t,r);let i=t&&Ln(t);if(i)throw new k(Mn(e,i.message));let{canEvaluateDirectly:s,invoke:a}=o.prepare(t);return new n(s?t:a)}constructor(e){typeof e=="function"?this.invoke=e:this.breakCondition=e}async shouldStayPaused(e){return this.invoke?(await this.invoke({callFrameId:e.callFrames[0].callFrameId,returnByValue:!0}))?.result.value===!0:Promise.resolve(!0)}},vh=(n,e)=>`(()=>{try{return ${n};}catch(e){console.error(\`Breakpoint condition error: \${e.message||e}\`);return ${!!e}}})()`});var tE,ya,rE,Sh=m(()=>{"use strict";Ie();ge();tE=/^(>|>=|={1,3}|<|<=|%)?\s*([0-9]+)$/,ya=class n{constructor(e){this.predicate=e;this.hits=0;this.breakCondition=void 0}shouldStayPaused(){return Promise.resolve(this.predicate(++this.hits))}static parse(e){let t=tE.exec(e);if(!t)throw new k(dh(e));let[,r="=",o]=t;return new n(rE(e,r,Number(o)))}},rE=(n,e,t)=>{switch(e){case"=":case"==":case"===":return r=>r===t;case">":return r=>r>t;case">=":return r=>r>=t;case"<":return r=>r<t;case"<=":return r=>r<=t;case"%":return r=>r%t===0;default:throw new k(dh(n))}}});var hd,FI=m(()=>{"use strict";hd=class{constructor(e){this.invoke=e;this.breakCondition=void 0}async shouldStayPaused(e){return await this.invoke({callFrameId:e.callFrames[0].callFrameId}),!1}}});var zi,kh=m(()=>{"use strict";Mt();Ie();ge();zi=class{constructor(e,t){this.breakCondition=t;let r=t&&Ln(t);if(r)throw new k(Mn(e,r.message))}shouldStayPaused(){return Promise.resolve(!0)}}});var MI,NI,bd,jn,Ph=m(()=>{"use strict";MI=require("astring"),NI=require("crypto"),bd=require("inversify");Ri();Mt();Ie();ge();Hi();FI();kh();jn=class{constructor(e){this.evaluator=e}compile(e,t){let r=this.logMessageToExpression(t),o=Ln(r);if(o)throw new k(Mn(e,o.message));let{canEvaluateDirectly:i,invoke:s}=this.evaluator.prepare(r);return i?new zi(e,this.logMessageToExpression(t)):new hd(s)}serializeLogStatements(e){return Pv([],e,!1)}logMessageToExpression(e){let t=l=>l.replace(/%/g,"%%"),r=[],o=[],i=0;for(;;){let l=e.indexOf("{",i);if(l===-1){r.push(t(e.slice(i)));break}r.push(t(e.slice(i,l)));let[p]=Cl(e.slice(l));if(i=l+p.end,i-1===l+1||e[i-1]!=="}"){r.push(t(e.slice(l,i)));continue}if(p.type!=="BlockStatement")break;p.body.length===1&&p.body[0].type==="BlockStatement"&&(p.body=Cl(`(${e.slice(l+1,i-2)}})`)),o.push((0,MI.generate)(this.serializeLogStatements(p.body))),r.push("%O")}let a=`console.log(${[JSON.stringify(r.join("")),...o].join(", ")}), false`,c=(0,NI.createHash)("sha256").update(a).digest("hex").slice(0,7);return a+`
//# sourceURL=logpoint-${c}.cdp`}};jn=h([(0,bd.injectable)(),d(0,(0,bd.inject)(Dr))],jn)});var Ia,oE,P1,wd,va,xh=m(()=>{"use strict";Ia=require("inversify");J();Hi();Ih();Sh();Ph();kh();oE=new zi({line:0},void 0),P1=new zi({line:0},"false"),wd=Symbol("IBreakpointConditionFactory"),va=class{constructor(e,t,r){this.logPointCompiler=e;this.evaluator=t;this.breakOnError=r.__breakOnConditionalError}getConditionFor(e){return e.condition?gd.parse(e,e.condition,this.breakOnError,this.evaluator):e.logMessage?this.logPointCompiler.compile(e,e.logMessage):e.hitCondition?ya.parse(e.hitCondition):oE}};va=h([(0,Ia.injectable)(),d(0,(0,Ia.inject)(jn)),d(1,(0,Ia.inject)(Dr)),d(2,(0,Ia.inject)(re))],va)});var yd,vd,OI,nE,Sa,Id=m(()=>{"use strict";O();V();Zr();yd=(n,e)=>n.lineNumber===e.lineNumber&&n.columnNumber===e.columnNumber,vd=n=>!("location"in n),OI=n=>"location"in n,nE=(n,e)=>n.url&&e===n.url||n.urlRegex&&new RegExp(n.urlRegex).test(e),Sa=class{constructor(e,t,r){this._manager=e;this._source=t;this._originalPosition=r;this.isEnabled=!1;this.setInCdpScriptIds=new Set;this.cdpScriptIds=this.setInCdpScriptIds;this.cdpBreakpoints=[];this._cdpIds=new Set}get enabled(){return this.isEnabled}get cdpIds(){return this._cdpIds}get source(){return this._source}get originalPosition(){return this._originalPosition}async updateSourceLocation(e,t,r){this._source=t,this._originalPosition=r;let o=[];for(let i of this.cdpBreakpoints)i.state===1&&o.push(this.updateUiLocations(e,i.cdpId,i.locations));await Promise.all(o)}async refreshUiLocations(e){await Promise.all(this.cdpBreakpoints.filter(t=>t.state===1).map(t=>this.updateUiLocations(e,t.cdpId,t.locations)))}async enable(e){if(this.isEnabled)return;this.isEnabled=!0;let t=[this._setPredicted(e)],r=this._manager._sourceContainer.source(this.source);if((!r||!(r instanceof Ge))&&t.push(this._setByPath(e,r?.offsetSourceToScript(this.originalPosition)||this.originalPosition)),await Promise.all(t),r&&this.isEnabled){let o=await this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r});await Promise.all(o.map(i=>this._setByUiLocation(e,r.offsetSourceToScript(i))))}}async updateUiLocations(e,t,r){this.updateExistingCdpRef(t,a=>({...a,locations:r}));let o=(await Promise.all(r.map(a=>e.rawLocationToUiLocation(e.rawLocation(a))))).find(a=>!!a);if(!o)return;let i=this._manager._sourceContainer.source(this.source);if(!i)return;let s=await this._manager._sourceContainer.currentSiblingUiLocations(o);this.updateExistingCdpRef(t,a=>{let c=s.filter(l=>l.source===i);return{...a,locations:r,uiLocations:c.length?c:s}})}compare(e){let t=this.originalPosition,r=e.originalPosition;return t.lineNumber!==r.lineNumber?t.lineNumber-r.lineNumber:t.columnNumber-r.columnNumber}async disable(){if(!this.isEnabled)return;this.isEnabled=!1;let e=this.cdpBreakpoints.map(t=>this.removeCdpBreakpoint(t));await Promise.all(e)}async updateForNewLocations(e,t){let r=this._manager._sourceContainer.source(this.source);if(!r)return[];let o=await this._manager._sourceContainer.currentSiblingUiLocations({lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber,source:r},await t.source);if(!o.length)return[];let i=[];for(let s of o)i.push(this._setForSpecific(e,t,r.offsetSourceToScript(s)));for(let s of this.cdpBreakpoints){if(!vd(s.args)||!nE(s.args,t.url))continue;let a=s.args;o.some(c=>c.columnNumber-1===a.columnNumber&&c.lineNumber-1===a.lineNumber)||(this._manager.logger.verbose("runtime.sourcemap","Adjusted breakpoint due to overlaid sourcemap",{url:r.url}),i.push(this.removeCdpBreakpoint(s)))}return await Promise.all(i),o}executionContextWasCleared(){this.updateCdpRefs(e=>e.filter(t=>vd(t.args)))}hasResolvedAt(e,t){let{lineNumber:r,columnNumber:o}=t.base0;return this.cdpBreakpoints.some(i=>i.state===1&&i.locations.some(s=>s.scriptId===e&&s.lineNumber===r&&(s.columnNumber===void 0||s.columnNumber===o)))}getBreakCondition(){}updateExistingCdpRef(e,t){this.updateCdpRefs(r=>r.map(o=>o.state!==1||o.cdpId!==e?o:t(o)))}updateCdpRefs(e){let t=this;t.cdpBreakpoints=e(this.cdpBreakpoints);let r=new Set;this.setInCdpScriptIds.clear();for(let o of this.cdpBreakpoints)if(o.state===1){r.add(o.cdpId);for(let i of o.locations)this.setInCdpScriptIds.add(i.scriptId)}this._cdpIds=r}async _setPredicted(e){if(!this.source.path||!this._manager._breakpointsPredictor)return;let t=this._manager._breakpointsPredictor.predictedResolvedLocations({absolutePath:this.source.path,lineNumber:this.originalPosition.lineNumber,columnNumber:this.originalPosition.columnNumber}),r=[];for(let o of t){let i=this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(o.absolutePath);i!==void 0&&(typeof i=="string"?r.push(this._setByUrlRegexp(e,i,o)):r.push(i.then(s=>s?this._setByUrlRegexp(e,s,o):void 0)))}await Promise.all(r)}async _setByUiLocation(e,t){await Promise.all(t.source.scripts.map(r=>this._setForSpecific(e,r,t)))}async _setByPath(e,t){let r=this._manager._sourceContainer.source({path:this.source.path});if(!(r instanceof Ge&&[...r.compiledToSourceUrl.keys()].some(i=>i.absolutePath===this.source.path)))if(this.source.path){let o=await this._manager._sourceContainer.sourcePathResolver.absolutePathToUrlRegexp(this.source.path);if(!o)return;await this._setByUrlRegexp(e,o,t)}else{let i=this._manager._sourceContainer.source(this.source)?.url;if(!i)return;await this._setByUrl(e,i,t),this.source.path!==i&&this.source.path!==void 0&&await this._setByUrl(e,Q(this.source.path),t)}}hasSetOnLocation(e,t){return this.cdpBreakpoints.find(r=>e.scriptId&&OI(r.args)&&r.args.location.scriptId===e.scriptId&&yd(r.args.location,t)||e.url&&!e.hasSourceURL&&vd(r.args)&&(r.args.urlRegex?new RegExp(r.args.urlRegex).test(e.url):e.url===r.args.url)&&yd(r.args,t))}hasSetOnLocationByUrl(e,t,r){return this.cdpBreakpoints.find(o=>{if(vd(o.args))return yd(o.args,r)?e==="url"?o.args.urlRegex?new RegExp(o.args.urlRegex).test(t):o.args.url===t:e==="re"&&o.args.urlRegex===t:!1;let i=this._manager._sourceContainer.getScriptById(o.args.location.scriptId);if(i)return yd(o.args.location,r)&&e==="re"?new RegExp(t).test(i.url):i.url===t})}async _setForSpecific(e,t,r){return t.url&&!t.hasSourceURL&&(!t.embedderName||t.embedderName===t.url)?this._setByUrl(e,t.url,r):this._setByScriptId(e,t,r)}async _setByUrl(e,t,r){r=Xo(r);let o=this.hasSetOnLocationByUrl("url",t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{url:t,condition:this.getBreakCondition(),...r})}async _setByUrlRegexp(e,t,r){r=Xo(r);let o=this.hasSetOnLocationByUrl("re",t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{urlRegex:t,condition:this.getBreakCondition(),...r})}async _setByScriptId(e,t,r){r=Xo(r);let o=this.hasSetOnLocation(t,r);if(o){o.state===0&&await o.done;return}return this._setAny(e,{condition:this.getBreakCondition(),location:{scriptId:t.scriptId,...r}})}async _setAny(e,t){if(!this.isEnabled)return;let r={state:0,args:t,deadletter:!1};r.done=(async()=>{let o=OI(t)?await e.cdp().Debugger.setBreakpoint(t):await e.cdp().Debugger.setBreakpointByUrl(t);if(!o)return;if(r.deadletter){await e.cdp().Debugger.removeBreakpoint({breakpointId:o.breakpointId});return}let i="actualLocation"in o?[o.actualLocation]:o.locations;this._manager._resolvedBreakpoints.set(o.breakpointId,this);let s={state:1,cdpId:o.breakpointId,args:t,locations:i,uiLocations:[]};return this.updateCdpRefs(a=>a.map(c=>c===r?s:c)),await this.updateUiLocations(e,o.breakpointId,i),s})(),this.updateCdpRefs(o=>[...o,r]),await r.done}async removeCdpBreakpoint(e){this.updateCdpRefs(t=>t.filter(r=>r!==e)),e.state===0?(e.deadletter=!0,await e.done):(await this._manager._thread?.cdp().Debugger.removeBreakpoint({breakpointId:e.cdpId}),this._manager._resolvedBreakpoints.delete(e.cdpId))}}});var Sd,xo,Ch=m(()=>{"use strict";Sd=require("path");Yr();Un();Id();xo=class n extends Sa{constructor(t,r,o){super(t,r,{lineNumber:1,columnNumber:1});this.mode=o}static getModeKeyForSource(t,r){return t===1?(0,Sd.basename)(r,(0,Sd.extname)(r)||void 0):r}_setPredicted(){return Promise.resolve()}_setByPath(t,r){if(!this.source.path)return Promise.resolve();let o=n.getModeKeyForSource(this.mode,this.source.path);return this.mode===1?super._setByUrlRegexp(t,yt(o),r):super._setByPath(t,r)}}});var jI,Lr,Yl=m(()=>{"use strict";jI=y(require("@vscode/l10n"));$();Id();Lr=class extends Sa{constructor(t,r,o,i,s){super(t,o,{lineNumber:i.line,columnNumber:i.column||1});this.dapId=r;this.dapParams=i;this.condition=s;this.completedSet=ye()}equivalentTo(t){return t.dapParams.column===this.dapParams.column&&t.dapParams.line===this.dapParams.line&&t.dapParams.hitCondition===this.dapParams.hitCondition&&t.dapParams.condition===this.dapParams.condition&&t.dapParams.logMessage===this.dapParams.logMessage}untilSetCompleted(){return this.completedSet.promise}markSetCompleted(){this.completedSet.resolve()}testHitCondition(t){return this.condition.shouldStayPaused(t)}async toDap(){let t=this.getResolvedUiLocation();this.lastAnnouncedUiLocation=t;let r=this.enabled&&t;return r?{id:this.dapId,verified:!0,source:await r.source.toDap(),line:r.lineNumber,column:r.columnNumber}:{id:this.dapId,verified:!1,message:jI.t("Unbound breakpoint")}}diagnosticDump(){return{source:this.source,params:this.dapParams,cdp:this.cdpBreakpoints}}getBreakCondition(){return this.condition.breakCondition}updateCdpRefs(t){super.updateCdpRefs(t),this.getResolvedUiLocation()!==this.lastAnnouncedUiLocation&&this.notifyResolved()}getResolvedUiLocation(){for(let t of this.cdpBreakpoints)if(t.state===1&&t.uiLocations.length)return t.uiLocations[0]}async notifyResolved(){await this.completedSet.promise,await this._manager.notifyBreakpointChange(this,!0)}}});var kd,UI=m(()=>{"use strict";Sh();Yl();kd=class extends Lr{constructor(e,t,r,o){super(e,t,r,o,new ya(()=>!1))}getResolvedUiLocation(){}}});var WI,Zl,VI=m(()=>{"use strict";WI=require("micromatch");le();Un();Ch();Zl=class extends xo{constructor(t,r){super(t,{path:r},1);this.pattern=r}async enable(t){if(this.isEnabled)return;this.isEnabled=!0;let r=(0,WI.makeRe)(G(this.pattern),{contains:!0,lookbehinds:!1});await this._setAny(t,{urlRegex:r.source.replace(/([a-z]):/i,(o,i)=>`[${i.toLowerCase()}${i.toUpperCase()}]:`),lineNumber:0,columnNumber:0})}}});var ka,Pd=m(()=>{"use strict";ka=Symbol("IExperimentationService")});var Pa,sE,aE,$I,cE,je,ep=m(()=>{"use strict";Pa=require("inversify");st();H();$();eo();Pd();ua();sE=/\/node_modules\/|^node\:/,aE=2,$I=5e3,cE=$I/2,je=class{constructor(e,t,r){this.telemetry=t;this.experimentation=r;this.disposable=new q;this.hadBreakpoint=!1;this.didVerifyBreakpoint=!1;this.hadNonModuleSourcemap=!1;this.startedAt=Date.now();this.disposable.push(je.didVerifyEmitter.event(()=>{this.didVerifyBreakpoint=!0})),je.consecutiveQualifyingSessions>=aE&&this.disposable.push(Yy(async()=>{this.currentlyQualifying&&await this.experimentation.getTreatment("diagnosticPrompt",!0)&&(t.report("diagnosticPrompt",{event:"suggested"}),je.didSuggest=!0,e.suggestDiagnosticTool({}))},$I))}get currentlyQualifying(){return this.hadBreakpoint&&!this.didVerifyBreakpoint&&this.hadNonModuleSourcemap}notifyHadBreakpoint(){this.hadBreakpoint=!0}notifyVerifiedBreakpoint(){this.didVerifyBreakpoint||(je.didVerifyEmitter.fire(),je.didSuggest&&(je.didSuggest=!1,this.telemetry.report("diagnosticPrompt",{event:"resolved"})))}attach(e){if(!this.hadNonModuleSourcemap){let t=this.disposable.push(e.Debugger.on("scriptParsed",r=>{r.sourceMapURL&&!sE.test(r.url)&&(this.hadNonModuleSourcemap=!0,this.disposable.disposeObject(t))}))}}dispose(){this.currentlyQualifying&&Date.now()-cE>this.startedAt?je.consecutiveQualifyingSessions++:je.consecutiveQualifyingSessions=0,this.disposable.dispose()}};je.consecutiveQualifyingSessions=0,je.didVerifyEmitter=new S,je.didSuggest=!1,je=h([(0,Pa.injectable)(),d(0,(0,Pa.inject)(sa)),d(1,(0,Pa.inject)(lt)),d(2,(0,Pa.inject)(ka))],je)});var qI,xd,HI,zI=m(()=>{"use strict";qI=y(require("fs")),xd=y(require("path")),HI=n=>{let e={};w(e);function t(v,A){return n({category:"telemetry",output:v,data:A})}let r=v=>t("js-debug/dap/operation",{...e,...v}),o=v=>t("js-debug/cdp/operation",{...e,...v}),i=v=>t("js-debug/error",{...e,...v}),s=v=>t("blazor-debug/blazorDebugException",{...e,...v}),a=v=>{e.browser=(v.targetProject||v.targetProject)+"/"+v.targetVersion,t("js-debug/browserVersion",{...e,...v})},c=v=>t("js-debug/breakpointStats",{...e,...v}),l=v=>t("js-debug/statistics",{...e,...v}),p=v=>{e.nodeVersion=v.version,t("js-debug/nodeRuntime",{...e,...v})},u=v=>{t("js-debug/launch",{...e,...v,parameters:JSON.stringify(v.parameters)})},g=v=>{t("js-debug/diagnosticPrompt",{...e,...v})};function w(v){try{let A=xd.resolve(xd.dirname(__filename),"..","..",".gitcommit");v.jsDebugCommitId=qI.readFileSync(A,"utf8")}catch{}}return{breakpointStats:c,statistics:l,browserVersion:a,cdpOperation:o,dapOperation:r,error:i,launch:u,nodeRuntime:p,diagnosticPrompt:g,setGlobalMetric:(v,A)=>{e[v]=A},blazorDebugException:s}}});var tp,GI=m(()=>{"use strict";tp=class{constructor(e=!0){this.isVSCode=e;this.measurements=Object.create(null)}add(e,t,r){let o=this.measurements[e];o||(o=this.measurements[e]={times:[],errors:[]}),o.times.push(t),r&&o.errors.push(r)}flush(){let e={errors:[]};for(let t in this.measurements){let{times:r,errors:o}=this.measurements[t],i={operation:t,totalTime:0,max:0,avg:0,stddev:0,count:r.length,failed:o.length};for(let s of r)i.totalTime+=s,i.max=Math.max(i.max,s);i.avg=i.totalTime/i.count;for(let s of r)i.stddev+=(s-i.avg)**2;i.stddev=Math.sqrt(i.stddev/(r.length-1)),e[i.operation]=i,e[`!${i.operation}.errors`]=o,this.isVSCode||(e[`${i.operation}.errors`]=o)}return this.measurements=Object.create(null),e}}});function Rh(n){let e=String(n.message),t=String(n.name);JI.lastIndex=0;let r=typeof n.stack=="string"?n.stack.replace(JI,"$1"):void 0;return{error:{message:e,name:t,stack:r}}}var Cd,Er,Th,JI,Td=m(()=>{"use strict";Cd=require("inversify");H();U();X();zI();GI();Er=class{constructor(e=!0){this.isVsCode=e;this.target=[];this.flushEmitter=new S;this.loggers=HI(e=>this.pushOutput(e));this.batchFlushTimeout={};this.batchers={dapOperation:new tp(this.isVsCode),cdpOperation:new tp(this.isVsCode)};this.onFlush=this.flushEmitter.event;this.setGlobalMetric=this.loggers.setGlobalMetric}report(e,...t){let r=this.loggers[e];r(...t)}reportOperation(e,t,r,o){this.batchers[e].add(t,r,o),this.batchFlushTimeout[e]===void 0&&(this.batchFlushTimeout[e]=setTimeout(()=>{this.report(e,this.batchers[e].flush()),this.batchFlushTimeout[e]=void 0},Er.batchFlushInterval))}attachDap(e){this.target instanceof Array&&this.target.forEach(t=>e.output(t)),this.target=e}flush(){this.flushEmitter.fire();let e=Object.entries(this.batchFlushTimeout);for(let[t,r]of e){let o=this.batchers[t].flush();o.length&&this.report(t,o),this.batchFlushTimeout[t]=void 0,clearTimeout(r)}}dispose(){for(let e of Object.values(this.batchFlushTimeout))e&&clearTimeout(e)}pushOutput(e){e.data=Th(e.data),this.target instanceof Array?this.target.push(e):this.target.output(e)}};Er.batchFlushInterval=5e3,Er=h([(0,Cd.injectable)(),d(0,(0,Cd.inject)(Bi))],Er);Th=n=>typeof n=="number"?Number(n.toFixed(1)):typeof n!="object"||!n?n:n instanceof Error?Rh(n):n instanceof Array?n.map(Th):Ho(n,Th),JI=/(?:[A-z]:)?(?:[\\/][^:]*)+[\\/]([^:]*:)/g});var Rd=m(()=>{"use strict"});var Gi,Dd=m(()=>{"use strict";Gi=Symbol("IDwarfModuleProvider")});var XI,Co,_d,Lh,Ad,xa,Ca,lE,Ld,Dh,KI,Ed,rp=m(()=>{"use strict";XI=require("crypto"),Co=require("inversify");tt();xn();O();U();Pr();J();Ie();ge();Rd();Ze();Dd();_d=Symbol("IWasmSymbolProvider"),Lh=Symbol("IWasmWorkerFactory"),Ad=n=>n.replace(/\.wasm$/i,"")+".wat",xa=class{constructor(e,t){this.dwarf=e;this.launchConfig=t;this.cdpCounter=0;this.cdp=new Map;this.prompt=B(()=>this.dwarf.prompt())}async spawn(e){if(!this.launchConfig.enableDWARF)return null;this.worker??=this.dwarf.load().then(o=>{if(!o)return null;let i=o.spawn({getWasmGlobal:(s,a)=>this.loadWasmValue(`globals[${s}]`,a),getWasmLocal:(s,a)=>this.loadWasmValue(`locals[${s}]`,a),getWasmOp:(s,a)=>this.loadWasmValue(`stack[${s}]`,a),getWasmLinearMemory:(s,a,c)=>this.loadWasmValue(`[].slice.call(new Uint8Array(memories[0].buffer, ${+s}, ${+a}))`,c).then(l=>new Uint8Array(l).buffer)});return i.rpc.sendMessage("hello",[],!1),i});let t=await this.worker;if(!t)return null;let r=this.cdpCounter++;return this.cdp.set(r,e),{rpc:t.rpc,getStopId:o=>`${r}:${o}`,dispose:()=>(this.cdp.delete(r),this.cdp.size>0?Promise.resolve():(this.worker=void 0,t.dispose()))}}async dispose(){await this.worker?.then(e=>e?.dispose()),this.worker=Promise.resolve(null)}async loadWasmValue(e,t){let r=t,o=r.indexOf(":"),i=r.substring(0,o),s=r.substring(o+1),a=await this.cdp.get(+i)?.Debugger.evaluateOnCallFrame({callFrameId:s,expression:e+Ue(),silent:!0,returnByValue:!0,throwOnSideEffect:!0});if(!a||a.exceptionDetails)throw new Error(`evaluate failed: ${a?.exceptionDetails?.text||"unknown"}`);return a.result.value}};xa=h([(0,Co.injectable)(),d(0,(0,Co.inject)(Gi)),d(1,(0,Co.inject)(re))],xa);Ca=class{constructor(e,t,r,o){this.dwarf=e;this.cdp=t;this.logger=r;this.launchConfig=o;this.worker=B(()=>this.dwarf.spawn(this.cdp))}async loadWasmSymbols(e){if(!this.launchConfig.enableDWARF)return this.defaultSymbols(e);let t=await this.worker();if(!t){let p=this.defaultSymbols(e);return p.onDidDisassemble=this.dwarf.prompt,p}let{rpc:r}=t,o=(0,XI.randomUUID)(),i;try{let p=e.debugSymbols;if(lE(p)&&p.externalURL)i=new URL(p.externalURL);else if(Array.isArray(p)){let u=e.debugSymbols?.find(g=>(g.type==="EmbeddedDWARF"||g.type==="ExternalDWARF")&&g.externalURL);u?.externalURL&&(i=new URL(u.externalURL))}}catch{}let s=new URL(e.url),a=s.hostname==="localhost"?["127.0.0.1","[::1]","localhost"]:[s.hostname],c=i?.hostname==="localhost",l;for(let p of a){s.hostname=p,i&&c&&(i.hostname=p);try{l=await r.sendMessage("addRawModule",o,i?.toString(),{url:s.toString(),code:!i&&s.protocol.startsWith("wasm:")?await this.getBytecode(e.scriptId):void 0});break}catch(u){this.logger.warn("sourcemap.parsing",`failed to load wasm symbols for ${s}`,{error:u})}}return l?!(l instanceof Array)||l.length===0?(r.sendMessage("removeRawModule",o),this.defaultSymbols(e)):(this.logger.info("sourcemap.parsing","parsed files from wasm",{files:l}),new Dh(e,this.cdp,o,t,l)):this.defaultSymbols(e)}async dispose(){await this.worker.value?.then(e=>e?.dispose())}defaultSymbols(e){return new Ld(e,this.cdp,[])}async getBytecode(e){let r=(await this.cdp.Debugger.getScriptSource({scriptId:e}))?.bytecode;return r?Buffer.from(r,"base64").buffer:void 0}};Ca=h([(0,Co.injectable)(),d(0,(0,Co.inject)(Lh)),d(1,(0,Co.inject)(Be)),d(2,(0,Co.inject)(L)),d(3,(0,Co.inject)(re))],Ca);lE=n=>!!n?.externalURL,Ld=class{constructor(e,t,r){this.event=e;this.cdp=t;this.doDisassemble=B(async()=>{let e=[],t;for await(let r of this.getDisassembledStream()){e=e.concat(r.lines);let o;if(t){let i=new Uint32Array(t.length+r.lines.length);o=t.length,i.set(t),t=i}else t=new Uint32Array(r.lines.length),o=0;for(let i=0;i<r.lines.length;i++)t[o+i]=r.bytecodeOffsets[i]}return t??=new Uint32Array(0),{lines:e,byteOffsetsOfLines:t}});this.decompiledUrl=Ad(e.url),r.push(this.decompiledUrl),this.files=r}async getDisassembly(){let{lines:e}=await this.doDisassemble();return this.onDidDisassemble?.(),e.join(`
`)}originalPositionFor(e){return this.disassembledPositionFor(e)}async disassembledPositionFor(e){let{byteOffsetsOfLines:t}=await this.doDisassemble(),r=Ev(t,e.base0.columnNumber,(o,i)=>o-i);if(r!==t.length)return{url:this.decompiledUrl,position:new Ae(r,0)}}async compiledPositionFor(e,t){if(e!==this.decompiledUrl)return[];let{byteOffsetsOfLines:r}=await this.doDisassemble(),{lineNumber:o}=t.base0;if(o>=r.length)return[];let i=r[t.base0.lineNumber];return[new Ae(0,i)]}dispose(){}async*getDisassembledStream(){let{scriptId:e}=this.event,t=await this.cdp.Debugger.disassembleWasmModule({scriptId:e});if(t)for(yield t.chunk;t.streamId;){let r=await this.cdp.Debugger.nextWasmDisassemblyChunk({streamId:t.streamId});if(!r)return;yield r.chunk}}},Dh=class extends Ld{constructor(t,r,o,i,s){super(t,r,s);this.moduleId=o;this.worker=i;this.mappedLines=new Map}get codeOffset(){return this.event.codeOffset||0}async originalPositionFor(t){let r=await this.worker.rpc.sendMessage("rawLocationToSourceLocation",{codeOffset:t.base0.columnNumber-this.codeOffset,inlineFrameIndex:t.base0.lineNumber,rawModuleId:this.moduleId});return r.length?{position:new Ae(r[0].lineNumber,r[0].columnNumber),url:r[0].sourceFileURL}:super.originalPositionFor(t)}async compiledPositionFor(t,r){if(t===this.decompiledUrl)return super.compiledPositionFor(t,r);let{lineNumber:o,columnNumber:i}=r.base0,s=await this.worker.rpc.sendMessage("sourceLocationToRawLocation",{lineNumber:o,columnNumber:i===0?-1:i,rawModuleId:this.moduleId,sourceFileURL:t});if(i===0&&s.length===0){let a=await this.getMappedLines(t),c=a.find(l=>l>o);if(!a.includes(o)&&c)return this.compiledPositionFor(t,new Ae(c,0))}return s.filter(a=>a.rawModuleId===this.moduleId).map(a=>new Ae(0,this.codeOffset+a.startOffset))}dispose(){return this.worker.rpc.sendMessage("removeRawModule",this.moduleId)}async getVariablesInScope(t,r){let o={codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId};return(await this.worker.rpc.sendMessage("listVariablesInScope",o)).map(s=>({name:s.name,scope:s.scope,type:s.type,evaluate:async()=>{let a=await this.worker.rpc.sendMessage("evaluate",s.name,o,this.worker.getStopId(t));return a?new Ed(a,this.worker.rpc):KI}}))}async getFunctionStack(t){let r=await this.worker.rpc.sendMessage("getFunctionInfo",{codeOffset:t.base0.columnNumber-this.codeOffset,inlineFrameIndex:t.base0.lineNumber,rawModuleId:this.moduleId});return"frames"in r?r.frames:[]}async getStepSkipList(t,r,o,i){if(o===this.decompiledUrl)return[];let s={codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId},a=()=>i&&o?this.worker.rpc.sendMessage("sourceLocationToRawLocation",{lineNumber:i.base0.lineNumber,columnNumber:-1,rawModuleId:this.moduleId,sourceFileURL:o}):[],c;switch(t){case 2:{c=await this.worker.rpc.sendMessage("getInlinedFunctionRanges",s);break}case 1:{let l=await Promise.all([this.worker.rpc.sendMessage("getInlinedCalleesRanges",s),a()]);c=Go(l);break}case 0:c=await a();break;default:c=[];break}return c.map(l=>new Pt(new Ae(0,l.startOffset+this.codeOffset),new Ae(0,l.endOffset+this.codeOffset)))}async evaluate(t,r,o){try{let i=await this.worker.rpc.sendMessage("evaluate",o,{codeOffset:r.base0.columnNumber-this.codeOffset,inlineFrameIndex:r.base0.lineNumber,rawModuleId:this.moduleId},this.worker.getStopId(t));return i?new Ed(i,this.worker.rpc):KI}catch(i){throw new k(he(i.message))}}getMappedLines(t){let r=this.mappedLines.get(t);if(r)return r;let o=(async()=>{try{let i=await this.worker.rpc.sendMessage("getMappedLines",this.moduleId,t);return new Uint32Array(i?.sort((s,a)=>s-a)||[])}catch{return new Uint32Array}})();return this.mappedLines.set(t,o),o}},KI={type:"null",description:"no properties"},Ed=class n{constructor(e,t){if(this.type=e.type,this.description=e.description,this.linearMemoryAddress=e.linearMemoryAddress,this.linearMemorySize=e.linearMemoryAddress,e.objectId&&e.hasChildren){let r=e.objectId;this.getChildren=B(()=>this._getChildren(t,r))}}async _getChildren(e,t){return(await e.sendMessage("getProperties",t)).map(o=>({name:o.name,value:new n(o.value,e)}))}}});var Wn,op=m(()=>{"use strict";Wn=Symbol("IScriptSkipper")});function YI(n){return typeof n.lineNumber=="number"&&typeof n.columnNumber=="number"&&!!n.source}var Fd,_r,rS,ZI,pE,uE,dE,eS,tS,ut,tn=m(()=>{"use strict";Fd=require("@jridgewell/trace-mapping"),_r=require("inversify"),rS=require("js-xxhash");zs();H();O();le();Pr();zl();Gt();Mt();V();J();eo();Ie();X();Td();rp();Vl();op();Zr();ZI=()=>({source:null,line:null,column:null,name:null,lastColumn:null,isSourceMapLoadFailure:!0}),pE=/\?t=[0-9]+$/,uE=n=>n.endsWith(".hot-update.js")||pE.test(n),dE={load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:1e3,sourceMapCumulativePause:1e4},eS=(n,e)=>e instanceof Ge&&e.compiledToSourceUrl.has(n),tS=2**31-1,ut=class{constructor(e,t,r,o,i,s,a,c,l){this.sourceMapFactory=t;this.logger=r;this.launchConfig=o;this.initializeConfig=i;this.sourcePathResolver=s;this.scriptSkipper=a;this.resourceProvider=c;this.wasmSymbols=l;this.rootPaths=[];this.scriptsById=new Map;this.onSourceMappedSteppingChangeEmitter=new S;this.onScriptEmitter=new S;this._sourceByOriginalUrl=new Ct(e=>e.toLowerCase());this._sourceByReference=new Map;this._sourceMapSourcesByUrl=new Map;this._sourceByAbsolutePath=Li();this._sourceMapTimeouts=dE;this._fileContentOverridesForTest=new Map;this._temporarilyDisabledSourceMaps=new Set;this._permanentlyDisabledSourceMaps=new Set;this.onScript=this.onScriptEmitter.event;this._statistics={fallbackSourceMapCount:0};this._doSourceMappedStepping=this.launchConfig.sourceMaps;this.onSourceMappedSteppingChange=this.onSourceMappedSteppingChangeEmitter.event;this._dap=e;let p="webRoot"in o?o.webRoot:o.rootPath;p&&(this.rootPaths=[p,ir(p,"..","ClientApp")]),a.setSourceContainer(this),this.setSourceMapTimeouts({...this.sourceMapTimeouts(),...o.timeouts})}get sources(){return this._sourceByReference.values()}statistics(){return this._statistics}get doSourceMappedStepping(){return this._doSourceMappedStepping}set doSourceMappedStepping(e){e!==this._doSourceMappedStepping&&(this._doSourceMappedStepping=e,this.onSourceMappedSteppingChangeEmitter.fire(e))}setSourceMapTimeouts(e){this._sourceMapTimeouts=e}sourceMapTimeouts(){return this._sourceMapTimeouts}setFileContentOverrideForTest(e,t){t===void 0?this._fileContentOverridesForTest.delete(e):this._fileContentOverridesForTest.set(e,t)}async loadedSources(){let e=[];for(let t of this._sourceByReference.values())e.push(t.toDap());return await Promise.all(e)}source(e){if(e.sourceReference)return this._sourceByReference.get(e.sourceReference);if(e.path)return this._sourceByAbsolutePath.get(e.path)}isSourceSkipped(e){return this.scriptSkipper.isScriptSkipped(e)}addScriptById(e){this.scriptsById.set(e.scriptId,e),"source"in e&&this.onScriptEmitter.fire(e)}getSourceScriptById(e){return this.scriptsById.get(e)}getScriptById(e){let t=this.scriptsById.get(e);return t&&"source"in t?t:void 0}getSourceByOriginalUrl(e){return this._sourceByOriginalUrl.get(e)}getSourceReference(e){let t=(0,rS.xxHash32)(e)&tS;for(let r=0;r<65535;r++){if(!this._sourceByReference.has(t))return t;t===tS&&(t=0),t++}return this.logger.assert(!1,"Max iterations exceeding for source reference assignment"),t}async preferredUiLocation(e){let t=!1,r=4;for(;;){let o=await this._originalPositionFor(e);if(!YI(o)){r=t?void 0:o;break}e=o,t=!0,r=void 0}return{...e,isMapped:t,unmappedReason:r}}async currentSiblingUiLocations(e,t){let r=await this._uiLocations(e);return t?r.filter(o=>o.source===t):r}clear(e){this.scriptsById.clear();for(let t of this._sourceByReference.values())this.removeSource(t,e);this._sourceByReference.clear(),this.sourceMapFactory instanceof Nn&&this.sourceMapFactory.invalidateCache()}async _uiLocations(e){let[t,r]=await Promise.all([this.getSourceMapUiLocations(e),this.getCompiledLocations(e)]);return[...t,e,...r]}async getSourceMapUiLocations(e){let t=await this._originalPositionFor(e);if(!YI(t))return[];let r=await this.getSourceMapUiLocations(t);return r.push(t),r}async _originalPositionFor(e){if(!Ot(e.source))return 1;let t=await Ol.waitForValueWithTimeout(e.source.sourceMap,this._sourceMapTimeouts.resolveLocation);if(!t)return 2;if(this._doSourceMappedStepping)return this._originalPositionForMap(e,t);if(Yg(t)){let r=await t.disassembledPositionFor(new Ne(e.lineNumber,e.columnNumber)),o=r&&e.source.sourceMap.sourceByUrl.get(r.url);if(o)return o?{columnNumber:r.position.base1.lineNumber,lineNumber:r.position.base1.lineNumber,source:o}:3}return 0}async _originalPositionForMap(e,t){let r=e.source;if(!Ot(r))return 1;if(this._temporarilyDisabledSourceMaps.has(r)||this._permanentlyDisabledSourceMaps.has(r))return 0;let o=await this.getOptiminalOriginalPosition(t,Qv(e,r.inlineScriptOffset));if(!o)return 3;let i=r.sourceMap.sourceByUrl.get(o.url);if(!i)return 3;let s=o.position.base1;return{lineNumber:s.lineNumber,columnNumber:s.columnNumber,source:i}}async getCompiledLocations(e){if(!(e.source instanceof Ge))return[];let t=[];for(let[r,o]of e.source.compiledToSourceUrl){let i=await Ol.waitForValueWithTimeout(r.sourceMap,this._sourceMapTimeouts.resolveLocation);if(!i)continue;let s;if("decompiledUrl"in i){let a=await i.compiledPositionFor(o,new Ne(e.lineNumber,e.columnNumber));if(!a)continue;s=a.map(c=>({lineNumber:c.base1.lineNumber,columnNumber:c.base1.columnNumber,source:r}))}else{let a=this.sourceMapFactory.guardSourceMapFn(i,()=>zu(o,e,i),ZI);if(!a||a.line===null)continue;let{lineNumber:c,columnNumber:l}=Kv({lineNumber:a.line||1,columnNumber:(a.column||0)+1},r.inlineScriptOffset),p={lineNumber:c,columnNumber:l,source:r};s=[p,...await this.getCompiledLocations(p)]}t=t.concat(s)}return t}async getOptiminalOriginalPosition(e,t){if(Yg(e))return await e.originalPositionFor(new Ne(t.lineNumber,t.columnNumber));let r=this.sourceMapFactory.guardSourceMapFn(e,()=>{let o=e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:Fd.GREATEST_LOWER_BOUND});return o.line!==null?o:e.originalPositionFor({line:t.lineNumber,column:t.columnNumber-1,bias:Fd.LEAST_UPPER_BOUND})},ZI);if(!(r.column===null||r.line===null||r.source===null))return{position:new $t(r.line,r.column),url:r.source}}async addSource(e,t,r,o,i,s){let a=await this.sourcePathResolver.urlToAbsolutePath({url:e.url});this.logger.verbose("runtime.sourcecreate","Creating source from url",{inputUrl:e.url,absolutePath:a});let c;return e.scriptLanguage==="WebAssembly"?c=new Ju(this,e,a):c=new _i(this,e.url,a,t,r&&this.sourcePathResolver.shouldResolveSourceMap({sourceMapUrl:r,compiledPath:a||e.url})?{sourceMapUrl:r,compiledPath:a||e.url,cacheKey:e.hash}:void 0,o,i,s),this._addSource(c),c}async _addSource(e){let t=e.url&&this._sourceByOriginalUrl.get(e.url);t&&!eS(t,e)&&this.removeSource(t,!0),this._sourceByOriginalUrl.set(e.url,e),this._sourceByReference.set(e.sourceReference,e),e instanceof Ge&&this._sourceMapSourcesByUrl.set(e.url,e);let r=this._sourceByAbsolutePath.get(e.absolutePath);(r===void 0||r.url.length>=e.url.length||eS(r,e))&&this._sourceByAbsolutePath.set(e.absolutePath,e),this.scriptSkipper.initializeSkippingValueForSource(e),e.sendLazy||this.emitLoadedSource(e),Ai(e)?this._finishAddSourceWithSourceMap(e):Fi(e)&&this._finishAddSourceWithWasm(e)}async _finishAddSourceWithWasm(e){let t=await this.wasmSymbols.loadWasmSymbols(e.event),r=[];for(let o of t.files){let i,s,a;o===t.decompiledUrl?(i=Ad(e.absolutePath),s=Ad(e.url),a=()=>t.getDisassembly()):(i=await this.sourcePathResolver.urlToAbsolutePath({url:o}),s=i?Q(i):o,a=()=>this.resourceProvider.fetch(s).then(l=>l.body)),this.logger.verbose("runtime.sourcecreate","Creating wasm source from source map",{inputUrl:o,absolutePath:i,resolvedUrl:s});let c=new Ge(this,s,i,a);c.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,c),r.push(this._addSource(c))}await Promise.all(r),e.sourceMap.value.resolve(t)}async _finishAddSourceWithSourceMap(e){let t=e.sourceMap.value,r;try{r=await this.sourceMapFactory.load(e.sourceMap.metadata)}catch(o){if(this.initializeConfig.clientID==="visualstudio"){let i=e.sourceMap.metadata.sourceMapUrl;try{let s=await this.sourcePathResolver.urlToAbsolutePath({url:i});s&&(e.sourceMap.metadata.sourceMapUrl=Q(s)),r=await this.sourceMapFactory.load(e.sourceMap.metadata),this._statistics.fallbackSourceMapCount++,this.logger.info("sourcemap.parsing","Failed to process original source-map; falling back to storage source-map",{fallbackSourceMapUrl:e.sourceMap.metadata.sourceMapUrl,originalSourceMapUrl:i,originalSourceMapError:Rh(o)})}catch{}}if(r===void 0)return this._dap.output({output:nd(e.url,o.message).error.format+`
`,category:"stderr"}),t.resolve(void 0)}if(this._sourceByReference.get(e.sourceReference)!==e)return t.resolve(void 0);this.logger.verbose("sourcemap.parsing","Creating sources from source map",{sourceMapId:r.id,metadata:r.metadata});try{await this._addSourceMapSources(e,r)}finally{t.resolve(r)}this.scriptSkipper.initializeSkippingValueForSource(e)}removeSource(e,t=!1){let r=this._sourceByReference.get(e.sourceReference);if(r!==void 0){if(this.logger.assert(e===r,"Expected source to be the same as the existing reference"),this._sourceByReference.delete(e.sourceReference),this._sourceByOriginalUrl.get(e.url)===e&&this._sourceByOriginalUrl.delete(e.url),e instanceof Ge){this._sourceMapSourcesByUrl.delete(e.url);for(let[o,i]of e.compiledToSourceUrl)o.sourceMap.sourceByUrl.delete(i)}this._sourceByAbsolutePath.delete(e.absolutePath),Ot(e)&&(this._permanentlyDisabledSourceMaps.delete(e),this._temporarilyDisabledSourceMaps.delete(e)),!t&&e.hasBeenAnnounced&&e.toDap().then(o=>this._dap.loadedSource({reason:"removed",source:o})),Fi(e)&&e.sourceMap.value.promise.then(o=>o?.dispose()),Ot(e)&&this._removeSourceMapSources(e,t)}}emitLoadedSource(e){return e.hasBeenAnnounced=!0,e.toDap().then(t=>this._dap.loadedSource({reason:"new",source:t}))}async _addSourceMapSources(e,t){let r=[];for(let o of t.sources){if(o===null)continue;let i=await this.sourcePathResolver.urlToAbsolutePath({url:o,map:t}),s=i?Q(i):t.computedSourceUrl(o),a=this._sourceMapSourcesByUrl.get(s);if(e===a)continue;if(a)if(uE(e.url))this.removeSource(a);else{a.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,a);continue}this.logger.verbose("runtime.sourcecreate","Creating source from source map",{inputUrl:o,sourceMapId:t.id,absolutePath:i,resolvedUrl:s});let c=i&&Q(i),l=this.sourceMapFactory.guardSourceMapFn(t,()=>t.sourceContentFor(o),()=>null),p;if(l){let g=Zs(l);if(g&&(!vt(g)&&i?p=Xr(i?Q(i):o,g):p=g),i&&p){let w={sourceMapUrl:p,compiledPath:i};this.sourcePathResolver.shouldResolveSourceMap(w)||(p=void 0)}}let u=new Ge(this,s,i,l!==null?()=>Promise.resolve(l):c?()=>this.resourceProvider.fetch(c).then(g=>g.body):()=>e.content(),p?{compiledPath:i||s,sourceMapUrl:p,cacheKey:t.metadata.cacheKey}:void 0,void 0,e.runtimeScriptOffset);u.compiledToSourceUrl.set(e,o),e.sourceMap.sourceByUrl.set(o,u),r.push(this._addSource(u))}await Promise.all(r)}_removeSourceMapSources(e,t){for(let r of e.sourceMap.sourceByUrl.keys()){let o=e.sourceMap.sourceByUrl.get(r);o&&(e.sourceMap.sourceByUrl.delete(r),o.compiledToSourceUrl.delete(e),!o.compiledToSourceUrl.size&&this.removeSource(o,t))}}async waitForSourceMapSources(e){return Ot(e)?[...(await Ol.waitForSources(e.sourceMap)).values()]:[]}async revealUiLocation(e){this._dap.revealLocationRequested({source:await e.source.toDap(),line:e.lineNumber,column:e.columnNumber})}disableSourceMapForSource(e,t=!1){t?this._permanentlyDisabledSourceMaps.add(e):this._temporarilyDisabledSourceMaps.add(e)}clearDisabledSourceMaps(e){e?this._temporarilyDisabledSourceMaps.delete(e):this._temporarilyDisabledSourceMaps.clear()}};ut=h([(0,_r.injectable)(),d(0,(0,_r.inject)(zt)),d(1,(0,_r.inject)(Io)),d(2,(0,_r.inject)(L)),d(3,(0,_r.inject)(re)),d(4,(0,_r.inject)(Jt)),d(5,(0,_r.inject)(Te)),d(6,(0,_r.inject)(Wn)),d(7,(0,_r.inject)(Ni)),d(8,(0,_r.inject)(_d))],ut)});var To,oS,nS,iS,Ar,Un=m(()=>{"use strict";To=require("inversify");O();U();le();$();V();J();eo();ge();TI();wh();md();xh();Ch();UI();VI();Yl();ep();Zr();tn();oS=n=>n.originalPosition.columnNumber===1&&n.originalPosition.lineNumber===1,nS=500,iS=Symbol("DontCompare"),Ar=class{constructor(e,t,r,o,i,s,a){this.logger=r;this.launchConfig=o;this.conditionFactory=i;this.suggester=s;this._breakpointsPredictor=a;this._resolvedBreakpoints=new Map;this._totalBreakpointsCount=0;this._launchBlocker=new Set;this._predictorDisabledForTest=!1;this._breakpointsStatisticsCalculator=new pd;this.entryBreakpointMode=0;this._enabledFilter=()=>!0;this._byDapId=new Map;this._byPath=Li();this._byRef=new Map;this.moduleEntryBreakpoints=Li();this._dap=e,this._sourceContainer=t,a?.onLongParse(()=>e.longPrediction({})),t.onScript(c=>{c.source.then(l=>{let p=this._thread;p&&this._byRef.get(l.sourceReference)?.forEach(u=>u.updateForNewLocations(p,c))})}),t.onSourceMappedSteppingChange(()=>{if(this._thread)for(let c of this._byDapId.values())c.refreshUiLocations(this._thread)}),this._scriptSourceMapHandler=async(c,l)=>{if(!r.assert(this._thread,"Expected thread to be set for the breakpoint source map handler"))return[];let p=[],u=[l];for(let g=0;g<u.length;g++)for(let w of u[g]){let I=w.absolutePath,v=I?this._byPath.get(I):void 0;for(let z of v||[])p.push(z.updateForNewLocations(this._thread,c));let A=this._byRef.get(w.sourceReference);for(let z of A||[])p.push(z.updateForNewLocations(this._thread,c));w.sourceMap&&u.push(w.sourceMap.sourceByUrl.values())}return Go(await Promise.all(p))}}get appliedByPath(){return this._byPath}get appliedByRef(){return this._byRef}hasAtLocation(e){let t=this._byPath.get(e.source.absolutePath)||[],r=this._byRef.get(e.source.sourceReference)||[];return t.concat(r).some(o=>o.originalPosition.columnNumber===e.columnNumber&&o.originalPosition.lineNumber===e.lineNumber)}async moveBreakpoints(e,t,r,o){let i=p=>Wy(p,async u=>{let g=await this._sourceContainer.getOptiminalOriginalPosition(r,u.originalPosition);if(!g)return!1;let w=g.position.base1;return u.updateSourceLocation(e,{path:o.absolutePath,sourceReference:o.sourceReference},{lineNumber:w.lineNumber,columnNumber:w.columnNumber,source:o}),!1}),s=t.absolutePath,a=o.absolutePath,c=s?this._byPath.get(s):void 0;if(c&&a){let[p,u]=await i(c);this._byPath.set(s,p),this._byPath.set(a,u)}let l=this._byRef.get(t.sourceReference);if(l){let[p,u]=await i(l);this._byRef.set(t.sourceReference,p),this._byRef.set(o.sourceReference,u)}}async updateEntryBreakpointMode(e,t){if(t===this.entryBreakpointMode)return;let r=[...this.moduleEntryBreakpoints.values()];this.moduleEntryBreakpoints.clear(),this.entryBreakpointMode=t,await Promise.all(r.map(o=>this.ensureModuleEntryBreakpoint(e,o.source)))}async applyEnabledFilter(e,t=iS){if(t!==iS&&this._enabledFilter!==t)return;this._enabledFilter=e||(()=>!0);let r=this._thread;r&&await Promise.all([...this._byDapId.values()].map(o=>this._enabledFilter(o)?o.enable(r):o.disable()))}async getBreakpointLocations(e,t,r,o){let i=r.base1,s=o.base1,[a,c]=await Promise.all([this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:i.lineNumber,columnNumber:i.columnNumber}),this._sourceContainer.currentSiblingUiLocations({source:t,lineNumber:s.lineNumber,columnNumber:s.columnNumber})]);if(a.length!==c.length)return this.logger.warn("internal","Expected to have the same number of start and end locations"),[];let l=[],p=[];for(let u=0;u<a.length;u++){let g=a[u],w=c[u];if(g.source!==w.source){this.logger.warn("internal","Expected to have the same number of start and end scripts");continue}let I=g.source;if(!I.scripts.length)continue;let{scriptId:v}=I.scripts[I.scripts.length-1];l.push(e.cdp().Debugger.getPossibleBreakpoints({restrictToFunction:!1,start:{scriptId:v,...I.offsetSourceToScript(Xo(g))},end:{scriptId:v,...I.offsetSourceToScript(Xo(w))}}).then(A=>{if(A?.locations)return Promise.all(A.locations.map(async z=>{let{lineNumber:De,columnNumber:R=0}=z,Z=await this._sourceContainer.currentSiblingUiLocations({source:I,...I.offsetScriptToSource(Xv({lineNumber:De,columnNumber:R}))});p.push({breakLocation:z,uiLocations:Z})}))}))}return await Promise.all(l),p}setThread(e){this._thread=e,this._thread.cdp().Debugger.on("breakpointResolved",async t=>{let r=this._resolvedBreakpoints.get(t.breakpointId)||await x(0).then(()=>this._resolvedBreakpoints.get(t.breakpointId));r&&r.updateUiLocations(e,t.breakpointId,[t.location])}),this._thread.setSourceMapDisabler(t=>{let r=[];for(let o of t){let i=this._resolvedBreakpoints.get(o);if(i){let s=this._sourceContainer.source(i.source);Ot(s)&&r.push(s)}}return r});for(let t of this._byPath.values())t.forEach(r=>this._setBreakpoint(r,e)),this.ensureModuleEntryBreakpoint(e,t[0]?.source);for(let t of this._byRef.values())t.forEach(r=>this._setBreakpoint(r,e));"runtimeSourcemapPausePatterns"in this.launchConfig&&this.launchConfig.runtimeSourcemapPausePatterns.length&&this.setRuntimeSourcemapPausePatterns(e,this.launchConfig.runtimeSourcemapPausePatterns),this._byDapId.size>0&&this._installSourceMapHandler(this._thread)}async launchBlocker(){ud(this.logger,"BreakpointManager.launchBlocker",async()=>{this._predictorDisabledForTest||await Promise.all([...this._launchBlocker])})}setRuntimeSourcemapPausePatterns(e,t){return Promise.all(t.map(r=>this._setBreakpoint(new Zl(this,r),e)))}addLaunchBlocker(...e){for(let t of e)this._launchBlocker.add(t),t.finally(()=>this._launchBlocker.delete(t))}setPredictorDisabledForTest(e){this._predictorDisabledForTest=e}_installSourceMapHandler(e){let t=this.launchConfig.perScriptSourcemaps==="yes",r;t?r=Promise.all([this.updateEntryBreakpointMode(e,1),e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler)]).then(()=>!0):this._breakpointsPredictor&&!this.launchConfig.pauseForSourceMap?r=e.setScriptSourceMapHandler(!1,this._scriptSourceMapHandler):r=e.setScriptSourceMapHandler(!0,this._scriptSourceMapHandler),this._sourceMapHandlerInstalled={entryBpSet:r}}async _uninstallSourceMapHandler(e){e.setScriptSourceMapHandler(!1),this._sourceMapHandlerInstalled=void 0}_setBreakpoint(e,t){this._enabledFilter(e)&&this.addLaunchBlocker(Promise.race([x(nS),e.enable(t)]))}async setBreakpoints(e,t){!this._sourceMapHandlerInstalled&&this._thread&&e.breakpoints?.length&&this._installSourceMapHandler(this._thread);let r=await this._sourceMapHandlerInstalled?.entryBpSet;e.source.path=ee(e.source.path,!0);let o=this._sourceContainer.source(e.source);if(!r&&this._breakpointsPredictor&&!o){let p=this._breakpointsPredictor.predictBreakpoints(e);this.addLaunchBlocker(p),await p}let i=this._thread;if(i?.debuggerReady.hasSettled()===!1){let p=i.debuggerReady.promise;this.addLaunchBlocker(p),await p}let s=p=>{let u={unbound:p.slice(),new:[],list:[]};if(!e.breakpoints)return u;for(let g=0;g<e.breakpoints.length;g++){let w=e.breakpoints[g],I;try{I=new Lr(this,t[g],e.source,w,this.conditionFactory.getConditionFor(w))}catch(z){if(!(z instanceof k))throw z;this._dap.output({category:"stderr",output:z.message}),I=new kd(this,t[g],e.source,w)}let v=u.unbound.findIndex(z=>z.equivalentTo(I)),A=u.unbound[v];A?.equivalentTo?.(I)?(u.list.push(A),u.unbound.splice(v,1)):(u.new.push(I),u.list.push(I),this._byDapId.set(I.dapId,I))}return u},a=()=>e.source.sourceReference?this._byRef.get(e.source.sourceReference):e.source.path?this._byPath.get(e.source.path):void 0,c=s(a()??[]);if(e.source.sourceReference)this._byRef.set(e.source.sourceReference,c.list);else if(e.source.path)this._byPath.set(e.source.path,c.list);else return{breakpoints:[]};if(c.unbound.length===0&&c.new.length===0)return{breakpoints:[]};if(this._totalBreakpointsCount-=c.unbound.length,await Promise.all(c.unbound.map(p=>(this._byDapId.delete(p.dapId),p.disable()))),this._totalBreakpointsCount+=c.new.length,this._thread&&(this._totalBreakpointsCount===0&&this._sourceMapHandlerInstalled?this._uninstallSourceMapHandler(this._thread):this._totalBreakpointsCount>0&&!this._sourceMapHandlerInstalled&&this._installSourceMapHandler(this._thread)),i&&c.new.length){this.ensureModuleEntryBreakpoint(i,e.source);let p=a(),u=Promise.all(c.new.filter(this._enabledFilter).filter(g=>p?.includes(g)).map(g=>g.enable(i)));this.addLaunchBlocker(Promise.race([x(nS),u])),await u}let l=await Promise.all(c.list.map(p=>p.toDap()));return this._breakpointsStatisticsCalculator.registerBreakpoints(l),x(0).then(()=>c.new.forEach(p=>p.markSetCompleted())),{breakpoints:l}}async notifyBreakpointChange(e,t){if(!this._byDapId.has(e.dapId))return;let r=await e.toDap();r.verified&&(this._breakpointsStatisticsCalculator.registerResolvedBreakpoint(e.dapId),this.suggester.notifyVerifiedBreakpoint()),t&&this._dap.breakpoint({reason:"changed",breakpoint:r})}isEntrypointBreak(e,t){return[...this.moduleEntryBreakpoints.values()].some(o=>o.enabled&&o.cdpScriptIds.has(t))?!0:e.some(o=>{let i=this._resolvedBreakpoints.get(o);return i&&(i instanceof xo||oS(i))})}async disableEntrypointBreaks(e){await Promise.all([...this.moduleEntryBreakpoints.values()].map(t=>{if(t.enabled&&t.cdpScriptIds.has(e))return t.disable()}))}isEntrypointCdpBreak(e){return this._resolvedBreakpoints.get(e)instanceof xo}async shouldPauseAt(e,t,r,o=!1){if(!t.length)return e.reason!=="instrumentation";let i=0,s=o?1:0;return await Promise.all(t.map(async a=>{if(r?.cdpId===a){i++;return}let c=this._resolvedBreakpoints.get(a);if(c instanceof xo){this.entryBreakpointMode===0&&!(c instanceof Zl)&&c.disable(),s++;return}c instanceof Lr&&(await c.testHitCondition(e)?i++:s++)})),i>0||s===0}registerBreakpointsHit(e){for(let t of e){let r=this._resolvedBreakpoints.get(t);r instanceof Lr&&this._breakpointsStatisticsCalculator.registerBreakpointHit(r.dapId)}}statisticsForTelemetry(){return this._breakpointsStatisticsCalculator.statistics()}ensureModuleEntryBreakpoint(e,t){if(!t.path||(this._byPath.get(t.path)??[]).some(oS))return;let o=xo.getModeKeyForSource(this.entryBreakpointMode,t.path);if(!t.path||this.moduleEntryBreakpoints.has(o))return;let i=new xo(this,t,this.entryBreakpointMode);this.moduleEntryBreakpoints.set(t.path,i),this._setBreakpoint(i,e)}executionContextWasCleared(){for(let e of this._byDapId.values())e.executionContextWasCleared()}async reapply(){let e=[...this._byDapId.values()];if(await Promise.all(e.map(t=>t.disable())),this._thread){let t=this._thread;await Promise.all(e.map(r=>r.enable(t)))}}};Ar=h([(0,To.injectable)(),d(0,(0,To.inject)(zt)),d(1,(0,To.inject)(ut)),d(2,(0,To.inject)(L)),d(3,(0,To.inject)(re)),d(4,(0,To.inject)(wd)),d(5,(0,To.inject)(je)),d(6,(0,To.inject)($i))],Ar)});var Le,np,sS=m(()=>{"use strict";Le=class n{static{this.Undefined=new n(void 0)}constructor(e){this.element=e,this.next=n.Undefined,this.prev=n.Undefined}},np=class{constructor(){this._first=Le.Undefined;this._last=Le.Undefined;this._size=0}get size(){return this._size}isEmpty(){return this._first===Le.Undefined}clear(){let e=this._first;for(;e!==Le.Undefined;){let t=e.next;e.prev=Le.Undefined,e.next=Le.Undefined,e=t}this._first=Le.Undefined,this._last=Le.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let r=new Le(e);if(this._first===Le.Undefined)this._first=r,this._last=r;else if(t){let i=this._last;this._last=r,r.prev=i,i.next=r}else{let i=this._first;this._first=r,r.next=i,i.prev=r}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(r))}}shift(){if(this._first!==Le.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Le.Undefined){let e=this._last.element;return this._remove(this._last),e}}applyFilter(e){let t=this._first;for(;t!==Le.Undefined;){let r=t.next;e(t.element)||this._remove(t),t=r}}_remove(e){if(e.prev!==Le.Undefined&&e.next!==Le.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Le.Undefined&&e.next===Le.Undefined?(this._first=Le.Undefined,this._last=Le.Undefined):e.next===Le.Undefined?(this._last=this._last.prev,this._last.next=Le.Undefined):e.prev===Le.Undefined&&(this._first=this._first.next,this._first.prev=Le.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Le.Undefined;)yield e.element,e=e.next}}});function Xt(n,e,t){if(e.isCancellationRequested)return Promise.reject(new Rt(t||"Task cancelled"));let r=ye(),o=e.onCancellationRequested(r.resolve);return Promise.race([r.promise.then(()=>{throw new Rt(t||"Task cancelled")}),n.then(i=>(o.dispose(),i)).catch(i=>{throw o.dispose(),i})])}function cS(n,e){let t=new we(e),r=n.map(async o=>{try{return await o(t.token)}finally{t.cancel()}});return Promise.race(r)}var Rt,lS,Je,Eh,we,Ta,Ke=m(()=>{"use strict";Ie();ge();H();$();Rt=class extends k{constructor(e){super({id:9243,format:e,showUser:!0}),this._cause={id:9243,format:e,showUser:!0}}};lS=Object.freeze(function(n,e){let t=setTimeout(n.bind(e),0);return{dispose(){clearTimeout(t)}}}),Je=Object.freeze({isCancellationRequested:!1,onCancellationRequested:()=>({dispose:()=>{}})}),Eh=Object.freeze({isCancellationRequested:!0,onCancellationRequested:lS}),we=class n{constructor(e){this._token=void 0;this._parentListener=void 0;this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}static withTimeout(e,t){let r=new n(t),o=r._token=new Ta,i=setTimeout(()=>o.cancel(),e);return o.onCancellationRequested(()=>clearTimeout(i)),r}get token(){return this._token||(this._token=new Ta),this._token}cancel(){this._token?this._token instanceof Ta&&this._token.cancel():this._token=Eh}dispose(e=!1){e&&this.cancel(),this._parentListener&&this._parentListener.dispose(),this._token?this._token instanceof Ta&&this._token.dispose():this._token=Je}},Ta=class{constructor(){this._isCancelled=!1;this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?lS:(this._emitter||(this._emitter=new S),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}});var pS,uS=m(()=>{"use strict";pS=(n,e)=>n+Math.floor(Math.random()*(e-n))});async function Qe({min:n=53e3,max:e=54e3,attempts:t=1e3,tester:r=gS}={},o=Je){let i=pS(n,e);for(let s=Math.min(t,e-n);;s--)try{return await r(i,o)}catch(a){if(s===0||a instanceof Rt)throw a;i=i===e-1?n:i+1}}async function fS(n,e){try{return await gS(n,e),!0}catch{return!1}}function gS(n,e=Je){let t;return new Promise((r,o)=>{let i=dS.createServer();i.listen(n,"127.0.0.1",()=>{let s=i.address();i.close(()=>r(s.port))}),i.on("error",o),t=e.onCancellationRequested(()=>{i.close(),o(new Rt("Port open lookup cancelled"))})}).finally(()=>t?.dispose())}var dS,mS,hS,bS,Vn=m(()=>{"use strict";dS=y(require("net")),mS=y(require("ws"));Ke();uS();hS=n=>(e,t)=>bS(new mS.WebSocketServer({host:"127.0.0.1",...n,port:e}),t),bS=(n,e)=>{let t;return new Promise((r,o)=>{n.on("error",o),n.on("listening",()=>r(n)),t=e.onCancellationRequested(()=>{n.close(),o(new Rt("Port open lookup cancelled"))})}).finally(()=>t?.dispose())}});var Md,Nd,Dt,Ra,rn=m(()=>{"use strict";Md=require("inversify");Ke();H();Vn();$();X();Nd=async(n,e,t)=>{let r=await Qe({tester:hS(e)},t),o=n.register(r.address().port);return r.on("close",()=>o.dispose()),r.on("error",()=>o.dispose()),r},Dt=Symbol("IPortLeaseTracker"),Ra=class{constructor(e){this.usedPorts=new Set;this.onRegistered=new S;this.isMandated=e==="remote"}register(e){return this.usedPorts.add(e),this.onRegistered.fire(e),{dispose:()=>this.usedPorts.delete(e)}}isRegistered(e,t=2e3){return this.usedPorts.has(e)?Promise.resolve(!0):e<53e3||e>=54e3?Promise.resolve(!1):cS([()=>x(t).then(()=>!1),r=>new Promise(o=>{let i=this.onRegistered.event(s=>{s===e&&o(!0)});r.onCancellationRequested(()=>i.dispose())})])}};Ra=h([(0,Md.injectable)(),d(0,(0,Md.inject)(to))],Ra)});var vS,La,wS,yS,_h,Od,Da,fE,Ah,Fh=m(()=>{"use strict";vS=require("crypto"),La=require("inversify");tt();sS();st();O();rn();wS="JsDebug",yS="*",_h=class{constructor(){this.replays=new Map}addReplay(e,t,r){let o=this.replays.get(e);return o||(o=new np,this.replays.set(e,o)),o.push({event:`${e}.${t}`,params:r})}capture(e,t,r,o){let i=e[t];if(o===0)i.on(r,s=>this.addReplay(t,r,s));else if(o===2){let s;i.on(r,a=>{s?.(),s=this.addReplay(t,r,a)})}else{let s=new np;i.on(r,a=>{s.size===o.cap&&s.shift()?.(),s.push(this.addReplay(t,r,a))})}}filter(e,t){let r=this.replays.get(e);r&&r.applyFilter(t)}clearEvent(e,t){let r=`${e}.${t}`;this.filter(e,o=>o.event!==r)}clearDomain(e){this.replays.delete(e)}read(e){return this.replays.get(e)??[]}},Od=Symbol("ICdpProxyProvider"),Da=class{constructor(e,t,r){this.cdp=e;this.portTracker=t;this.logger=r;this.disposables=new q;this.replay=new _h;this.jsDebugApi={subscribe:(e,{events:t})=>{for(let r of t)r.endsWith(yS)?e.pushDisposable(this.cdp.session.onPrefix(r.slice(0,-yS.length),o=>e.send({method:o.method,params:o.params}))):e.pushDisposable(this.cdp.session.on(r,o=>e.send({method:r,params:o})));return{}}};this.replay.capture(e,"CSS","styleSheetAdded",0),this.replay.capture(e,"Debugger","paused",2),this.replay.capture(e,"Runtime","executionContextCreated",{cap:50,type:1}),this.replay.capture(e,"Runtime","consoleAPICalled",{cap:50,type:1}),e.Debugger.on("resumed",()=>{this.replay.clearEvent("Debugger","paused")}),e.CSS.on("fontsUpdated",o=>{o.font&&this.replay.addReplay("CSS","fontsUpdated",o)}),e.CSS.on("styleSheetRemoved",o=>this.replay.filter("CSS",i=>i.params.styleSheetId!==o.styleSheetId))}async proxy(){this.server||(this.server=this.createServer());let{server:e,path:t}=await this.server,r=e.address();return{host:r.address,port:r.port,path:t}}async createServer(){let e=`/${(0,vS.randomBytes)(20).toString("hex")}`,t=await Nd(this.portTracker,{perMessageDeflate:!0,path:e});return this.logger.info("proxyActivity","activated cdp proxy"),t.on("connection",r=>{let o=new Ah(r,this.logger);this.logger.info("proxyActivity","accepted proxy connection",{id:o.id}),r.on("close",()=>{this.logger.verbose("proxyActivity","closed proxy connection",{id:o.id}),this.disposables.disposeObject(o)}),r.on("message",async i=>{let s;try{s=JSON.parse(i.toString())}catch(g){return o.send({id:0,error:{code:-32700,message:g.message}})}this.logger.verbose("proxyActivity","received proxy message",s);let{method:a,params:c,id:l=0}=s,[p,u]=a.split(".");try{let g=p===wS?await this.invokeJsDebugDomainMethod(o,u,c):await this.invokeCdpMethod(o,p,u,c);o.send({id:l,result:g})}catch(g){let w=g instanceof qi&&g.cause?g.cause:{code:0,message:g.message};o.send({id:l,error:w})}})}),{server:t,path:e}}dispose(){this.disposables.dispose(),this.server?.then(e=>e.server.close()),this.server=void 0}invokeCdpMethod(e,t,r,o){let i=this.cdp.session.sendOrDie(`${t}.${r}`,o);switch(r){case"enable":for(let s of this.replay.read(t))e.send({method:s.event,params:s.params});break;case"disable":this.replay.clearDomain(t);break;default:}return i}invokeJsDebugDomainMethod(e,t,r){if(!this.jsDebugApi.hasOwnProperty(t))throw new qi(t).setCause(-32601,`${wS}.${t} not found`);return this.jsDebugApi[t](e,r)}};Da=h([(0,La.injectable)(),d(0,(0,La.inject)(Be)),d(1,(0,La.inject)(Dt)),d(2,(0,La.inject)(L))],Da);fE=0,Ah=class{constructor(e,t){this.webSocket=e;this.logger=t;this.disposables=new q;this.id=fE++}pushDisposable(e){this.disposables.push(e)}dispose(){this.disposables.dispose(),this.webSocket.close()}send(e){this.logger.verbose("proxyActivity","send proxy message",e),this.webSocket.send(JSON.stringify(e))}}});var IS,ip,$n,Bd=m(()=>{"use strict";IS=require("inversify"),ip=Symbol("IClientCapabilies"),$n=class{};$n=h([(0,IS.injectable)()],$n)});var Mh,SS,kS=m(()=>{"use strict";jd();Ze();Mh=Ye(function(n,e,t){let r=t?"variable":"property",o=(p,u,g)=>{if(u!=="function")return r;if(p==="constructor")return"class";let w=String(g);return w.startsWith("class ")||w.includes("[native code]")&&/^[A-Z]/.test(p)?"class":t?"function":"method"},i=p=>{switch(typeof p){case"number":case"boolean":return`${p}`;case"object":return p===null?"null":p.constructor.name||"object";case"function":return`fn(${new Array(p.length).fill("?").join(", ")})`;default:return typeof p}},s=[],a=new Set,c="~",l=n===void 0?this:n;for(;l!=null;l=l.__proto__){c+="~";let p=Object.getOwnPropertyNames(l).filter(u=>u.startsWith(e)&&!u.match(/^\d+$/));for(let u of p){if(a.has(u))continue;a.add(u);let g=Object.getOwnPropertyDescriptor(l,u),w=r,I;try{let v=l[u];w=o(u,typeof g?.value,v),I=i(v)}catch{}s.push({label:u,sortText:c+u.replace(/^_+/,v=>"{".repeat(v.length)),type:w,detail:I})}t=!1}return{result:s,isArray:this instanceof Array}}),SS=Ko(Mh.source)});function hE(n){let e=!1;return Sn(n,{enter(t){if(t.type==="CallExpression"||t.type==="NewExpression"||t.type==="UnaryExpression"&&t.operator==="delete"||t.type==="ClassBody")return e=!0,0}}),e}var PS,sp,gE,Ud,Ea,jd=m(()=>{"use strict";PS=require("./vendor/acorn-loose.js"),sp=require("inversify");tt();Ri();Yr();Hi();kS();gE=n=>{switch(n.type){case"ClassDeclaration":case"ClassExpression":return{type:"class",id:n.id};case"MethodDefinition":return{type:n.key?.type==="Identifier"&&n.key.name==="constructor"?"constructor":"method",id:n.key};case"VariableDeclarator":return{type:n.init?.type==="FunctionExpression"||n.init?.type==="ArrowFunctionExpression"?"function":"variable",id:n.id}}};Ud=Symbol("ICompletions"),Ea=class{constructor(e,t){this.evaluator=e;this.cdp=t}async completions(e){let t=ho(e.expression),r=new Cn(e.expression).convert(e.position),o=()=>Promise.resolve([]);return Sn(t,{enter:(i,s)=>{let a=i;if(a.start<r&&r<=a.end){if(i.type==="MemberExpression"||i.type==="Identifier"&&s?.type==="MemberExpression"&&!s.computed&&s.object!==i){let c=i.type==="MemberExpression"?i:s;o=c.computed?()=>this.elementAccessCompleter(e,c,r):()=>this.propertyAccessCompleter(e,c,r)}else i.type==="Identifier"&&(o=()=>this.identifierCompleter(e,t,i,r));s=i}}}),o().then(i=>i.sort((s,a)=>s.sortText>a.sortText?1:-1))}async elementAccessCompleter(e,t,r){if(t.property.type!=="Literal"||typeof t.property.value!="string")return[];let o=e.expression.slice(In(t.property)+1,r);return(await this.defaultCompletions(e,o)).filter(s=>s.sortText!=="~~[").map(s=>({...s,text:JSON.stringify(s.text??s.label)+"]",start:In(t.property),length:$g(t.property)-In(t.property)}))}async identifierCompleter(e,t,r,o){let i=[],s=In(r);Sn(t,{enter(l){let p=gE(l);p?.id?.type==="Identifier"&&i.push({label:p.id.name,type:p.type,sortText:p.id.name})}});let a=e.expression.slice(s,o),c=[...i,...await this.defaultCompletions(e,a)];this.evaluator.hasReturnValue&&e.executionContextId!==void 0&&en.startsWith(a)&&c.push({sortText:`~${en}`,label:en,type:"variable"});for(let l of c)l.start=s,l.length=o-s;return c}async propertyAccessCompleter(e,t,r){let{result:o,isArray:i}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:Iv(e.expression,t.object),prefix:(0,PS.isDummy)(t.property)?"":e.expression.slice(In(t.property),r),throwOnSideEffect:hE(t)}),s=In(t.property)-1,a=/^[$a-z_][0-9a-z_$]*$/i;for(let c of o)a.test(c.label)||(c.text=`[${JSON.stringify(c.label)}]`,c.start=s,c.length=1);if(i){let c="index";o.unshift({label:`[${c}]`,text:`[${c}]`,type:"property",sortText:"~~[",start:s,selectionStart:1,selectionLength:c.length,length:1})}return o}async completePropertyAccess({executionContextId:e,stackFrame:t,expression:r,prefix:o,isInGlobalScope:i=!1,throwOnSideEffect:s=!1}){let a={expression:`(${r})`,objectGroup:"console",silent:!0,throwOnSideEffect:s},c=t&&t.callFrameId(),l=await this.evaluator.evaluate(c?{...a,callFrameId:c}:{...a,contextId:e},{stackFrame:t});if(!l||l.exceptionDetails)return{result:[],isArray:!1};if(!l.result.objectId){let p={...a,returnByValue:!0,throwOnSideEffect:!1,expression:SS.expr(`(${r})`,JSON.stringify(o),JSON.stringify(i))},u=await this.evaluator.evaluate(c?{...p,callFrameId:c}:{...p,contextId:e});return!u||u.exceptionDetails?{result:[],isArray:!1}:u.result.value}try{return(await Mh({cdp:this.cdp,args:[void 0,o,i],objectId:l.result.objectId,returnByValue:!0})).value}catch{return{result:[],isArray:!1}}finally{this.cdp.Runtime.releaseObject({objectId:l.result.objectId})}}async defaultCompletions(e,t=""){for(let r of["self","global","this"]){let{result:o}=await this.completePropertyAccess({executionContextId:e.executionContextId,stackFrame:e.stackFrame,expression:r,prefix:t,isInGlobalScope:!0});if(e.stackFrame){let i=t.toLowerCase(),s=new Set(o.map(a=>a.label));for(let a of await e.stackFrame.completions())s.has(a.label)||!a.label.toLowerCase().includes(i)||(s.add(a.label),o.push(a))}return o.push(...this.syntheticCompletions(e,t)),o}return this.syntheticCompletions(e,t)}syntheticCompletions(e,t){return this.evaluator.hasReturnValue&&en.startsWith(t)?[{sortText:`~${en}`,label:en,type:"variable"}]:[]}};Ea=h([(0,sp.injectable)(),d(0,(0,sp.inject)(Dr)),d(1,(0,sp.inject)(Be))],Ea)});var xS,CS,qn,Nh,Wd=m(()=>{"use strict";Pr();xS=/^(\W*at .*\()(.*):(\d+):(\d+)(\))$/,CS=/^(\W*at )(.*):(\d+):(\d+)$/,qn=class{constructor(e){this.stack=e}static isStackLike(e){return xS.test(e)||CS.test(e)}*[Symbol.iterator](){for(let e of this.stack.split(`
`)){let t=xS.exec(e)||CS.exec(e);if(!t){yield e+`
`;continue}let[,r,o,i,s,a]=t;r&&(yield r),yield new Nh(o,new Ne(Number(i),Number(s))),a&&(yield a),yield`
`}}},Nh=class{constructor(e,t){this.path=e;this.position=t}toString(){return`${this.path}:${this.position.lineNumber}:${this.position.columnNumber}`}}});var Ro,Oh=m(()=>{"use strict";Ro=class{constructor(e,t){this._tokens=[];this._separator=t||"",this._budget=e-1-this._separator.length}append(e){if(e.length>this.budget()){this.appendEllipsis();return}this._append(e)}_append(e){this._tokens.length&&(this._budget-=this._separator.length),this._tokens.push(e),this._budget-=e.length}appendEllipsis(){this._tokens[this._tokens.length-1]!=="\u2026"&&this._append("\u2026")}checkBudget(){return this._budget<=0&&this.appendEllipsis(),this._budget>0}budget(){return this._budget-(this._tokens.length?this._separator.length:0)}build(){return this._tokens.join(this._separator)}isEmpty(){return!this._tokens.length}}});function wE(n,e){if(!n.includes("%"))return[{type:"string",value:n}];let t=[];function r(c){if(!c)return;let l=t[t.length-1];l?.type==="string"?l.value+=c:t.push({type:"string",value:c})}function o(c,l,p){t.push({type:"specifier",specifier:c,precision:l,substitutionIndex:p})}let i=0,s=0,a=new RegExp(`%%|%(?:(\\d+)\\$)?(?:\\.(\\d*))?([${e.join("")}])`,"g");for(let c=a.exec(n);c;c=a.exec(n)){let l=c.index;if(l>i&&r(n.substring(i,l)),c[0]==="%%")r("%");else{let[,p,u,g]=c;p&&Number(p)>0&&(s=Number(p)-1);let w=u?Number(u):void 0;o(g,w,s),++s}i=l+c[0].length}return r(n.substring(i)),t}function Bh(n,e,t){let r=wE(n,Array.from(t.keys())),o=new Set,i=t.get("");if(!i)throw new Error("Expected to hav a default formatter");let s=new Ro(bE),a=!1;for(let c=0;s.checkBudget()&&c<r.length;++c){let l=r[c];if(l.type==="string"){s.append(l.value);continue}let p=l.substitutionIndex;if(p>=e.length){s.append("%"+(l.precision||"")+l.specifier);continue}o.add(p),l.specifier==="c"&&(a=!0);let u=t.get(l.specifier)||i;s.append(u(e[p],{budget:s.budget(),quoted:!1,ansi:!0}))}a&&s.append("\x1B[0m");for(let c=0;s.checkBudget()&&c<e.length;++c)o.has(c)||(o.add(c),(n||c)&&s.append(" "),s.append(i(e[c],{budget:s.budget(),quoted:!1,ansi:!0})));return{result:s.build(),usedAllSubs:o.size===e.length}}function TS(n){try{return new RS.default(n).ansi256().object().ansi256}catch{}}function DS(n){let e=/\s*(.*?)\s*:\s*(.*?)\s*(?:;|$)/g,t="\x1B[0m",r=e.exec(n);for(;r!==null;){if(r.length===3)switch(r[1]){case"color":let o=TS(r[2]);o&&(t+=`\x1B[38;5;${o}m`);break;case"background":case"background-color":let i=TS(r[2]);i&&(t+=`\x1B[48;5;${i}m`);break;case"font-weight":r[2]==="bold"&&(t+="\x1B[1m");break;case"font-style":r[2]==="italic"&&(t+="\x1B[3m");break;case"text-decoration":r[2]==="underline"&&(t+="\x1B[4m");break;default:}r=e.exec(n)}return t}var RS,bE,Vd=m(()=>{"use strict";RS=y(require("color"));Oh();bE=1e4});var ES,vE,LS,IE,SE,kE,$d,ap=m(()=>{"use strict";ES=n=>n.replace(/\n/gm,"\\n").replace(/\r/gm,"\\r").replace(/\t/gm,"\\t"),vE={budget:1e5,quoted:!0},LS={budget:1e3,quoted:!0,postProcess:ES},IE={budget:1/0,quoted:!1},SE={budget:1e3,quoted:!0,postProcess:ES},kE={budget:1e5,quoted:!0},$d=n=>{switch(n){case"repl":return vE;case"hover":return LS;case"propertyValue":return LS;case"watch":return SE;case"copy":case"clipboard":return IE;default:return kE}}});function Ji(n){return n.type==="function"||n.type==="object"&&!Uh.has(n.subtype)}function Wh(n){return n.subtype==="array"||n.subtype==="typedarray"}function Ki(n,e,t){let r=$d(e),o=qd(n,r,t);return n.preview?.subtype==="regexp"?o:r.postProcess?.(o)??o}function qd(n,e,t){return n.type==="function"?n.description?BS(n.description,e.budget):"<function>":n.type==="object"&&n.subtype==="node"?n.description:"preview"in n&&n.preview?Hd(n.preview,e.budget,t):OS(n,e,t)}function Hd(n,e,t){return Wh(n)?RE(n,e):n.subtype==="internal#entry"?bo(n.description||"",e):n.type==="function"?BS(n.description,e):Ji(n)?DE(n,e,t):EE(n,e,t)}function RE(n,e){let t=new Ro(e),r=n.description,o=r.match(/[^(]*\(([\d]+)\)/);if(!o)return r;let i=parseInt(o[1],10);r.startsWith("Array(")&&(r=r.substring(5)),t.append(bo(r,t.budget())),t.append(" ");let s=new Ro(t.budget()-2,", "),a=-1;for(let c of n.properties){if(!s.checkBudget())break;if(isNaN(c.name))continue;let l=parseInt(c.name,10);l>a+1&&s.appendEllipsis(),a=l,s.append(cp(c,s.budget()))}i>a+1&&s.appendEllipsis();for(let c of n.properties){if(!s.checkBudget())break;isNaN(c.name)&&s.append(cp(c,s.budget(),c.name))}return n.overflow&&s.appendEllipsis(),t.append("["+s.build()+"]"),t.build()}function DE(n,e,t){let r=new Ro(e," ");n.description!=="Object"&&r.append(bo(n.description,r.budget()));let o=new Map,i=n.properties||[];for(let g of i)o.set(g.name,g);let s=o.get("[[PrimitiveValue]]");if(s)return r.append(`(${cp(s,r.budget()-2)})`),r.build();let a=o.get("[[PromiseStatus]]"),c=o.get("[[PromiseValue]]");if(a&&c)return a.value==="pending"?r.append(`{<${a.value}>}`):r.append(`{${cp(c,r.budget()-2,`<${a.value}>`)}}`),r.build();let l=o.get("[[GeneratorStatus]]");if(l)return r.append(`{<${l.value}>}`),r.build();let p=new Ro(r.budget()-2,", ");for(let g of i){if(!p.checkBudget())break;p.append(cp(g,p.budget(),g.name))}for(let g of n.entries||[]){if(!p.checkBudget())break;if(g.key){let w=Hd(g.key,Math.min(jh,p.budget()),t),I=Hd(g.value,Math.min(jh,p.budget()-w.length-4),t);p.append(_a(w," => ",I,p.budget()))}else p.append(Hd(g.value,Math.min(jh,p.budget()),t))}n.overflow&&p.appendEllipsis();let u=p.build();return u?r.append("{"+u+"}"):r.isEmpty()&&r.append("{}"),r.build()}function AS(n,e){return n.length<=e?n:"\u2026"}function LE(n,e){return n.length>=e?n.slice(0,e-1)+"\u2026":n}function EE(n,e,t){if(n.type==="object"&&n.subtype==="null")return AS("null",e);if(n.type==="undefined")return AS("undefined",e);if(n.type==="string"){let r=n.description??n.value;return t?.hex&&(r=Buffer.from(r,"utf8").toString("hex")),Gs(r,e)}return n.type==="number"||n.type==="bigint"?lp(n,!1,e,t):LE(n.description||"",e)}function _a(n,e,t,r){return n===void 0?Gs(t,r):n.length+e.length>r?bo(n,r):MS(`${n}${e}${Gs(t,r-n.length-e.length)}`)}function cp(n,e,t){return e=Math.min(e,xE),n.type==="function"?_a(t,": ","\u0192",e):n.type==="object"&&n.value==="Object"?_a(t,": ","{\u2026}",e):typeof n.value>"u"?_a(t,": ",`<${n.type}>`,e):n.type==="string"?_a(t,": ",NS(n.value),e):_a(t,": ",n.value??"unknown",e)}function MS(n){return n.replaceAll("\x1B","\\x1b")}function NS(n){let e=n.includes("'")?n.includes('"')?n.includes("`")?"'":"`":'"':"'",t=new RegExp(`[${e}\\\\]`,"g");return`${e}${n.replace(t,"\\$&")}${e}`}function OS(n,{budget:e,quoted:t,ansi:r},o){if(n.type==="string"){let i=n.value||(n.description?n.description:"");o?.hex&&(i=Buffer.from(i,"utf8").toString("hex"),t=!1);let s=Gs(i,t?e-2:e);return t&&(s=NS(s)),r?s:MS(s)}return n.type==="undefined"?"undefined":n.subtype==="null"?"null":n.type==="bigint"||n.type==="number"?lp(n,!1,e,o):n.description?bo(n.description,Math.max(e,1e5)):bo(String("value"in n?n.value:n.description),e)}function BS(n,e){let t=new Ro(e),r=n.replace(/^function [gs]et /,"function ").replace(/^function [gs]et\(/,"function(").replace(/^[gs]et /,""),o=r.match(/^(async\s+function)/),i=r.startsWith("function*"),s=r.startsWith("*"),a=!i&&r.startsWith("function"),c=r.startsWith("class ")||r.startsWith("class{"),l=r.indexOf("=>"),p=!o&&!i&&!a&&!c&&l>0,u;if(c){u=r.substring(5);let I=/^[^{\s]+/.exec(u.trim()),v="";I&&(v=I[0].trim()||""),w("class",u,v)}else if(o)u=r.substring(o[1].length),w("async \u0192",u,g(u));else if(i)u=r.substring(9),w("\u0192*",u,g(u));else if(s)u=r.substring(1),w("\u0192*",u,g(u));else if(a)u=r.substring(8),w("\u0192",u,g(u));else if(p){let I=r;r.length>PE&&(I=r.substring(0,l+2)+" {\u2026}"),w("",r,I)}else w("\u0192",r,g(r));return t.build();function g(I){let v=I.indexOf("("),A=I.match(/\)\s*{/),z=A&&A.index||0;if(v!==-1&&A&&z>v){let De=I.substring(0,v).trim()||"",R=I.substring(v,z+1);return De+R}return"()"}function w(I,v,A){t.checkBudget()&&(I.length&&t.append(I+" "),v=v.trim(),v.endsWith(" { [native code] }")&&(v=v.substring(0,v.length-18)),t.budget()>=v.length?t.append(v):t.append(A.replace(/\n/g," ")))}}function Qi(n){let e=n;if(e.type!=="object"||e.subtype==="null")return{title:OS(e,{budget:CE,quoted:!1},void 0)};let t=e.description??e.className??"Error",r=/^\s+at\s/m.exec(t);if(!r){let o=t.lastIndexOf(`
`);return o===-1?{title:t}:{title:t.substring(0,o)}}return{title:t.substring(0,r.index-1),stackTrace:t.substring(r.index+2)}}function lp(n,e,t,r){if(n.type==="number"){if("unserializableValue"in n)return n.unserializableValue;let s=n.value!==void 0?n.value:+n.description;return r?.hex?s.toString(16):String(s)}if(n.type==="bigint"){let s=n.unserializableValue||n.description;return r?.hex?BigInt(s.slice(0,-1)).toString(16):s}let o=n,i=typeof o.value=="number"?o.value:+String(o.description);return bo(String(e?Math.floor(i):i),t)}function _E(n,e){return Gs(String(typeof n.value<"u"?n.value:n.description),e)}function jS(n){let e=[],t=new Set([void 0]),r=new Map;for(let p of n.properties.filter(u=>u.valuePreview)){let u=new Map;u.set(void 0,p.name),r.set(void 0,Math.max(r.get(void 0)||0,p.name.length)),e.push(u),p.valuePreview?.properties.map(g=>{g.value&&(t.add(g.name),u.set(g.name,g.value),r.set(g.name,Math.max(r.get(g.name)||0,g.value.length)))})}for(let p of t.values())p&&r.set(p,Math.max(r.get(p)||0,p.length));let o=Array.from(r.values()).reduce((p,u)=>p+u,0),i=_S-4-(t.size-1)*3;if(o>i){let p=i/o;for(let u of r.keys()){let g=Math.max(TE,r.get(u)*p|0);r.set(u,g)}}let s=[];for(let p of t.values())s.push("-".repeat(r.get(p)));let a="[-"+s.join("-|-")+"-]",c=[];c.push(a.replace("[","\u256D").replace(/\|/g,"\u252C").replace("]","\u256E").replace(/-/g,"\u2504"));let l=[];for(let p of t.values())l.push(FS(p||"",r.get(p)));c.push("\u250A "+l.join(" \u250A ")+" \u250A"),c.push(a.replace("[","\u251C").replace(/\|/g,"\u253C").replace("]","\u2524").replace(/-/g,"\u2504"));for(let p of e){let u=[];for(let g of t.values())u.push(FS(p.get(g)||"",r.get(g)));c.push("\u250A "+u.join(" \u250A ")+" \u250A")}return c.push(a.replace("[","\u2570").replace(/\|/g,"\u2534").replace("]","\u256F").replace(/-/g,"\u2504")),c.map(p=>bo(p,_S)).join(`
`)}function FS(n,e){return n.length===e?n:n.length<e?n+" ".repeat(e-n.length):bo(n,e)}var PE,xE,jh,CE,TE,_S,Uh,Vh,Aa=m(()=>{"use strict";Oh();Yr();Vd();ap();PE=30,xE=100,jh=20,CE=1e4,TE=3,_S=120,Uh=new Set(["null","regexp","date"]);Vh=new Map([["",(n,e)=>qd(n,e)],["s",(n,e)=>_E(n,e.budget)],["i",(n,e)=>lp(n,!0,e.budget,void 0)],["d",(n,e)=>lp(n,!0,e.budget,void 0)],["f",(n,e)=>lp(n,!1,e.budget,void 0)],["c",n=>DS(n.value)],["o",(n,e)=>qd(n,e)],["O",(n,e)=>qd(n,e)]])});async function $h(n){let e=await n.uiLocation();return e?e.source.blackboxed()?2:Ot(e.source)&&!e.isMapped&&e.unmappedReason===3?1:0:0}var pp,AE,FE,Hn,zd=m(()=>{"use strict";pp=require("inversify");O();U();J();Rd();Zr();tn();up();AE=new Set(["breakpoint","exception","entry"]),FE=256,Hn=class{constructor(e,t){this.launchConfig=e;this.logger=t;this._smartStepCount=0}resetSmartStepCount(){this._smartStepCount>0&&(this.logger.verbose("internal",`smartStep: skipped ${this._smartStepCount} steps`),this._smartStepCount=0)}async getSmartStepDirection(e,t){if(!this.launchConfig.smartStep||AE.has(e.reason))return;let r=(await e.stackTrace.loadFrames(1)).find(Ci(Lt));if((r&&await $h(r))===0){this.resetSmartStepCount();return}return this._smartStepCount++>FE?2:t?.reason==="step"?t.direction:0}};Hn=h([(0,pp.injectable)(),d(0,(0,pp.inject)(re)),d(1,(0,pp.inject)(L))],Hn)});var WS,VS,Gd,qh=m(()=>{"use strict";Ze();WS=Ye(function(){return[Symbol.for("debug.description"),Symbol.for("nodejs.util.inspect.custom")]}),VS=Ko(function(n,e){let t={},r="<<default preview>>";if(typeof this!="object"||!this)return t;for(let o of Object.keys(this)){let i;try{i=this[o]}catch{continue}if(e)try{let s=e.call(i,r);if(s!==r){t[o]=String(s);continue}}catch(s){t[o]=`<<indescribable>>${JSON.stringify([String(s),o])}`;continue}if(typeof i=="object"&&i){let s;for(let a of runtimeArgs[0])if(typeof i[a]=="function")try{s=i[a](2);break}catch{}!s&&!String(i.toString).includes("[native code]")&&(s=String(i)),s&&!s.startsWith("[object ")&&(t[o]=s.length>=n?s.slice(0,n)+"\u2026":s)}}return t}),Gd=Ko(function(n,e){if(e)try{let t="<<default preview>>",r=e.call(this,t);if(r!==t)return String(r)}catch(t){return`<<indescribable>>${JSON.stringify([String(t),"object"])}`}if(typeof this=="object"&&this){let t;for(let r of[Symbol.for("debug.description"),Symbol.for("nodejs.util.inspect.custom")])if(typeof this[r]=="function")try{t=this[r](2);break}catch{}if(!t&&!String(this.toString).includes("[native code]")&&(t=String(this)),t&&!t.startsWith("[object "))return t.length>=n?t.slice(0,n)+"\u2026":t}})});var Fr,Fa=m(()=>{"use strict";Fr=class n{constructor(e=process.hrtime()){this.value=e}get ms(){return this.s*1e3}get s(){return this.value[0]+this.value[1]/1e9}elapsed(){return new n().subtract(this)}subtract(e){let t=this.value[1]-e.value[1],r=this.value[0]-e.value[0];return t<0&&(t+=1e9,r--),new n([r,t])}}});var Ma,Hh=m(()=>{"use strict";H();V();Ma=class{constructor(e,t,r,o,i,s){this.launchConfig=e;this.targetInfo=t;this.parentTarget=r;this.targetOriginValue=o;this.cdp=i;this.logger=s;this.onNameChanged=new S().event;this.attached=!1;this.isWaitingForDebugger=!0;i.pause()}id(){return this.targetInfo.targetId}name(){return this.targetInfo.title}fileName(){return this.targetInfo.url}type(){return"node"}parent(){return this.parentTarget}children(){return[]}canStop(){return!1}stop(){}canRestart(){return!1}restart(){}canAttach(){return!this.attached}async attach(){return await this.cdp.Runtime.enable({}),this.launchConfig.noDebug||await this.cdp.Debugger.enable({}),this.attached=!0,this.cdp}canDetach(){return this.attached}async detach(){await this.cdp.Debugger.resume({}),await this.cdp.NodeWorker.detach({sessionId:this.targetInfo.targetId}),this.attached=!1}targetOrigin(){return this.targetOriginValue}afterBind(){return this.cdp.resume(),Promise.resolve()}async runIfWaitingForDebugger(){this.isWaitingForDebugger=!1,await this.cdp.Runtime.runIfWaitingForDebugger({})}initialize(){return Promise.resolve()}waitingForDebugger(){return this.isWaitingForDebugger}supportsCustomBreakpoints(){return!1}supportsXHRBreakpoints(){return!1}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?Q(e):e}executionContextName(){return this.targetInfo.title}}});function Kd(){if(Jd.size)return Jd;function n(i,s){for(let a of s)a.group=i,Jd.set(a.id,a)}function e(i,s){let a=s||i;return{id:"instrumentation:"+i,title:a,group:"",details:c=>{if(i==="webglErrorFired"){let l=c.webglErrorName;return l=l.replace(/^.*(0x[0-9a-f]+).*$/i,"$1"),{short:l,long:Fe.t('Paused on WebGL Error instrumentation breakpoint, error "{0}"',l)}}return i==="scriptBlockedByCSP"&&c.directiveText?{short:Fe.t('CSP violation "{0}"',c.directiveText),long:Fe.t('Paused on Content Security Policy violation instrumentation breakpoint, directive "{0}"',c.directiveText)}:{short:a,long:Fe.t('Paused on instrumentation breakpoint "{0}"',a)}},apply:async(c,l)=>(l?await c.EventBreakpoints.setInstrumentationBreakpoint({eventName:i}):await c.EventBreakpoints.removeInstrumentationBreakpoint({eventName:i}))?!0:!!(l?await c.DOMDebugger.setInstrumentationBreakpoint({eventName:i}):await c.DOMDebugger.removeInstrumentationBreakpoint({eventName:i}))}}function t(i,s,a){let c=s===void 0?"*":typeof s=="string"?[s]:s;return{id:"listener:"+i,title:a||i,group:"",details:l=>{let p=(l.targetName||"*").toLowerCase();return{short:p+"."+i,long:Fe.t('Paused on event listener breakpoint "{0}", triggered on "{1}"',i,p)}},apply:async(l,p)=>{let u=!0;for(let g of c)p?u=u&&!!await l.DOMDebugger.setEventListenerBreakpoint({eventName:i,targetName:g}):u=u&&!!await l.DOMDebugger.removeEventListenerBreakpoint({eventName:i,targetName:g});return u}}}n("Ad Auction Worklet",[e("beforeBidderWorkletBiddingStart",Fe.t("Bidder Bidding Phase Start")),e("beforeBidderWorkletReportingStart",Fe.t("Bidder Reporting Phase Start")),e("beforeSellerWorkletScoringStart",Fe.t("Seller Scoring Phase Start")),e("beforeSellerWorkletReportingStart",Fe.t("Seller Reporting Phase Start"))]),n("Animation",[e("requestAnimationFrame",Fe.t("Request Animation Frame")),e("cancelAnimationFrame",Fe.t("Cancel Animation Frame")),e("requestAnimationFrame.callback",Fe.t("Animation Frame Fired"))]),n("Canvas",[e("canvasContextCreated",Fe.t("Create canvas context")),e("webglErrorFired",Fe.t("WebGL Error Fired")),e("webglWarningFired",Fe.t("WebGL Warning Fired"))]),n("Clipboard",[t("copy"),t("cut"),t("paste"),t("beforecopy"),t("beforecut"),t("beforepaste")]),n("Control",[t("resize"),t("scroll"),t("scrollend"),t("zoom"),t("focus"),t("blur"),t("select"),t("change"),t("submit"),t("reset")]),n("Device",[t("deviceorientation"),t("devicemotion")]),n("DOM Mutation",[t("DOMActivate"),t("DOMFocusIn"),t("DOMFocusOut"),t("DOMAttrModified"),t("DOMCharacterDataModified"),t("DOMNodeInserted"),t("DOMNodeInsertedIntoDocument"),t("DOMNodeRemoved"),t("DOMNodeRemovedFromDocument"),t("DOMSubtreeModified"),t("DOMContentLoaded")]),n("Drag / Drop",[t("drag"),t("dragstart"),t("dragend"),t("dragenter"),t("dragover"),t("dragleave"),t("drop")]),n("Geolocation",[e("Geolocation.getCurrentPosition","getCurrentPosition"),e("Geolocation.watchPosition","watchPosition")]),n("Keyboard",[t("keydown"),t("keyup"),t("keypress"),t("input")]),n("Load",[t("load"),t("beforeunload"),t("unload"),t("abort"),t("error"),t("hashchange"),t("popstate"),t("navigate"),t("navigatesuccess"),t("navigateerror"),t("currentchange"),t("nagivateto"),t("navigatefrom"),t("finish"),t("dispose")]);let r=["audio","video"];n("Media",[t("play",r),t("pause",r),t("playing",r),t("canplay",r),t("canplaythrough",r),t("seeking",r),t("seeked",r),t("timeupdate",r),t("ended",r),t("ratechange",r),t("durationchange",r),t("volumechange",r),t("loadstart",r),t("progress",r),t("suspend",r),t("abort",r),t("error",r),t("emptied",r),t("stalled",r),t("loadedmetadata",r),t("loadeddata",r),t("waiting",r)]),n("Mouse",[t("auxclick"),t("click"),t("dblclick"),t("mousedown"),t("mouseup"),t("mouseover"),t("mousemove"),t("mouseout"),t("mouseenter"),t("mouseleave"),t("mousewheel"),t("wheel"),t("contextmenu")]),n("Notification",[e("Notification.requestPermission","requestPermission")]),n("Parse",[e("Element.setInnerHTML",Fe.t("Set innerHTML")),e("Document.write","document.write")]),n("Picture-in-Picture",[t("enterpictureinpicture","video"),t("leavepictureinpicture","video"),t("resize","PictureInPictureWindow"),t("enter","documentPictureInPicture")]),n("Pointer",[t("pointerover"),t("pointerout"),t("pointerenter"),t("pointerleave"),t("pointerdown"),t("pointerup"),t("pointermove"),t("pointercancel"),t("gotpointercapture"),t("lostpointercapture"),t("pointerrawupdate")]),n("Script",[e("scriptFirstStatement",Fe.t("Script First Statement")),e("scriptBlockedByCSP",Fe.t("Script Blocked by Content Security Policy"))]),n("Timer",[e("setTimeout"),e("clearTimeout"),e("setInterval"),e("clearInterval"),e("setTimeout.callback",Fe.t("setTimeout fired")),e("setInterval.callback",Fe.t("setInterval fired"))]),n("Touch",[t("touchstart"),t("touchmove"),t("touchend"),t("touchcancel")]),n("WebAudio",[e("audioContextCreated",Fe.t("Create AudioContext")),e("audioContextClosed",Fe.t("Close AudioContext")),e("audioContextResumed",Fe.t("Resume AudioContext")),e("audioContextSuspended",Fe.t("Suspend AudioContext"))]),n("Window",[e("DOMWindow.close","window.close")]),n("Worker",[t("message"),t("messageerror")]);let o=["xmlhttprequest","xmlhttprequestupload"];return n("XHR",[t("readystatechange",o),t("load",o),t("loadstart",o),t("loadend",o),t("abort",o),t("error",o),t("progress",o),t("timeout",o)]),Jd}var Fe,Jd,$S=m(()=>{"use strict";Fe=y(require("@vscode/l10n")),Jd=new Map});var zh,qS,HS=m(()=>{"use strict";Ze();zh=qg(),qS=Ko(function(){let n=["instantiate","instantiateStreaming","compile","compileStreaming"];for(let e of n){let t=WebAssembly[e];WebAssembly[e]=function(...r){return t.apply(this,r).then(o=>{if(!(r[0]instanceof WebAssembly.Module))debugger;return o})}}},zh)});var Qd,zS,GS=m(()=>{"use strict";Ze();Qd=Ko(function(n,e){let t=" ".repeat(e),r=`
`;function o(s){if(s instanceof Uint8Array)return Uint8Array;if(s instanceof Uint8ClampedArray)return Uint8ClampedArray;if(s instanceof Uint16Array)return Uint16Array;if(s instanceof Uint32Array)return Uint32Array;if(s instanceof BigUint64Array)return BigUint64Array;if(s instanceof Int8Array)return Int8Array;if(s instanceof Int32Array)return Int32Array;if(s instanceof BigInt64Array)return BigInt64Array;if(s instanceof Float32Array)return Float32Array;if(s instanceof Float64Array)return Float64Array}function i(s,a=0,c=[]){switch(typeof s){case"bigint":return`${s}n`;case"boolean":return s.toString();case"function":{let u=s.toString().replace(/^[^\s]+\(/,"function(").split(/\r?\n/g),g=/^$/;for(let w of u){let I=/^[ \t]+/.exec(w);if(I){g=new RegExp(`^[ \\t]{0,${I[0].length}}`);break}}return u.map((w,I)=>I===0?w:(w=w.replace(g,""),I===u.length-1?t.repeat(a)+w:t.repeat(a+1)+w)).join(r)}case"number":return`${s}`;case"object":if(s===null)return"null";if(c.includes(s))return"[Circular]";if(s instanceof Date)return`"${s.toISOString()}"`;if(typeof Node<"u"&&n instanceof Node)return n.outerHTML;let l=o(s);if(l)return`new ${l.name}([${s.join(", ")}])`;if(s instanceof ArrayBuffer)return`new Uint8Array([${new Uint8Array(s).join(", ")}]).buffer`;if(s instanceof Array)return["[",...s.map(u=>t.repeat(a+1)+i(u,a+1,[...c,s])+","),t.repeat(a)+"]"].join(r);let p=s;return["{",...Object.keys(p).map(u=>t.repeat(a+1)+(/^[$a-z_][0-9a-z_$]*$/i.test(u)?u:JSON.stringify(u))+": "+i(p[u],a+1,[...c,s])+","),t.repeat(a)+"}"].join(r);case"string":return s.includes(`
`)?"`"+s.replace(/[`\\\\]|\${/g,"\\$&")+"`":JSON.stringify(s);case"symbol":return s.toString();case"undefined":return"undefined";default:return String(s)}}try{return i(n)}catch{return""+n}}),zS=Ye(`
  function(spaces2) {
    const result = ${Qd.expr("this","spaces2")};
    return result;
  }
`)});var JS,KS=m(()=>{"use strict";Ze();JS=Ye(function(){let n={__proto__:this.__proto__},e=Object.getOwnPropertyNames(this);for(let t=0;t<e.length;++t){let r=e[t],o=r>>>0;if(String(o>>>0)===r&&o>>>0!==4294967295)continue;let i=Object.getOwnPropertyDescriptor(this,r);i&&Object.defineProperty(n,r,i)}return n})});var QS,XS=m(()=>{"use strict";Ze();QS=Ye(function(n,e){let t={},r=n===-1?0:n,o=e===-1?this.length:n+e;for(let i=r;i<o&&i<this.length;++i){let s=Object.getOwnPropertyDescriptor(this,i);s&&Object.defineProperty(t,i,s)}return t})});var YS,ZS=m(()=>{"use strict";Ze();YS=Ye(function(n,e){let t={},r=n===-1?0:n,o=e===-1?this.childNodes.length:n+e;for(let i=r;i<o&&i<this.childNodes.length;++i){let s=this.childNodes[i];s.nodeName==="#comment"?t[i]=`<!-- ${s.textContent} -->`:s.nodeName==="#text"?t[i]=s.textContent||"":t[i]=s}return t})});var ek,tk=m(()=>{"use strict";Ze();ek=Ye(function(n){return n.call(this)})});var Gh,rk=m(()=>{"use strict";Ze();Gh=Ye(function(n,e){let{buffer:t,byteLength:r,byteOffset:o}=this instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&this instanceof SharedArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,i=o+Math.min(n,r),s=Math.max(0,Math.min(e,r-n));return a(new Uint8Array(t,i,s));function a(c){let l="0123456789abcdef",p="";for(let u=0;u<c.length;u++){let g=c[u];p+=l[g>>>4]+l[g&15]}return p}})});var Jh,ok=m(()=>{"use strict";Ze();Jh=Ye(function(n,e){let t=c(e),{buffer:r,byteLength:o,byteOffset:i}=this instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&this instanceof SharedArrayBuffer?new DataView(this):this instanceof WebAssembly.Memory?new DataView(this.buffer):this,s=i+Math.min(n,o),a=Math.max(0,Math.min(t.length,o-n));return new Uint8Array(r,s,a).set(t.subarray(0,a)),a;function c(l){let p=new Uint8Array(l.length>>>1);for(let u=0;u<l.length;u+=2)p[u>>>1]=parseInt(l.slice(u,u+2),16);return p}})});function dk(n){let e=n.exception&&Qi(n.exception).title||n.text;return be(e)}function mk(n){return n.name==="[[FunctionLocation]]"&&!!n.value&&n.value.subtype==="internal#location"}var Mr,lk,zn,Oa,cb,NE,pk,OE,BE,jE,nk,ik,uk,Kh,sk,dp,UE,lr,Xd,Qh,Xh,Yd,Yh,Zd,Xi,Zh,eb,tb,ak,rb,em,ob,mp,nb,ib,fp,sb,Na,ab,Gn,fk=m(()=>{"use strict";Mr=y(require("@vscode/l10n")),lk=require("astring"),zn=require("inversify");tt();U();Ri();Gl();J();eo();Ie();ge();Bd();rp();Vd();Aa();ap();Ze();KS();XS();ZS();qh();tk();rk();ok();Oa=(()=>{let n=0,e=2147483646;return()=>n++%e+1})(),cb=n=>{if(typeof n=="string")return{value:n};let e=n;return e.objectId?{objectId:e.objectId}:e.unserializableValue?{unserializableValue:e.unserializableValue}:{value:e.value}},NE=new Set(["typedarray","dataview","arraybuffer","webassemblymemory"]),pk=1024,OE=/^[$a-z_][0-9a-z_$]*$/i,BE=/^#[0-9a-z_$]+$/i,jE=n=>n.hasOwnProperty("configurable"),nk=(n,e,t)=>{let r=Sv(n,Cl(e),t);return(0,lk.generate)(r)},ik="<<indescribable>>",uk=n=>{if(!n.startsWith(ik))return n;let e,t;try{[e,t]=JSON.parse(n.slice(ik.length))}catch{return n}return Mr.t("{0} (couldn't describe: {1})",e,t)},Kh=n=>!!n&&typeof n=="object"&&"readMemory"in n&&"writeMemory"in n,sk={PARAMETER:{name:Mr.t("Parameters"),sortOrder:-10},LOCAL:{name:Mr.t("Locals"),sortOrder:-9},GLOBAL:{name:Mr.t("Globals"),sortOrder:-8}},dp=class n{constructor(e,t,r,o,i,s,a,c){this.cdp=e;this.parent=t;this.vars=o;this.locationProvider=i;this.currentRef=s;this.settings=a;this.clientCapabilities=c;this.name=r.name,this.presentationHint=r.presentationHint,this.sortOrder=r.sortOrder||0}get customDescriptionGenerator(){return this.settings.customDescriptionGenerator}createVariable(e,t,...r){let o=new e(new n(this.cdp,this.currentRef?.(),t,this.vars,this.locationProvider,()=>o,this.settings,this.clientCapabilities),...r);return o.id>0&&this.vars.add(o),o}createVariableByType(e,t,r){if(Wh(t))return this.createVariable(em,e,t);if(t.objectId){if(t.type==="function")return this.createVariable(tb,e,t,r);if(t.subtype==="map"||t.subtype==="set")return this.createVariable(rb,e,t,r);if(t.subtype==="node")return this.createVariable(eb,e,t,r);if(!Uh.has(t.subtype))return this.createVariable(Xi,e,t,r)}return this.createVariable(lr,e,t)}createWasmVariable(e,t,r){return this.createVariable(fp,e,t,r)}async getDescriptionSymbols(e){return this.settings.descriptionSymbols??=WS({cdp:this.cdp,args:[],objectId:e}).then(t=>({objectId:t.objectId}),()=>({value:[]})),await this.settings.descriptionSymbols}async createObjectPropertyVars(e,t){let r=[];if(this.settings.customPropertiesGenerator){let{result:l,errorDescription:p}=await this.evaluateCodeForObject(e,this.settings.customPropertiesGenerator,[]);l&&l.type!=="undefined"?e=l:r.push([this.createVariable(Yh,{name:"",sortOrder:-1},l,l?.description||p||Mr.t("Unknown error"))])}if(!e.objectId)return[];t&&this.cdp.DotnetDebugger.setEvaluationOptions({options:t,type:"variable"});let[o,i,s]=await Promise.all([this.cdp.Runtime.getProperties({objectId:e.objectId,accessorPropertiesOnly:!0,ownProperties:!1,generatePreview:!0}),this.cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0,generatePreview:!0}),this.cdp.Runtime.callFunctionOn({functionDeclaration:VS.decl(`${pk}`,this.settings.customDescriptionGenerator||"null"),arguments:[await this.getDescriptionSymbols(e.objectId)],objectId:e.objectId,throwOnSideEffect:!0,returnByValue:!0}).then(l=>l?.result.value||{}).catch(()=>({}))]);if(!o||!i)return[];let a=new Map,c=[];for(let l of o.result){if(l.symbol){c.push(l);continue}l.name==="__proto__"&&i.internalProperties?.some(p=>p.name==="[[Prototype]]")||a.set(l.name,l)}for(let l of i.result)l.get||l.set||(l.symbol?c.push(l):a.set(l.name,l));for(let l of[a.values(),c.values()])for(let p of l)r.push(this.createPropertyVar(p,e,s?.hasOwnProperty(p.name)?uk(s[p.name]):void 0));for(let l of i.privateProperties??[])r.push(this.createPropertyVar(l,e,void 0,{presentationHint:{visibility:"private"},sortOrder:1}));for(let l of i.internalProperties||[]){if(l.name==="[[StableObjectId]]")continue;let p;mk(l)?p=this.createFunctionLocationVariable(l):l.value!==void 0&&(p=this.createVariableByType({name:l.name,presentationHint:{visibility:"internal"},sortOrder:2},l.value)),p&&r.push([p])}return Go(await Promise.all(r))}createFunctionLocationVariable(e){return this.createVariable(Yd,{name:e.name,presentationHint:{visibility:"internal",attributes:["readOnly"]},sortOrder:2},e.value)}async createPropertyVar(e,t,r,o){let i=[],s=e.get&&e.get.type!=="undefined",a=e.set&&e.set.type!=="undefined",c={name:e.name,presentationHint:{},sortOrder:0,...o};return o||(jE(e)?(e.enumerable===!1&&!s&&(c.presentationHint.visibility="internal",c.sortOrder=1),(e.writable===!1||s&&!a)&&(c.presentationHint.attributes=["readOnly"])):(c.presentationHint.visibility="private",c.sortOrder=1)),"value"in e&&e.value&&i.push(this.createVariableByType(c,e.value,r)),s?i.push(this.createVariable(ib,c,e.get,t)):a&&i.push(this.createVariable(nb,c,e.set)),i}async evaluateCodeForObject(e,t,r){try{let o=await this.cdp.Runtime.callFunctionOn({objectId:e.objectId,functionDeclaration:t,arguments:r.map(cb)});if(o){if(o.exceptionDetails===void 0)return{result:o.result};if(o&&o.result.description)return{errorDescription:o.result.description}}return{errorDescription:Mr.t("Unknown error")}}catch(o){return{errorDescription:o.stack||o.message||String(o)}}}},UE=n=>typeof n=="number"||/^[0-9]+$/.test(n),lr=class n{constructor(e,t){this.context=e;this.remoteObject=t;this.id=Oa()}get name(){return this.context.name}get sortOrder(){return this.context.sortOrder}get accessor(){let{parent:e,name:t}=this.context;if(e instanceof mp)return e.accessor;if(!(e instanceof n))return this.context.name;let r=e.context.parent;if(r instanceof n){if(this.remoteObject.subtype==="internal#entry")return`[...${r.accessor}.entries()][${+t}]`;if(e.remoteObject.subtype==="internal#entry")return`${e.accessor}[${this.name==="key"?0:1}]`}return UE(t)?`${e.accessor}[${t}]`:OE.test(t)?`${e.accessor}.${t}`:e.accessor==="this"&&BE.test(t)?`${e.accessor}.${t}`:`${e.accessor}[${JSON.stringify(t)}]`}async toDap(e,t){let r=this.context.name;return this.context.parent instanceof Na&&(r=await this.context.parent.getRename(r)),Promise.resolve({name:r,value:Ki(this.remoteObject,e,t),evaluateName:this.accessor,type:this.remoteObject.type,variablesReference:0,presentationHint:this.context.presentationHint})}async setProperty(e,t){let r=await this.context.cdp.Runtime.callFunctionOn({objectId:this.remoteObject.objectId,functionDeclaration:`function(a) { return this[a] = ${t}; ${Ue()} }`,arguments:[cb(e)],silent:!0});if(!r)throw new k(he(Mr.t("Unable to set variable value")));if(r.exceptionDetails)throw new k(dk(r.exceptionDetails));return this.context.createVariableByType({name:e},r.result)}async getChildren(e){return Promise.resolve([])}},Xd=class{constructor(e){this.child=e;this.id=Oa()}getChildren(){return Promise.resolve([this.child])}},Qh=class extends lr{constructor(t,r,o,i){super(t,{type:o[0]?.type??"string"});this.value=r;this.args=o;this.stackTrace=i}toDap(){return Promise.resolve({name:this.context.name,value:this.value,variablesReference:this.stackTrace||this.args.some(Ji)?this.id:0})}getChildren(t){let r=[],{args:o,stackTrace:i}=this;for(let s=0;s<o.length;++s)Ji(o[s])&&r.push(this.context.createVariableByType({name:`arg${s}`,sortOrder:s},o[s]));return i&&r.push(this.context.createVariable(Xh,{name:"",sortOrder:Number.MAX_SAFE_INTEGER},this.remoteObject,i)),Promise.resolve(r)}},Xh=class extends lr{constructor(t,r,o){super(t,r);this.stacktrace=o}async toDap(){return{name:"",value:await this.stacktrace.format(),variablesReference:0}}},Yd=class extends lr{constructor(e,t){super(e,t),this.location=t.value}async toDap(){return{name:this.context.name,value:await this.context.locationProvider.renderDebuggerLocation(this.location),variablesReference:0,presentationHint:{visibility:"internal"}}}},Yh=class extends lr{constructor(t,r,o){super(t,r);this.message=o}get accessor(){if(!(this.context.parent instanceof lr))throw new Error("ErrorVariable must have a parent Variable");return this.context.parent.accessor}toDap(){return Promise.resolve({name:this.context.name,value:this.message,variablesReference:0})}},Zd=Symbol("NoStringRepr"),Xi=class extends lr{constructor(t,r,o){super(t,r);this.customStringRepr=o}async toDap(t,r){let[o,i]=await Promise.all([await super.toDap(t,r),await this.getValueRepresentation(t)]);return{...o,type:this.remoteObject.className||this.remoteObject.subtype||this.remoteObject.type,variablesReference:this.id,memoryReference:NE.has(this.remoteObject.subtype)?String(this.id):void 0,value:i}}async getValueRepresentation(t){if(typeof this.customStringRepr=="string")return this.customStringRepr;if(!this.context.parent&&this.remoteObject.objectId&&this.customStringRepr!==Zd)try{let r=await this.context.cdp.Runtime.callFunctionOn({functionDeclaration:Gd.decl(`${pk}`,this.context.customDescriptionGenerator||"null"),objectId:this.remoteObject.objectId,returnByValue:!0});if(r?.result.value)return this.customStringRepr=uk(r.result.value)}catch{this.customStringRepr=Zd}return this.context.name==="__proto__"&&this.remoteObject.description||Ki(this.remoteObject,t)}async readMemory(t,r){let o=await Gh({cdp:this.context.cdp,args:[t,r],objectId:this.remoteObject.objectId,returnByValue:!0});return Buffer.from(o.value,"hex")}async writeMemory(t,r){return(await Jh({cdp:this.context.cdp,args:[t,r.toString("hex")],objectId:this.remoteObject.objectId,returnByValue:!0})).value}getChildren(t){return this.context.createObjectPropertyVars(this.remoteObject,t.evaluationOptions)}},Zh=class extends Xi{constructor(){super(...arguments);this.id=Oa()}get accessor(){return this.context.parent.accessor}async toDap(t,r){return Promise.resolve({...await super.toDap(t,r),value:"..."})}},eb=class extends lr{constructor(){super(...arguments);this.description=B(()=>this.context.cdp.DOM.describeNode({objectId:this.remoteObject.objectId}))}async toDap(t,r){let i=(await this.description())?.node?.childNodeCount||0;return{...await super.toDap(t,r),value:await this.getValuePreview(t),variablesReference:this.id,indexedVariables:i>100?i:void 0,namedVariables:i>100?1:void 0}}async getChildren(t){switch(t?.filter){case"indexed":return this.getNodeChildren(t.start,t.count);case"named":return[this.getAttributesVar()];default:return[this.getAttributesVar(),...await this.getNodeChildren()]}}getAttributesVar(){return this.context.createVariable(Zh,{name:Mr.t("Node Attributes"),presentationHint:{visibility:"internal"},sortOrder:Number.MAX_SAFE_INTEGER},this.remoteObject,void 0)}async getNodeChildren(t=-1,r=-1){let o;try{o=await YS({cdp:this.context.cdp,generatePreview:!1,args:[t,r],objectId:this.remoteObject.objectId})}catch{return[]}let i=await this.context.createObjectPropertyVars(o);return o.objectId&&await this.context.cdp.Runtime.releaseObject({objectId:o.objectId}),i}async getValuePreview(t){let r=await this.description();if(!r?.node)return"";let{localName:o,attributes:i,childNodeCount:s}=r.node,a=this.context.clientCapabilities.value?.supportsANSIStyling?!0:"",c=(a&&"\x1B[34m")+`<${o}`;if(i)for(let l=0;l<i.length;l+=2){let p=i[l],u=i[l+1];c+=` ${a&&"\x1B[34;1m"}${p}${a&&"\x1B[2m"}=${a&&"\x1B[33m"}${JSON.stringify(u)}`}return c+=(a&&"\x1B[34m")+">",s&&(c+=`${a&&"\x1B[2m"}...${a&&"\x1B[34m"}`),c+=`</${o}>${a&&"\x1B[0m"}`,c}},tb=class extends Xi{async toDap(e){let[t,r]=await Promise.all([super.toDap(e),this.context.cdp.Runtime.getProperties({objectId:this.remoteObject.objectId,ownProperties:!0,nonIndexedPropertiesOnly:!0})]),o=r?.internalProperties?.find(mk);return o&&(t.valueLocationReference=this.context.createFunctionLocationVariable(o).id),t}},ak="[[Entries]]",rb=class extends Xi{constructor(t,r){super(t,r,Zd);this.baseChildren=B(()=>super.getChildren({variablesReference:this.id}));this.isMap=r.subtype==="map";let o=r.preview;this.size=Number(o?.properties.find(i=>i.name==="size")?.value)??void 0}async toDap(t){let r=await super.toDap(t);return this.size&&this.size>100&&(r.indexedVariables=this.size),r}async getChildren(t){let r=await this.baseChildren();return[...(await r.find(i=>i.name===ak)?.getChildren(t)||[]).filter(i=>i.sortOrder===0),...r.filter(i=>i.name!==ak)]}},em=class extends Xi{constructor(t,r){super(t,r,Zd);this.length=0;let o=String(r.description).match(/\(([0-9]+)\)/);this.length=o?+o[1]:0}async toDap(t){return{...await super.toDap(t),indexedVariables:this.length>100?this.length:void 0,namedVariables:this.length>100?1:void 0}}async getChildren(t){switch(t?.filter){case"indexed":return this.getArraySlots(t);case"named":return this.getArrayProperties();default:return Promise.all([this.getArrayProperties(),this.getArraySlots()]).then(Go)}}async getArrayProperties(){try{let t=await JS({cdp:this.context.cdp,args:[],objectId:this.remoteObject.objectId,generatePreview:!0});return this.context.createObjectPropertyVars(t)}catch{return[]}}async getArraySlots(t){let r=t&&typeof t.start<"u"?t.start:-1,o=t&&typeof t.count<"u"?t.count:-1,i;try{i=await QS({cdp:this.context.cdp,generatePreview:!1,args:[r,o],objectId:this.remoteObject.objectId})}catch{return[]}let s=await this.context.createObjectPropertyVars(i);return i.objectId&&await this.context.cdp.Runtime.releaseObject({objectId:i.objectId}),s}},ob=class extends em{async toDap(e){return this.remoteObject.preview?{...await super.toDap(e),name:jS(this.remoteObject.preview)}:super.toDap(e)}},mp=class extends lr{constructor(e,t){super(e,t)}getChildren(e){return this.context.createObjectPropertyVars(this.remoteObject)}},nb=class extends mp{async toDap(e,t){return{...await super.toDap(e,t),value:"write-only",variablesReference:this.id}}},ib=class extends mp{constructor(t,r,o){super(t,r);this.parentObject=o}async toDap(t,r){let o=await super.toDap(t,r);return o.variablesReference=this.id,o.presentationHint={...o.presentationHint,lazy:!0},o}async getChildren(t){try{let r=await ek({cdp:this.context.cdp,objectId:this.parentObject.objectId,args:[new Rl(this.remoteObject.objectId)]});return[this.context.createVariableByType({name:this.name,presentationHint:this.context.presentationHint},r)]}catch(r){if(!(r instanceof Di))throw r}return super.getChildren(t)}},fp=class n{constructor(e,t,r){this.context=e;this.variable=t;this.scopeRef=r;this.id=Oa();this.sortOrder=0}static{this.presentationHint={attributes:["readOnly"]}}toDap(){return Promise.resolve({name:this.context.name,value:this.variable.description||"",variablesReference:this.variable.getChildren?this.id:0,memoryReference:this.variable.linearMemoryAddress?String(this.id):void 0,presentationHint:this.context.presentationHint})}async getChildren(){return(await this.variable.getChildren?.()||[]).map(t=>this.context.createVariable(n,{name:t.name,presentationHint:n.presentationHint},t.value,this.scopeRef))}async readMemory(e,t){let r=this.variable.linearMemoryAddress;if(r===void 0)return;let o=await this.context.cdp.Debugger.evaluateOnCallFrame({callFrameId:this.scopeRef.callFrameId,expression:`(${Gh.source}).call(memories[0].buffer, ${+r+e}, ${+t}) ${Ue()}`,returnByValue:!0});if(!o)throw new Di({exceptionId:0,text:"No response from CDP",lineNumber:0,columnNumber:0});return Buffer.from(o.result.value,"hex")}async writeMemory(e,t){let r=this.variable.linearMemoryAddress;return r===void 0?0:(await this.context.cdp.Debugger.evaluateOnCallFrame({callFrameId:this.scopeRef.callFrameId,expression:`(${Jh.source}).call(memories[0].buffer, ${+r+e}, ${JSON.stringify(t.toString("hex"))}) ${Ue()}`,returnByValue:!0}))?.result.value||0}},sb=class{constructor(e,t,r,o){this.context=e;this.kind=t;this.variables=r;this.scopeRef=o;this.id=Oa();this.sortOrder=sk[this.kind]?.sortOrder||0}toDap(){return Promise.resolve({name:sk[this.kind]?.name||this.kind,value:"",variablesReference:this.id})}getChildren(){return Promise.all(this.variables.map(async e=>{let t=await e.evaluate();return this.context.createVariable(fp,{name:e.name,presentationHint:fp.presentationHint},t,this.scopeRef)}))}},Na=class{constructor(e,t,r,o,i){this.remoteObject=e;this.context=t;this.ref=r;this.extraProperties=o;this.renameProvider=i;this.id=Oa()}async getChildren(e){let t=await this.context.createObjectPropertyVars(this.remoteObject),r=new Set(t.map(o=>o.name));for(let o of this.extraProperties)r.has(o.name)||t.push(this.context.createVariableByType({name:o.name},o.value));return t}async getRename(e){return(await this.renameProvider.provideOnStackframe(this.ref.stackFrame)).getOriginalName(e,this.ref.stackFrame.rawPosition)||e}async setProperty(e,t){let r=await this.context.cdp.Debugger.evaluateOnCallFrame({expression:`${t} ${Ue()}`,callFrameId:this.ref.callFrameId});if(!r)throw new k(be(Mr.t("Invalid expression")));if(r.exceptionDetails)throw new k(dk(r.exceptionDetails));return await this.context.cdp.Debugger.setVariableValue({callFrameId:this.ref.callFrameId,scopeNumber:this.ref.scopeNumber,variableName:e,newValue:cb(r.result)}),this.context.createVariableByType({name:e},r.result)}},ab=class{constructor(){this.value=new Map}get(e){return this.value.get(e)}add(e){this.value.set(e.id,e)}clear(){this.value.clear()}},Gn=class{constructor(e,t,r,o,i,s){this.renameProvider=e;this.cdp=t;this.dap=r;this.launchConfig=o;this.clientCapabilities=i;this.locationProvider=s;this.vars=new ab;this.contextSettings={customDescriptionGenerator:o.customDescriptionGenerator&&nk(["defaultValue"],o.customDescriptionGenerator,!1),customPropertiesGenerator:o.customPropertiesGenerator&&nk([],o.customPropertiesGenerator,!1)}}createDetached(){return new Gn(this.renameProvider,this.cdp,this.dap,this.launchConfig,this.clientCapabilities,this.locationProvider)}clear(){this.vars.clear()}createFloatingVariable(e,t){return this.createFloatingContext().createVariableByType({name:e},t)}createFloatingWasmVariable(e,t,r,o){let i=this.createFloatingContext(),s={stackFrame:r,callFrameId:o,scopeNumber:0};return i.createWasmVariable({name:e},t,s)}createVariableForOutput(e,t,r,o){let i=this.createFloatingContext(),s=t.length===1&&o==="table"?i.createVariable(ob,{name:""},t[0]):t.length===1&&Ji(t[0])&&!r?i.createVariableByType({name:""},t[0]):i.createVariable(Qh,{name:""},e,t,r),a=new Xd(s);return this.vars.add(a),a}createScope(e,t,r){let o=new Na(e,new dp(this.cdp,void 0,{name:""},this.vars,this.locationProvider,()=>o,this.contextSettings,this.clientCapabilities),t,r,this.renameProvider);return this.vars.add(o),o}createWasmScope(e,t,r){let o=new sb(new dp(this.cdp,void 0,{name:""},this.vars,this.locationProvider,()=>o,this.contextSettings,this.clientCapabilities),e,t,r);return this.vars.add(o),o}hasVariable(e){return!!this.vars.get(e)}hasMemory(e){return Kh(this.vars.get(Number(e)))}async readMemory(e,t,r){let o=this.vars.get(Number(e));return Kh(o)?o.readMemory(t,r):void 0}async writeMemory(e,t,r){let o=this.vars.get(Number(e)),i=Kh(o)?await o.writeMemory(t,r):0;return i>0&&this.dap.invalidated({areas:["variables"]}),i}async getVariableNames(e){let t=this.vars.get(e.variablesReference);return t?(await t.getChildren(e)).filter(Ci(lr)):[]}async getVariables(e){let t=this.vars.get(e.variablesReference);if(!t)return[];let r=await t.getChildren(e);return(await Promise.all(r.map(i=>i.toDap(t instanceof Na||t instanceof Xd?"repl":"propertyValue",e.format).then(s=>({v:i,dap:s}))))).sort((i,s)=>i.v.sortOrder-s.v.sortOrder||+i.dap.name-+s.dap.name||i.dap.name.localeCompare(s.dap.name)).map(i=>i.dap)}async getLocations(e){let t=this.vars.get(e);if(!t||!(t instanceof Yd))throw ql();return t.location}async setVariable(e){let t=this.vars.get(e.variablesReference);if(!e.value)throw new k(be(Mr.t("Cannot set an empty value")));if(t instanceof Na||t instanceof lr)return await(await t.setProperty(e.name,e.value)).toDap("propertyValue",e.format);throw new k(he(Mr.t("Variable not found")))}createFloatingContext(){return new dp(this.cdp,void 0,{name:"<unnamed>"},this.vars,this.locationProvider,void 0,this.contextSettings,this.clientCapabilities)}};Gn=h([(0,zn.injectable)(),d(0,(0,zn.inject)(On)),d(1,(0,zn.inject)(Be)),d(2,(0,zn.inject)(zt)),d(3,(0,zn.inject)(re)),d(4,(0,zn.inject)($n))],Gn)});var pe,hk,lb,pb,WE,gk,VE,ub,Ba,mb=m(()=>{"use strict";pe=y(require("@vscode/l10n")),hk=require("crypto");W();H();Fa();O();U();Pr();$();Mt();Wd();Yr();V();V();J();Ie();ge();Hh();Un();Yl();rm();$S();Aa();ap();Rd();Zr();up();HS();GS();fk();lb=class{constructor(e){this.description=e;this.sourceMapLoads=new Map;this.scripts=[]}get isDefault(){return this.description.auxData&&this.description.auxData.isDefault}async remove(e){await Promise.all(this.scripts.map(async t=>{let r=await t.source;r.filterScripts(o=>o.executionContextId!==this.description.id),r.scripts.length||e.removeSource(r)}))}},pb=class{constructor(e){this._obj=e;this._dapDeferred=ye()}resolve(){this._dapDeferred.resolve(this._obj)}with(e){return this._dapDeferred.hasSettled()?e(this._obj):this._dapDeferred.promise.then(t=>e(t))}},WE=50,gk=(n,e)=>n.sourceReference===e.sourceReference&&Wu(n.path||"",e.path||""),VE=()=>`
//# sourceURL=eval-${(0,hk.randomBytes)(4).toString("hex")}.repl
`,ub=class{async enqueue(e,t){if(this.queue?.operation===e&&await new Promise(r=>setTimeout(r)),!this.queue||this.queue.operation!==e){let r=this.queue?.result.then(t,t)??t(),o=this.queue={operation:e,result:r.finally(()=>{this.queue===o&&(this.queue=void 0)})}}return this.queue.result}},Ba=class n{constructor(e,t,r,o,i,s,a,c,l,p,u,g,w,I,v){this.target=o;this.logger=s;this.evaluator=a;this.completer=c;this.launchConfig=l;this._breakpointManager=p;this.console=u;this.exceptionPause=g;this._smartStepper=w;this.shutdown=I;this._executionContexts=new Map;this._excludedCallers=[];this.stateQueue=new ub;this._onPausedEmitter=new S;this.disposed=!1;this.debuggerReady=ye();this.onPaused=this._onPausedEmitter.event;this._dap=new pb(r),this._sourceContainer=e,this._cdp=t,this.id=n._lastThreadId++,this.replVariables=new Gn(i,this._cdp,r,l,v,this),e.onSourceMappedSteppingChange(()=>this.refreshStackTrace()),this._initialize()}static{this._lastThreadId=0}static{this._allThreadsByDebuggerId=new Map}setExcludedCallers(e){this._excludedCallers=e}cdp(){return this._cdp}name(){return this.target.name()}pausedDetails(){return this._pausedDetails}pausedVariables(){return this._pausedVariables}defaultExecutionContext(){for(let e of this._executionContexts.values())if(e.isDefault)return e}resume(){return this.stateQueue.enqueue("resume",async()=>(this._sourceContainer.clearDisabledSourceMaps(),!await this._cdp.Debugger.resume({})&&this._pausedDetails!==void 0?he(pe.t("Unable to resume")):{allThreadsContinued:!1}))}pause(){return this.stateQueue.enqueue("pause",async()=>(this._expectedPauseReason={reason:"pause"},await this._cdp.Debugger.pause({})?{}:he(pe.t("Unable to pause"))))}stepOver(){return this.stateQueue.enqueue("stepOver",async()=>{this._expectedPauseReason={reason:"step",direction:1};let e=await this.getCurrentSkipList(1);return await this._cdp.Debugger.stepOver({skipList:e})?{}:he(pe.t("Unable to step next"))})}stepInto(e){return this.stateQueue.enqueue("stepInto",async()=>{this._waitingForStepIn={lastDetails:this._pausedDetails},this._expectedPauseReason={reason:"step",direction:0};let t=this._pausedDetails?.stepInTargets?.[e];if(t){let r=await this._cdp.Debugger.setBreakpoint({location:t.breakLocation});if(this._waitingForStepIn.intoTargetBreakpoint=r?.breakpointId,await this._cdp.Debugger.resume({}))return{}}else{let r=await this.getCurrentSkipList(0);if(await this._cdp.Debugger.stepInto({breakOnAsyncCall:!0,skipList:r}))return{}}return he(pe.t("Unable to step in"))})}stepOut(){return this.stateQueue.enqueue("stepOut",async()=>(this._expectedPauseReason={reason:"step",direction:2},await this._cdp.Debugger.stepOut({})?{}:he(pe.t("Unable to step out"))))}async getCurrentSkipList(e){if(!this._pausedDetails)return;let[t]=await this._pausedDetails.stackTrace.loadFrames(1);if(!t||!bk(t))return;let r=await t.getStepSkipList(e);if(r)return Pt.simplify(r).map(o=>({start:o.begin.base0,end:o.end.base0,scriptId:t.root.scriptId}))}_stackFrameNotFoundError(){return he(pe.t("Stack frame not found"))}_evaluateOnAsyncFrameError(){return he(pe.t("Unable to evaluate on async stack frame"))}async restartFrame(e){let t=this._pausedDetails?.stackTrace.frame(e.frameId)?.root;if(!t)return this._stackFrameNotFoundError();let r=t.callFrameId();return r?await this._cdp.Debugger.restartFrame({callFrameId:r,mode:"StepInto"})?(this._expectedPauseReason={reason:"frame_entry",description:pe.t("Paused on frame entry")},t.canExplicitlyBeRestarted||await this._cdp.Debugger.stepInto({}),{}):be(pe.t("Frame could not be restarted")):be(pe.t("Cannot restart asynchronous frame"))}async stackTrace(e){return this._pausedDetails?this._pausedDetails.stackTrace.toDap(e):he(pe.t("Thread is not paused"))}async scopes(e){let t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0;return t?t.scopes():this._stackFrameNotFoundError()}async exceptionInfo(){let e=this._pausedDetails&&this._pausedDetails.exception;if(!e)return he(pe.t("Thread is not paused on exception"));let t=Qi(e);return{exceptionId:t.title,breakMode:"all",details:{stackTrace:t.stackTrace,evaluateName:void 0}}}async revealPage(){return this._cdp.Page.bringToFront({}),{}}async completions(e){let t;if(e.frameId!==void 0){if(t=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId)?.root:void 0,!t)return this._stackFrameNotFoundError();if(!t.callFrameId())return this._evaluateOnAsyncFrameError()}if(e.line===1&&e.text.startsWith("cd "))return{targets:this.getExecutionContextCompletions(e)};let r=await this.completer.completions({executionContextId:this._selectedContext?this._selectedContext.description.id:void 0,stackFrame:t,expression:e.text,position:new Ne(e.line||1,e.column)});return{targets:[...this.getExecutionContextCompletions(e),...r]}}getExecutionContextCompletions(e){if(e.line&&e.line>1)return[];let t=e.text.slice(0,e.column).trim();return[...this._executionContexts.values()].map(r=>`cd ${this.target.executionContextName(r.description)}`).filter(r=>r.startsWith(t)).map(r=>({label:r,start:0,length:e.text.length}))}async _evaluteWasm(e,t,r){if(!e)return;let o=e.root,i=o.callFrameId(),s=await o.scriptSource?.source;if(!Fi(s)||!i)return;let a=await s.sourceMap.value.promise;if(!a.evaluate)return;let c=new Ae(e instanceof hp?e.inlineFrameIndex:0,o.rawPosition.base0.columnNumber),l=await a.evaluate(i,c,t.expression);return await r.createFloatingWasmVariable(t.expression,l,o,i).toDap(t.context,t.format)}async _evaluteJs(e,t,r){let o,i;if(t.context==="clipboard"?(i=Qd.exprArgRanges(t.expression,"2"),o={expression:Qd.expr(t.expression,"2"),includeCommandLineAPI:!0,returnByValue:!0,objectGroup:"console"}):o={expression:t.expression,includeCommandLineAPI:!0,objectGroup:"console",generatePreview:!0,timeout:t.context==="hover"?this.getHoverEvalTimeout():void 0},t.context==="repl"){if(o.expression=Nl(o.expression),o.expression.indexOf("await")!==-1){let p=qv(o.expression);p&&(o.expression=p,o.awaitPromise=!0)}o.expression+=VE()}t.evaluationOptions&&this.cdp().DotnetDebugger.setEvaluationOptions({options:t.evaluationOptions,type:"evaluation"});let s;if(t.source&&t.line&&t.column){let p=this._pausedVariables,u=this._sourceContainer.source(t.source);u&&p&&(s={source:u,position:new Ne(t.line,t.column),variables:p})}let a=e?.root.callFrameId(),c=this.evaluator.evaluate(a?{...o,callFrameId:a}:{...o,contextId:this._selectedContext?this._selectedContext.description.id:void 0},{isInternalScript:!1,stackFrame:e?.root,location:s,transformRanges:i});if(t.context==="repl")return await this._evaluateRepl(t,c,t.format);let l=await c;if(!l)throw new k(he(pe.t("Unable to evaluate")));if(l.exceptionDetails){let p=l.exceptionDetails.exception?Qi(l.exceptionDetails.exception).title:l.exceptionDetails.text;throw p.startsWith("Uncaught")||(p="Uncaught "+p),new k(he(p))}return r.createFloatingVariable(o.expression,l.result).toDap(t.context,t.format)}async evaluate(e){let t,r;if(e.frameId!==void 0){if(r=this._pausedDetails?this._pausedDetails.stackTrace.frame(e.frameId):void 0,!r)throw new k(this._stackFrameNotFoundError());if(t=r.root.callFrameId(),!t)throw new k(this._evaluateOnAsyncFrameError())}if(e.context==="repl"&&e.expression.startsWith("cd ")){let s=e.expression.substring(3).trim();for(let a of this._executionContexts.values())if(this.target.executionContextName(a.description)===s)return this._selectedContext=a,{result:`[${s}]`,variablesReference:0}}let o=t?this._pausedVariables:this.replVariables;if(!o)throw new k(he(pe.t("Unable to evaluate")));let i=await this._evaluteWasm(r,e,o)??await this._evaluteJs(r,e,o);return{type:i.type,result:i.value,variablesReference:i.variablesReference,namedVariables:i.namedVariables,indexedVariables:i.indexedVariables,memoryReference:i.memoryReference,valueLocationReference:i.valueLocationReference}}getHoverEvalTimeout(){let e=this.launchConfig.timeouts?.hoverEvaluation;if(e===void 0)return 500;if(!(e<=0))return e}async _evaluateRepl(e,t,r){let o=await t;if(!o)return{name:e.expression,value:"",variablesReference:0};if(o.exceptionDetails){let c=await new gp(o.exceptionDetails).toDap(this);throw new k(fI(c.output))}let i=this._selectedContext&&this.defaultExecutionContext()!==this._selectedContext?`\x1B[33m[${this.target.executionContextName(this._selectedContext.description)}] `:"",s=await this.replVariables.createFloatingVariable(e.expression,o.result).toDap("repl",r),a=$d("repl").budget;return s.variablesReference===0&&s.value.length===a&&setImmediate(()=>this.console.enqueue(this,{toDap:()=>({output:pe.t("Output has been truncated to the first {0} characters. Run `{1}` to copy the full output.",a,`copy(${e.expression.trim()})`),category:"stdout"})})),{...s,value:`${i}${s.value}`}}_initialize(){this._cdp.Runtime.on("executionContextCreated",e=>{this._executionContextCreated(e.context)}),this._cdp.Runtime.on("executionContextDestroyed",e=>{this._executionContextDestroyed(e.executionContextId)}),this._cdp.Runtime.on("executionContextsCleared",()=>{this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.replVariables.clear(),this._executionContextsCleared()}),this._cdp.Inspector.on("targetReloadedAfterCrash",()=>{this._breakpointManager.reapply()}),this.launchConfig.outputCapture==="console"&&(this._cdp.Runtime.on("consoleAPICalled",e=>{this.console.dispatch(this,e)}),this._cdp.Runtime.on("exceptionThrown",e=>{this.console.enqueue(this,new gp(e.exceptionDetails))})),this._cdp.Runtime.on("inspectRequested",e=>{e.hints.copyToClipboard?this._copyObjectToClipboard(e.object):e.hints.queryObjects?this.console.enqueue(this,new tm(e.object,this.cdp())):this._revealObject(e.object)}),this._cdp.Debugger.on("paused",async e=>this._onPaused(e)),this._cdp.Debugger.on("resumed",()=>this.onResumed()),this._cdp.Debugger.on("scriptParsed",e=>this._onScriptParsed(e)),this._cdp.Debugger.on("scriptFailedToParse",e=>this._onScriptParsed(e)),this._cdp.Runtime.enable({}),this._cdp.Profiler.enable({}),this._ensureDebuggerEnabledAndRefreshDebuggerId(),this.launchConfig.noDebug&&this.logger.info("runtime.launch","Running with noDebug, so debug domains are disabled"),this.target.initialize(),this._dap.with(e=>e.thread({reason:"started",threadId:this.id}))}dapInitialized(){this._dap.resolve()}async enableNetworking({mirrorEvents:e}){if(!await this._cdp.Network.enable({}))throw bI();return this._dap.with(r=>{for(let o of e)this._cdp.Network.on(o,i=>r.networkEvent({data:i,event:o}))}),{}}async getStepInTargets(e){let t=this._pausedDetails;if(!t)return[];let r=t.stackTrace.frames.find(p=>p.frameId===e);if(!(r instanceof Lt))return[];let o=await r.uiLocation();if(!o)return[];let i=t.event.callFrames[0].location,[s,a]=await Promise.all([this._breakpointManager.getBreakpointLocations(this,o.source,new Ne(o.lineNumber,1),new Ne(o.lineNumber+1,1)).then(p=>p.filter(u=>u.breakLocation.lineNumber!==i.lineNumber||u.breakLocation.columnNumber!==i.columnNumber)),o.source.content()]),c=t.stepInTargets?.length||0;t.stepInTargets=t.stepInTargets?.concat(s)||s;let l=a&&new Cn(a);return s.map((p,u)=>{let g=p.uiLocations.find(I=>I.source===o.source);if(!g)return;if(!l)return{id:c+u,label:`Column ${g}`,line:g.lineNumber,column:g.columnNumber};let w=Hv(a.slice(l.getLineOffset(g.lineNumber-1),l.getLineOffset(g.lineNumber)),g.columnNumber-1);if(w)return{id:c+u,label:w.text,line:g.lineNumber,column:w.start+1,endLine:g.lineNumber,endColumn:w.end+1}}).filter(Me)}async refreshStackTrace(){this._pausedDetails&&(this._pausedDetails=await this._createPausedDetails(this._pausedDetails.event),this._onThreadResumed(),await this._onThreadPaused(this._pausedDetails))}_executionContextCreated(e){let t=new lb(e);return this._executionContexts.set(e.id,t),this._scriptWithSourceMapHandler&&this._installWasmPauseHandler(e.id),t}_installWasmPauseHandler(e){return this._cdp.Runtime.evaluate({expression:qS.expr(),silent:!0,contextId:e})}async _executionContextDestroyed(e){let t=this._executionContexts.get(e);t&&(this._executionContexts.delete(e),await this.shutdown.shutdownContext(),t.remove(this._sourceContainer))}async _executionContextsCleared(){let e=[...this._executionContexts.values()],t=this._pausedDetails;this._executionContexts.clear(),await this.shutdown.shutdownContext();for(let r of e)r.remove(this._sourceContainer);this._breakpointManager.executionContextWasCleared(),t&&t===this._pausedDetails&&!this.disposed&&this.onResumed()}_ensureDebuggerEnabledAndRefreshDebuggerId(){if(this.launchConfig.noDebug)return this.debuggerReady.resolve();this._cdp.Debugger.enable({}).then(e=>{this.debuggerReady.resolve(),e&&n._allThreadsByDebuggerId.set(e.debuggerId,this)}),this.exceptionPause.apply(this._cdp)}async _onPaused(e){let t=e.hitBreakpoints??[],r=e.reason==="Break on start"||e.reason==="debugCommand",o=e.callFrames[0]?.location,i=e.data?.scriptId||o?.scriptId,s=i&&this._sourceContainer.getSourceScriptById(i)?.url===zh,a=i&&(e.reason==="instrumentation"||this._breakpointManager.isEntrypointBreak(t,i)||t.some(u=>this._pauseOnSourceMapBreakpointIds?.includes(u))||s);if(this.evaluator.setReturnedValue(e.callFrames[0]?.returnValue),a){this.launchConfig.perScriptSourcemaps==="auto"&&this._shouldEnablePerScriptSms(e)&&await this._enablePerScriptSourcemaps(),e.data&&!r&&(e.data.__rewriteAs="breakpoint");let u=this._expectedPauseReason;if(s){let g=this._lastParsedWasmScriptIds;return this._lastParsedWasmScriptIds=void 0,g&&await Promise.all(g.map(w=>this._handleSourceMapPause(w,o))),this.resume()}else if(!(i&&await this._handleSourceMapPause(i,o))){if(!r){if(await this.isCrossThreadStep(e))e.data={...e.data,__rewriteAs:"step"};else if(!await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!0))if(u?.reason==="step"){if(u.direction!==0)return this._cdp.Debugger.resume({})}else return this.resume()}}}else if(!(e.reason==="exception"||e.reason==="promiseRejection"?await this.exceptionPause.shouldPauseAt(e):await this._breakpointManager.shouldPauseAt(e,t,this.target.entryBreakpoint,!1)))return this.resume();let c=this._waitingForStepIn?.intoTargetBreakpoint;if(c){e.hitBreakpoints?.includes(c)?(this._waitingForStepIn.intoTargetBreakpoint=void 0,await this._cdp.Debugger.removeBreakpoint({breakpointId:c}),await this._cdp.Debugger.stepInto({breakOnAsyncCall:!1})):this.resume();return}if(r&&("continueOnAttach"in this.launchConfig&&this.launchConfig.continueOnAttach||this.launchConfig.type==="pwa-extensionHost"||this.target instanceof Ma)){this.resume();return}let l=this._pausedDetails=await this._createPausedDetails(e);if(this._excludedCallers.length&&await this._matchesExcludedCaller(this._pausedDetails.stackTrace)){this.logger.info("runtime","Skipping pause due to excluded caller"),this.resume();return}let p=await this._smartStepper.getSmartStepDirection(l,this._expectedPauseReason);if(this._pausedDetails===l){switch(p){case 0:return this.stepInto();case 2:return this.stepOut();case 1:return this.stepOver();default:}this._waitingForStepIn=void 0,this._pausedVariables=this.replVariables.createDetached(),await this._onThreadPaused(l)}}async _matchesExcludedCaller(e){if(!this._excludedCallers.length)return!1;let t=e.frames[0],r=t instanceof Lt&&await t.uiLocation();if(!r)return!1;let o,i,s=[];for(let{caller:a,target:c}of this._excludedCallers)if(!(c.line!==r.lineNumber||c.column!==r.columnNumber)&&(o??=await r.source.toDap(),!!gk(o,c.source))){i||(i=await e.loadFrames(WE).then(p=>Promise.all(p.slice(1).filter(Ci(Lt)).map(u=>u.uiLocation()))));for(let l=0;l<i.length;l++){let p=i[l];if(!p||p.lineNumber!==a.line||p.columnNumber!==a.column)continue;let u=s[l]??=await p.source.toDap();if(gk(u,a.source))return!0}}return!1}onResumed(){this._pausedDetails=void 0,this._pausedVariables=void 0,this.evaluator.setReturnedValue(void 0),this._onThreadResumed()}async dispose(){await this.shutdown.shutdownAll(),this.disposed=!0;for(let[e,t]of n._allThreadsByDebuggerId)t===this&&n._allThreadsByDebuggerId.delete(e);this._removeAllScripts(!0),this._executionContextsCleared(),await this._dap.with(e=>e.thread({reason:"exited",threadId:this.id}))}rawLocation(e){if("location"in e){let t=e;return{lineNumber:Math.max(0,t.location.lineNumber)+1,columnNumber:Math.max(0,t.location.columnNumber||0)+1,scriptId:t.location.scriptId}}return{lineNumber:Math.max(0,e.lineNumber)+1,columnNumber:Math.max(0,e.columnNumber||0)+1,scriptId:e.scriptId}}rawLocationToUiLocation(e){if(!e.scriptId||this.disposed||this.launchConfig.noDebug)return;let t=this._sourceContainer.getScriptById(e.scriptId);return t?t.resolvedSource?this._sourceContainer.preferredUiLocation({...t.resolvedSource.offsetScriptToSource(e),source:t.resolvedSource}):t.source.then(r=>this._sourceContainer.preferredUiLocation({...r.offsetSourceToScript(e),source:r})):this.rawLocationToUiLocationWithWaiting(e)}async rawLocationToUiLocationWithWaiting(e){let t=e.scriptId?await this.getScriptByIdOrWait(e.scriptId):void 0;if(!t)return;let r=await t.source;return this._sourceContainer.preferredUiLocation({...r.offsetScriptToSource(e),source:r})}getScriptById(e){return this._sourceContainer.getScriptById(e)}getScriptByIdOrWait(e,t=500){return this._sourceContainer.getScriptById(e)||this.waitForScriptId(e,t)}waitForScriptId(e,t){return new Promise(r=>{let o=this._sourceContainer.onScript(s=>{s.scriptId===e&&(r(s),o.dispose(),clearTimeout(i))}),i=setTimeout(()=>{r(void 0),o.dispose()},t)})}async renderDebuggerLocation(e){let t=this.rawLocation(e),r=await this.rawLocationToUiLocation(t);return r?`@ ${await r.source.prettyName()}:${r.lineNumber}`:`@ VM${t.scriptId||"XX"}:${t.lineNumber}`}async updateCustomBreakpoints(e,t){if(!this.target.supportsCustomBreakpoints())return;this._enabledCustomBreakpoints??=new Set;let r=new Set;for(let i of e)r.add("x"+i);for(let i of t)r.add("e"+i);let o=[];for(let i of r)if(!this._enabledCustomBreakpoints.has(i)){let s=i.slice(1);o.push(i.startsWith("x")?this._cdp.DOMDebugger.setXHRBreakpoint({url:s}):Kd().get(s)?.apply(this._cdp,!0))}for(let i of this._enabledCustomBreakpoints)if(!r.has(i)){let s=i.slice(1);o.push(i.startsWith("x")?this._cdp.DOMDebugger.removeXHRBreakpoint({url:s}):Kd().get(s)?.apply(this._cdp,!1))}this._enabledCustomBreakpoints=r,await Promise.all(o)}async _createPausedDetails(e){let t=e.reason==="assert"||e.reason==="exception"||e.reason==="promiseRejection"||e.reason==="other"||e.reason==="ambiguous",r=e.hitBreakpoints?.filter(i=>!this._breakpointManager.isEntrypointCdpBreak(i))||[];if((r.length||!t)&&this._sourceContainer.clearDisabledSourceMaps(),e.hitBreakpoints&&this._sourceMapDisabler)for(let i of this._sourceMapDisabler(e.hitBreakpoints))this._sourceContainer.disableSourceMapForSource(i);let o=on.fromDebugger(this,e.callFrames,e.asyncStackTrace,e.asyncStackTraceId);if(e.data?.__rewriteAs==="breakpoint")return{thread:this,event:e,stackTrace:o,reason:"breakpoint",description:pe.t("Paused on breakpoint")};if(e.data?.__rewriteAs==="step")return{thread:this,event:e,stackTrace:o,reason:"step",description:pe.t("Paused")};switch(e.reason){case"assert":return{thread:this,event:e,stackTrace:o,reason:"exception",description:pe.t("Paused on assert")};case"debugCommand":return{thread:this,event:e,stackTrace:o,reason:"pause",description:pe.t("Paused on debug() call")};case"DOM":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:pe.t("Paused on DOM breakpoint")};case"EventListener":return this._resolveEventListenerBreakpointDetails(o,e);case"exception":return{thread:this,event:e,stackTrace:o,reason:"exception",description:pe.t("Paused on exception"),exception:e.data};case"promiseRejection":return{thread:this,event:e,stackTrace:o,reason:"exception",description:pe.t("Paused on {0}","promise rejection"),exception:e.data};case"instrumentation":return e.data&&e.data.scriptId?{thread:this,event:e,stackTrace:o,reason:"step",description:pe.t("Paused")}:{thread:this,event:e,stackTrace:o,reason:"function breakpoint",description:pe.t("Paused on instrumentation breakpoint")};case"XHR":return{thread:this,event:e,stackTrace:o,reason:"data breakpoint",description:pe.t("Paused on XMLHttpRequest or fetch")};case"OOM":return{thread:this,event:e,stackTrace:o,reason:"exception",description:pe.t("Paused before Out Of Memory exception")};default:if(r.length){let i=!1,s=this.target.entryBreakpoint;if(s&&r.includes(s.cdpId)){i=!0;let a=this._sourceContainer.source({path:We(s.path)});a!==void 0&&(i=!(await this._sourceContainer.currentSiblingUiLocations({lineNumber:e.callFrames[0].location.lineNumber+1,columnNumber:(e.callFrames[0].location.columnNumber||0)+1,source:a}))?.some(l=>this._breakpointManager.hasAtLocation(l)))}return i||this._breakpointManager.registerBreakpointsHit(r),{thread:this,event:e,stackTrace:o,hitBreakpoints:e.hitBreakpoints,reason:i?"entry":"breakpoint",description:pe.t("Paused on breakpoint")}}return this._expectedPauseReason?{thread:this,event:e,stackTrace:o,description:pe.t("Paused"),...this._expectedPauseReason}:{thread:this,event:e,stackTrace:o,reason:"pause",description:pe.t("Paused on debugger statement")}}}_resolveEventListenerBreakpointDetails(e,t){let r=t.data,o=r&&r.eventName||"",i=Kd().get(o);if(i){let s=i.details(r);return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:s.short,text:s.long}}return{thread:this,event:t,stackTrace:e,reason:"function breakpoint",description:pe.t("Paused on event listener")}}_clearDebuggerConsole(){return{category:"console",output:"\x1B[2J"}}_removeAllScripts(e=!1){this._sourceContainer.clear(e)}_onScriptParsed(e){let t={url:e.url,hasSourceURL:!!e.hasSourceURL,embedderName:e.embedderName,scriptId:e.scriptId,executionContextId:e.executionContextId};Tt(e.url)&&(e.url=Q(e.url));let r=this._sourceContainer.getScriptById(e.scriptId);if(r&&this._executionContexts.has(r.executionContextId))return;if(e.url.endsWith(".cdp")){this._sourceContainer.addScriptById(t);return}e.url&&(e.url=this.target.scriptUrlToUrl(e.url));let o=this._executionContexts.get(e.executionContextId);o||(this.logger.info("internal","Creating missing execution context id",e),o=this._executionContextCreated({id:e.executionContextId,name:"<autofilled>",origin:"",uniqueId:String(e.executionContextId)}));let s={...t,source:(async()=>{let a=this._sourceContainer.getSourceByOriginalUrl(e.url);if(e.hash&&a?.contentHash===e.hash)return a.addScript({scriptId:e.scriptId,url:e.url,embedderName:e.embedderName,hasSourceURL:!!e.hasSourceURL,executionContextId:e.executionContextId}),a;let c=async()=>{let w=await this._cdp.Debugger.getScriptSource({scriptId:e.scriptId});return w?w.scriptSource:void 0},l=e.startLine||e.startColumn?{lineOffset:e.startLine,columnOffset:e.startColumn}:void 0,p=e.url.endsWith("#vscode-extension")?{lineOffset:2,columnOffset:0}:void 0,u;e.sourceMapURL&&(u=vt(e.sourceMapURL)?e.sourceMapURL:e.url&&Xr(e.url,e.sourceMapURL)||e.url,u||this._dap.with(w=>sI(w,`Could not load source map from ${e.sourceMapURL}`))),e.scriptLanguage==="WebAssembly"&&(this._lastParsedWasmScriptIds??=[],this._lastParsedWasmScriptIds.push(e.scriptId));let g=await this._sourceContainer.addSource(e,c,u,l,p,!e.hasSourceURL&&this.launchConfig.enableContentValidation?e.hash:void 0);return g.addScript({scriptId:e.scriptId,url:e.url,embedderName:e.embedderName,hasSourceURL:!!e.hasSourceURL,executionContextId:e.executionContextId}),g})()};s.source.then(a=>s.resolvedSource=a),o.scripts.push(s),this._sourceContainer.addScriptById(s),(e.sourceMapURL||e.scriptLanguage==="WebAssembly")&&this._getOrStartLoadingSourceMaps(s)}async _handleSourceMapPause(e,t){this._pausedForSourceMapScriptId=e;let r=this._sourceContainer.sourceMapTimeouts().sourceMapMinPause,o=r+this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause,i=this._sourceContainer.getScriptById(e);if(!i)return this._pausedForSourceMapScriptId=void 0,!1;let s=new Fr,a=this._breakpointManager.disableEntrypointBreaks(e),c=await Promise.race([this._getOrStartLoadingSourceMaps(i),x(o)]),l=s.elapsed().ms,p=this._sourceContainer.sourceMapTimeouts().sourceMapCumulativePause-Math.max(l-r,0);this._sourceContainer.setSourceMapTimeouts({...this._sourceContainer.sourceMapTimeouts(),sourceMapCumulativePause:p}),this.logger.verbose("internal","Blocked execution waiting for source-map",{timeSpentWallClockInMs:l,sourceMapCumulativePause:p}),c||this._dap.with(w=>w.output({category:"stderr",output:pe.t("WARNING: Processing source-maps of {0} took longer than {1} ms so we continued execution without waiting for all the breakpoints for the script to be set.",i.url||i.scriptId,o)})),console.assert(this._pausedForSourceMapScriptId===e),this._pausedForSourceMapScriptId=void 0,await a;let u=t?.lineNumber||0,g=t?.columnNumber;return!!c?.map(Xo).some(w=>w.lineNumber===u&&(g===void 0||g===w.columnNumber))}_getOrStartLoadingSourceMaps(e){let t=this._executionContexts.get(e.executionContextId);if(!t)return Promise.resolve([]);let r=t.sourceMapLoads.get(e.scriptId);if(r)return r;let o=e.source.then(i=>this._sourceContainer.waitForSourceMapSources(i)).then(i=>i.length&&this._scriptWithSourceMapHandler?this._scriptWithSourceMapHandler(e,i):[]);return t.sourceMapLoads.set(e.scriptId,o),o}async _revealObject(e){if(e.type!=="function"||e.objectId===void 0)return;let t=await this._cdp.Runtime.getProperties({objectId:e.objectId,ownProperties:!0});if(t)for(let r of t.internalProperties||[]){if(r.name!=="[[FunctionLocation]]"||!r.value||r.value.subtype!=="internal#location")continue;let o=await this.rawLocationToUiLocation(this.rawLocation(r.value.value));o&&this._sourceContainer.revealUiLocation(o);break}}async _copyObjectToClipboard(e){if(!e.objectId){this._dap.with(t=>t.copyRequested({text:Ki(e,"copy")}));return}try{let t=await zS({cdp:this.cdp(),objectId:e.objectId,args:[2],silent:!0,returnByValue:!0});this._dap.with(r=>r.copyRequested({text:t.value}))}catch{}finally{this.cdp().Runtime.releaseObject({objectId:e.objectId}).catch(()=>{})}}async _onThreadPaused(e){this._expectedPauseReason=void 0,this._onPausedEmitter.fire(e);let t;e.hitBreakpoints&&(t=await Promise.race([x(1e3).then(()=>{}),Promise.all(e.hitBreakpoints.map(r=>this._breakpointManager._resolvedBreakpoints.get(r)).filter(Ci(Lr)).map(r=>r.untilSetCompleted().then(()=>r.dapId)))])),await x(0),this._dap.with(r=>r.stopped({reason:e.reason,description:e.description,threadId:this.id,text:e.text,hitBreakpointIds:t,allThreadsStopped:!1}))}_onThreadResumed(){this._dap.with(e=>e.continued({threadId:this.id,allThreadsContinued:!1}))}isCrossThreadStep(e){if(!e.asyncStackTraceId||!e.asyncStackTraceId.debuggerId)return!1;let t=n.threadForDebuggerId(e.asyncStackTraceId.debuggerId);if(!t||!t._waitingForStepIn?.lastDetails)return!1;let r=t._waitingForStepIn.lastDetails.stackTrace;return t._cdp.Debugger.getStackTrace({stackTraceId:e.asyncStackTraceId}).then(o=>!o||!o.stackTrace.callFrames.length||!Lt.fromRuntime(t,o.stackTrace.callFrames[0],!1).equivalentTo(r.frames[0])?!1:(t._waitingForStepIn=void 0,!0))}async setScriptSourceMapHandler(e,t){this._scriptWithSourceMapHandler=t;let r=e&&this._sourceContainer.sourceMapTimeouts().sourceMapMinPause&&t;if(r&&!this._pauseOnSourceMapBreakpointIds?.length){await this.debuggerReady.promise;let o=await Promise.all([this._cdp.Debugger.setInstrumentationBreakpoint({instrumentation:"beforeScriptWithSourceMapExecution"})]);this._pauseOnSourceMapBreakpointIds=o.map(i=>i?.breakpointId).filter(Me)}else if(!r&&this._pauseOnSourceMapBreakpointIds?.length){let o=this._pauseOnSourceMapBreakpointIds;this._pauseOnSourceMapBreakpointIds=void 0,await Promise.all(o.map(i=>this._cdp.Debugger.removeBreakpoint({breakpointId:i})))}if(t){let o=Promise.all([...this._executionContexts.keys()].map(i=>this._installWasmPauseHandler(i)));await Promise.race([o,x(100)])}return!!this._pauseOnSourceMapBreakpointIds?.length}async _enablePerScriptSourcemaps(){await this._breakpointManager.updateEntryBreakpointMode(this,1),await this.setScriptSourceMapHandler(!1,this._scriptWithSourceMapHandler)}_shouldEnablePerScriptSms(e){let t=this._sourceContainer.getScriptById(e.callFrames[0]?.location.scriptId);return t?t.url.includes("@vite/client")?!0:e.reason!=="instrumentation"||!vt(e.data?.sourceMapURL)?!1:t.url.startsWith("webpack")||t.url.startsWith("ng:"):!1}setSourceMapDisabler(e){this._sourceMapDisabler=e}static threadForDebuggerId(e){return n._allThreadsByDebuggerId.get(e)}async replacePathsInStackTrace(e){let t=[];for(let o of new qn(e)){if(typeof o=="string"){t.push(o);continue}let i=this._sourceContainer.getSourceByOriginalUrl(Q(o.path))||this._sourceContainer.getSourceByOriginalUrl(o.path);if(!i){t.push(o.toString());continue}t.push(this._sourceContainer.preferredUiLocation({columnNumber:o.position.base1.columnNumber,lineNumber:o.position.base1.lineNumber,source:i}).then(({source:s,lineNumber:a,columnNumber:c})=>`${s.absolutePath}:${a}:${c}`))}return(await Promise.all(t)).join("")}}});async function qE(n,e,t){if(!e.functionName)return wk;if(e.functionName.includes("."))return e.functionName;let r;if(e.this.objectId&&t&&(r=(await n.cdp().Runtime.callFunctionOn({functionDeclaration:Gd.decl("64","null"),objectId:e.this.objectId,returnByValue:!0}))?.result.value),!r&&e.this.description){r=e.this.description;let s=$E.exec(r);s&&(r=s[1])}if(!r)return e.functionName;let o=r.indexOf(`
`);o!==-1&&(r=r.slice(0,o).trim());let i=e.functionName;return r===i?`${r}.constructor`:r?`${r}.${i}`:i}function HE(n){return n.functionName||wk}var Yt,bk,on,gb,om,wk,$E,Lt,fb,hp,up=m(()=>{"use strict";Yt=y(require("@vscode/l10n"));xn();U();Pr();Mt();Ie();ge();rp();ap();zd();Zr();qh();mb();bk=n=>typeof n.uiLocation=="function",on=class n{constructor(e){this.thread=e;this.frames=[];this._frameById=new Map;this._lastInlineWasmExpanded=Promise.resolve(0);this._lastFrameThread=e}static fromRuntime(e,t){let r=new n(e);for(let o of t.callFrames)o.url.endsWith(".cdp")||r.frames.push(Lt.fromRuntime(e,o,!1));return t.parentId?(r._asyncStackTraceId=t.parentId,console.assert(!t.parent)):r._appendStackTrace(e,t.parent),r}static fromDebugger(e,t,r,o){let i=new n(e);for(let s of t)i._appendFrame(Lt.fromDebugger(e,s));return o?(i._asyncStackTraceId=o,console.assert(!r)):i._appendStackTrace(e,r),i}async loadFrames(e,t){return await this.expandAsyncStack(e,t),await this.expandWasmFrames(),this.frames}async expandAsyncStack(e,t){for(;this.frames.length<e&&this._asyncStackTraceId;){if(this._asyncStackTraceId.debuggerId&&(this._lastFrameThread=Ba.threadForDebuggerId(this._asyncStackTraceId.debuggerId)),!this._lastFrameThread){this._asyncStackTraceId=void 0;break}t&&this._lastFrameThread.cdp().DotnetDebugger.setEvaluationOptions({options:{noFuncEval:t},type:"stackFrame"});let r=await this._lastFrameThread.cdp().Debugger.getStackTrace({stackTraceId:this._asyncStackTraceId});this._asyncStackTraceId=void 0,r&&this._appendStackTrace(this._lastFrameThread,r.stackTrace)}}expandWasmFrames(){return this._lastInlineWasmExpanded=this._lastInlineWasmExpanded.then(async e=>{for(;e<this.frames.length;e++){let t=this.frames[e];if(!(t instanceof Lt))continue;let r=t.scriptSource?.resolvedSource;if(!Fi(r))continue;let o=await r.sourceMap.value.promise;if(!o.getFunctionStack)continue;let i=await o.getFunctionStack(t.rawPosition);if(i.length===0)continue;let s=[];for(let a=0;a<i.length;a++){let c=new hp({source:r,thread:this.thread,inlineFrameIndex:a,name:i[a].name,root:t});this._frameById.set(c.frameId,c),s.push(c)}this._spliceFrames(e,1,...s),e+=i.length-1}return e})}frame(e){return this._frameById.get(e)}_appendStackTrace(e,t){for(console.assert(!t||!this._asyncStackTraceId);t;){if(t.description==="async function"&&t.callFrames.length&&t.callFrames.shift(),t.callFrames.length){this._appendFrame(new om(t.description||"async"));for(let r of t.callFrames)this._appendFrame(Lt.fromRuntime(e,r,!0))}t.parentId&&(this._asyncStackTraceId=t.parentId,console.assert(!t.parent)),t=t.parent}}_spliceFrames(e,t,...r){this.frames.splice(e,t,...r);for(let o of r)o instanceof om||this._frameById.set(o.frameId,o)}_appendFrame(e){this._spliceFrames(this.frames.length,0,e)}async formatAsNative(){return await this.formatWithMapper(e=>e.formatAsNative())}async format(){return await this.formatWithMapper(e=>e.format())}async formatWithMapper(e){let t=await this.loadFrames(50);for(let o=t.length-1;o>=0;o--){let i=t[o];if(i instanceof Lt&&i.isReplEval){t=t.slice(0,o+1);break}}let r=t.map(e);return(await Promise.all(r)).join(`
`)+`
`}async toDap(e){let t=e.startFrame||0,r=(e.levels||50)+t,o=await this.loadFrames(r,e.noFuncEval);r=Math.min(o.length,e.levels?r:o.length);let i=[];for(let s=t;s<r;s++)i.push(o[s].toDap(e.format));return{stackFrames:await Promise.all(i),totalFrames:this._asyncStackTraceId?1e6:o.length}}},gb=vu(),om=class{constructor(e="async"){this.label=e;this.frameId=gb()}async toDap(){return{name:this.label,id:this.frameId,line:0,column:0,presentationHint:"label"}}async formatAsNative(){return`    --- ${this.label} ---`}async format(){return`\u25C0 ${this.label} \u25B6`}},wk="<anonymous>",$E=/^class\s+(.+) {($|\n)/;Lt=class n{constructor(e,t,r,o=!1){this.callFrame=t;this.isAsync=o;this.frameId=gb();this.root=this;this.getLocationInfo=B(async()=>{let e=this.uiLocation(),t=await $h(this),r=this.overrideName||("this"in this.callFrame?await qE(this._thread,this.callFrame,t===0):HE(this.callFrame));return{isSmartStepped:t,name:r,uiLocation:await e}});this.completions=B(async()=>{if(!this._scope)return[];let e=this._thread.pausedVariables();if(!e)return[];let t=[];for(let o=0;o<this._scope.chain.length;o++){let i=this._scopeVariable(o,this._scope);i&&t.push(e.getVariableNames({variablesReference:i.id}).then(s=>s.map(({name:a})=>({label:a,type:"property"}))))}let r=await Promise.all(t);return[].concat(...r)});this._rawLocation=r,this.uiLocation=B(()=>e.rawLocationToUiLocation(r)),this._thread=e;let i=r.scriptId?e.getScriptById(r.scriptId):void 0;this.isReplEval=i?i.url.endsWith(".repl"):!1}get rawPosition(){return new Ne(this._rawLocation.lineNumber,this._rawLocation.columnNumber)}get rawScopeChain(){return this._scope?.chain||[]}static fromRuntime(e,t,r){return new n(e,t,e.rawLocation(t),r)}static fromDebugger(e,t){let r=new n(e,t,e.rawLocation(t));return r._scope={chain:t.scopeChain,thisObject:t.this,returnValue:t.returnValue,variables:new Array(t.scopeChain.length).fill(void 0),callFrameId:t.callFrameId},r}get scriptId(){return"scriptId"in this.callFrame?this.callFrame.scriptId:this.callFrame.location.scriptId}get scriptSource(){return this._thread._sourceContainer.getScriptById(this.scriptId)}get canExplicitlyBeRestarted(){return!!this.callFrame.canBeRestarted}equivalentTo(e){return e instanceof n&&e._rawLocation.columnNumber===this._rawLocation.columnNumber&&e._rawLocation.lineNumber===this._rawLocation.lineNumber&&e._rawLocation.scriptId===this._rawLocation.scriptId}callFrameId(){return this._scope?this._scope.callFrameId:void 0}async scopes(){let e=this._scope;if(!e)throw new k(gI());return{scopes:(await Promise.all(e.chain.map(async(r,o)=>{let i="",s;switch(r.type){case"global":i=Yt.t("Global");break;case"local":i=Yt.t("Local"),s="locals";break;case"with":i=Yt.t("With Block"),s="locals";break;case"closure":i=Yt.t("Closure"),s="arguments";break;case"catch":i=Yt.t("Catch Block"),s="locals";break;case"block":i=Yt.t("Block"),s="locals";break;case"script":i=Yt.t("Script");break;case"eval":i=Yt.t("Eval");break;case"module":i=Yt.t("Module");break;default:i=r.type.substr(0,1).toUpperCase()+r.type.substr(1);break}r.name&&r.type==="closure"?i=Yt.t("Closure ({0})",r.name):r.name&&(i=`${i}: ${r.name}`);let a=this._scopeVariable(o,e);if(!a)return;let c={name:i,presentationHint:s,expensive:r.type==="global",variablesReference:a.id};if(r.startLocation){let l=this._thread.rawLocation(r.startLocation),p=await this._thread.rawLocationToUiLocation(l);if(c.line=(p||l).lineNumber,c.column=(p||l).columnNumber,p&&(c.source=await p.source.toDap()),r.endLocation){let u=this._thread.rawLocation(r.endLocation),g=await this._thread.rawLocationToUiLocation(u);c.endLine=(g||u).lineNumber,c.endColumn=(g||u).columnNumber}}return c}))).filter(Me)}}getStepSkipList(e){return Promise.resolve(void 0)}async toDap(e){let{isSmartStepped:t,name:r,uiLocation:o}=await this.getLocationInfo(),i=o?await o.source.toDap():void 0,s=t?"deemphasize":"normal";t&&i&&(i.origin=t===1?Yt.t("Skipped by smartStep"):Yt.t("Skipped by skipFiles"));let a=(o||this._rawLocation).lineNumber,c=(o||this._rawLocation).columnNumber,l=r;return i&&e&&(e.module&&(l+=` [${i.name}]`),e.line&&(l+=` Line ${a}`)),{id:this.frameId,name:l,line:a,column:c,source:i,presentationHint:s,canRestart:this.callFrame.canBeRestarted??!this.isAsync}}async formatAsNative(){let{name:e,uiLocation:t}=await this.getLocationInfo(),r=await t?.source.existingAbsolutePath()||await t?.source.prettyName()||this.callFrame.url,{lineNumber:o,columnNumber:i}=t||this._rawLocation;return`    at ${e} (${r}:${o}:${i})`}async format(){let{name:e,uiLocation:t}=await this.getLocationInfo(),r=await t?.source.prettyName()||"<unknown>",o=t||this._rawLocation,i=`${e} @ ${r}:${o.lineNumber}`;return o.columnNumber>1&&(i+=`:${o.columnNumber}`),i}_scopeVariable(e,t){let r=t.variables[e];if(r)return r;let o={stackFrame:this,callFrameId:t.callFrameId,scopeNumber:e},i=[];e===0&&(t.thisObject&&i.push({name:"this",value:t.thisObject}),t.returnValue&&i.push({name:Yt.t("Return value"),value:t.returnValue}));let s=this._thread.pausedVariables();if(!s)return;let a=s.createScope(t.chain[e].object,o,i);return t.variables[e]=a}},fb={scopes:[]},hp=class{constructor(e){this.frameId=gb();this.name=e.name,this.root=e.root,this.thread=e.thread,this.source=e.source,this.inlineFrameIndex=e.inlineFrameIndex,this.wasmPosition=new Ae(this.inlineFrameIndex,this.root.rawPosition.base0.columnNumber),this.uiLocation=B(()=>e.thread._sourceContainer.preferredUiLocation({columnNumber:e.root.rawPosition.base1.columnNumber,lineNumber:e.inlineFrameIndex+1,source:e.source}))}async formatAsNative(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation();return`    at ${this.name} (${r.url}:${t}:${e})`}async format(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation(),o=await r.prettyName()||"<unknown>";return`${this.name} @ ${o}:${t}:${e}`}async toDap(){let{columnNumber:e,lineNumber:t,source:r}=await this.uiLocation();return Promise.resolve({id:this.frameId,name:this.name,column:e,line:t,source:await r.toDap()})}async getStepSkipList(e){let t=this.source.sourceMap.value.settledValue;if(!t?.getStepSkipList)return;let r=await this.uiLocation();return r?t.getStepSkipList(e,this.wasmPosition,r.source.compiledToSourceUrl.get(this.source),new Ne(r.lineNumber,r.columnNumber)):t.getStepSkipList(e,this.root.rawPosition)}async scopes(){let e=this.source.sourceMap.value.settledValue,t=this.root.callFrameId();if(!e||!t)return fb;let r=await e.getVariablesInScope?.(t,this.wasmPosition);if(!r)return fb;let o=this.thread.pausedVariables();if(!o)return fb;let i={stackFrame:this.root,callFrameId:t,scopeNumber:0};return{scopes:await Promise.all([..._v(r,s=>s.scope)].map(([s,a])=>o.createWasmScope(s,a,i).toDap("propertyValue").then(c=>({name:c.name,variablesReference:c.variablesReference,expensive:s!=="LOCAL"}))))}}}});var yk,Yi,nm,Zi,Jn,im,sm,am,cm,lm,hb=m(()=>{"use strict";yk=y(require("@vscode/l10n"));U();Wd();Vd();Aa();up();Yi=class{constructor(e){this.event=e;this.stackTrace=B(e=>this.event.stackTrace?on.fromRuntime(e,this.event.stackTrace):void 0);this.getUiLocation=B(async e=>{let t=this.stackTrace(e);if(!t)return;let r;for(let o of t.frames){if(!(o instanceof Lt))continue;let i=await o.uiLocation();if(i&&(r||(r=i),!i.source.blackboxed()))return{source:await i.source.toDap(),line:i.lineNumber,column:i.columnNumber}}if(r)return{source:await r.source.toDap(),line:r.lineNumber,column:r.columnNumber}})}formatDefaultString(e,t,r=!1){let i=t.length>1&&t[0].type==="string"?Bh(t[0].value,t.slice(1),Vh):Bh("",t,Vh),s=i.result+`
`;return i.usedAllSubs&&!t.some(Ji)?{output:s}:this.formatComplexStringOutput(e,s,t,r)}async formatComplexStringOutput(e,t,r,o){(r.some(s=>s.subtype==="error")||qn.isStackLike(t))&&(await this.getUiLocation(e),t=await e.replacePathsInStackTrace(t),o=!0);let i=e.replVariables.createVariableForOutput(t,r,o?this.stackTrace(e):void 0);return{output:t,variablesReference:i.id}}},nm=class extends Yi{async toDap(e){return this.event.args[0]?.value==="console.assert"&&(this.event.args[0].value=yk.t("Assertion failed")),{category:"stderr",...await this.formatDefaultString(e,this.event.args,!0),...await this.getUiLocation(e)}}},Zi=class extends Yi{constructor(t,r,o){super(t);this.includeStack=r;this.category=o}async toDap(t){return{category:this.category,...await this.formatDefaultString(t,this.event.args,this.includeStack),...await this.getUiLocation(t)}}},Jn=class extends Zi{constructor(e){super(e,!1,"stdout")}},im=class extends Zi{constructor(e){super(e,!0,"stdout")}},sm=class extends Zi{constructor(e){super(e,!0,"stderr")}},am=class extends Zi{constructor(e){super(e,!0,"stderr")}},cm=class extends Yi{async toDap(e){return{category:"stdout",group:this.event.type==="startGroupCollapsed"?"startCollapsed":"start",...await this.formatDefaultString(e,this.event.args),...await this.getUiLocation(e)}}},lm=class extends Zi{constructor(e){super(e,!1,"stdout")}async toDap(e){return this.event.args[0]?.preview?{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput("",this.event.args,void 0,this.event.type).id,...await this.getUiLocation(e)}:super.toDap(e)}}});var gp,vk=m(()=>{"use strict";U();Wd();Aa();up();hb();gp=class extends Yi{constructor(){super(...arguments);this.stackTrace=B(t=>{if(this.event.stackTrace)return on.fromRuntime(t,this.event.stackTrace);if(this.event.scriptId)return on.fromRuntime(t,{callFrames:[{functionName:"(program)",lineNumber:this.event.lineNumber,columnNumber:this.event.columnNumber,scriptId:this.event.scriptId,url:this.event.url||""}]})})}async toDap(t){let r=this.event.exception?Qi(this.event.exception):{title:""},o=r.title;o.startsWith("Uncaught")||(o=`Uncaught ${this.event.exception?.className??"Error"} `+o);let i=this.stackTrace(t),s=this.event.exception&&!r.stackTrace?[this.event.exception]:[];return qn.isStackLike(o)?o=await t.replacePathsInStackTrace(o):i&&(o+=`
`+await i.formatAsNative()),{category:"stderr",output:o,variablesReference:i||s.length?t.replVariables.createVariableForOutput(o,s,i).id:void 0,...await this.getUiLocation(t)}}}});var Ik,Sk=m(()=>{"use strict";Ze();Ik=Ye(function(){return this})});var pm,tm,kk=m(()=>{"use strict";pm=y(require("@vscode/l10n"));Aa();Sk();tm=class{constructor(e,t){this.protoObj=e;this.cdp=t}async toDap(e){if(!this.protoObj.objectId)return{category:"stderr",output:pm.t("Only objects can be queried")};let t=await this.cdp.Runtime.queryObjects({prototypeObjectId:this.protoObj.objectId,objectGroup:"console"});if(await this.cdp.Runtime.releaseObject({objectId:this.protoObj.objectId}),!t)return{category:"stderr",output:pm.t("Could not query the provided object")};let r;try{r=await Ik({cdp:this.cdp,args:[],objectId:t.objects.objectId,objectGroup:"console",generatePreview:!0})}catch(s){return{category:"stderr",output:pm.t(s.message)}}let o="\x1B[32mobjects: "+Ki(r,"repl")+"\x1B[0m";return{category:"stdout",output:"",variablesReference:e.replVariables.createVariableForOutput(o,[r]).id}}}});var um,rm=m(()=>{"use strict";vk();kk();um=Symbol("IConsole")});var bb,Pk,xk,Ck=m(()=>{"use strict";bb=require("path"),Pk=(0,bb.join)(__dirname,"diagnosticTool.js"),xk=(0,bb.join)(__dirname,"diagnosticTool.css")});var Do,It,Kn=m(()=>{"use strict";Do=Symbol("ITarget"),It=Symbol("ILauncher")});var es,Tk,Rk,Qn,wb=m(()=>{"use strict";es=require("inversify"),Tk=require("os"),Rk=require("path");U();Ck();X();Kn();Un();Id();Zr();tn();Qn=class{constructor(e,t,r,o){this.fs=e;this.sources=t;this.breakpoints=r;this.target=o}async generateObject(){let[e]=await Promise.all([this.dumpSources()]);return{breakpoints:this.dumpBreakpoints(),sources:e,config:this.target.launchConfig}}async generateHtml(e=(0,Rk.join)((0,Tk.tmpdir)(),"js-debug-diagnostics.html")){return await this.fs.writeFile(e,`<!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <style>${await this.fs.readFile(xk,"utf-8")}<</style>
      </head>
      <body>
        <script>window.DUMP=${JSON.stringify(await this.generateObject())}</script>
        <script>${await this.fs.readFile(Pk,"utf-8")}</script>
      </body>
      </html>`),e}dumpBreakpoints(){let e=[];for(let t of[this.breakpoints.appliedByPath,this.breakpoints.appliedByRef])for(let r of t.values())for(let o of r){let i=o.diagnosticDump();e.push({source:i.source,params:i.params,cdp:i.cdp.map(s=>s.state===1?{...s,uiLocations:s.uiLocations.map(a=>this.dumpUiLocation(a))}:{...s,done:void 0})})}return e}dumpSources(){let e=[],t=0;for(let r of this.sources.sources)e.push((async()=>({uniqueId:t++,url:r.url,sourceReference:r.sourceReference,absolutePath:r.absolutePath,actualAbsolutePath:await r.existingAbsolutePath(),scriptIds:r.scripts.map(o=>o.scriptId),prettyName:await r.prettyName(),compiledSourceRefToUrl:r instanceof Ge?[...r.compiledToSourceUrl.entries()].map(([o,i])=>[o.sourceReference,i]):void 0,sourceMap:Ai(r)?{url:r.sourceMap.metadata.sourceMapUrl,metadata:r.sourceMap.metadata,sources:Ho(Object.fromEntries(r.sourceMap.sourceByUrl),o=>o.sourceReference)}:void 0}))());return Promise.all(e)}dumpUiLocation(e){return{lineNumber:e.lineNumber,columnNumber:e.columnNumber,sourceReference:e.source.sourceReference}}};Qn=h([(0,es.injectable)(),d(0,(0,es.inject)(oe)),d(1,(0,es.inject)(ut)),d(2,(0,es.inject)(Ar)),d(3,(0,es.inject)(Do))],Qn)});var Xn,Ua,ja,yb=m(()=>{"use strict";Xn=require("inversify");U();$();Mt();J();eo();Ie();ge();Ih();Hi();op();tn();Ua=Symbol("IExceptionPauseService"),ja=class{constructor(e,t,r,o,i){this.evaluator=e;this.scriptSkipper=t;this.dap=r;this.sourceContainer=i;this.state={cdp:"none"};this.blocker=ye();this.noDebug=!!o.noDebug,this.breakOnError=o.__breakOnConditionalError,this.blocker.resolve()}get launchBlocker(){return this.blocker.promise}async setBreakpoints(e){if(!this.noDebug){try{this.state=this.parseBreakpointRequest(e)}catch(t){if(!(t instanceof k))throw t;this.dap.output({category:"stderr",output:t.message});return}this.cdp?await this.sendToCdp(this.cdp):this.state.cdp!=="none"&&this.blocker.hasSettled()&&(this.blocker=ye())}}async shouldPauseAt(e){if(e.reason!=="exception"&&e.reason!=="promiseRejection"||this.state.cdp==="none"||e.callFrames.some(r=>this.sourceContainer.getSourceScriptById(r.location.scriptId)?.url.endsWith(".cdp"))||this.shouldScriptSkip(e))return!1;let t=this.state.condition;if(e.data?.uncaught){if(t.uncaught&&!await this.evalCondition(e,t.uncaught))return!1}else if(t.caught&&!await this.evalCondition(e,t.caught))return!1;return!0}async apply(e){this.cdp=e,this.state.cdp!=="none"&&await this.sendToCdp(e)}async sendToCdp(e){await e.Debugger.setPauseOnExceptions({state:this.state.cdp}),this.blocker.resolve()}async evalCondition(e,t){return!!(await t({callFrameId:e.callFrames[0].callFrameId},o=>o==="error"?e.data:void 0))?.result.value}shouldScriptSkip(e){if(e.data?.uncaught||!e.callFrames.length)return!1;let t=this.sourceContainer.getScriptById(e.callFrames[0].location.scriptId);return!!t&&this.scriptSkipper.isScriptSkipped(t.url)}parseBreakpointRequest(e){let t=(e.filterOptions??[]).concat(e.filters.map(a=>({filterId:a}))),r="none",o=[],i=[];for(let{filterId:a,condition:c}of t)a==="all"?(r="all",c&&o.push(a)):a==="uncaught"&&(r==="none"&&(r="uncaught"),c&&i.push(a));let s=a=>{if(a.length===0)return;let c="!!("+t.map(u=>u.condition).filter(Me).join(") || !!(")+")",l=Ln(c);if(l)throw new k(Mn({line:0,condition:c},l.message));let p=vh(c,this.breakOnError);return this.evaluator.prepare(p,{hoist:["error"]}).invoke};return r==="none"?{cdp:r}:{cdp:r,condition:{caught:s(o),uncaught:s(i)}}}};ja=h([(0,Xn.injectable)(),d(0,(0,Xn.inject)(Dr)),d(1,(0,Xn.inject)(Wn)),d(2,(0,Xn.inject)(zt)),d(3,(0,Xn.inject)(re)),d(4,(0,Xn.inject)(ut))],ja)});var dm,Dk=m(()=>{"use strict";dm=class{constructor(){this.didEnable=new WeakSet}async retrieve(e){this.didEnable.has(e)||(this.didEnable.add(e),await e.Performance.enable({}));let t=await e.Performance.getMetrics({});if(!t)return{error:"Error in CDP"};let r={};for(let o of t.metrics)r[o.name]=o.value;return{metrics:r}}}});var mm,Lk=m(()=>{"use strict";Ze();mm=class{async retrieve(e){let t=await e.Runtime.evaluate({expression:`({
        memory: process.memoryUsage(),
        cpu: process.cpuUsage(),
        timestamp: Date.now(),
        resourceUsage: process.resourceUsage && process.resourceUsage(),
      })${Ue()}`,returnByValue:!0});return t?t.exceptionDetails?{error:t.exceptionDetails.text}:{metrics:t.result.value}:{error:"No response from CDP"}}}});var fm,gm,ts,vb=m(()=>{"use strict";fm=require("inversify");Kn();Dk();Lk();gm=Symbol("IPerformanceProvider"),ts=class{constructor(e){this.target=e}create(){return this.target.type()==="node"?new mm:new dm}};ts=h([(0,fm.injectable)(),d(0,(0,fm.inject)(Do))],ts)});var Wa,Ib=m(()=>{"use strict";Wa=class{constructor(e){this.sources=e;this.locationIdCounter=0;this.locationsByRef=new Map}getLocationIdFor(e){let t=[e.functionName,e.url,e.scriptId,e.lineNumber,e.columnNumber].join(":"),r=this.locationsByRef.get(t);if(r)return r.id;let o=this.locationIdCounter++;return this.locationsByRef.set(t,{id:o,callFrame:e,locations:(async()=>{let i=await this.sources.getScriptById(e.scriptId)?.source;if(!i)return[];let s=await this.sources.currentSiblingUiLocations({lineNumber:e.lineNumber+1,columnNumber:e.columnNumber+1,source:i});return Promise.all(s.map(async a=>({...a,source:await a.source.toDap()})))})()}),o}getLocations(){return Promise.all([...this.locationsByRef.values()].sort((e,t)=>e.id-t.id).map(async e=>({callFrame:e.callFrame,locations:await e.locations})))}}});async function Ek(n,e,t){let r=new Wa(e),o=n.nodes.map(i=>({...i,locationId:r.getLocationIdFor(i.callFrame),positionTicks:i.positionTicks?.map(s=>({...s,startLocationId:r.getLocationIdFor({...i.callFrame,lineNumber:s.line-1,columnNumber:0}),endLocationId:r.getLocationIdFor({...i.callFrame,lineNumber:s.line,columnNumber:0})}))}));return{...n,nodes:o,$vscode:{rootPath:t,locations:await r.getLocations()}}}var Sb,rs,hm,dt,kb,bp=m(()=>{"use strict";Sb=y(require("@vscode/l10n")),rs=require("inversify"),hm=require("path");tt();H();J();Ie();ge();X();tn();Ib();dt=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(!await this.cdp.Profiler.start({}))throw new k(na());return new kb(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}async save(e,t){let r=await Ek(e,this.sources,this.launchConfig.__workspaceFolder);(0,hm.isAbsolute)(t)||(t=(0,hm.join)(this.launchConfig.__workspaceFolder,t)),await this.fs.writeFile(t,JSON.stringify(r))}};dt.type="cpu",dt.extension=".cpuprofile",dt.label=Sb.t("CPU Profile"),dt.description=Sb.t("Generates a .cpuprofile file you can open in VS Code or the Edge/Chrome devtools"),dt.editable=!0,dt=h([(0,rs.injectable)(),d(0,(0,rs.inject)(Be)),d(1,(0,rs.inject)(oe)),d(2,(0,rs.inject)(ut)),d(3,(0,rs.inject)(re))],dt);kb=class{constructor(e,t,r,o,i){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=i;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,this.stopEmitter.fire())}async stop(){let e=await this.cdp.Profiler.stop({});if(!e)throw new k(na());await this.dispose();let t=await Ek(e.profile,this.sources,this.workspaceFolder);await this.fs.writeFile(this.file,JSON.stringify(t))}}});var Pb,os,pr,xb,Cb=m(()=>{"use strict";Pb=y(require("@vscode/l10n")),os=require("inversify");tt();H();J();Ie();ge();X();tn();Ib();pr=class{constructor(e,t,r,o){this.cdp=e;this.fs=t;this.sources=r;this.launchConfig=o}static canApplyTo(){return!0}async start(e,t){if(await this.cdp.HeapProfiler.enable({}),!await this.cdp.HeapProfiler.startSampling({}))throw new k(na());return new xb(this.cdp,this.fs,this.sources,this.launchConfig.__workspaceFolder,t)}};pr.type="heap",pr.extension=".heapprofile",pr.label=Pb.t("Heap Profile"),pr.description=Pb.t("Generates a .heapprofile file you can open in VS Code or the Edge/Chrome devtools"),pr.editable=!0,pr=h([(0,os.injectable)(),d(0,(0,os.inject)(Be)),d(1,(0,os.inject)(oe)),d(2,(0,os.inject)(ut)),d(3,(0,os.inject)(re))],pr);xb=class{constructor(e,t,r,o,i){this.cdp=e;this.fs=t;this.sources=r;this.workspaceFolder=o;this.file=i;this.stopEmitter=new S;this.disposed=!1;this.onUpdate=new S().event;this.onStop=this.stopEmitter.event}async dispose(){this.disposed||(this.disposed=!0,await this.cdp.HeapProfiler.disable({}),this.stopEmitter.fire())}async stop(){let e=await this.cdp.HeapProfiler.stopSampling({});if(!e)throw new k(na());await this.dispose();let t=await this.annotateSources(e.profile);await this.fs.writeFile(this.file,JSON.stringify(t))}async annotateSources(e){let t=new Wa(this.sources),r=(i,s)=>{s.locationId=t.getLocationIdFor(i.callFrame);for(let a of i.children){let c={...a,children:[]};s.children.push(c),r(a,c)}},o={...e.head,children:[]};return r(e.head,o),{...e,head:o,$vscode:{rootPath:this.workspaceFolder,locations:await t.getLocations()}}}}});var Tb,_k,bm,ur,Rb=m(()=>{"use strict";Tb=y(require("@vscode/l10n")),_k=require("fs"),bm=require("inversify");tt();H();ur=class{constructor(e){this.cdp=e;this.cdp.HeapProfiler.on("addHeapSnapshotChunk",({chunk:t})=>this.currentWriter?.stream.write(t))}static canApplyTo(){return!0}async start(e,t){return{onStop:new S().event,onUpdate:new S().event,dispose:()=>{},stop:async()=>{await this.cdp.HeapProfiler.enable({}),await this.dumpToFile(t),await this.cdp.HeapProfiler.disable({})}}}async dumpToFile(e){let{stream:t,promise:r}=this.currentWriter={stream:(0,_k.createWriteStream)(e),promise:this.cdp.HeapProfiler.takeHeapSnapshot({})};await r,t.end(),this.currentWriter=void 0}};ur.type="memory",ur.extension=".heapsnapshot",ur.label=Tb.t("Heap Snapshot"),ur.description=Tb.t("Generates a .heapsnapshot file you can open in VS Code or the Edge/Chrome devtools"),ur.instant=!0,ur=h([(0,bm.injectable)(),d(0,(0,bm.inject)(Be))],ur)});var wm,ym,vm,Zt,Im=m(()=>{"use strict";wm=require("inversify");X();bp();Cb();Rb();ym=Symbol("IProfilerFactory"),vm=()=>{let n=new Date;return["vscode-profile",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()].map(e=>String(e).padStart(2,"0")).join("-")},Zt=class{constructor(e){this.container=e}get(e){let t=Zt.ctors.find(r=>r.type===e);if(!t)throw new Error(`Invalid profilter type ${e}`);return this.container.get(t)}};Zt.ctors=[dt,pr,ur],Zt=h([(0,wm.injectable)(),d(0,(0,wm.inject)(la))],Zt)});var Db,Ak,Yn,Fk,Mk,Sm,Va,Lb=m(()=>{"use strict";Db=y(require("@vscode/l10n")),Ak=require("crypto"),Yn=require("inversify"),Fk=require("os"),Mk=require("path");tt();Ie();ge();Jl();Un();Yl();Im();bp();Sm=Symbol("IProfileController"),Va=class{constructor(e,t,r,o,i){this.cdp=e;this.factory=t;this.basicCpuProfiler=r;this.breakpoints=o;this.shutdown=i;this.seenConsoleProfileNames=Object.create(null)}connect(e,t){e.on("startProfile",async r=>(await this.start(e,t,r),{})),e.on("stopProfile",()=>this.stopProfiling(e)),this.cdp.Profiler.on("consoleProfileStarted",()=>{e.output({output:Db.t("Console profile started")+`
`,category:"console"})}),this.cdp.Profiler.on("consoleProfileFinished",async r=>{let o=this.saveConsoleProfile(e,r),i=this.shutdown.register(0,()=>o);await o,i.dispose()}),t.onPaused(()=>this.stopProfiling(e))}async start(e,t,r){if(this.profile)throw new k(mI());this.profile=this.startProfileInner(e,t,r).catch(o=>{throw this.profile=void 0,o}),await this.profile}async saveConsoleProfile(e,t){let r;if(t.title){r=t.title.replace(/[\/\\]/g,"-");let o=this.seenConsoleProfileNames[t.title]||0;this.seenConsoleProfileNames[t.title]=o+1,o>0&&(r+=`-${o}`)}else r=vm();r+=dt.extension,await this.basicCpuProfiler.save(t.profile,r),e.output({output:Db.t('CPU profile saved as "{0}" in your workspace folder',r)+`
`,category:"console"})}async startProfileInner(e,t,r){let o=!1,i;if(r.stopAtBreakpoint?.length){let p=new Set(r.stopAtBreakpoint);o=!0,i=u=>!(u instanceof Lr)||p.has(u.dapId)}else i=()=>!1;await this.breakpoints.applyEnabledFilter(i);let s=(0,Mk.join)((0,Fk.tmpdir)(),`vscode-js-profile-${(0,Ak.randomBytes)(4).toString("hex")}`),a=await this.factory.get(r.type).start(r,s),c={file:s,profile:a,enableFilter:i,keptDebuggerOn:o};a.onUpdate(p=>e.profilerStateUpdate({label:p,running:!0})),a.onStop(()=>this.disposeProfile(c));let l=!!t.pausedDetails();return o?await t.resume():l&&(await this.cdp.Debugger.disable({}),l&&t.onResumed()),e.profileStarted({file:c.file,type:r.type}),c}async stopProfiling(e){let t=await this.profile?.catch(()=>{});return!t||!this.profile?{}:(this.profile=void 0,await t?.profile.stop(),e.profilerStateUpdate({label:"",running:!1}),{})}async disposeProfile({profile:e,enableFilter:t,keptDebuggerOn:r}){r||await this.cdp.Debugger.enable({}),await this.breakpoints.applyEnabledFilter(void 0,t),e.dispose()}};Va=h([(0,Yn.injectable)(),d(0,(0,Yn.inject)(Be)),d(1,(0,Yn.inject)(ym)),d(2,(0,Yn.inject)(dt)),d(3,(0,Yn.inject)(Ar)),d(4,(0,Yn.inject)(Bn))],Va)});var Nr,ns,Eb=m(()=>{"use strict";Nr=y(require("@vscode/l10n"));st();O();U();Pr();$();Gl();Mt();V();Ie();ge();X();ua();Jl();Un();Fh();Bd();jd();rm();wb();ep();Hi();yb();vb();Lb();bp();op();zd();Zr();tn();mb();ns=class n{constructor(e,t,r,o){this.asyncStackPolicy=t;this.launchConfig=r;this._services=o;this._disposables=new q;this._customBreakpoints=[];this._xhrBreakpoints=[];this._threadDeferred=ye();this.breakpointIdCounter=vu();this._cdpProxyProvider=this._services.get(Od);this._configurationDoneDeferred=ye(),this.sourceContainer=o.get(ut),this.breakpointManager=o.get(Ar);let i=o.get(gm),s=o.get(lt);s.onFlush(()=>{s.report("breakpointStats",this.breakpointManager.statisticsForTelemetry()),s.report("statistics",this.sourceContainer.statistics())}),this.dap=e,this.dap.on("initialize",a=>this.onInitialize(a)),this.dap.on("setBreakpoints",a=>this._onSetBreakpoints(a)),this.dap.on("setExceptionBreakpoints",a=>this.setExceptionBreakpoints(a)),this.dap.on("configurationDone",()=>this.configurationDone()),this.dap.on("loadedSources",()=>this._onLoadedSources()),this.dap.on("disableSourcemap",a=>this._onDisableSourcemap(a)),this.dap.on("source",a=>this._onSource(a)),this.dap.on("threads",()=>this._onThreads()),this.dap.on("stackTrace",a=>this._withThread(c=>c.stackTrace(a))),this.dap.on("variables",a=>this._onVariables(a)),this.dap.on("readMemory",a=>this._onReadMemory(a)),this.dap.on("writeMemory",a=>this._onWriteMemory(a)),this.dap.on("setVariable",a=>this._onSetVariable(a)),this.dap.on("setExpression",a=>this._onSetExpression(a)),this.dap.on("continue",()=>this._withThread(a=>a.resume())),this.dap.on("pause",()=>this._withThread(a=>a.pause())),this.dap.on("next",()=>this._withThread(a=>a.stepOver())),this.dap.on("stepIn",a=>this._withThread(c=>c.stepInto(a.targetId))),this.dap.on("stepOut",()=>this._withThread(a=>a.stepOut())),this.dap.on("restartFrame",a=>this._withThread(c=>c.restartFrame(a))),this.dap.on("scopes",a=>this._withThread(c=>c.scopes(a))),this.dap.on("evaluate",a=>this.onEvaluate(a)),this.dap.on("completions",a=>this._withThread(c=>c.completions(a))),this.dap.on("exceptionInfo",()=>this._withThread(a=>a.exceptionInfo())),this.dap.on("setCustomBreakpoints",a=>this.setCustomBreakpoints(a)),this.dap.on("toggleSkipFileStatus",a=>this._toggleSkipFileStatus(a)),this.dap.on("toggleSkipFileStatus",a=>this._toggleSkipFileStatus(a)),this.dap.on("prettyPrintSource",a=>this._prettyPrintSource(a)),this.dap.on("locations",a=>this._onLocations(a)),this.dap.on("revealPage",()=>this._withThread(a=>a.revealPage())),this.dap.on("getPerformance",()=>this._withThread(a=>i.retrieve(a.cdp()))),this.dap.on("breakpointLocations",a=>this._breakpointLocations(a)),this.dap.on("createDiagnostics",a=>this._dumpDiagnostics(a)),this.dap.on("requestCDPProxy",()=>this._requestCDPProxy()),this.dap.on("setExcludedCallers",a=>this._onSetExcludedCallers(a)),this.dap.on("saveDiagnosticLogs",({toFile:a})=>this._saveDiagnosticLogs(a)),this.dap.on("setSourceMapStepping",a=>this._setSourceMapStepping(a)),this.dap.on("stepInTargets",a=>this._stepInTargets(a)),this.dap.on("setDebuggerProperty",a=>this._setDebuggerProperty(a)),this.dap.on("setSymbolOptions",a=>this._setSymbolOptions(a)),this.dap.on("networkCall",a=>this._doNetworkCall(a)),this.dap.on("enableNetworking",a=>this._withThread(c=>c.enableNetworking(a))),this.dap.on("getPreferredUILocation",a=>this._getPreferredUILocation(a))}async _getPreferredUILocation(e){let t;if(e.originalUrl&&(t=this.sourceContainer.getSourceByOriginalUrl(e.originalUrl)),!t&&e.source&&(t=this.sourceContainer.source(e.source)),!t){if(e.source)return{column:e.column,line:e.line,source:e.source};throw new k(yI())}let r=await this.sourceContainer.preferredUiLocation({columnNumber:e.column+1,lineNumber:e.line+1,source:t});return{column:r.columnNumber-1,line:r.lineNumber-1,source:await r.source.toDap()}}async _doNetworkCall({method:e,params:t}){return this._thread?this._thread.cdp().Network[e](t):Promise.resolve({})}_setDebuggerProperty(e){return this._thread?.cdp().DotnetDebugger.setDebuggerProperty(e),Promise.resolve({})}_setSymbolOptions(e){return this._thread?.cdp().DotnetDebugger.setSymbolOptions(e),Promise.resolve({})}_breakpointLocations(e){return this._withThread(async t=>{let r=this.sourceContainer.source(e.source);return r?{breakpoints:(await this.breakpointManager.getBreakpointLocations(t,r,new Ne(e.line,e.column||1),new Ne(e.endLine||e.line+1,e.endColumn||e.column||1))).map(i=>i.uiLocations.find(s=>s.source===r)).filter(Me).map(i=>({line:i.lineNumber,column:i.columnNumber}))}:{breakpoints:[]}})}_stepInTargets(e){return this._withThread(async t=>({targets:await t.getStepInTargets(e.frameId)}))}_setSourceMapStepping({enabled:e}){return this.sourceContainer.doSourceMappedStepping=e,Promise.resolve({})}async _saveDiagnosticLogs(e){let t=this._services.get(L).getRecentLogs();return await this._services.get(oe).writeFile(e,t.map(r=>JSON.stringify(r)).join(`
`)),{}}async launchBlocker(){await this._configurationDoneDeferred.promise,await this._thread?.debuggerReady.promise,await this._services.get(Ua).launchBlocker,await this.breakpointManager.launchBlocker()}async _onSetExcludedCallers({callers:e}){return(await this._threadDeferred.promise).setExcludedCallers(e),{}}async onInitialize(e){console.assert(e.linesStartAt1),console.assert(e.columnsStartAt1),this._services.get(ip).value=e;let t=n.capabilities(!0);return setTimeout(()=>this.dap.initialized({}),0),setTimeout(()=>this._thread?.dapInitialized(),0),t}static capabilities(e=!1){return{supportsConfigurationDoneRequest:!0,supportsFunctionBreakpoints:!1,supportsConditionalBreakpoints:!0,supportsHitConditionalBreakpoints:!0,supportsEvaluateForHovers:!0,supportsReadMemoryRequest:!0,supportsWriteMemoryRequest:!0,exceptionBreakpointFilters:[{filter:"all",label:Nr.t("Caught Exceptions"),default:!1,supportsCondition:!0,description:Nr.t("Breaks on all throw errors, even if they're caught later."),conditionDescription:'error.name == "MyError"'},{filter:"uncaught",label:Nr.t("Uncaught Exceptions"),default:!1,supportsCondition:!0,description:Nr.t("Breaks only on errors or promise rejections that are not handled."),conditionDescription:'error.name == "MyError"'}],supportsStepBack:!1,supportsSetVariable:!0,supportsRestartFrame:!0,supportsGotoTargetsRequest:!1,supportsStepInTargetsRequest:!0,supportsCompletionsRequest:!0,supportsModulesRequest:!1,additionalModuleColumns:[],supportedChecksumAlgorithms:[],supportsRestartRequest:!0,supportsExceptionOptions:!1,supportsValueFormattingOptions:!0,supportsExceptionInfoRequest:!0,supportTerminateDebuggee:!0,supportsDelayedStackTraceLoading:!0,supportsLoadedSourcesRequest:!0,supportsLogPoints:!0,supportsTerminateThreadsRequest:!1,supportsSetExpression:!0,supportsTerminateRequest:!1,completionTriggerCharacters:[".","[",'"',"'"],supportsBreakpointLocationsRequest:!0,supportsClipboardContext:!0,supportsExceptionFilterOptions:!0,supportsEvaluationOptions:!!e,supportsDebuggerProperties:!!e,supportsSetSymbolOptions:!!e,supportsANSIStyling:!0}}async _onSetBreakpoints(e){return this.breakpointManager.setBreakpoints(e,e.breakpoints?.map(()=>this.breakpointIdCounter())??[])}async setExceptionBreakpoints(e){return await this._services.get(Ua).setBreakpoints(e),{}}async configurationDone(){return this._configurationDoneDeferred.resolve(),{}}async _onLoadedSources(){return{sources:await this.sourceContainer.loadedSources()}}async _onDisableSourcemap(e){let t=this.sourceContainer.source(e.source);if(!t)return he(Nr.t("Source not found"));if(!(t instanceof Ge))return he(Nr.t("Source not a source map"));for(let r of t.compiledToSourceUrl.keys())this.sourceContainer.disableSourceMapForSource(r,!0);return await this._thread?.refreshStackTrace(),{}}async _onSource(e){e.source||(e.source={sourceReference:e.sourceReference}),e.source.path=ar(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return he(Nr.t("Source not found"));let r=await t.content();return r===void 0?(t instanceof Ge&&this.dap.suggestDisableSourcemap({source:e.source}),he(Nr.t("Unable to retrieve source content"))):{content:r,mimeType:t.getSuggestedMimeType}}async _onThreads(){let e=[];return this._thread&&e.push({id:this._thread.id,name:this._thread.name()}),{threads:e}}findVariableStore(e){if(!this._thread)return;let t=this._thread.pausedVariables();if(t&&e(t))return t;if(e(this._thread.replVariables))return this._thread.replVariables}async _onLocations(e){let t=this.findVariableStore(i=>i.hasVariable(e.locationReference));if(!t||!this._thread)throw ql();let r=await t.getLocations(e.locationReference),o=await this._thread.rawLocationToUiLocationWithWaiting(this._thread.rawLocation(r));if(!o)throw ql();return{source:await o.source.toDap(),line:o.lineNumber,column:o.columnNumber}}async _onVariables(e){return{variables:await this.findVariableStore(r=>r.hasVariable(e.variablesReference))?.getVariables(e)??[]}}async _onReadMemory(e){let t=e.memoryReference,r=await this.findVariableStore(o=>o.hasMemory(t))?.readMemory(t,e.offset??0,e.count);return r?{address:"0",data:r.toString("base64"),unreadableBytes:e.count-r.length}:{address:"0",unreadableBytes:e.count}}async _onWriteMemory(e){let t=e.memoryReference;return{bytesWritten:await this.findVariableStore(o=>o.hasMemory(t))?.writeMemory(t,e.offset??0,Buffer.from(e.data,"base64"))}}async _onSetExpression(e){if(!this._thread)throw new k(fh());let t=await this._thread.evaluate({expression:`${e.expression} = ${Nl(e.value)}`,context:"repl",frameId:e.frameId});return{value:t.result,variablesReference:t.variablesReference,indexedVariables:t.indexedVariables,namedVariables:t.namedVariables,presentationHint:t.presentationHint,type:t.type,memoryReference:t.memoryReference,valueLocationReference:t.valueLocationReference}}async _onSetVariable(e){let t=this.findVariableStore(r=>r.hasVariable(e.variablesReference));return t?(e.value=Nl(e.value.trim()),t.setVariable(e)):he(Nr.t("Variable not found"))}_withThread(e){if(!this._thread)throw new k(fh());return e(this._thread)}async _refreshStackTrace(){if(!this._thread)return;this._thread.pausedDetails()&&await this._thread.refreshStackTrace()}createThread(e,t){this._thread=new Ba(this.sourceContainer,e,this.dap,t,this._services.get(On),this._services.get(L),this._services.get(Dr),this._services.get(Ud),this.launchConfig,this.breakpointManager,this._services.get(um),this._services.get(Ua),this._services.get(Hn),this._services.get(Bn),this._services.get(ip));let r=this._services.get(Sm);return r.connect(this.dap,this._thread),"profileStartup"in this.launchConfig&&this.launchConfig.profileStartup&&r.start(this.dap,this._thread,{type:dt.type}),this._thread.updateCustomBreakpoints(this._xhrBreakpoints,this._customBreakpoints),this.asyncStackPolicy.connect(e).then(o=>this._disposables.push(o)).catch(o=>this._services.get(L).error("internal","Error enabling async stacks",o)),this.breakpointManager.setThread(this._thread),this._services.get(je).attach(e),this._threadDeferred.resolve(this._thread),this._thread}async setCustomBreakpoints({ids:e,xhr:t}){return await this._thread?.updateCustomBreakpoints(t,e),this._customBreakpoints=e,this._xhrBreakpoints=t,{}}async _toggleSkipFileStatus(e){return await this._services.get(Wn).toggleSkippingFile(e),await this._refreshStackTrace(),{}}async _prettyPrintSource(e){if(!e.source||!this._thread)return{};e.source.path=ar(e.source.path);let t=this.sourceContainer.source(e.source);if(!t)return he(Nr.t("Source not found"));let r=await t.prettyPrint();if(!r)return he(Nr.t("Unable to pretty print"));let{map:o,source:i}=r;await this.breakpointManager.moveBreakpoints(this._thread,t,o,i),this.sourceContainer.clearDisabledSourceMaps(t);let s=!!this._thread.pausedDetails();return await this._refreshStackTrace(),{source:await i.toDap(),didReveal:s}}onEvaluate(e){return e.expression===".scripts"?this._dumpDiagnostics({fromSuggestion:!1}).then(this.dap.openDiagnosticTool).then(()=>({result:"Opening diagnostic tool...",variablesReference:0})):this._withThread(t=>t.evaluate(e))}async _dumpDiagnostics(e){let t={file:await this._services.get(Qn).generateHtml()};return e.fromSuggestion&&this._services.get(lt).report("diagnosticPrompt",{event:"opened"}),t}async _requestCDPProxy(){return await this._cdpProxyProvider.proxy()}dispose(){this._disposables.dispose(),cd(this._services)}}});var GE,Ok,JE,Nk,Bk,jk=m(()=>{"use strict";st();H();GE={connect:async()=>bn},Ok=n=>({async connect(e){return await e.Debugger.setAsyncCallStackDepth({maxDepth:n}),bn}}),JE=n=>{let e=new S,t=!1,r=()=>{t||(t=!0,e.fire())};return{async connect(o){if(t)return await o.Debugger.setAsyncCallStackDepth({maxDepth:n}),bn;let i=new q;return i.push(e.event(()=>{i.dispose(),o.Debugger.setAsyncCallStackDepth({maxDepth:n})}),o.Debugger.on("breakpointResolved",r),o.Debugger.on("paused",s=>{s.reason!=="instrumentation"&&r()})),i}}},Nk=Ok(32),Bk=n=>n===!1?GE:n===!0?Nk:"onAttach"in n?Ok(n.onAttach):"onceBreakpointResolved"in n?JE(n.onceBreakpointResolved):Nk});var Uk,Wk,km,Vk=m(()=>{"use strict";Uk=require("fs"),Wk=require("inspector"),km=class{constructor(e){this.file=e;this.session=new Wk.Session;this.session.connect()}async start(){try{await this.post("Profiler.enable")}catch{}await this.post("Profiler.start")}async stop(){let{profile:e}=await this.post("Profiler.stop");await Uk.promises.writeFile(this.file,JSON.stringify(e))}dispose(){this.session.disconnect()}post(e,t){return new Promise((r,o)=>this.session.post(e,t,(i,s)=>{i?o(i):r(s)}))}}});var wp,$k,_b=m(()=>{"use strict";H();wp=Symbol("MutableLaunchConfig"),$k=n=>{let e=new S;return new Proxy({},{ownKeys(){return Object.keys(n)},get(t,r){switch(r){case"update":return o=>{n=o,e.fire()};case"onChange":return e.event;default:return n[r]}}})}});var yp,Pm,qk=m(()=>{"use strict";yp=class{toDap(){return{category:"console",output:"\x1B[2J"}}},Pm=class{toDap(){return{category:"stdout",output:"",group:"end"}}}});var xm,Hk,zk,Gk,Ab,Jk=m(()=>{"use strict";H();xm=class{constructor(e){this.sink=e;this.q=[];this.disposed=!1;this.onDrainedEmitter=new S;this.onDrained=this.onDrainedEmitter.event}get length(){return this.q.length}enqueue(e){this.disposed||(this.q.push(new Ab(e)),this.q.length===1&&this.process())}dispose(){this.disposed=!0,this.q=[]}async process(){let e=this.q.findIndex(t=>t.value===zk);e===0?await this.q[0].wait:e===-1?(this.sink(Hk(this.q)),this.q=[]):(this.sink(Hk(this.q.slice(0,e))),this.q=this.q.slice(e)),this.q.length?this.process():this.onDrainedEmitter.fire()}},Hk=n=>n.map(e=>e.value).filter(e=>e!==Gk),zk=Symbol("unsettled"),Gk=Symbol("unsettled"),Ab=class{constructor(e){this.value=zk;e instanceof Promise?this.wait=e.then(t=>{this.value=t},()=>{this.value=Gk}):(this.value=e,this.wait=Promise.resolve())}}});var vp,KE,$a,Kk=m(()=>{"use strict";vp=require("inversify");U();eo();Jl();qk();Jk();hb();KE=new Set(["group","assert","count"]),$a=class{constructor(e,t){this.dap=e;this.isDirty=!1;this.queue=new xm(e=>{for(let t of e)this.dap.output(t)});this.onDrained=this.queue.onDrained;t.register(0,async r=>{this.length&&await new Promise(o=>this.onDrained(o)),r&&this.dispose()})}get length(){return this.queue.length}dispose(){this.queue.dispose()}dispatch(e,t){let r=this.parse(t);r&&this.enqueue(e,r)}enqueue(e,t){if(!(t instanceof yp))this.isDirty=!0;else if(this.isDirty)this.isDirty=!1;else return;this.queue.enqueue(t.toDap(e))}parse(e){if(e.type==="log"){let t=e.stackTrace?.callFrames[0];if(t&&t.url==="internal/console/constructor.js"&&KE.has(t.functionName))return}switch(e.type){case"clear":return new yp;case"endGroup":return new Pm;case"assert":return new nm(e);case"table":return new lm(e);case"startGroup":case"startGroupCollapsed":return new cm(e);case"debug":case"log":case"info":return new Jn(e);case"trace":return new im(e);case"error":return new am(e);case"warning":return new sm(e);case"dir":case"dirxml":return new Jn(e);case"count":return new Jn(e);case"profile":case"profileEnd":return new Jn(e);case"timeEnd":return new Jn(e);default:try{Ws(e.type,"unknown console message type")}catch{}}}};$a=h([(0,vp.injectable)(),d(0,(0,vp.inject)(zt)),d(1,(0,vp.inject)(Bn))],$a)});var Xk,Cm,Qk,qa,Yk=m(()=>{"use strict";Xk=y(require("@vscode/l10n")),Cm=require("inversify");eo();Qk="@vscode/dwarf-debugging",qa=class{constructor(e){this.dap=e;this.didPrompt=!1}async load(){try{return await import(Qk)}catch{return}}prompt(){this.didPrompt||(this.didPrompt=!0,this.dap.output({output:Xk.t("You may install the `{}` module via npm for enhanced WebAssembly debugging",Qk),category:"console"}))}};qa=h([(0,Cm.injectable)(),d(0,(0,Cm.inject)(zt))],qa)});var Ha,Tm=m(()=>{"use strict";Ha=Symbol("IRequestOptionsProvider")});var Zk,eP,Rm,is,er,Dm=m(()=>{"use strict";Zk=require("data-uri-to-buffer"),eP=require("dns"),Rm=y(require("got")),is=require("inversify");Ke();st();V();X();Vl();Tm();er=class{constructor(e,t){this.fs=e;this.options=t;this.autoLocalhostPortFallbacks={}}async fetch(e,t=Je,r){try{let i=(0,Zk.dataUriToBuffer)(e);return{ok:!0,url:e,body:new TextDecoder().decode(i.buffer),statusCode:200}}catch{}let o=Tt(e)?e:We(e);if(o)try{return{ok:!0,url:e,body:await this.fs.readFile(o,"utf-8"),statusCode:200}}catch(i){return{ok:!1,url:e,error:i,statusCode:200}}return this.fetchHttp(e,t,r)}async fetchJson(e,t,r){let o=await this.fetch(e,t,{Accept:"application/json",...r});if(!o.ok)return o;try{return{...o,body:JSON.parse(o.body)}}catch(i){return{...o,ok:!1,url:e,error:i}}}async fetchHttp(e,t,r){let o=new URL(e),i=o.protocol!=="http:",s=Number(o.port)??(i?443:80),a={headers:r,followRedirect:!0};i&&await Qs(e)&&(a.rejectUnauthorized=!1),this.options?.provideOptions(a,e);let c=o.hostname==="localhost";if(c&&this.autoLocalhostPortFallbacks[s]){let u=await this.requestHttp(o.toString(),a,t);return u.statusCode!==503?u:(delete this.autoLocalhostPortFallbacks[s],this.requestHttp(e,a,t))}let p=await this.requestHttp(e,a,t);if(p.statusCode===503&&c){let u;try{u=await eP.promises.lookup(o.hostname)}catch{return p}o.hostname=u.family===6?"127.0.0.1":"[::1]",p=await this.requestHttp(o.toString(),a,t),p.statusCode!==503&&(this.autoLocalhostPortFallbacks[s]=o.hostname)}return p}async requestHttp(e,t,r){this.options?.provideOptions(t,e);let o=new q;try{let i=(0,Rm.default)(e,t);o.push(r.onCancellationRequested(()=>i.cancel()));let s=await i;return{ok:!0,url:e,body:s.body,statusCode:s.statusCode}}catch(i){if(!(i instanceof Rm.RequestError))throw i;let s=i.response?String(i.response?.body):i.message,a=i.response?.statusCode??503;return{ok:!1,body:s,statusCode:a,url:e,error:new td(a,e,s)}}finally{o.dispose()}}};er=h([(0,is.injectable)(),d(0,(0,is.inject)(oe)),d(1,(0,is.optional)()),d(1,(0,is.inject)(Ha))],er)});var Or,ss,tP=m(()=>{"use strict";Or=require("inversify");tt();st();O();X();Kn();Dm();Tm();ss=class extends er{constructor(t,r,o,i,s){super(t,s);this.logger=r;this.target=o;this.cdp=i;this.disposables=new q}dispose(){this.disposables.dispose()}async fetchHttp(t,r,o={}){let i=await super.fetchHttp(t,r,o);return i.ok?i:(this.logger.info("runtime","Network load failed, falling back to CDP",{url:t,res:i}),this.fetchOverBrowserNetwork(t,i))}async fetchOverBrowserNetwork(t,r){if(!this.cdp)return r;let o=await this.cdp.Network.loadNetworkResource({frameId:this.target?.targetInfo.targetId,url:t,options:{includeCredentials:!0,disableCache:!0}});if(!o||!o.resource.success||!o.resource.httpStatusCode||o.resource.httpStatusCode>=400||!o.resource.stream)return r;let i=Number(o.resource.headers?.["Content-Length"]);isNaN(i)&&(i=1/0);let s=[],a=0;for(;;){let c=await this.cdp.IO.read({handle:o.resource.stream,offset:a});if(!c)return this.logger.info("runtime","Stream error encountered in middle, falling back",{url:t}),r;let l=c.base64Encoded?Buffer.from(c.data,"base64").toString():c.data;if(a+=Buffer.byteLength(l,"utf-8"),s.push(l),a>=i){this.cdp.IO.close({handle:o.resource.stream});break}if(c.eof)break}return{ok:!0,body:s.join(""),statusCode:o.resource.httpStatusCode,url:t}}};ss=h([(0,Or.injectable)(),d(0,(0,Or.inject)(oe)),d(1,(0,Or.inject)(L)),d(2,(0,Or.optional)()),d(2,(0,Or.inject)(Do)),d(3,(0,Or.optional)()),d(3,(0,Or.inject)(Be)),d(4,(0,Or.optional)()),d(4,(0,Or.inject)(Ha))],ss)});function oP(n,e=yt){let t=[];for(let r=0;r<n.length;r++){let o=n[r];if(o.startsWith("!")){let i=rP(o.slice(1),e);for(let s=0;s<t.length;s++)t[s]=`^(?!${i.slice(1)})${t[s].slice(1)}`}else t.push(rP(o,e))}return t.map(r=>new RegExp(r,"i"))}function rP(n,e=yt){let t=n.split("/"),r=[];for(let o=0;o<t.length;o++){let i=t[o];if(i==="**")o===0?r.push("(.+/)?"):o===t.length-1||r.push(".*/");else{if(i.includes("*")){let s=i.split("*");r.push(s.map(a=>e(a)).join("[^\\/]*"))}else r.push(e(i));r.push(o<t.length-1?"\\/":"$")}}return`^${r.join("")}`}var nP=m(()=>{"use strict";Yr()});function QE(n){let e=/^<node_internals>[\/\\](.*)$/,t=n.map(r=>{r=r.trim();let o=e.exec(r);return o?o[1]:null}).filter(Me);return t.length>0?t:void 0}function XE(n,e){return e.filter(r=>!r.includes(Qr)).map(r=>Tt(r)?Qo(n.rebaseLocalToRemote(r)):G(r)).map(Uu)}function sP(n){let e=n.parent();return e?sP(e):n}var Zn,iP,Lo,aP=m(()=>{"use strict";Zn=require("inversify"),iP=y(require("micromatch"));tt();zs();H();O();Ti();U();le();$();Gt();Yr();V();J();Kn();Zr();Ze();nP();Lo=class{constructor({skipFiles:e},t,r,o,i){this.logger=r;this.cdp=o;this._regexForAuthored=By(e=>oP(e,t=>_l(t,0,t.length,!0,!0)));this._scriptsWithSkipping=new Set;this._targetId=i.id(),this._rootTargetId=sP(i).id(),this._isUrlFromSourceMapSkipped=new Ct(s=>this._normalizeUrl(s)),this._authoredGlobs=XE(t,e),this._nodeInternalsGlobs=QE(e),this._initNodeInternals(i),this._updateSkippedDebounce=Uy(500,()=>this._updateGeneratedSkippedSources()),e.length&&this._updateGeneratedSkippedSources(),this._sharedSkipListener=Lo.sharedSkipsEmitter.event(s=>{s.rootTargetId===this._rootTargetId&&s.targetId!==this._targetId&&this._toggleSkippingFile(s.params)})}dispose(){this._sharedSkipListener.dispose()}setSourceContainer(e){this._sourceContainer=e}_testSkipNodeInternal(e){return this._nodeInternalsGlobs?(e.startsWith(Kr)&&(e=e.slice(Kr.length)),(0,iP.default)([e],this._nodeInternalsGlobs).length>0):!1}_testSkipAuthored(e){return this._regexForAuthored(this._authoredGlobs).some(t=>t.test(e))}_isNodeInternal(e,t){return e.startsWith(Kr)?!0:t?.has(e)||/^internal\/.+\.js$/.test(e)}async _updateGeneratedSkippedSources(){let e=this._regexForAuthored(this._authoredGlobs).map(r=>r.source),t=this._allNodeInternals?.settledValue;if(t){e.push(`^(${Kr})?internal\\/`);for(let r of t)this._testSkipNodeInternal(r)&&e.push(`^(${Kr})?${yt(r)}$`)}await this.cdp.Debugger.setBlackboxPatterns({patterns:e})}_normalizeUrl(e){return G(e.toLowerCase())}isScriptSkipped(e){return this._isNodeInternal(e,this._allNodeInternals?.settledValue)?this._testSkipNodeInternal(e):(e=this._normalizeUrl(e),this._isUrlFromSourceMapSkipped.get(e)===!0?!0:this._testSkipAuthored(e))}async _updateSourceWithSkippedSourceMappedSources(e,t){let r=this.isScriptSkipped(e.url),o=[],i=r;for(let a of e.sourceMap.sourceByUrl.values()){let c=this.isScriptSkipped(a.url);if(typeof c>"u"&&(c=r),c!==i){let[[l],[p]]=await Promise.all([this._sourceContainer.currentSiblingUiLocations({source:a,lineNumber:1,columnNumber:1},e),this._sourceContainer.currentSiblingUiLocations({source:a,lineNumber:1/0,columnNumber:1},e)]);l&&p?(o.push({lineNumber:l.lineNumber-1,columnNumber:l.columnNumber-1},{lineNumber:p.lineNumber-1,columnNumber:p.columnNumber-1}),i=!i):this.logger.error("internal","Could not map script beginning for "+a.sourceReference)}}let s=t;o.length||(s=s.filter(a=>this._scriptsWithSkipping.has(a.scriptId)),s.forEach(a=>this._scriptsWithSkipping.delete(a.scriptId))),s.map(({scriptId:a})=>this.cdp.Debugger.setBlackboxedRanges({scriptId:a,positions:o}))}initializeSkippingValueForSource(e){this._initializeSkippingValueForSource(e)}_initializeSkippingValueForSource(e,t=e.scripts){let r=e.url,o=this.isScriptSkipped(r);if(!o&&e.absolutePath&&this._testSkipAuthored(Q(e.absolutePath))&&(this.setIsUrlBlackboxSkipped(r,!0),o=!0,this._updateSkippedDebounce()),Ot(e)){if(o)for(let i of e.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(i.url,!0);for(let i of e.sourceMap.sourceByUrl.values())this._initializeSkippingValueForSource(i,t);this._updateSourceWithSkippedSourceMappedSources(e,t)}}async _initNodeInternals(e){if(e.type()!=="node"||!this._nodeInternalsGlobs||this._allNodeInternals)return;let t=this._allNodeInternals=ye(),r=await this.cdp.Runtime.evaluate({expression:"require('module').builtinModules"+Ue(),returnByValue:!0,includeCommandLineAPI:!0});r&&!r.exceptionDetails?t.resolve(new Set(r.result.value.map(o=>o+".js"))):t.resolve(new Set),await this._updateGeneratedSkippedSources()}async _toggleSkippingFile(e){let t;e.resource&&Tt(e.resource)&&(t=e.resource);let r={path:t,sourceReference:e.sourceReference},o=this._sourceContainer.source(r);if(!o)return{};let i=!this.isScriptSkipped(o.url);if(o instanceof Ge){this._isUrlFromSourceMapSkipped.set(o.url,i);let s=Array.from(o.compiledToSourceUrl.keys());await Promise.all(s.map(a=>this._updateSourceWithSkippedSourceMappedSources(a,a.scripts)))}else{if(Ot(o))for(let s of o.sourceMap.sourceByUrl.values())this._isUrlFromSourceMapSkipped.set(s.url,i);this.setIsUrlBlackboxSkipped(o.url,i),await this._updateGeneratedSkippedSources()}return{}}setIsUrlBlackboxSkipped(e,t){let r=e,o=`!${r}`,i=this._authoredGlobs.filter(s=>s!==r&&s!==o);this._regexForAuthored(i).some(s=>s.test(e))!==t&&(i.push(t?r:o),this._regexForAuthored.clear()),this._authoredGlobs=i}async toggleSkippingFile(e){let t=await this._toggleSkippingFile(e);return Lo.sharedSkipsEmitter.fire({params:e,rootTargetId:this._rootTargetId,targetId:this._targetId}),t}};Lo.sharedSkipsEmitter=new S,Lo=h([(0,Zn.injectable)(),d(0,(0,Zn.inject)(re)),d(1,(0,Zn.inject)(Te)),d(2,(0,Zn.inject)(L)),d(3,(0,Zn.inject)(Be)),d(4,(0,Zn.inject)(Do))],Lo)});var Ip,lP,cP,YE,za,ei,Sp=m(()=>{"use strict";Ip=require("inversify"),lP=require("path");ma();U();Ql();cP=/^webpack:\/{3}([^/]+?\.vue)(\?[0-9a-z]*)?$/i,YE=/^webpack:\/{3}\.\/.+\.vue\?[0-9a-z]+$/i,za=Symbol("IVueFileMapper"),ei=class{constructor(e,t){this.files=e;this.search=t;this.getMapping=B(async()=>{let e=new Map;return await this.search.streamAllChildren(this.files,t=>e.set((0,lP.basename)(t),t)),e})}async lookup(e){let t=cP.exec(e);return t?(await this.getMapping()).get(t[1]):void 0}getVueHandling(e){return this.files.empty?0:cP.test(e)?1:YE.test(e)?2:0}};ei=h([(0,Ip.injectable)(),d(0,(0,Ip.inject)(Zo)),d(1,(0,Ip.inject)(fa))],ei)});var Eo,kp=m(()=>{"use strict";H();Eo=class{constructor(){this.changeEmitter=new S;this.addEmitter=new S;this.removeEmitter=new S;this.targetMap=new Map;this.onChanged=this.changeEmitter.event;this.onAdd=this.addEmitter.event;this.onRemove=this.removeEmitter.event}get size(){return this.targetMap.size}add(e,t){this.targetMap.set(e,t),this.addEmitter.fire([e,t]),this.changeEmitter.fire()}get(e){return this.targetMap.get(e)}remove(e){let t=this.targetMap.get(e);return t===void 0?!1:(this.targetMap.delete(e),this.removeEmitter.fire([e,t]),this.changeEmitter.fire(),!0)}value(){return this.targetMap.values()}}});var as,Ja,Ga,Lm=m(()=>{"use strict";as=require("inversify");X();U();Ja=Symbol("IDefaultBrowserProvider"),Ga=class{constructor(e,t){this.location=e;this.vscode=t;this.lookup=B(async()=>{let e;return this.location==="remote"&&this.vscode?e=await this.vscode.commands.executeCommand("js-debug-companion.defaultBrowser"):e=(await import("default-browser").then(r=>r.default())).name,["chrome","edge"].find(r=>e.toLowerCase().includes(r))??"other"})}};Ga=h([(0,as.injectable)(),d(0,(0,as.inject)(to)),d(1,(0,as.optional)()),d(1,(0,as.inject)(Kt))],Ga)});var Em,pP=m(()=>{"use strict";O();Em=class{async setup(){}dispose(){}write(e){if(e.level>2)throw new Error(e.message);console.log(JSON.stringify(e))}}});var uP,_m,Mb,j,ZE,ro=m(()=>{"use strict";uP=require("inversify"),_m=y(require("os"));J();O();pP();Mb=class{constructor(e=512){this.size=e;this.items=[];this.i=0}write(e){this.items[this.i]=e,this.i=(this.i+1)%this.size}read(){return this.items.slice(this.i).concat(this.items.slice(0,this.i))}},j=class{constructor(){this.logTarget={queue:[]};this.logBuffer=new Mb(1)}static async test(){let e=new j;return e.setup({sinks:[new Em],showWelcome:!1}),e}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}log(e){if(this.logBuffer.write(e),"queue"in this.logTarget){this.logTarget.queue.push(e);return}for(let t of this.logTarget.sinks)t.write(e)}getRecentLogs(){return this.logBuffer.read()}dispose(){if("sinks"in this.logTarget){for(let e of this.logTarget.sinks)e.dispose();this.logTarget={queue:[]}}}forTarget(){return this}async setup(e){if(await Promise.all(e.sinks.map(r=>r.setup())),e.showWelcome!==!1){let r=ZE();for(let o of e.sinks)o.write(r)}let t=this.logTarget;this.logTarget={sinks:e.sinks.slice()},"sinks"in t?t.sinks.forEach(r=>r.dispose()):t.queue.forEach(r=>this.log(r))}};j.null=(()=>{let e=new j;return e.setup({sinks:[]}),e})(),j=h([(0,uP.injectable)()],j);ZE=()=>({timestamp:Date.now(),tag:"runtime.welcome",level:1,message:`${Zu} v${Mi} started`,metadata:{os:`${_m.platform()} ${_m.arch()}`,nodeVersion:process.version,adapterVersion:Mi}})});var cs,ti,Nb=m(()=>{"use strict";cs=Symbol("touched");(c=>{function n(){return{children:{},[cs]:1}}c.root=n;function e(l,p){return l[cs]=1,a(l,s(p),0)}c.getPath=e;function t(l){l[cs]=1}c.touch=t;function r(l){l[cs]=2}c.touchAll=r;function o(l,p){let u=l.children[p]??={children:{}};return u[cs]=1,u}c.getOrMakeChild=o;function i(l){if(l[cs]){for(let[p,u]of Object.entries(l.children))switch(u[cs]){case 1:i(u);break;case 2:break;default:delete l.children[p]}return l}}c.prune=i;function s(l){let p=l.split(/\/|\\/);return p[0]===""&&p.unshift(),p}function a(l,p,u){let g=o(l,p[u]);return u===p.length-1?g:a(g,p,u+1)}})(ti||={})});var Ob,Bb,ls,dP,e_,Am,mP=m(()=>{"use strict";Ob=require("fs"),Bb=y(require("micromatch")),ls=require("path"),dP=y(require("to-absolute-glob"));H();U();le();Nb();e_=/\//g,Am=class{constructor(e){this.stat=zo(e=>Ob.promises.lstat(e));this.readdir=zo(e=>Ob.promises.readdir(e,{withFileTypes:!0}));this.alreadyProcessedFiles=new Set;this.fileEmitter=new S;this.onFile=this.fileEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;this.processor=e.fileProcessor,this.filter=e.filter,this.ignore=e.ignore.map(o=>Bb.default.matcher((0,dP.default)(G(o),{cwd:e.cwd})));let t=(0,ls.isAbsolute)(e.pattern)?(0,ls.relative)(e.cwd,e.pattern):e.pattern,r=Bb.default.parse(G(t),{ignore:e.ignore,cwd:e.cwd,expand:!0});this.done=Promise.all(r.map(o=>{let i=[];for(let l=1;l<o.tokens.length;){let p=l+1;for(;p<o.tokens.length&&o.tokens[p].type!=="slash";)p++;let u=o.tokens[l];u.type==="globstar"?i.push("**"):p===l+1&&u.type==="text"?i.push(u.value):i.push(new RegExp("^"+o.tokens.slice(l,p).map(g=>g.output||g.value).join("")+"$")),l=p+1}let s=i[0]==="**"?[0,1]:[0],a=ti.getPath(e.cache,e.cwd),c={elements:i,seen:new Set};return Promise.all(s.map(l=>this.readSomething(c,l,e.cwd,[],a)))})).then(()=>{})}async readSomething(e,t,r,o,i){if(this.alreadyProcessedFiles.has(i))return;let s=`${t}:${r}`;if(e.seen.has(s))return;e.seen.add(s);let a;try{a=await this.stat(r)}catch(l){this.errorEmitter.fire({path:r,error:l});return}if(this.alreadyProcessedFiles.has(i))return;let c=i.data;if(c&&a.mtimeMs===c.mtime){if(c.type===0){let l=[],u=Object.entries(i.children).filter(([,g])=>g.data?.type!==0).map(([g])=>g);for(let[g,w]of Object.entries(i.children))l.push(w.data!==void 0?this.handleDirectoryEntry(e,t,r,{name:g,type:w.data.type},u,i):this.stat(r).then(I=>this.handleDirectoryEntry(e,t,r,{name:g,type:I.isFile()?1:0},u,i),()=>{}));await Promise.all(l)}else c.type===1&&(this.alreadyProcessedFiles.add(i),this.fileEmitter.fire(c.extracted));return}a.isDirectory()?await this.handleDir(e,t,a.mtimeMs,r,i):(this.alreadyProcessedFiles.add(i),await this.handleFile(a.mtimeMs,r,o,i))}applyFilterToFile(e,t,r){let o=r.children[e];if(this.alreadyProcessedFiles.has(o))return!1;if(!this.filter)return!0;let i=o.data?.type===1?o.data.extracted:void 0;return ti.touch(o),this.filter(t,i)}handleDirectoryEntry(e,t,r,o,i,s){let a=r+"/"+o.name,c=this.getDirectoryReadDescends(e,t,r,o);if(c===void 0)return;let l=ti.getOrMakeChild(s,o.name);if(!(o.type===1&&!this.applyFilterToFile(o.name,a,s)))return typeof c=="number"?this.readSomething(e,t+c,a,i,l):Promise.all(c.map(p=>this.readSomething(e,t+p,a,i,l)))}getDirectoryReadDescends(e,t,r,o){let i=r+"/"+o.name;if(this.ignore.some(c=>c(i)))return;let s=t===e.elements.length-1,a=e.elements[t];if(a==="**")return o.type===1?s?0:this.getDirectoryReadDescends(e,t+1,r,o):s?0:[0,1];if((a instanceof RegExp&&a.test(o.name)||a===o.name)&&(o.type===0?!s:s))return 1}async handleFile(e,t,r,o){let i=ls.sep==="/"?t:t.replace(e_,ls.sep),s;try{s=await this.processor(i,{siblings:r,mtime:e})}catch(a){this.errorEmitter.fire({path:i,error:a});return}o.data={type:1,mtime:e,extracted:s},this.fileEmitter.fire(s)}async handleDir(e,t,r,o,i){let s;try{s=await this.readdir(o)}catch(l){this.errorEmitter.fire({path:o,error:l});return}let a=[],c=s.filter(l=>l.isFile()).map(l=>l.name);for(let l of s){if(l.name.startsWith("."))continue;let p;if(l.isDirectory())p=0;else if(l.isFile())p=1;else continue;a.push(this.handleDirectoryEntry(e,t,o,{name:l.name,type:p},c,i))}await Promise.all(a),i.data={type:0,mtime:r}}}});var fP,Fm,ri,jb=m(()=>{"use strict";fP=y(require("glob-stream")),Fm=require("inversify");O();U();le();Nb();Ql();mP();ri=class{constructor(e){this.logger=e}async streamAllChildren(e,t){let r=[];return await this.globForFiles(e,i=>r.push(t(ee(i.path)))),(await Promise.all(r)).filter(i=>i!==void 0)}async streamChildrenWithSourcemaps(e){let t=[],r=e.lastState||{},o={};return await Promise.all([...e.files.explode()].map(async s=>{let a=JSON.stringify(s),c=r[a]||ti.root();await this._streamChildrenWithSourcemaps(c,e,t,s);let l=ti.prune(c);l&&(o[a]=l)})),this.logger.info("sourcemap.parsing",`turboGlobStream search found ${t.length} files`),{values:(await Promise.all(t)).filter(Me),state:o}}async _streamChildrenWithSourcemaps(e,t,r,o){let i=new Am({pattern:o.pattern,ignore:o.negations,cwd:o.cwd,cache:e,filter:t.filter,fileProcessor:(s,a)=>DI(s,a).then(c=>c&&t.processMap(c))});i.onError(({path:s,error:a})=>{this.logger.warn("sourcemap.parsing","Error parsing source map",{error:a,path:s})}),i.onFile(s=>s&&r.push(t.onProcessedMap(s))),await i.done}async globForFiles(e,t){await Promise.all([...e.explode()].map(r=>new Promise((o,i)=>(0,fP.default)([r.pattern,"!**/*.asar/**"],{ignore:r.negations,cwd:r.cwd}).on("data",t).on("end",o).on("error",i))))}};ri=h([(0,Fm.injectable)(),d(0,(0,Fm.inject)(L))],ri)});function Ub(n,e){return n.length<=e?n:n.substr(0,e-1)+"\u2026"}function t_(n){let e;try{e=new hP.URL(n)}catch{return Ub(n,20)}if(e.protocol==="data")return Ub(n,20);if(e.protocol==="blob"||n==="about:blank")return n;let t=gP.basename(e.pathname);return t||(t=(e.host||"")+"/"),t==="/"&&(t=Ub(n,20)),t}var gP,hP,Mm,Wb,bP=m(()=>{"use strict";gP=y(require("path")),hP=require("url");H();Mm=class{constructor(){this._onFrameAddedEmitter=new S;this._onFrameRemovedEmitter=new S;this._onFrameNavigatedEmitter=new S;this.onFrameAdded=this._onFrameAddedEmitter.event;this.onFrameRemoved=this._onFrameRemovedEmitter.event;this.onFrameNavigated=this._onFrameNavigatedEmitter.event;this._frames=new Map}attached(e,t){e.Page.enable({}),e.Page.getResourceTree({}).then(r=>{this._processCachedResources(e,r?r.frameTree:void 0,t)})}mainFrame(){return this._mainFrame}_processCachedResources(e,t,r){t&&this._addFramesRecursively(e,t,t.frame.parentId,r),e.Page.on("frameAttached",o=>{this._frameAttached(e,r,o.frameId,o.parentFrameId)}),e.Page.on("frameNavigated",o=>{this._frameNavigated(e,r,o.frame)}),e.Page.on("frameDetached",o=>{this._frameDetached(e,r,o.frameId)})}_addFrame(e,t,r){let o=new Wb(this,e,t,r);return this._frames.set(o.id,o),o.isMainFrame()&&(this._mainFrame=o),this._onFrameAddedEmitter.fire(o),o}_frameAttached(e,t,r,o){let i=this._frames.get(r);return i||(i=this._addFrame(e,r,o)),i._ref(t),i}_frameNavigated(e,t,r){let o=this._frames.get(r.id);o||(o=this._frameAttached(e,t,r.id,r.parentId)),o._navigate(r,t),this._onFrameNavigatedEmitter.fire(o)}_frameDetached(e,t,r){let o=this._frames.get(r);o&&o._unref(t)}frameForId(e){return this._frames.get(e)}frames(){return Array.from(this._frames.values())}_addFramesRecursively(e,t,r,o){let i=t.frame,s=this._frames.get(i.id);s?(s._navigate(i,o),this._onFrameNavigatedEmitter.fire(s)):(s=this._addFrame(e,i.id,r),s._navigate(i,o));for(let a=0;t.childFrames&&a<t.childFrames.length;++a)this._addFramesRecursively(e,t.childFrames[a],s.id,o)}},Wb=class{constructor(e,t,r,o){this._targets=new Set;this.cdp=t,this.model=e,this._parentFrameId=o,this.id=r,this._url=""}_ref(e){this._targets.add(e)}_navigate(e,t){this._name=e.name,this._url=e.url,this._securityOrigin=e.securityOrigin,this._unreachableUrl=e.unreachableUrl||"",this._ref(t),this._unrefChildFrames(t)}name(){return this._name||""}url(){return this._url}securityOrigin(){return this._securityOrigin}unreachableUrl(){return this._unreachableUrl}isMainFrame(){return!this._parentFrameId}parentFrame(){return this._parentFrameId?this.model.frameForId(this._parentFrameId):void 0}childFrames(){return this.model.frames().filter(e=>e._parentFrameId===this.id)}_unrefChildFrames(e){for(let t of this.childFrames())t._unref(e)}_unref(e){this._targets.delete(e),!this._targets.size&&(this._unrefChildFrames(e),this.model._frames.delete(this.id),this.model._onFrameRemovedEmitter.fire(this))}displayName(){return this._name?this._name:t_(this._url)||`<iframe ${this.id}>`}}});var wP,Vb,$b,Nm,yP=m(()=>{"use strict";wP=require("url");H();Vb=class{constructor(e){this.versions=new Map;this.id=e.registrationId,this.scopeURL=e.scopeURL}},$b=class{constructor(e,t){this.revisions=[];this.registration=e,this.id=t.versionId,this.scriptURL=t.scriptURL,this._targetId=t.targetId,this._status=t.status,this._runningStatus=t.runningStatus}addRevision(e){this._targetId&&e.targetId&&this._targetId!==e.targetId&&console.error(`${this._targetId} !== ${e.targetId}`),e.targetId&&(this._targetId=e.targetId),this._status=e.status,this._runningStatus=e.runningStatus,this.revisions.unshift(e)}status(){return this._status}runningStatus(){return this._runningStatus}targetId(){return this._targetId}label(){let e=new wP.URL(this.registration.scopeURL),t=e.pathname.substr(1);t.endsWith("/")&&(t=t.substring(0,t.length-1));let r=t||`${e.host}`,o=this._status==="activated"?"":` ${this._status}`,i=this._runningStatus==="running"?"":` ${this._runningStatus}`;return`${r} #${this.id}${o}${i}`}},Nm=class n{constructor(e){this._registrations=new Map;this._versions=new Map;this._onDidChangeUpdater=new S;this.onDidChange=this._onDidChangeUpdater.event;this._targets=new Set;this._frameModel=e,n._instances.add(this)}static{this._instances=new Set}dispose(){n._instances.delete(this)}attached(e){this._targets.add(e),!this._cdp&&(this._cdp=e,e.ServiceWorker.enable({}),e.ServiceWorker.on("workerRegistrationUpdated",t=>this._workerRegistrationsUpdated(t.registrations)),e.ServiceWorker.on("workerVersionUpdated",t=>this._workerVersionsUpdated(t.versions)),n._mode!=="normal"&&this.setMode(n._mode))}async detached(e){this._targets.delete(e)}version(e){return this._versions.get(e)}registrations(){let e=[],t=this._frameModel.frames().map(r=>r.url());for(let r of this._registrations.values())for(let o of t)if(o.startsWith(r.scopeURL)){e.push(r);break}return e}registration(e){return this._registrations.get(e)}_workerVersionsUpdated(e){for(let t of e){let r=this._registrations.get(t.registrationId);if(!r)continue;let o=r.versions.get(t.versionId);o||(o=new $b(r,t),r.versions.set(t.versionId,o)),t.targetId&&this._versions.set(t.targetId,o),o.addRevision(t),o.status()==="redundant"&&o.runningStatus()==="stopped"&&(t.targetId&&this._versions.delete(t.targetId),r.versions.delete(o.id))}this._onDidChangeUpdater.fire()}_workerRegistrationsUpdated(e){for(let t of e)if(t.isDeleted){if(!this._registrations.has(t.registrationId))debugger;this._registrations.delete(t.registrationId)}else{if(this._registrations.has(t.registrationId))return;this._registrations.set(t.registrationId,new Vb(t))}this._onDidChangeUpdater.fire()}static setModeForAll(e){n._mode=e;for(let t of n._instances)t.setMode(e)}setMode(e){if(this._cdp){this._cdp.ServiceWorker.setForceUpdateOnPageLoad({forceUpdateOnPageLoad:e==="force"});for(let t of this._targets.values())e==="bypass"?(t.Network.enable({}),t.Network.setBypassServiceWorker({bypass:!0})):t.Network.disable({})}}async stopWorker(e){if(!this._cdp)return;let t=this.version(e);t&&await this._cdp.ServiceWorker.stopWorker({versionId:t.id})}}});var oi,Om=m(()=>{"use strict";H();O();kn();bP();yP();oi=class{constructor(e,t,r,o,i,s,a,c){this.process=t;this.logger=i;this.telemetry=s;this.launchParams=a;this._targets=new Map;this._detachedTargets=new Set;this.frameModel=new Mm;this.serviceWorkerModel=new Nm(this.frameModel);this._lifecycleQueue=Promise.resolve();this._onTargetAddedEmitter=new S;this._onTargetRemovedEmitter=new S;this.onTargetAdded=this._onTargetAddedEmitter.event;this.onTargetRemoved=this._onTargetRemovedEmitter.event;this._connection=e,this._sourcePathResolver=o,this._browser=r,this._targetOrigin=c,this.serviceWorkerModel.onDidChange(()=>{for(let l of this._targets.values())l.type()==="service_worker"&&l._onNameChangedEmitter.fire()})}static async connect(e,t,r,o,i,s,a){let l=await e.rootSession().Target.attachToBrowserTarget({});if(!l)return;let p=e.createSession(l.sessionId);return new this(e,t,p,r,i,s,o,a)}dispose(){this.serviceWorkerModel.dispose()}targetList(){return Array.from(this._targets.values()).filter(e=>Dl.has(e.type()))}async getCandiateInfo(e){let t=await this._browser.Target.getTargets({});return t?e?t.targetInfos.filter(e):t.targetInfos:[]}async closeBrowser(){if(this.launchParams.request==="launch"){if(this.launchParams.cleanUp==="wholeBrowser")await this._browser.Browser.close({}),this.process?.kill();else for(let e of this._targets.values())await this._browser.Target.closeTarget({targetId:e.targetId}),this._connection.close();this.process=void 0}}waitForMainTarget(e){let t,r=new Promise(i=>t=i),o=async i=>{if([...this._targets.values()].some(c=>c.targetId===i.targetId)||this._detachedTargets.has(i.targetId)||e&&!e(i))return;let s=this._browser.Target.on("targetInfoChanged",c=>{c.targetInfo.targetId===i.targetId&&(i=c.targetInfo)}),a;try{a=await this._browser.Target.attachToTarget({targetId:i.targetId,flatten:!0})}finally{s.dispose()}if(!a){t(void 0);return}t(this.attachedToTarget(i,a.sessionId,!0))};return this._browser.Target.setDiscoverTargets({discover:!0}),this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(i=>o(i.targetInfo))),this._browser.Target.on("targetInfoChanged",i=>this._targetInfoChanged(i.targetInfo,this.enqueueLifecycleFn(o))),this._browser.Target.on("detachedFromTarget",this.enqueueLifecycleFn(async i=>{i.targetId&&await this._detachedFromTarget(i.sessionId,!1)})),r}enqueueLifecycleFn(e){return t=>this._lifecycleQueue=this._lifecycleQueue.then(()=>e(t))}attachedToTarget(e,t,r,o,i=!0){let s=this._targets.get(t);if(s)return s;let a=this._connection.createSession(t),c=new Hs(this,e,a,o,r,this.launchParams,t,this.logger,()=>{this._connection.disposeSession(t),this._detachedFromTarget(t)});this._targets.set(t,c),o&&o._children.set(e.targetId,c),a.Target.on("attachedToTarget",async p=>{this.attachedToTarget(p.targetInfo,p.sessionId,p.waitingForDebugger,c)}),a.Target.on("detachedFromTarget",async p=>{p.targetId&&this._detachedFromTarget(p.sessionId,!1)}),a.Target.setAutoAttach({autoAttach:!0,waitForDebuggerOnStart:i,flatten:!0}),a.Network.setCacheDisabled({cacheDisabled:this.launchParams.disableNetworkCache}).catch(p=>this.logger.info("runtime.target","Error setting network cache state",p)),o||this.retrieveBrowserTelemetry(a);let l=e.type;return Mu.has(l)&&this.frameModel.attached(a,e.targetId),this.serviceWorkerModel.attached(a),this._onTargetAddedEmitter.fire(c),!Dl.has(l)||l==="service_worker"?c.runIfWaitingForDebugger():l==="page"&&i&&!e.canAccessOpener&&a.Page.waitForDebugger({}),c}async retrieveBrowserTelemetry(e){try{let t=await e.Browser.getVersion({});if(!t)throw new Error("Undefined return from getVersion()");let r={targetCRDPVersion:t.protocolVersion,targetRevision:t.revision,targetUserAgent:t.userAgent,targetV8:t.jsVersion,targetVersion:"",targetProject:"",targetProduct:""};this.logger.verbose("runtime.target","Retrieved browser information",t);let o=(t.product||"").split("/");o.length===2?(r.targetProject=o[0],r.targetVersion=o[1]):r.targetProduct=t.product,this.telemetry.report("browserVersion",r)}catch(t){this.logger.warn("runtime.target","Error getting browser telemetry",t)}}async _detachedFromTarget(e,t=!0){let r=this._targets.get(e);if(r){this._targets.delete(e),r.parentTarget?._children.delete(e);try{await r._detached()}catch{}if(this._onTargetRemovedEmitter.fire(r),t&&(this._detachedTargets.add(r.targetId),await this._browser.Target.detachFromTarget({sessionId:e})),!this._targets.size&&this.launchParams.request==="launch")try{this.launchParams.cleanUp==="wholeBrowser"?await this._browser.Browser.close({}):(await this._browser.Target.closeTarget({targetId:r.id()}),this._connection.close())}catch{}}}async _targetInfoChanged(e,t){let r=[...this._targets.values()].filter(o=>o.targetId===e.targetId);if(!e.attached||!r.length)return r.length&&await Promise.all(r.map(o=>this._detachedFromTarget(o.sessionId,!1))),t(e);for(let o of r)o._updateFromInfo(e);for(let o of this._targets.values())o.targetId!==e.targetId&&o._onNameChangedEmitter.fire()}}});var vP,r_,mt,ni=m(()=>{"use strict";vP=y(require("ws"));Ke();H();Fa();$();V();r_=50,mt=class n{constructor(e){this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this._ws=e,this._ws.addEventListener("message",t=>{this.messageEmitter.fire([t.data.toString("utf-8"),new Fr])}),this._ws.addEventListener("close",()=>{this.endEmitter.fire(),this._ws=void 0}),this._ws.addEventListener("error",()=>{})}static async create(e,t,r){let o=!e.startsWith("ws://"),i=await Qs(e);for(;;){let s=Date.now()+r_;try{let a={headers:{host:r??"localhost"},perMessageDeflate:!1,maxPayload:268435456,rejectUnauthorized:!(o&&i),followRedirects:!0},c=new vP.default(e,[],a);return await Xt(new Promise((l,p)=>{c.addEventListener("open",()=>l(new n(c))),c.addEventListener("error",u=>{let g=e===c.url?e:c.url.replace(/^http(s?):/,"ws$1:");if(g===e){p(u.error);return}this.create(g,t,r).then(l,p)})}),we.withTimeout(2e3,t).token,`Could not open ${e}`).catch(l=>{throw c.close(),l})}catch(a){if(t.isCancellationRequested)throw a;let c=s-Date.now();c>0&&await x(c)}}}send(e){this._ws?.send(e)}dispose(){return new Promise(e=>{if(!this._ws)return e();this._ws.addEventListener("close",()=>e()),this._ws.close()})}}});function o_(n){let e=[/^APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL$/i,/^ELECTRON_.+$/i,/^GOOGLE_API_KEY$/i,/^VSCODE_.+$/i,/^SNAP(|_.*)$/i,/^GDK_PIXBUF_.+$/i];return new xe(n).map((t,r)=>e.some(o=>o.test(t))?void 0:r)}var Bm,xe,_o=m(()=>{"use strict";Bm=y(require("path"));U();xe=class n{constructor(e){this.defined=B(()=>Us(this.value));this.value=e?Fy(e):{}}static{this.platform=process.platform}static{this.empty=new n({})}static{this.processEnv=B(()=>o_(process.env))}lookup(e){return n.platform==="win32"?Oy(this.value,e):this.value[e]}addToPath(e,t="append",r=!1){let o=n.platform==="win32"?"Path":"PATH",i=n.platform==="win32"?Bm.win32.delimiter:Bm.posix.delimiter,s=this.lookup(o);return r&&!s&&(s=`\${env:${o}}`),s?t==="append"?s=s+i+e:s=e+i+s:s=e,this.update(o,s)}addNodeOption(e){let t=this.lookup("NODE_OPTIONS");return this.update("NODE_OPTIONS",t?`${t} ${e}`:e)}update(e,t){return n.merge(this,{[e]:t})}merge(...e){return n.merge(this,...e)}map(e){return new n(Ho(this.value,(t,r)=>e(r,t)))}static merge(...e){let t=e.map(o=>o instanceof n?o.value:o),r=n.platform==="win32"?Ny(...t):Object.assign({},...t);return new n(r)}}});function jm(n,e,t){return new Promise((r,o)=>{let i=xp(n,e,t?.cwd),s=(0,IP.spawn)(i.executable,i.args,{...t,cwd:i.cwd,shell:i.shell,stdio:"pipe"}),a=[],c=[];s.stderr.on("data",p=>a.push(p)),s.stdout.on("data",p=>c.push(p));let l=(p,u)=>o(new Pp(n,Buffer.concat(a).toString(),Buffer.concat(c).toString(),p,u));s.on("error",p=>l(void 0,p)),s.on("close",p=>p?l(p):r({stdout:Buffer.concat(c).toString(),stderr:Buffer.concat(a).toString()}))})}var IP,Pp,n_,xp,Cp=m(()=>{"use strict";IP=require("child_process");V();Pp=class n extends Error{constructor(t,r,o,i,s){super(`${t} exited with code ${i||-1}: ${r}`);this.command=t;this.stderr=r;this.stdout=o;this.code=i;this.innerError=s}static fromExeca(t){return new n(t.command,t.stderr.toString(),t.stdout.toString(),t.exitCode)}};n_=/\.(bat|cmd)$/i,xp=(n,e,t)=>(process.platform==="win32"&&(n=ar(n),t&&(t=ar(t.toString())),n.endsWith(".ps1")&&(e=["-File",n,...e],n="powershell.exe")),process.platform!=="win32"||!n_.test(n)?{executable:n,args:e,shell:!1,cwd:t}:{executable:`"${n}"`,args:e.map(r=>r.includes(" ")?`"${r}"`:r),shell:!0,cwd:t})});var SP,Br,Ka=m(()=>{"use strict";SP=require("stream"),Br=class extends SP.Transform{constructor(t){super();this.prefix=[];this.splitSuffix=Buffer.alloc(0);if(typeof t=="string"&&t.length===1)this.splitter=t.charCodeAt(0);else if(typeof t=="number")this.splitter=t;else throw new Error("not implemented here")}_transform(t,r,o){let i=0;for(;i<t.length;){let s=t.indexOf(this.splitter,i);if(s===-1)break;let a=t.subarray(i,s),c=this.prefix.length||this.splitSuffix.length?Buffer.concat([...this.prefix,a,this.splitSuffix]):a;this.push(c),this.prefix.length=0,i=s+1}i<t.length&&this.prefix.push(t.subarray(i)),o()}_flush(t){this.prefix.length&&this.push(Buffer.concat([...this.prefix,this.splitSuffix])),t()}}});var dr,Qa=m(()=>{"use strict";H();Fa();O();U();Ka();dr=class{constructor(e,t,r){this.logger=e;this.pipeWrite=t;this.pipeRead=r;this.messageEmitter=new S;this.endEmitter=new S;this.onMessage=this.messageEmitter.event;this.onEnd=this.endEmitter.event;this.onceEnded=B(()=>{this.streams&&(this.beforeClose(),this.streams.read.removeAllListeners(),this.pipeRead?.destroy(),this.streams.write.removeListener("end",this.onceEnded),this.streams.write.removeListener("error",this.onWriteError),this.streams.write.on("error",()=>{}),this.streams.write.end(),this.streams=void 0,this.endEmitter.fire())});this.onWriteError=e=>{this.logger.error("internal","pipeWrite error",{error:e})};let o=r||t;this.streams={read:o.on("error",i=>this.logger.error("internal","pipeRead error",{error:i})).pipe(new Br(0)).on("data",i=>this.messageEmitter.fire([i.toString(),new Fr])).on("end",this.onceEnded),write:t.on("end",this.onceEnded).on("error",this.onWriteError)}}send(e){this.streams?.write.write(e+"\0")}dispose(){this.onceEnded()}beforeClose(){}}});function i_(n){try{return process.kill(n,0),!0}catch{return!1}}var ii,qb=m(()=>{"use strict";ii=class{constructor(e,t,r){this.pid=e;this.onExit=t;this.updateInterval(r)}dispose(){clearInterval(this.timer)}updateInterval(e=200){this.timer&&clearInterval(this.timer),this.timer=setInterval(()=>{i_(this.pid)||(this.onExit(!0),this.dispose())},e)}}});function mr(n,e,t="forceful"){if(t==="none")return!0;if(process.platform==="win32"){let r=process.env.WINDIR||"C:\\Windows",o=(0,Hb.join)(r,"System32","taskkill.exe");try{return(0,Um.execSync)(`${o} ${t==="forceful"?"/F":""} /T /PID ${n}`,{stdio:"pipe"}),!0}catch(i){return e.error("runtime.exception","Error running taskkill.exe",i),!1}}else try{let r=(0,Hb.join)(__dirname,"./targets/node/terminateProcess.sh"),o=(0,Um.spawnSync)("sh",[r,n.toString(),t==="forceful"?"9":"15"]);return o.stderr&&o.status?(e.error("runtime.exception","Error running terminateProcess",o),!1):!0}catch(r){return e.error("runtime.exception","Error running terminateProcess",r),!1}}var Um,Hb,Xa=m(()=>{"use strict";Um=require("child_process"),Hb=require("path");O();J()});async function zb(n,e,t,r,o){let i=new er(CP.promises),[s,a]=await Promise.all([PP(i,new URL("/json/version",n),e,o),r?PP(i,new URL("/json/list",n),e,o):Promise.resolve(void 0)]);if(!s.ok)t.verbose("runtime.launch","Error looking up /json/version",s);else if(s.body.webSocketDebuggerUrl){let c=xP(s.url,s.body.webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/version",{url:s.body.webSocketDebuggerUrl,fixed:c}),c}if(a)if(!a.ok)t.verbose("runtime.launch","Error looking up /json/list",a);else{let c=xP(a.url,a.body[0].webSocketDebuggerUrl);return t.verbose("runtime.launch","Discovered target URL from /json/list",{url:a.body[0].webSocketDebuggerUrl,fixed:c}),c}throw new Error("Could not find any debuggable target")}async function PP(n,e,t,r){if(e.hostname!=="localhost")return n.fetchJson(e.toString(),t,{host:r??"localhost"});e.hostname="127.0.0.1";let o=e.toString();e.hostname="[::1]";let i=e.toString(),s=new we(t);try{let a;return await go([o,i].map(async l=>(a=await n.fetchJson(l,s.token),a.ok&&a)))||a}finally{s.cancel()}}function xP(n,e){let t=new URL(n),r=new URL(e);return r.host=t.host,r.toString()}var CP,TP,Ya,Wm,ps=m(()=>{"use strict";CP=require("fs");Dm();Ke();O();$();TP=n=>async(e,t,r,o)=>{for(;;)try{return await zb(e,t,r,n,o)}catch(i){if(t.isCancellationRequested)throw new Error(`Could not connect to debug target at ${e}: ${i.message}`);await x(200)}},Ya=TP(!0),Wm=TP(!1)});function s_(n,e){if(!n.stderr)throw new Error("Cannot wait for a websocket for a target that lacks stderr");return new Promise((t,r)=>{let o=RP.createInterface({input:n.stderr}),i="",s=()=>l();o.on("line",p),o.on("close",s);let a=new q([n.onExit(()=>l()),n.onError(l)]),c=e.onCancellationRequested(()=>{u(),r(new Rt(`Timed out after ${c} ms while trying to connect to the browser!`))});function l(g){u(),r(new Error(["Failed to launch browser!"+(g?" "+g.message:""),i,"","TROUBLESHOOTING: https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md",""].join(`
`)))}function p(g){i+=g+`
`;let w=g.match(/^DevTools listening on (ws:\/\/.*)$/);w&&(u(),t(w[1]))}function u(){c.dispose(),o.removeListener("line",p),o.removeListener("close",s),a.dispose()}})}var RP,Gb,Vm,$m,qm,DP=m(()=>{"use strict";RP=y(require("readline"));Qa();ni();Ke();st();H();qb();$();Xa();Su();ps();Gb=async(n,e,t,r)=>{let o=t.connection===0?await s_(e,r):await Wm(`http://localhost:${t.connection}`,r,n),i=t.inspectUri?Vt(t.inspectUri,t.url,o):o;for(;;)try{return await mt.create(i,r)}catch(s){if(r.isCancellationRequested)throw s;await x(200)}},Vm=class{constructor(e){this.logger=e;this.pid=void 0;this.onExit=new S().event;this.onError=new S().event}async transport(e,t){return Gb(this.logger,this,e,t)}kill(){}},$m=class{constructor(e,t){this.pid=e;this.logger=t;this.stderr=void 0;this.stdout=void 0;this.exitEmitter=new S;this.onExit=this.exitEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;this.liveness=new ii(e,()=>this.exitEmitter.fire(0),1e3)}async transport(e,t){return Gb(this.logger,this,e,t)}kill(){try{process.kill(this.pid)}catch{}this.liveness.updateInterval(200)}},qm=class{constructor(e,t,r){this.cp=e;this.logger=t;this.killBehavior=r;this.pid=void 0;this.exitEmitter=new S;this.onExit=this.exitEmitter.event;this.errorEmitter=new S;this.onError=this.errorEmitter.event;e.on("exit",o=>this.exitEmitter.fire(o||0)),e.on("error",o=>this.errorEmitter.fire(o))}get stderr(){return this.cp.stderr}get stdio(){return this.cp.stdio}async transport(e,t){return e.connection==="pipe"?new dr(this.logger,this.cp.stdio[3],this.cp.stdio[4]):Gb(this.logger,this,e,t)}kill(){mr(this.cp.pid,this.logger,this.killBehavior)}}});async function LP(n,e,t,r){let o=n.launchUnelevatedRequest({process:e,args:t});return await Xt(o,r,"Could not launch browser unelevated")}var EP=m(()=>{"use strict";Ke()});async function MP(n,e,t,r,o,i,s={}){let{onStderr:a=_P,onStdout:c=_P,args:l=[],dumpio:p=!1,cwd:u=process.cwd(),env:g=xe.empty,connection:w="pipe",cleanUp:I="wholeBrowser",url:v,killBehavior:A="forceful",inspectUri:z}=s,De=new wt(l),R=De.getSuggestedConnection();s.includeLaunchArgs!==!1?(De=Jb(De,s),R===void 0&&(De=De.setConnection(w),R=w)):R===void 0&&(R="pipe");let Z=["pipe","pipe","pipe"];R==="pipe"&&(p?Z=["ignore","pipe","pipe","pipe","pipe"]:Z=["ignore","ignore","ignore","pipe","pipe"]);let M;if(!!(o.supportsLaunchUnelevatedProcessRequest&&s.launchUnelevated)&&typeof R=="number"&&R!==0){let ke=await LP(n,e,De.toArray(),i);M=ke.pid?new $m(ke.pid,t):new Vm(t)}else{t.info("runtime.launch",`Launching Chrome from ${e}`);let ke=xp(e,De.toArray(),await wn(FP.promises,u)?u:process.cwd()),mo=AP.spawn(ke.executable,ke.args,{detached:!0,env:g.defined(),shell:ke.shell,cwd:ke.cwd,stdio:Z});if(mo.pid===void 0)throw await Promise.race([x(1e3).then(()=>new Error("Unable to launch the executable (undefined pid)")),new Promise(xi=>mo.once("error",xi))]);M=new qm(mo,t,A)}p?(M.stderr?.on("data",ke=>a(ke.toString())),M.stdout?.on("data",ke=>c(ke.toString()))):(M.stderr?.resume(),M.stdout?.resume());let C=()=>{I==="wholeBrowser"&&M.kill()};process.on("exit",C),M.onExit(()=>process.removeListener("exit",C));try{if(s.promisedPort){let ke;R=await Promise.race([s.promisedPort,new Promise((mo,xi)=>{ke=M.onExit(Tg=>{xi(new k(SI(Tg)))})})]).finally(()=>ke.dispose())}return{process:M,canReconnect:typeof R=="number",createConnection:async ke=>{let mo=await M.transport({connection:R,inspectUri:z||void 0,url:v||void 0},ke);return new et(mo,t,r)}}}catch(ke){throw M.kill(),ke}}function Jb(n,e={}){let{userDataDir:t=null,ignoreDefaultArgs:r=!1}=e,o=r===!0?new wt:wt.default;return r instanceof Array&&(o=o.filter(i=>!r.includes(i))),t&&(o=o.add("--user-data-dir",t)),o=o.merge(n),n.toArray().every(i=>i.startsWith("-"))&&e.hasUserNavigation&&(o=o.add("about:blank")),o}async function NP(n,e,t,r){let{browserWSEndpoint:o,browserURL:i}=n;if(o){let s=await mt.create(o,e);return new et(s,t,r)}else if(i){let s=await Wm(i,e,t),a=n.inspectUri?Vt(n.inspectUri,n.pageURL,s):s,c=await mt.create(a,e);return new et(c,t,r)}throw new Error("Either browserURL or browserWSEndpoint needs to be specified")}var AP,FP,_P,Hm=m(()=>{"use strict";AP=y(require("child_process")),FP=require("fs");tt();ni();_o();de();O();Cp();$();J();Ie();ge();Iu();Su();DP();ps();EP();_P=()=>{}});var zm,si,jr,Tp=m(()=>{"use strict";zm=y(require("@vscode/l10n")),si=require("inversify");Ke();W();H();O();$();Gt();V();Ie();ge();X();Om();kn();Hm();jr=class{constructor(e,t,r){this.logger=e;this.pathResolver=t;this.vscode=r;this._disposables=[];this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event;this.closeWhenTargetsEmpty=!0}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[],this._attemptTimer&&clearTimeout(this._attemptTimer),this._targetManager&&this._targetManager.dispose()}resolveParams(e){return e.request==="attach"&&(e.type==="pwa-chrome"||e.type==="pwa-msedge"&&typeof e.useWebView!="object")&&e.browserAttachLocation==="workspace"}async launch(e,t){return this.resolveParams(e)?(this._lastLaunchParams={...e,timeout:1/0},await this.attemptToAttach(this._lastLaunchParams,t),{blockSessionTermination:!0}):{blockSessionTermination:!1}}_scheduleAttach(e,t){this._attemptTimer=setTimeout(()=>{this._attemptTimer=void 0,this.attemptToAttach(e,{...t,cancellationToken:Je})},1e3)}createTargetManager(e,t,r){return oi.connect(e,void 0,this.pathResolver,t,this.logger,r.telemetryReporter,r.targetOrigin)}async attemptToAttach(e,t){let r=await this.acquireConnectionForBrowser(t,e);this._connection=r,r.onDisconnected(()=>{this._connection=void 0,this._targetManager&&(this._targetManager.dispose(),this._targetManager=void 0,this._onTargetListChangedEmitter.fire()),this._lastLaunchParams===e&&e.restart?this._scheduleAttach(e,t):this._onTerminatedEmitter.fire({killed:!0,code:0})},void 0,this._disposables);let o=this._targetManager=await this.createTargetManager(r,e,t);if(!o)return;o.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),o.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),o.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),o.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire(),!o.targetList().length&&this.closeWhenTargetsEmpty&&(this._onTerminatedEmitter.fire({killed:!0,code:0}),this._connection?.close())});let i=await Promise.race([o.waitForMainTarget(await this.getTargetFilter(o,e)),x(e.timeout).then(()=>{throw new k(od())})]);return typeof i=="string"?i:void 0}async getTargetFilter(e,t){let r=Rn(t),o=Xs(r);if(t.targetSelection!=="pick")return o;let i=await e.getCandiateInfo(o);if(i.length===0)return o;if(i.length===1||!this.vscode)return c=>c.targetId===i[0].targetId;let s=zm.t("Select a tab"),a=await this.vscode.window.showQuickPick(i.map(c=>({label:c.title,detail:c.url,targetId:c.targetId})),{matchOnDescription:!0,matchOnDetail:!0,placeHolder:s});return a?c=>c.targetId===a.targetId:o}async acquireConnectionForBrowser({telemetryReporter:e,cancellationToken:t},r){for(;this._lastLaunchParams===r;)try{return await this.acquireConnectionInner(e,r,t)}catch(o){if(t.isCancellationRequested)throw new k($l(zm.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,o.message)));await x(1e3)}throw new k($l(zm.t("Cannot connect to the target at {0}: {1}",`${r.address}:${r.port}`,"Cancelled")))}async acquireConnectionInner(e,t,r){let o=`http://${t.address}:${t.port}`;return await NP({browserURL:o,inspectUri:t.inspectUri,pageURL:t.url},r,this.logger,e)}async terminate(){this._lastLaunchParams=void 0,this._connection?.close()}async restart(){if(this._targetManager)for(let e of this._targetManager.targetList())e.type()==="page"&&!e.name().startsWith("devtools://")&&e.restart()}targetList(){let e=this._targetManager;return e?e.targetList():[]}};jr=h([(0,si.injectable)(),d(0,(0,si.inject)(L)),d(1,(0,si.inject)(Te)),d(2,(0,si.optional)()),d(2,(0,si.inject)(Kt))],jr)});var BP,jP,Rp,ai,Za,Ao,Gm=m(()=>{"use strict";BP=require("@vscode/js-debug-browsers"),jP=y(require("@vscode/l10n")),Rp=y(require("fs")),ai=require("inversify"),Za=y(require("path"));Ke();st();_o();H();de();O();$();Gt();V();Ie();ge();X();Om();kn();Hm();Ao=class{constructor(e,t,r,o,i){this.storagePath=e;this.logger=t;this.pathResolver=r;this.initializeParams=o;this.fs=i;this._disposables=new q;this._onTerminatedEmitter=new S;this.onTerminated=this._onTerminatedEmitter.event;this._onTargetListChangedEmitter=new S;this.onTargetListChanged=this._onTargetListChangedEmitter.event;this._terminatedCts=new we}dispose(){this._disposables.dispose()}async launchBrowser({runtimeExecutable:e,trace:t,includeDefaultArgs:r,includeLaunchArgs:o,runtimeArgs:i,userDataDir:s,env:a,cwd:c,port:l,url:p,file:u,inspectUri:g,webRoot:w,cleanUp:I,launchUnelevated:v,killBehavior:A},z,De,R,Z){let M=await this.findBrowserPath(e||"stable"),N;return typeof s=="string"?N=Za.resolve(s):s&&(N=Za.resolve(Za.join(this.storagePath,i?.includes("--headless")?".headless-profile":".profile"))),Rp.mkdirSync(this.storagePath,{recursive:!0}),N&&(Rp.mkdirSync(N,{recursive:!0}),N=Rp.realpathSync(N)),await MP(z,M,this.logger,R,this.initializeParams,De,{onStdout:C=>z.output({category:"stdout",output:C}),onStderr:C=>z.output({category:"stderr",output:C}),dumpio:typeof t=="boolean"?t:t.stdio,cleanUp:I,hasUserNavigation:!!(p||u),cwd:c||w||void 0,env:xe.merge(xe.processEnv(),a),args:i||[],userDataDir:N,connection:l||(g?0:"pipe"),launchUnelevated:v,ignoreDefaultArgs:!r,includeLaunchArgs:o,killBehavior:A,url:p,inspectUri:g,promisedPort:Z})}getFilterForTarget(e){return Xs(Rn(e,["about:blank"]))}async doLaunch(e,t){let r;try{r=await this.launchBrowser(e,t.dap,t.cancellationToken,t.telemetryReporter)}catch(l){throw new k(mh(l))}let o=new we(this._terminatedCts.token);r.process.onExit(()=>this.fireTerminatedEvent());let i=()=>r.canReconnect&&!o.token.isCancellationRequested,s=async l=>{if(this._targetManager?.dispose(),this._targetManager=void 0,this._onTargetListChangedEmitter.fire(),i()&&(await x(1e3),i())){t.dap.output({category:"stderr",output:jP.t("Browser connection failed, will retry: {0}",l?.message||"Connection closed")});try{return await x(2e3),await a()}catch{}}r.process.kill(),this.fireTerminatedEvent()},a=async()=>{if(!o.token.isCancellationRequested)try{let l=await r.createConnection(o.token),p=await this.launchCdp(e,r,l,{...t,cancellationToken:o.token});await this.finishLaunch(p,e),l.onDisconnected(()=>s())}catch(l){if(i())return s(l);throw r.process.kill(),new k(mh(l))}},c=t.cancellationToken.onCancellationRequested(()=>o.cancel());try{await a()}finally{c.dispose()}}async launchCdp(e,t,r,o){if(this._connectionForTest=r,this._targetManager=await oi.connect(r,t.process,this.pathResolver,e,this.logger,o.telemetryReporter,o.targetOrigin),!this._targetManager)throw new k($l());this._targetManager.serviceWorkerModel.onDidChange(()=>this._onTargetListChangedEmitter.fire()),this._targetManager.frameModel.onFrameNavigated(()=>this._onTargetListChangedEmitter.fire()),this._disposables.push(this._targetManager),this._targetManager.onTargetAdded(()=>{this._onTargetListChangedEmitter.fire()}),this._targetManager.onTargetRemoved(()=>{this._onTargetListChangedEmitter.fire()});let i=this.getFilterForTarget(e),s=await Xt(this._targetManager.waitForMainTarget(i),o.cancellationToken,"Could not attach to main target");if(!s)throw new k(od());return s}async finishLaunch(e,t){if("skipNavigateForTest"in t)return;let r;if(t.file){let o=Za.resolve(t.webRoot||t.rootPath||"",t.file),i=Math.min(o.includes("#")?o.indexOf("#"):1/0,o.includes("?")?o.indexOf("?"):1/0);isFinite(i)&&!await Ft(this.fs,o)?r=Q(o.slice(0,i))+o.slice(i):r=Q(o)}else r=t.url;r&&await e.cdp().Page.navigate({url:r})}async launch(e,t){let r=this.resolveParams(e);return r?(await this.doLaunch(r,t),{blockSessionTermination:!0}):{blockSessionTermination:!1}}async terminate(){this._targetManager?await this._targetManager.closeBrowser():this.fireTerminatedEvent()}async restart(){for(let e of this.targetList())e.type()==="page"&&e.restart()}async findBrowserByExe(e,t){return t==="*"?(await e.findWhere(o=>o.quality==="stable")||(await e.findAll())[0])?.path:(0,BP.isQuality)(t)?(await e.findWhere(r=>r.quality===t))?.path:t}targetList(){let e=this._targetManager;return e?e.targetList():[]}connectionForTest(){return this._connectionForTest}fireTerminatedEvent(){this._terminatedCts.token.isCancellationRequested||(this._terminatedCts.cancel(),this._onTerminatedEmitter.fire({code:0,killed:!0}))}};Ao=h([(0,ai.injectable)(),d(0,(0,ai.inject)(So)),d(1,(0,ai.inject)(L)),d(2,(0,ai.inject)(Te)),d(3,(0,ai.inject)(Jt)),d(4,(0,ai.inject)(oe))],Ao)});var oo,us,UP=m(()=>{"use strict";oo=require("inversify");W();de();O();Gt();Ie();ge();X();Gm();us=class extends Ao{constructor(t,r,o,i,s,a){super(t,r,s,a,i);this.browserFinder=o}resolveParams(t){return t.type==="pwa-chrome"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await wn(this.fs,r))throw new k(rd("Chrome",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};us=h([(0,oo.injectable)(),d(0,(0,oo.inject)(So)),d(1,(0,oo.inject)(L)),d(2,(0,oo.inject)(ji)),d(2,(0,oo.tagged)("browser","chrome")),d(3,(0,oo.inject)(oe)),d(4,(0,oo.inject)(Te)),d(5,(0,oo.inject)(Jt))],us)});var WP,no,VP,$P,qP,a_,ec,HP=m(()=>{"use strict";WP=require("crypto"),no=require("inversify"),VP=require("net"),$P=require("os"),qP=require("path");tt();ni();Ke();W();de();O();$();Gt();V();Ie();ge();X();Gm();a_=["--do-not-de-elevate"],ec=class extends Ao{constructor(t,r,o,i,s,a){super(t,r,s,a,i);this.browserFinder=o}resolveParams(t){return t.type==="pwa-msedge"&&t.request==="launch"&&t.browserLaunchLocation==="workspace"?t:void 0}launchBrowser(t,r,o,i){return super.launchBrowser({...t,runtimeArgs:t.runtimeArgs??a_},r,o,i,t.useWebView?this.getWebviewPort(t,i):void 0)}getFilterForTarget(t){return t.useWebView&&t.urlFilter?Xs(Rn(t)):super.getFilterForTarget(t)}async getWebviewPort(t,r){let o=ye();if(!t.runtimeExecutable)return o.resolve(t.port),o.promise;let i=t.runtimeExecutable.split(/\\|\//).pop(),s=`VSCode_${(0,WP.randomBytes)(12).toString("base64")}`,a=`\\\\.\\pipe\\WebView2\\Debugger\\${i}\\${s}`,c=(0,VP.createServer)(l=>{l.on("data",async p=>{let u=JSON.parse(p.toString()),g=u.devtoolsActivePort||"",w=parseInt(g.split(`
`).shift()||""),I=t.port||w;o.resolve(I);let v=`ws://${t.address}:${I}/devtools/${u.type}/${u.id}`,A=await mt.create(v,Je),z=new et(A,this.logger,r);await z.rootSession().Runtime.runIfWaitingForDebugger({}),z.close()})});return c.on("error",o.reject),c.on("close",()=>o.resolve(t.port)),c.listen(a),t.userDataDir=t.userDataDir||(0,qP.join)((0,$P.tmpdir)(),`vscode-js-debug-userdatadir_${t.port}`),t.env=t.env||{},t.env.WEBVIEW2_USER_DATA_FOLDER=t.userDataDir.toString(),t.env.WEBVIEW2_ADDITIONAL_BROWSER_ARGUMENTS=`--remote-debugging-port=${t.port}`,t.env.WEBVIEW2_WAIT_FOR_SCRIPT_DEBUGGER="true",t.env.WEBVIEW2_PIPE_FOR_SCRIPT_DEBUGGER=s,o.promise}async findBrowserPath(t){let r=await this.findBrowserByExe(this.browserFinder,t);if(!r||!await wn(this.fs,r))throw new k(rd("Edge",t,(await this.browserFinder.findAll()).map(o=>o.quality)));return r}};ec=h([(0,no.injectable)(),d(0,(0,no.inject)(So)),d(1,(0,no.inject)(L)),d(2,(0,no.inject)(ji)),d(2,(0,no.tagged)("browser","edge")),d(3,(0,no.inject)(oe)),d(4,(0,no.inject)(Te)),d(5,(0,no.inject)(Jt))],ec)});var zP,Jm,c_,Fo,Km=m(()=>{"use strict";zP=require("crypto"),Jm=require("inversify");rn();ni();Ke();c_=0,Fo=class{constructor(e){this.portLeaseTracker=e;this.teardown=new WeakMap}async launch(e,t,r){this.server&&this.server.close();let o=`/${(0,zP.randomBytes)(20).toString("hex")}`,i=this.server=await Nd(this.portLeaseTracker,{perMessageDeflate:!0,host:"127.0.0.1",path:o}),s=++c_;e.launchBrowserInCompanion({...r,serverPort:i.address().port,path:o,launchId:s});let a=await Xt(new Promise((l,p)=>{i.once("connection",l),i.once("error",p)}),t,"Timed out waiting for browser connection"),c=new mt(a);return this.teardown.set(c,()=>e.killCompanionBrowser({launchId:s})),c}close(e){this.teardown.get(e)?.()}dispose(){this.server?.close(),this.server=void 0}};Fo=h([(0,Jm.injectable)(),d(0,(0,Jm.inject)(Dt))],Fo)});var nn,tc,GP=m(()=>{"use strict";nn=require("inversify");tt();W();O();Gt();X();Tp();Km();tc=class extends jr{constructor(t,r,o,i){super(r,o,i);this.helper=t}resolveParams(t){return t.request==="attach"&&(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.browserAttachLocation==="ui"}async acquireConnectionForBrowser(t,r){let o=await this.helper.launch(t.dap,t.cancellationToken,{type:r.type==="pwa-chrome"?"chrome":"edge",params:r,attach:{host:r.address,port:r.port}});return new et(o,this.logger,t.telemetryReporter)}};tc=h([(0,nn.injectable)(),d(0,(0,nn.inject)(Fo)),d(1,(0,nn.inject)(L)),d(2,(0,nn.inject)(Te)),d(3,(0,nn.optional)()),d(3,(0,nn.inject)(Kt))],tc)});var sn,rc,JP=m(()=>{"use strict";sn=require("inversify");tt();W();H();O();Gt();X();Iu();Gm();Hm();Km();rc=class extends Ao{constructor(t,r,o,i,s,a){super(t,r,o,i,s);this.helper=a}resolveParams(t){return(t.type==="pwa-chrome"||t.type==="pwa-msedge")&&t.request==="launch"&&t.browserLaunchLocation==="ui"?t:void 0}async launchBrowser(t,r,o,i){let s=await this.helper.launch(r,o,{type:t.type==="pwa-chrome"?"chrome":"edge",browserArgs:Jb(new wt(t.runtimeArgs||[]),{hasUserNavigation:!!t.url,ignoreDefaultArgs:!t.includeDefaultArgs}).setConnection(t.port||"pipe").toArray(),params:t});return{canReconnect:!1,createConnection:()=>Promise.resolve(new et(s,this.logger,i)),process:{onExit:new S().event,onError:new S().event,transport:()=>Promise.resolve(s),kill:()=>this.helper.close(s)}}}async findBrowserPath(){throw new Error("not implemented")}};rc=h([(0,sn.injectable)(),d(0,(0,sn.inject)(So)),d(1,(0,sn.inject)(L)),d(2,(0,sn.inject)(Te)),d(3,(0,sn.inject)(Jt)),d(4,(0,sn.inject)(oe)),d(5,(0,sn.inject)(Fo))],rc)});var QP=Dg((v4,KP)=>{try{KP.exports=require("./win32-app-container-tokens.win32-arm64-msvc-4ZJZ3U55.node")}catch{}});var YP=Dg((I4,XP)=>{try{XP.exports=require("./win32-app-container-tokens.win32-x64-msvc-VCQE7GJP.node")}catch{}});function Qm(){if(process.platform!=="win32")throw new Error("Not running on Windows");return l_()}var l_,Kb=m(()=>{"use strict";U();l_=B(()=>{if(process.arch==="arm64")return Promise.resolve().then(()=>y(QP()));if(process.arch==="x64")return Promise.resolve().then(()=>y(YP()));throw new Error(`Unsupported architecture ${process.arch}`)})});var ci,ZP,ex,oc,tx=m(()=>{"use strict";ci=require("inversify"),ZP=require("net"),ex=require("path");tt();Qa();Ke();W();O();$();Gt();Kb();Ie();ge();X();Tp();oc=class extends jr{constructor(e,t,r){super(e,t,r)}resolveParams(e){return e.request==="attach"&&e.type==="pwa-msedge"&&typeof e.useWebView=="object"}async acquireConnectionForBrowser(e,t){let{getAppContainerProcessTokens:r}=await Qm(),o=r().map(c=>(0,ex.join)(c,t.useWebView.pipeName));if(!o)throw new k(hI());let i=o.map(c=>(0,ZP.connect)(c)),s;try{s=await Xt(go(i.map(c=>new Promise(l=>c.on("error",()=>l(void 0)).on("connect",()=>l(c))))),e.cancellationToken)}finally{for(let c of i)c!==s&&c.destroy()}if(!s)throw new k(wI());let a=new dr(this.logger,s);return new et(a,this.logger,e.telemetryReporter)}};oc=h([(0,ci.injectable)(),d(0,(0,ci.inject)(L)),d(1,(0,ci.inject)(Te)),d(2,(0,ci.optional)()),d(2,(0,ci.inject)(Kt))],oc)});var Dp,Qb=m(()=>{"use strict";Dp=Symbol("ILinkedBreakpointLocation")});function Xm(n,e){return n?(n.endsWith("/")||(n+="/"),n+e):e}async function Bt(n,e,t,r,o){e=We(e)||e;let i;if(n){if(Cr(n))i=We(n);else if(Tt(n))i=await r(n,t,o)||n;else if(an.isAbsolute(e))i=d_(e,n);else{let s=Gg(e)||"/",a=await r(s,t,o),c=an.dirname(a);i=yn(c,n)}o.verbose("sourcemap.parsing","resolved sourceRoot",{sourceRoot:n,absSourceRoot:i})}else if(an.isAbsolute(e))i=an.dirname(e),o.verbose("sourcemap.parsing","no sourceRoot specified, using script dirname",{absSourceRoot:i});else{let s=Gg(e)||"/placeholder.js",a=await r(s,t,o);i=a?an.dirname(a):"",o.verbose("sourcemap.parsing","no sourceRoot specified, using webRoot + script path dirname",{absSourceRoot:i})}return i=Uv(i),i=ee(i),i}function p_(n,e){return n===e?!0:(n.endsWith("/")||(n+="/"),e.startsWith(n))}function u_(n,e,t){let r=decodeURIComponent(t.substring(n.length));return r?yn(e,r):e}function d_(n,e){return ir(an.dirname(n),e)}var rx,an,Et,ox,Ym=m(()=>{"use strict";rx=require("fs"),an=y(require("path"));V();O();U();le();Et=async(n,e,t)=>{if(!n||!n.startsWith("/"))return"";let r=Object.keys(e).sort((o,i)=>i.length-o.length);for(let o of r){if(!o)continue;let i=e[o];if(o[0]!=="/"&&(t.verbose("sourcemap.parsing",`Keys should be absolute: ${o}`),o="/"+o),p_(o,n))return u_(o,i,n)}return""},ox=(n,e)=>async(t,r,o)=>{if(process.platform==="win32"&&/^[a-z]:/i.test(t))return t;let i=await Ks(n,an.dirname(e),"package.json");if(!i)return Et(t,r,o);let s=await Et(t,My(r,a=>a.length>=i.length),o);return process.platform!=="win32"&&t!=="/"&&!s&&(await rx.promises.stat(t).catch(()=>{}))?.isDirectory()?t:s||i}});var tf,nx,Zm,m_,Xb,ix,ef,sx=m(()=>{"use strict";O();le();Yr();tf="*",nx=new RegExp(yt(tf),"g"),Zm="?:"+tf,m_=new RegExp(yt(Zm),"g"),Xb=(n,e)=>{let t=e.match(n);return n.lastIndex=0,t?t.length:0},ix=new RegExp(`${yt(Zm)}|${yt(tf)}`,"g"),ef=class{constructor(e,t){this.logger=t;this.replacers=[];let r=Object.keys(e).sort((o,i)=>i.replace(Zm,"*").length-o.replace(Zm,"*").length);for(let o of r){let i=e[o];if(!i.includes("*")&&/\$[0-9'`&]/.test(i)){this.replacers.push([new RegExp(`^${o}$`,"i"),i]);continue}let s=G(o),a=`"${s}": "${i}"`,c=Xb(nx,s)-Xb(m_,s);if(c>1){t.warn("runtime.sourcemap",`Warning: only one asterisk allowed in a sourceMapPathOverrides entry - ${a}`);continue}if(Xb(nx,i)>c){t.warn("runtime.sourcemap",`The right side of a sourceMapPathOverrides entry must have 0 or 1 asterisks - ${a}}`);continue}let l="^",p=0;for(ix.lastIndex=0;;){let u=ix.exec(s);if(l+=yt(s.slice(p,u?.index),"/"),!u)break;u[0]===tf?l+="(.*?)":l+=".*?",p=u.index+u[0].length}c===0&&(l+="([\\/\\\\].*)?",i+="*"),this.replacers.push([new RegExp(l+"$","i"),i.replace(/\$/g,"$$$$").replace(/\*/,"$1")])}}apply(e){let t=G(e);for(let[r,o]of this.replacers){let i=t.replace(r,o);if(i!==t)return this.logger.verbose("runtime.sourcemap",`SourceMap: mapping ${e} => ${i}, via sourceMapPathOverrides entry - ${r.toString()}`),yn(i)}return e}}});var ax,li,f_,nc,Yb=m(()=>{"use strict";ax=y(require("micromatch")),li=y(require("path"));O();Ti();le();V();sx();f_=/\x00/,nc=class{constructor(e,t){this.options=e;this.logger=t;this.sourceMapOverrides=new ef(this.options.sourceMapOverrides,this.logger);this.resolvePatterns=this.options.resolveSourceMapLocations?.map(e=>{let t=e.startsWith("!")?"!":"",r=e.slice(t.length).replace(/(?<!\.)\.[^./\\]+$/,".*");if(!Tt(r))return G(e);r=G(ir(r));let o=Bg(this.options.workspaceFolder),i=Bg(r),s=0;for(let a=0;a<o.length&&a<i.length&&i[a].toLowerCase()===o[a].toLowerCase();a++)s+=o[a].length+1;return r=r.slice(0,s).replace(/[\[\]\(\)\{\}\!\*]/g,"\\$&")+r.slice(s),t+r})}shouldResolveSourceMap({sourceMapUrl:e,compiledPath:t}){if(t.startsWith(Kr))return!1;if(!this.resolvePatterns||this.resolvePatterns.length===0)return!0;let r=We(e)||vt(e)&&t||e;if(r.startsWith("webpack-internal:///"))return!0;let o=Tu(e)?!1:Fl(),i=this.rebaseRemoteToLocal(r);return(0,ax.default)((i!==r?[r,i]:[r]).map(G),this.resolvePatterns,{dot:!0,nocase:!o}).length>0}rebaseRemoteToLocal(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return fe(li.isAbsolute(e)?li.resolve(e):e);let t=xl(this.options.remoteRoot,e);if(t.startsWith(".."))return"";let r=yn(this.options.localRoot,t);return r=fe(r),this.logger.verbose("runtime.sourcemap",`Mapped remoteToLocal: ${e} -> ${r}`),ir(r)}rebaseLocalToRemote(e){if(!this.options.remoteRoot||!this.options.localRoot||!this.canMapPath(e))return e;let t=xl(this.options.localRoot,e),r=yn(this.options.remoteRoot,t);return r=ee(r,!0),this.logger.verbose("runtime.sourcemap",`Mapped localToRemote: ${e} -> ${r}`),r}normalizeSourceMapUrl(e){e=e.replace(f_,"");let t=e.lastIndexOf("?");return t!==-1&&e.slice(t-4,t)!==".vue"&&(e=e.slice(0,t)),e}canMapPath(e){return li.posix.isAbsolute(e)||li.win32.isAbsolute(e)||Cr(e)}}});var Lp,pi,cx,Zb,Ur,rf=m(()=>{"use strict";Lp=require("inversify"),pi=y(require("path")),cx=require("url");Sp();de();le();Ym();V();V();Yb();Zb="https?:\\/\\/[^\\/]+\\/",Ur=class extends nc{constructor(t,r,o,i){super(o,i);this.vueMapper=t;this.fsUtils=r}absolutePathToUrlPath(t){t=pi.normalize(t);let{baseUrl:r,pathMapping:o}=this.options,i=["/",o["/"]],s=Object.entries(o).sort(([l,p],[u,g])=>g.length-p.length||u.length-l.length).find(([,l])=>qs(l,t))||i;if(!s)return{url:Q(t),needsWildcard:!1};if(r&&Cr(r))return{url:Qo(t),needsWildcard:!1};let a=Tn(pi.relative(s[1],t)),c=s[0].replace(/\/$|^\//g,"");return c&&(a=c+"/"+a),!r&&!$u(a)?{url:a,needsWildcard:!0}:{url:Vu(r,a),needsWildcard:!1}}async urlToAbsolutePath({url:t,map:r}){let o=t.indexOf("?");return o!==-1&&t.slice(o-4,o)!==".vue"&&(t=t.slice(0,o)),r?this.sourceMapSourceToAbsolute(t,r):this.simpleUrlToAbsolute(t)}async simpleUrlToAbsolute(t){if(!t)return;if(t=this.sourceMapOverrides.apply(t),Cr(t)){let s=We(t);if(await this.fsUtils.exists(s))return s;let a=Wv(t);return await this.fsUtils.exists(a)?a:s}let r;try{let s=new cx.URL(t);if(!s.pathname||s.pathname==="/"?r="index.html":r=s.pathname,s.protocol==="webpack-internal:")return}catch{r=t}let o=pi.extname(r),i=r.replace(/^\//,"").split(/[\/\\]/);for(;i.length>0;){let s="/"+i.join("/"),a=await Et(s,this.options.pathMapping,this.logger);if(a){if(!o&&await this.fsUtils.exists(a+".html"))return a+".html";if(await this.fsUtils.exists(a))return a}i.shift()}}async sourceMapSourceToAbsolute(t,r){if(!this.shouldResolveSourceMap(r.metadata))return;switch(this.vueMapper.getVueHandling(t)){case 2:return;case 1:let a=await this.vueMapper.lookup(t);if(a)return ee(a);break;default:}t=this.normalizeSourceMapUrl(t);let{pathMapping:o}=this.options,i=Xm(r.sourceRoot,t),s=this.sourceMapOverrides.apply(i);if(s!==i){s=ee(s);let a=ir(o["/"],"..","ClientApp",xl(o["/"],s));return this.options.clientID==="visualstudio"&&i.startsWith("webpack:///")&&!await this.fsUtils.exists(s)&&await this.fsUtils.exists(a)?a:s}return Cr(t)?We(t):pi.isAbsolute(t)?ee(t):ir(await Bt(r.sourceRoot,r.metadata.compiledPath,o,Et,this.logger),t)}absolutePathToUrlRegexp(t){let r=this.absolutePathToUrlPath(t),o=r.url,i=o.length;o.endsWith("index.html")?(i=o.length-10-1,o=o.slice(0,i)+"\\/?($|index(\\.html)?)"):o.endsWith(".html")&&(i=o.length-5,o=o.slice(0,i)+"(\\.html)?");let s=0;r.needsWildcard&&(o=Zb+o,s=Zb.length,i+=Zb.length);let a=at(o,[s,i]);return r.needsWildcard?`${at(Q(t))}|${a}`:a}};Ur=h([(0,Lp.injectable)(),d(0,(0,Lp.inject)(za)),d(1,(0,Lp.inject)(xt))],Ur)});var lx,ic,ew=m(()=>{"use strict";lx=y(require("path"));O();V();rf();ic=class extends Ur{constructor(t,r,o,i){super(t,r,o,i);this.blazorInCodespacesRegexpSubstitution="$1:\\$2";if(this.options.remoteFilePrefix){let s=`\\${lx.default.sep}`,a=this.options.remoteFilePrefix.replace(new RegExp(s,"g"),s);this.blazorInCodespacesRegexp=new RegExp(`^${a}${s}([A-z])\\$${s}(.*)$`)}else this.blazorInCodespacesRegexp=new RegExp("")}absolutePathToUrlRegexp(t){if(this.options.remoteFilePrefix){let r=t.replace(this.blazorInCodespacesRegexp,this.blazorInCodespacesRegexpSubstitution),i=Tn(r).replace(/^(\w):(.*)$/,"$1$2"),s=at(i);if(s){let a=`dotnet://.*\\.dll/${s}`;return this.logger.verbose("runtime.breakpoints","absolutePathToUrlRegexp.blazor.remoteFs",{absolutePath:t,dotnetUrlRegexp:a}),a}}else{let r=Q(t),o=at(r),i=super.absolutePathToUrlRegexp(t);return o.includes(i)?o:`${o}|${i}`}return super.absolutePathToUrlRegexp(t)}}});function ux(n){if("file"in n&&n.file)return Qo(n.file);if(n.url)try{let e=new px.URL(n.url);return e.pathname="/",e.search="",e.hash="",e.protocol==="data:"?void 0:e.href}catch{}}var px,dx=m(()=>{"use strict";px=require("url");V()});var ds,fx,mx,He,tw=m(()=>{"use strict";ds=y(require("path")),fx=require("url");Ti();le();Ym();V();Yb();mx="node:",He=class n extends nc{constructor(t,r,o,i){super(o,i);this.fsUtils=t;this.linkedBp=r;this.options=o;this.logger=i}static shouldWarnAboutSymlinks(t){return"runtimeArgs"in t&&!t.runtimeArgs?.includes("--preserve-symlinks")}static getOptions(t){return{workspaceFolder:t.__workspaceFolder,resolveSourceMapLocations:t.resolveSourceMapLocations,basePath:t.cwd,sourceMapOverrides:t.sourceMapPathOverrides,remoteRoot:t.remoteRoot,localRoot:t.localRoot}}derive(t){return new n(this.fsUtils,this.linkedBp,{...this.options,...t},this.logger)}get resolutionOptions(){return this.options}async urlToAbsolutePath({url:t,map:r}){t=this.normalizeSourceMapUrl(t);let o=this.sourceMapOverrides.apply(t),i=o!==t;if(t=o,t.startsWith(mx)&&this.options.basePath)return t=ds.join(this.options.basePath,"lib",t.slice(mx.length)),t.endsWith(".js")||(t+=".js"),t;if(r)return this.sourceMapSourceToAbsolute(t,r,i);let s=We(t);if(s)return this.rebaseRemoteToLocal(s);if($u(t))t=i?o:new fx.URL(t).pathname.slice(1);else if(ds.isAbsolute(t))t=this.sourceMapOverrides.apply(t);else return`${Qr}/${t}`;let a=ir(this.options.basePath??"",t);return this.rebaseRemoteToLocal(a)}absolutePathToUrl(t){return Q(this.rebaseLocalToRemote(ds.normalize(t)))}async absolutePathToUrlRegexp(t){let r=t;try{r=await this.fsUtils.realPath(t)}catch{}return Wu(r,t)?at(this.absolutePathToUrl(t)):(this.linkedBp?.warn(),at(this.absolutePathToUrl(t))+"|"+at(this.absolutePathToUrl(r)))}async sourceMapSourceToAbsolute(t,r,o){if(!this.shouldResolveSourceMap(r.metadata))return;if(o)return fe(t);let i=Xm(r.sourceRoot,t),s=this.sourceMapOverrides.apply(i);return s!==i?ee(s):Cr(t)?this.rebaseRemoteToLocal(We(t)):!ds.isAbsolute(t)&&this.options.basePath?ir(await Bt(this.options.remoteRoot&&Tt(r.sourceRoot)&&this.rebaseRemoteToLocal(r.sourceRoot)||r.sourceRoot,r.metadata.compiledPath,{"/":this.options.basePath},ox(this.fsUtils,r.metadata.compiledPath),this.logger),t):this.rebaseRemoteToLocal(t)||t}}});var fr,gr,sc,ac,ms=m(()=>{"use strict";fr=require("inversify");Sp();W();de();X();Qb();ew();dx();rf();tw();gr=Symbol("ISourcePathResolverFactory"),sc=class{constructor(e,t){this.fsUtils=e;this.linkedBp=t}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new He(this.fsUtils,He.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,He.getOptions(e),t);throw new Error(`Not usable for type ${e.type}`)}};sc=h([(0,fr.injectable)(),d(0,(0,fr.inject)(xt)),d(1,(0,fr.optional)()),d(1,(0,fr.inject)(Dp))],sc);ac=class{constructor(e,t,r,o){this.initializeParams=e;this.vueMapper=t;this.fsUtils=r;this.linkedBp=o}create(e,t){if(e.type==="pwa-node"||e.type==="node-terminal"||e.type==="pwa-extensionHost")return new He(this.fsUtils,He.shouldWarnAboutSymlinks(e)?this.linkedBp:void 0,He.getOptions(e),t);{let r=!!e.inspectUri;return new(r?ic:Ur)(this.vueMapper,this.fsUtils,{workspaceFolder:e.__workspaceFolder,resolveSourceMapLocations:e.resolveSourceMapLocations,baseUrl:ux(e),localRoot:null,remoteRoot:null,pathMapping:{"/":e.webRoot,...e.pathMapping},sourceMapOverrides:e.sourceMapPathOverrides,clientID:this.initializeParams.clientID,remoteFilePrefix:e.__remoteFilePrefix},t)}}};ac=h([(0,fr.injectable)(),d(0,(0,fr.inject)(Jt)),d(1,(0,fr.inject)(za)),d(2,(0,fr.inject)(xt)),d(3,(0,fr.optional)()),d(3,(0,fr.inject)(Dp))],ac)});var gx,of,h_,hx=m(()=>{"use strict";gx=require("url");V();Om();kn();of=class extends oi{constructor(){super(...arguments);this.baseFilter=Rn(this.launchParams);this.filter=t=>{let{debugWebWorkerExtHost:r,debugWebviews:o}=this.launchParams;return!!(r&&(t.type==="worker"&&t.title.startsWith("DebugExtensionHostWorker")||t.type==="page"&&t.title.includes("[Extension Development Host]"))||o&&t.type==="iframe"&&this.baseFilter(t))}}static async connectRenderer(t,r,o,i,s,a){let l=await t.rootSession().Target.attachToBrowserTarget({});if(!l)return;let p=t.createSession(l.sessionId);return new this(t,void 0,p,r,i,s,o,a)}waitForMainTarget(t){let r=this.launchParams;return r.debugWebWorkerExtHost&&this._browser.Target.on("targetCreated",this.enqueueLifecycleFn(async({targetInfo:o})=>{if(!o.url.includes(r.__sessionId))return;let i=await this._browser.Target.attachToTarget({targetId:o.targetId,flatten:!0});i&&this.attachedToTarget(o,i.sessionId,!1)})),super.waitForMainTarget(t)}attachedToTarget(t,r,o,i){let s=super.attachedToTarget(t,r,o||this.filter(t),i,!1);return t.type==="iframe"&&s.setComputeNameFn(h_),s}},h_=n=>{let e;try{e=new gx.URL(n.targetInfo.url)}catch{return}switch(e.searchParams.get("purpose")){case"customEditor":return`${e.searchParams.get("extensionId")} editor: ${e.host}`;case"notebookRenderer":return`Notebook Renderer: ${e.host}`;default:let t=e.searchParams.get("extensionId");return`Webview: ${t?t+" ":""} ${e.host}`}}});var cc,io,rw=m(()=>{"use strict";cc=require("inversify");tt();ni();W();O();Gt();J();ms();Tp();hx();io=class extends jr{constructor(t,r,o){super(t,r);this.pathResolverFactory=o;this.closeWhenTargetsEmpty=!1}async launch(t,r){if(t.type!=="pwa-extensionHost"||t.request!=="attach")return{blockSessionTermination:!1};let o=io.debugIdTorendererDebugAddr.get(t.__sessionId);if(!o)return{blockSessionTermination:!1};let i=ta({name:"Webview",type:"pwa-chrome",request:"attach",address:o,__workspaceFolder:t.__workspaceFolder,timeout:0,urlFilter:"",resolveSourceMapLocations:t.resolveSourceMapLocations,...t.rendererDebugOptions});return i.__sessionId=t.__sessionId,i.debugWebWorkerExtHost=t.debugWebWorkerHost,i.debugWebviews=t.debugWebviews,super.launch(i,r).catch(s=>this.logger.error("runtime.exception","Error in webview attach",{err:s})),{blockSessionTermination:!1}}async acquireConnectionInner(t,r,o){return new et(await mt.create(r.address,o),this.logger,t)}async getTargetFilter(t){return t.filter}async createTargetManager(t,r,o){return new of(t,void 0,t.rootSession(),this.pathResolverFactory.create(r,this.logger),this.logger,o.telemetryReporter,r,o.targetOrigin)}};io.debugIdTorendererDebugAddr=new Map,io=h([(0,cc.injectable)(),d(0,(0,cc.inject)(L)),d(1,(0,cc.inject)(Te)),d(2,(0,cc.inject)(gr))],io)});var nf,bx=m(()=>{"use strict";O();nf=class n{constructor(){this.target={queue:[]}}connectTo(e){this.target={logger:e}}info(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:1})}verbose(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:0})}warn(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:2})}error(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:3})}fatal(e,t,r){this.log({tag:e,timestamp:Date.now(),message:t,metadata:r,level:4})}log(e){this.target&&("queue"in this.target?this.target.queue.push(e):this.target.logger.log(e))}getRecentLogs(){return this.target?"queue"in this.target?this.target.queue:this.target.logger.getRecentLogs():[]}assert(e,t){if(e===!1||e===void 0||e===null){if(this.error("runtime.assertion",t,{error:new Error("Assertion failed")}),process.env.JS_DEBUG_THROW_ASSERTIONS)throw new Error(t);debugger;return!1}return!0}setup(){throw new Error("A ProxyLogger cannot be setup()")}dispose(){this.target=void 0}forTarget(){return new n}}});var wx,sf,af,cf=m(()=>{"use strict";wx=Symbol("ITargetOrigin"),sf=class{constructor(e){this.id=e}},af=class{constructor(e){this.id=e}}});var lf,yx=m(()=>{"use strict";W();kp();H();bx();cf();lf=class{constructor(e,t){this.parentList=e;this.logger=t;this.targets=new Eo;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;e.onAdd(([,r])=>{r.parent&&this.targets.get(r.parent.id)&&this.targets.add(r.id,r.target)}),e.onRemove(([r])=>{this.targets.remove(r)&&!this.targets.size&&this.onTerminatedEmitter.fire({killed:!0,code:0})})}async launch(e,t){if(e.type!=="node-terminal"||e.request!=="attach")return{blockSessionTermination:!1};let r=this.parentList.get(e.delegateId);if(r===void 0)return setTimeout(()=>this.onTerminatedEmitter.fire({killed:!0,code:0}),1),{blockSessionTermination:!0};let o=r.target.targetOrigin();if(!(o instanceof af))throw new Error("Expected delegate session to have a mutable target origin");let i=r.target.logger;if(!(i instanceof nf))throw new Error("Expected delegate session to have a proxy logger");return o.id=t.targetOrigin.id,i.connectTo(this.logger),setTimeout(()=>{this.targets.add(e.delegateId,r.target),r.dap.connect(t.dap)},0),{blockSessionTermination:!0}}terminate(){for(let e of this.targets.value())e.stop();return Promise.resolve()}restart(){for(let e of this.targets.value())e.restart();return Promise.resolve()}targetList(){return[...this.targets.value()]}dispose(){this.terminate()}}});var vx,b_,fs,Ix=m(()=>{"use strict";vx=require("inversify");kp();yx();b_=0,fs=class{constructor(){this.delegateSessions=new Eo;this.refsByTarget=new WeakMap}createLauncher(e){return new lf(this.delegateSessions,e)}addDelegate(e,t,r){let o={id:b_++,target:e,dap:t,parent:r&&this.refsByTarget.get(r)};return this.refsByTarget.set(e,o),this.delegateSessions.add(o.id,o),o.id}removeDelegate(e){let t=this.refsByTarget.get(e);t&&this.delegateSessions.remove(t.id)}};fs=h([(0,vx.injectable)()],fs)});var me,ow=m(()=>{"use strict";me=class n{constructor(e,t,r){this.major=e;this.minor=t;this.patch=r}static parse(e){let t=e.split(".").map(Number);if(t.length!==3||t.some(isNaN))throw new SyntaxError(`Input string '${e}' is not a semver`);return new n(t[0],t[1],t[2])}static min(e,t){return e.lt(t)?e:t}compare(e){return this.major-e.major||this.minor-e.minor||this.patch-e.patch}gt(e){return this.compare(e)>0}gte(e){return this.compare(e)>=0}lt(e){return this.compare(e)<0}lte(e){return this.compare(e)<=0}toString(){return`${this.major}.${this.minor}.${this.patch}`}}});var pf,Sx=m(()=>{"use strict";st();H();Fa();pf=class{constructor(e,t){this.sessionId=e;this.sink=t;this.onMessageEmitter=new S;this.onEndEmitter=new S;this.disposables=new q;this.onMessage=this.onMessageEmitter.event;this.onEnd=this.onEndEmitter.event;this.disposables.push(t.NodeWorker.on("detachedFromWorker",r=>{r.sessionId===e&&(this.onEndEmitter.fire(),this.dispose())}),t.NodeWorker.on("receivedMessageFromWorker",r=>{r.sessionId===e&&this.onMessageEmitter.fire([r.message,new Fr])}))}send(e){this.sink.NodeWorker.sendMessageToWorker({message:e,sessionId:this.sessionId})}dispose(){this.disposables.isDisposed||(this.disposables.dispose(),this.onEndEmitter.fire())}}});var kx,Px=m(()=>{"use strict";kx=":::"});var nw,P6,xx,Cx=m(()=>{"use strict";nw=require("path"),P6=(0,nw.join)(__dirname,"watchdog.js"),xx=(0,nw.join)(__dirname,"bootloader.js")});var Ep,Tx,gs,lc,uf=m(()=>{"use strict";Ep=require("inversify"),Tx=require("path");W();de();U();V();J();gs=Symbol("IPackageJsonProvider"),lc=class{constructor(e,t){this.fs=e;this.config=t;this.getPath=B(async()=>{if(this.config.type!=="pwa-node"||this.config.request!=="launch")return;let e=await Ks(this.fs,this.config.cwd,"package.json");return e?(0,Tx.join)(e,"package.json"):void 0});this.getContents=B(async()=>{let e=await this.getPath();if(e)try{let t=await this.fs.readFile(e);return JSON.parse(t.toString())}catch{return}})}};lc=h([(0,Ep.injectable)(),d(0,(0,Ep.inject)(xt)),d(1,(0,Ep.inject)(re))],lc)});function df(n,e){return n.has(1)?e.addNodeOption("--inspect-publish-uid=http"):e}var Fp,tr,rr,Mo,w_,Rx,Dx,iw,y_,v_,_t,Ap,Lx,I_,S_,_p,pc,hs=m(()=>{"use strict";Fp=y(require("@vscode/l10n")),tr=require("inversify"),rr=require("path");_o();de();O();le();Cp();ow();V();J();Ie();ge();X();uf();Mo=Symbol("INodeBinaryProvider");w_=new Set(["npm","yarn","pnpm","tnpm","cnpm"]),Rx=n=>w_.has((0,rr.basename)(n,(0,rr.extname)(n))),Dx=(n,e)=>{if(!(!n||!Rx(n)))return e.find(t=>!t.startsWith("-")&&t!=="run"&&t!=="run-script")},iw=new me(12,0,0),y_=new me(8,0,0),v_=[{inclusiveMin:new me(16,0,0),inclusiveMax:new me(16,3,99),message:Fp.t("Some breakpoints might not work in your version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes. Details: https://aka.ms/AAcsvqm")},{inclusiveMin:new me(7,0,0),inclusiveMax:new me(8,99,99),message:Fp.t("You're running an outdated version of Node.js. We recommend upgrading for the latest bug, performance, and security fixes.")}],_t=class{constructor(e,t){this.path=e;this.version=t;this.capabilities=new Set;t===void 0&&(t=iw),t.gte(new me(12,0,0))&&this.capabilities.add(0),t.gte(new me(12,6,0))&&this.capabilities.add(1),t.gte(new me(22,14,0))&&t.lt(new me(24,0,0))&&I_.includes(Ml(e))&&this.capabilities.add(2)}get isPreciselyKnown(){return this.version!==void 0}get warning(){if(this.version){for(let e of v_)if(e.inclusiveMax.gte(this.version)&&e.inclusiveMin.lte(this.version))return e}}has(e,t){return!this.isPreciselyKnown&&t!==void 0?t:this.capabilities.has(e)}},Ap=class extends k{constructor(t,r){super(dI(t.toString(),r));this.version=t;this.location=r}},Lx=["node","node64","electron"],I_=[...Lx,"npx","npm"],S_=new Map([[11,new me(12,0,0)],[10,new me(12,0,0)],[9,new me(12,0,0)],[8,new me(12,0,0)],[7,new me(12,0,0)],[6,new me(12,0,0)],[5,new me(10,0,0)],[4,new me(10,0,0)],[3,new me(10,0,0)],[2,new me(8,0,0)],[1,new me(8,0,0)]]),_p=class{constructor(e,t,r,o){this.logger=e;this.fs=t;this.packageJson=r;this.launchConfig=o;this.knownGoodMappings=new Map}async resolveAndValidate(e,t="node",r,o){try{return await this.resolveAndValidateInner(e,t,r,o)}catch(i){if(!(i instanceof Ap))throw i;if(await this.shouldTryDebuggingAnyway(i))return new _t(i.location,i.version instanceof me?i.version:void 0);throw i}}shouldTryDebuggingAnyway(e){return Promise.resolve(!1)}async resolveNodeModulesLocation(e,t,r){if(!r||(0,rr.isAbsolute)(t)||!(0,rr.isAbsolute)(r))return;let o=this.launchConfig.__workspaceFolder;if(o)return Ei(r,i=>qs(o,i)?Og(this.fs,(0,rr.join)(i,"node_modules",".bin",t),e):Promise.resolve(void 0))}async resolveAndValidateInner(e,t,r,o){let i=await this.resolveBinaryLocation(t,e);if(i||(i=await this.resolveNodeModulesLocation(e,t,o)),this.logger.info("runtime.launch","Using binary at",{location:i,executable:t}),!i)throw new k(uh(t,Fp.t("path does not exist")));if(r)return new _t(i,new me(r,0,0));let s=Ml(i);if(s==="deno")return new _t(i,new me(20,0,0));if(!Lx.includes(s)){if(Rx(i)){let v=await this.packageJson.getPath();v&&(e=e.addToPath((0,rr.resolve)((0,rr.dirname)(v),"node_modules/.bin"),"prepend"))}try{let v=await this.resolveAndValidateInner(e,"node",void 0,o);return new _t(i,v.version)}catch(v){if(II(v,9230))throw v;return new _t(i,void 0)}}if(i.startsWith("/snap/"))return new _t(i,void 0);let a=this.knownGoodMappings.get(i);if(a)return a;let c=await this.getVersionText(i,o);if(!c)return new _t(i,void 0);this.logger.info("runtime.launch","Discovered version",{version:c});let l=/v([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(c);if(!l)throw new Ap(c,i);let[,p,u,g]=l.map(Number),w=new me(p,u,g);if(s==="electron"){let v=await this.resolveAndValidate(e);w=me.min(S_.get(w.major)??iw,v.version??iw)}if(w.lt(y_))throw new Ap(w,i);let I=new _t(i,w);return this.knownGoodMappings.set(i,I),I}async resolveBinaryLocation(e,t){return e&&(0,rr.isAbsolute)(e)?await Og(this.fs,e,t):await $s(this.fs,e,t.value)}async getVersionText(e,t){try{let{stdout:r}=await jm(e,["--version"],{env:xe.processEnv().defined(),cwd:t});return r.trim()}catch(r){throw t&&!(await Ft(this.fs,t))?.isDirectory()?new k(uI(t)):new k(uh(e,r.message))}}};_p=h([(0,tr.injectable)(),d(0,(0,tr.inject)(L)),d(1,(0,tr.inject)(oe)),d(2,(0,tr.inject)(gs)),d(3,(0,tr.inject)(re))],_p);pc=class extends _p{constructor(t,r,o,i,s){super(t,r,o,i);this.vscode=s}async shouldTryDebuggingAnyway({message:t}){if(!this.vscode)return!1;let r=Fp.t("Yes");return await this.vscode.window.showErrorMessage(t,r)===r}};pc=h([d(0,(0,tr.inject)(L)),d(1,(0,tr.inject)(oe)),d(2,(0,tr.inject)(gs)),d(3,(0,tr.inject)(re)),d(4,(0,tr.optional)()),d(4,(0,tr.inject)(Kt))],pc)});var Ex,mf,_x=m(()=>{"use strict";Ex=require("path");H();O();V();mf=class{constructor(e,t,r,o,i,s,a={},c){this.launchConfig=e;this.targetOriginValue=t;this.connection=r;this.targetInfo=i;this.logger=s;this.lifecycle=a;this._parent=c;this._serialize=Promise.resolve(void 0);this._attached=!1;this._onNameChangedEmitter=new S;this._onDisconnectEmitter=new S;this.entryBreakpoint=void 0;this.onDisconnect=this._onDisconnectEmitter.event;this.onNameChanged=this._onNameChangedEmitter.event;this.connection=r,this._cdp=o,o.pause(),this._waitingForDebugger=i.type==="waitingForDebugger",i.title?this._targetName=`${(0,Ex.basename)(i.title)} [${i.processId}]`:this._targetName=`[${i.processId}]`,o.Target.on("targetDestroyed",()=>this.connection.close()),r.onDisconnected(()=>this._disconnected())}id(){return this.targetInfo.targetId}processId(){return this.targetInfo.processId}name(){return this._targetName}fileName(){return this.targetInfo.title}type(){return"node"}targetOrigin(){return this.targetOriginValue}parent(){return this._parent}async initialize(){this.lifecycle.initialized&&(this.entryBreakpoint=await this.lifecycle.initialized(this)||void 0)}waitingForDebugger(){return this._waitingForDebugger}scriptUrlToUrl(e){return e[0]==="/"||process.platform==="win32"&&e[1]===":"&&e[2]==="\\"?Q(e):e}supportsCustomBreakpoints(){return!1}supportsXHRBreakpoints(){return!1}executionContextName(){return this._targetName}hasParent(){return!!this._parent}async runIfWaitingForDebugger(){await this._cdp.Runtime.runIfWaitingForDebugger({})}async _disconnected(){this._onDisconnectEmitter.fire()}canAttach(){return!this._attached}async attach(){return this._serialize=this._serialize.then(async()=>{if(!this._attached)return this._doAttach()}),this._serialize}async _doAttach(){this._waitingForDebugger=!1,this._attached=!0;let e=await this._cdp.Target.attachToTarget({targetId:this.targetInfo.targetId});if(!e){this.logger.info("runtime.launch","Failed to attach to target",{targetId:this.targetInfo.targetId});return}this._cdp.NodeWorker.enable({waitForDebuggerOnStart:!0}),e&&"__dynamicAttach"in e&&(await this._cdp.Runtime.enable({}),await this._cdp.Debugger.enable({}));let t;return this._cdp.Runtime.on("executionContextCreated",r=>{r.context.auxData&&r.context.auxData.isDefault&&(t=r.context.id)}),this._cdp.Runtime.on("executionContextDestroyed",r=>{r.executionContextId===t&&this.connection.close()}),this._cdp}async afterBind(){this._cdp.resume()}canDetach(){return this._attached}async detach(){this._serialize=this._serialize.then(async()=>{this._waitingForDebugger&&await(await this._doAttach())?.Runtime.runIfWaitingForDebugger({}),this._attached&&this._doDetach()})}async _doDetach(){await Promise.all([this._cdp.Target.detachFromTarget({targetId:this.targetInfo.targetId}),this._cdp.NodeWorker.disable({})]),this.connection.close(),this._attached=!1}canRestart(){return!1}restart(){}canStop(){return!0}stop(){try{this.lifecycle.close&&this.lifecycle.close(this)}finally{this.connection.close()}}}});function P_(n){if(!No.existsSync(n))return{};let e=x_(No.readFileSync(n,"utf8"));return Ax.parse(Buffer.from(e))}function x_(n){return n&&n[0]==="\uFEFF"&&(n=n.substr(1)),n}var Ax,No,bs,Fx,sw,aw,Wr,Mp=m(()=>{"use strict";Ax=y(require("dotenv")),No=y(require("fs")),bs=require("inversify"),Fx=y(require("net")),sw=y(require("os")),aw=y(require("path"));rn();Ze();tt();Qa();Sx();Ke();W();kp();st();_o();H();O();U();le();$();Ie();ge();ms();Px();Cx();hs();_x();Hh();Wr=class{constructor(e,t,r,o){this.pathProvider=e;this.logger=t;this.portLeaseTracker=r;this.pathResolverFactory=o;this.serverConnections=new Set;this.targets=new Eo;this.onTerminatedEmitter=new S;this.onTerminated=this.onTerminatedEmitter.event;this.onTargetListChanged=this.targets.onChanged;this.bootloaderFile=B(this.getBootloaderFile.bind(this));this.seenOpeners=new Map}async launch(e,t){let r=this.resolveParams(e);if(!r)return{blockSessionTermination:!1};this._stopServer();let{server:o,pipe:i}=await this._startServer(t.telemetryReporter),s=this.logger.forTarget(),a=this.run={server:o,serverAddress:i,params:r,context:t,logger:s,pathResolver:this.pathResolverFactory.create(r,this.logger)};return await this.launchProgram(a),{blockSessionTermination:!0}}async terminate(){this.program?await this.program.stop():this.onProgramTerminated({code:0,killed:!0})}async restart(e){if(!this.run)return;let t=this.program;t&&(this.program=void 0,await t.stop(),await Promise.race([x(2e3).then(()=>!1),Promise.all([...this.serverConnections].map(o=>new Promise(i=>o.onDisconnected(i))))])||(this.logger.warn("runtime.launch","Timeout waiting for server connections to close"),this.closeAllConnections())),await this.launchProgram({...this.run,params:e?this.resolveParams(e)??this.run.params:this.run.params,context:{...this.run.context,cancellationToken:this.run.params.timeout>0?we.withTimeout(this.run.params.timeout).token:Je}})}targetList(){return[...this.targets.value()]}dispose(){this._stopServer()}onProgramTerminated(e){this.onTerminatedEmitter.fire(e),this._stopServer(),this.program=void 0}resolveNodePath(e,t="node"){return this.pathProvider.resolveAndValidate(xe.merge(xe.processEnv(),this.getConfiguredEnvironment(e)),t,e.nodeVersionHint,e.cwd)}getConfiguredEnvironment(e){let t=xe.empty;if(e.envFile)try{t=t.merge(P_(e.envFile))}catch(r){throw new k(pI(r.message))}return t.merge(e.env)}async resolveEnvironment({params:e,serverAddress:t},r,o){let i=this.getConfiguredEnvironment(e),s=await this.bootloaderFile(e.cwd,r),a={inspectorIpc:t,deferredMode:!1,waitForDebugger:"",execPath:await $s(No.promises,"node",process.env),onlyEntrypoint:!e.autoAttachChildProcesses,verbose:e.trace===!0||typeof e.trace=="object"&&e.trace.stdio?!0:void 0,autoAttachMode:"always",mandatePortTracking:this.portLeaseTracker.isMandated?!0:void 0,...o},c={NODE_OPTIONS:` --require ${s.interpolatedPath} `,VSCODE_INSPECTOR_OPTIONS:kx+JSON.stringify(a),ELECTRON_RUN_AS_NODE:null},l=i.lookup("NODE_OPTIONS");l&&(c.NODE_OPTIONS+=` ${l} `);let p=xe.processEnv().lookup("NODE_OPTIONS");return p&&(c.NODE_OPTIONS+=` ${p}`),i.merge({...c})}createLifecycle(e,t,r){return{}}async _startServer(e){let t=sv(),r=await new Promise((o,i)=>{let s=Fx.createServer(a=>this._startSession(a,e)).on("error",i).listen(t,()=>o(s))});return{pipe:t,server:r}}_stopServer(){this.run?.server.close(),this.run=void 0,this.bootloaderFile.value?.then(e=>e.dispose()),this.bootloaderFile.forget(),this.closeAllConnections()}closeAllConnections(){this.serverConnections.forEach(e=>e.close()),this.serverConnections.clear()}async _startSession(e,t){if(!this.run)return;let{connection:r,cdp:o,targetInfo:i}=await this.acquireTarget(e,t,this.run.logger);if(!this.run){e.destroy();return}i.processId===void 0&&(i.processId=Number(i.targetId));let s=i.openerId;for(;s&&!this.targets.get(s)&&this.seenOpeners.has(s);)s=this.seenOpeners.get(s)?.openedBy;let a=new mf(this.run.params,this.run.context.targetOrigin,r,o,i,this.run.logger,this.createLifecycle(o,this.run,i),s?this.targets.get(s):void 0);this.seenOpeners.set(i.targetId,{openedBy:i.openerId}),this.listenToWorkerDomain(o,t,a),this.targets.add(i.targetId,a),a.onDisconnect(()=>this.targets.remove(i.targetId))}async listenToWorkerDomain(e,t,r){e.NodeWorker.on("attachedToWorker",o=>{let i=new pf(o.sessionId,e),s=new Ma(r.launchConfig,{attached:!0,canAccessOpener:!1,type:"node-worker",targetId:`${r.id()}-${o.sessionId}`,title:o.workerInfo.title,url:o.workerInfo.url,openerId:r.id()},r,r.targetOrigin(),new et(i,r.logger,t).rootSession(),r.logger),a=new q;a.push(i),a.push(r.onDisconnect(()=>a.dispose())),a.push(i.onEnd(()=>a.dispose())),a.callback(()=>this.targets.remove(s.id())),this.targets.add(s.id(),s)})}async acquireTarget(e,t,r){let o=new et(new dr(r,e),r,t);this.serverConnections.add(o),o.onDisconnected(()=>this.serverConnections.delete(o));let i=o.rootSession(),{targetInfo:s}=await new Promise(l=>i.Target.on("targetCreated",l)),a=s,c=this.portLeaseTracker.register(a.processInspectorPort);return o.onDisconnected(()=>c.dispose()),{targetInfo:a,cdp:i,connection:o,logger:r}}async getBootloaderFile(e,t){let r=G(xx);if(!r.includes(" "))return{interpolatedPath:r,dispose:()=>{}};if(t.has(0))return{interpolatedPath:`"${r}"`,dispose:()=>{}};let o=`require(${JSON.stringify(r)})`;if(!sw.tmpdir().includes(" ")||!e){let a=aw.join(sw.tmpdir(),"vscode-js-debug-bootloader.js");return await No.promises.writeFile(a,o),{interpolatedPath:a,dispose:()=>{}}}let i=".vscode-js-debug-bootloader.js",s=aw.join(e,i);return await No.promises.writeFile(s,o),{interpolatedPath:`./${i}`,dispose:()=>No.unlinkSync(s)}}async gatherTelemetryFromCdp(e,t){for(let r=0;r<8;r++){let o=await e.Runtime.evaluate({contextId:1,returnByValue:!0,expression:"typeof process === 'undefined' || process.pid === undefined ? 'process not defined' : ({ processId: process.pid, nodeVersion: process.version, architecture: process.arch })"+Ue()});if(!this.program)return;if(!o||!o.result.value){this.logger.error("runtime.target","Undefined result getting telemetry");return}if(typeof o.result.value!="object"){this.logger.info("runtime.target","Process not yet defined, will retry"),await x(50*2**r);continue}let i=o.result.value;return t.context.telemetryReporter.report("nodeRuntime",{version:i.nodeVersion,arch:i.architecture}),this.program.gotTelemetery(i),i}}};Wr=h([(0,bs.injectable)(),d(0,(0,bs.inject)(Mo)),d(1,(0,bs.inject)(L)),d(2,(0,bs.inject)(Dt)),d(3,(0,bs.inject)(gr))],Wr)});var Mx,C_,ui,cw=m(()=>{"use strict";Mx=require("inversify");Ze();O();$();Mp();C_=["NODE_OPTIONS","VSCODE_INSPECTOR_OPTIONS"],ui=class extends Wr{async appendEnvironmentVariables(e,t){let r="typeof Deno==='object'?'deno':typeof process==='undefined'||process.pid===undefined?'process not defined':(()=>{"+Object.entries(t.defined()).map(([o,i])=>{let s=JSON.stringify(o);return C_.includes(o)?`process.env[${s}]=(process.env[${s}]||'')+${JSON.stringify(i)}`:`process.env[${s}]=${JSON.stringify(i)}`}).join(";")+"})()"+Ue();for(let o=0;o<200;o++){let i=await e.Runtime.evaluate({contextId:1,returnByValue:!0,expression:r});if(!i){this.logger.error("runtime.target","Undefined result setting child environment vars");return}if(!i.exceptionDetails&&i.result.value!=="process not defined")return;this.logger.error("runtime.target","Error setting child environment vars",i),await x(50)}}};ui=h([(0,Mx.injectable)()],ui)});var ff,gf,ws,di,uc,ys=m(()=>{"use strict";qb();Xa();ff=class{constructor(e,t){this.a=e;this.b=t;this.stopped=Promise.race([this.a.stopped.then(async e=>await this.b.stop()&&e),this.b.stopped.then(async e=>await this.a.stop()&&e)])}gotTelemetery(e){this.a.gotTelemetery(e),this.b.gotTelemetery(e)}async stop(){return(await Promise.all([this.a.stop(),this.b.stop()]))[0]}},gf=class{constructor(e,t,r){this.child=e;this.logger=t;this.killBehavior=r;this.killed=!1;this.stopped=new Promise((o,i)=>{e.once("exit",s=>o({killed:this.killed,code:s||0})),e.once("error",s=>i({killed:this.killed,code:1,error:s}))})}gotTelemetery(){}stop(){return this.killed=!0,mr(this.child.pid,this.logger,this.killBehavior),this.stopped}},ws=class{constructor(){this.stopped=new Promise(e=>this.stopDefer=e)}gotTelemetery(e){this.telemetry=e}stop(){return this.stopDefer({code:0,killed:!0}),this.stopped}},di=class extends ws{constructor(t){super();this.wd=t;t.onEnd(r=>{this.stopDefer(r),this.wd.dispose()})}stop(){return this.wd.dispose(),this.stopped}},uc=class n{constructor(e,t,r){this.terminalResult=e;this.logger=t;this.killBehavior=r;this.didStop=!1;this.stopped=new Promise(e=>this.onStopped=t=>{this.didStop=!0,e({code:0,killed:t})});e.processId&&(this.liveness=new ii(e.processId,this.onStopped,n.terminationPollInterval))}static{this.terminationPollInterval=1e3}static{this.killConfirmInterval=200}gotTelemetery({processId:e}){if(this.didStop){mr(e,this.logger,this.killBehavior);return}this.liveness??=new ii(e,this.onStopped,1e3)}stop(){return this.didStop?this.stopped:(this.didStop=!0,this.liveness?(mr(this.liveness.pid,this.logger,this.killBehavior),this.liveness.updateInterval(n.killConfirmInterval)):this.terminalResult.shellProcessId?(mr(this.terminalResult.shellProcessId,this.logger,this.killBehavior),this.liveness=new ii(this.terminalResult.shellProcessId,this.onStopped,n.killConfirmInterval)):this.onStopped(!0),this.stopped)}}});var Nx,Ox,Bx=m(()=>{"use strict";Nx=require("crypto"),Ox=()=>(0,Nx.randomBytes)(12).toString("hex")});var jx,Oo,Np=m(()=>{"use strict";jx=y(require("net"));Qa();ni();Ke();H();ro();Bx();Oo=class n{constructor(e,t){this.info=e;this.server=t;this.onEndEmitter=new S;this.cts=new we;this.gracefulExit=!1;this.targetAlive=!1;this.targetInfo={targetId:this.info.ownId??Ox(),processId:Number(this.info.pid)||0,type:this.info.waitForDebugger?"waitingForDebugger":"",title:this.info.scriptName,url:"file://"+this.info.scriptName,openerId:this.info.openerId,attached:!0,canAccessOpener:!1,processInspectorPort:Number(new URL(this.info.inspectorURL).port)};this.onEnd=this.onEndEmitter.event;this.listenToServer()}get isTargetAlive(){return this.targetAlive}static async attach(e){let t=await new Promise((o,i)=>{let s=jx.createConnection(e.ipcAddress,()=>o(s));s.on("error",i)}),r=new dr(j.null,t);return new n(e,r)}listenToServer(){let{server:e,targetInfo:t}=this;e.send(JSON.stringify({method:"Target.targetCreated",params:{targetInfo:t}})),e.onMessage(async([r])=>{if(this.target&&!r.includes("Target.attachToTarget")&&!r.includes("Target.detachFromTarget")){this.target.send(r);return}let o=await this.execute(r);o&&e.send(JSON.stringify(o))}),e.onEnd(()=>{this.disposeTarget(),this.onEndEmitter.fire({killed:this.gracefulExit,code:this.gracefulExit?0:1})})}dispose(){this.gracefulExit=!0,this.cts.dispose(!0),this.disposeTarget(),this.server.dispose()}async execute(e){let t=JSON.parse(e);switch(t.method){case"Target.attachToTarget":return this.target&&this.disposeTarget(),this.target=await this.createTarget(),{id:t.id,result:{sessionId:this.targetInfo.targetId,__dynamicAttach:this.info.dynamicAttach?!0:void 0}};case"Target.detachFromTarget":return this.gracefulExit=!0,this.disposeTarget(),{id:t.id,result:{}};default:this.target?.send(t);return}}async createTarget(){this.gracefulExit=!1;let e=await mt.create(this.info.inspectorURL,this.cts.token,this.info.remoteHostHeader);return e.onMessage(([t])=>this.server.send(t)),e.onEnd(()=>{e&&this.server.send(JSON.stringify({method:"Target.targetDestroyed",params:{targetId:this.targetInfo.targetId,sessionId:this.targetInfo.targetId}})),this.targetAlive=!1,this.server.dispose()}),e}disposeTarget(){this.target&&(this.target.dispose(),this.target=void 0)}}});var Ux,lw,dc,Wx=m(()=>{"use strict";Ux=require("inversify");W();ow();J();ps();Xa();cw();hs();ys();Np();lw=class extends di{constructor(t,r){super(t);this.logger=r;this.stopped.then(()=>{this.telemetry&&mr(this.telemetry.processId,this.logger,"polite")})}},dc=class extends ui{constructor(){super(...arguments);this.restarting=!1}async restart(){this.restarting=!0,this.onProgramTerminated({code:0,killed:!0,restart:!0}),this.program?.stop()}resolveParams(t){return t.type==="pwa-extensionHost"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=await Ya(`http://localhost:${t.params.port}`,t.context.cancellationToken,this.logger),o=await Oo.attach({ipcAddress:t.serverAddress,scriptName:"Extension Host",inspectorURL:r,waitForDebugger:!0,dynamicAttach:!0}),i=this.program=new lw(o,this.logger);this.program.stopped.then(s=>{i===this.program&&this.onProgramTerminated(s)})}createLifecycle(t,r,o){return o.openerId?{}:{initialized:()=>this.onFirstInitialize(t,r,o)}}async onFirstInitialize(t,r,o){this.setEnvironmentVariables(t,r,o.targetId);let i=await this.gatherTelemetryFromCdp(t,r),s=this.program;if(i&&s){let a=new uc({processId:i.processId},this.logger,"forceful");a.stopped.then(()=>s.stop()),s.stopped.then(()=>{this.restarting||a.stop()})}}async setEnvironmentVariables(t,r,o){if(!r.params.autoAttachChildProcesses)return;let i=await this.resolveEnvironment(r,new _t("node",me.parse(process.versions.node)),{openerId:o});return this.appendEnvironmentVariables(t,i.update("ELECTRON_RUN_AS_NODE",null))}};dc=h([(0,Ux.injectable)()],dc)});var Op,Vx,mc,T_,$x=m(()=>{"use strict";Op=require("fs"),Vx=require("inversify");W();Vn();rw();Mp();ys();mc=class extends Wr{resolveParams(e){return e.type==="pwa-extensionHost"&&e.request==="launch"?e:void 0}async launchProgram(e){let t=e.params.port||await Qe(),r=await e.context.dap.launchVSCodeRequest({args:T_(e.params,t),env:this.getConfiguredEnvironment(e.params).defined(),debugRenderer:e.params.debugWebviews||e.params.debugWebWorkerHost});r.rendererDebugAddr&&io.debugIdTorendererDebugAddr.set(e.params.__sessionId,r.rendererDebugAddr),this.program=new ws,this.program.stop()}};mc=h([(0,Vx.injectable)()],mc);T_=(n,e)=>{let t=n.args.map(r=>{if(r.startsWith("-")){let o=r.split("=",2);return o.length===2&&((0,Op.existsSync)(o[1])||(0,Op.existsSync)(o[1]+".js"))?{prefix:o[0]+"=",path:o[1]}:{prefix:r}}else{try{let o=(0,Op.lstatSync)(r);if(o.isDirectory())return{prefix:"--folder-uri=",path:r};if(o.isFile())return{prefix:"--file-uri=",path:r}}catch{}return{path:r}}});return n.noDebug||t.unshift({prefix:`--inspect-brk-extensions=${e}`}),t.unshift({prefix:`--debugId=${n.__sessionId}`}),t}});var qx,Bp,Hx,zx,Vr,pw=m(()=>{"use strict";qx=require("crypto"),Bp=require("fs"),Hx=require("os"),zx=y(require("path")),Vr=class n{constructor(){this.disposed=!1;this.path=zx.join((0,Hx.tmpdir)(),`node-debug-callback-${(0,qx.randomBytes)(8).toString("hex")}`);this.file=Bp.promises.open(this.path,"w")}static{this.updateInterval=1e3}static{this.recencyDeadline=2e3}static isValid(e){try{let t=(0,Bp.readFileSync)(e);return t.length?t.readDoubleBE()>Date.now()-n.recencyDeadline:!1}catch{return!1}}async startTouchLoop(){await this.touch(),this.disposed||(this.updateInterval=setInterval(()=>this.touch(),n.updateInterval))}async touch(e=()=>Date.now()){let t=await this.file,r=Buffer.alloc(8);r.writeDoubleBE(e()),await t.write(r,0,r.length,0)}async dispose(){if(!this.disposed){this.disposed=!0,this.updateInterval&&clearInterval(this.updateInterval);try{await(await this.file).close(),await Bp.promises.unlink(this.path)}catch{}}}}});var Gx,hf,Jx=m(()=>{"use strict";Gx=require("child_process");Ka();hf=class{constructor(e=Gx.spawn){this.spawn=e}lookup(e,t){return new Promise((r,o)=>{let i=this.createProcess(),s=this.createParser();i.on("error",o),i.stderr.on("error",a=>o(`Error finding processes: ${a.toString()}`)),i.stdout.pipe(new Br(`
`)).on("data",a=>{let c=s(a.toString());c&&(t=e(c,t))}),i.on("close",(a,c)=>{a===0?r(t):c?o(new Error(`process terminated with signal: ${c}`)):a&&o(new Error(`process terminated with exit code: ${a}`))})})}}});var Kx,mi,bf=m(()=>{"use strict";Kx=require("path");Cp();Jx();mi=class extends hf{constructor(t){super();this.fsUtils=t}async getWorkingDirectory(t){try{let{stdout:r}=await jm("lsof",["-a","-dcwd","-Fn",`-p${t}`]),o=r.trim().split(`
`).pop().slice(1);return o&&(0,Kx.isAbsolute)(o)&&await this.fsUtils.exists(o)?o:void 0}catch(r){if(r instanceof Pp)return;throw r}}createProcess(){return this.spawn("ps",["-xo",`pid=PID,ppid=PPID,comm=${"a".repeat(256)},command=COMMAND`])}createParser(){let t;return r=>{if(!t){t=r.indexOf("COMMAND");return}let o=/^\W*([0-9]+)\W*([0-9]+)\W*/.exec(r);if(o)return{pid:Number(o[1]),ppid:Number(o[2]),command:r.slice(o[0].length,t).trim(),args:r.slice(t).trim()}}}}});var fc,uw=m(()=>{"use strict";bf();fc=class extends mi{createProcess(){return this.spawn("ps",["-axo","pid=PID,ppid=PPID,comm:30,command=COMMAND"])}createParser(){let e=super.createParser();return t=>{let r=e(t);if(!r)return;let o=r.args.indexOf(r.command);if(o===-1)return r;for(o=o+r.command.length;o<r.args.length&&r.args[o]!==" ";)o++;return r.command=r.args.substr(0,o),r.args=r.args.substr(o+1),r}}}});var wf,Qx=m(()=>{"use strict";Kb();wf=class{async getWorkingDirectory(){}async lookup(e,t){let r=await Qm();for(let o of r.getProcessInfo()){let i="",s,a=o.commandLine.indexOf('" ');if(a===-1){let c=o.commandLine.indexOf(" ");c===-1?s=o.commandLine:(s=o.commandLine.slice(0,c),i=o.commandLine.slice(c+1))}else s=o.commandLine.slice(1,a),i=o.commandLine.slice(a+2);t=e({args:i,command:s,date:o.creationDate*1e3,pid:o.processId,ppid:o.parentProcessId},t)}return t}}});function dw(n){let e=/--inspect-port=(\d+)/,t,r,o=R_().exec(n);if(o?.groups){let i=o.groups.port1||o.groups.port2;r=i?Number(i):9229,t=o.groups.address??"127.0.0.1"}return o=e.exec(n),o&&o.length===2&&(t||="127.0.0.1",r=parseInt(o[1])),{address:t,port:r}}var Yx,Xx,vs,R_,yf=m(()=>{"use strict";Yx=require("fs");de();U();bf();uw();Qx();Xx=new ve(Yx.promises),vs=process.platform==="win32"?new wf:process.platform==="darwin"?new mi(Xx):new fc(Xx),R_=B(()=>{let n=["--inspect(?:-brk)?","(?:=",["(?:",["(?:","(?<address>\\[[0-9a-f:]*\\]|[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+|(?:[a-z][a-z0-9\\.]*))","(?::(?<port1>\\d+))?",")"],"|",["(?:",":?","(?<port2>\\d+)?",")"],")"],")?"].flat(1/0).join("");return new RegExp(n,"i")})});async function Zx(n,e,t,r=Je){let o=await D_(n.pid,t);if(!o)return[];let i=[],s=o.children.slice();for(;s.length;){let a=s.pop();s=s.concat(a.children);let{port:c}=dw(a.args);c&&i.push(zb(`http://${n.hostname}:${c}`,r,t,!0).then(l=>Oo.attach({ipcAddress:n.ipcAddress,scriptName:"Child Process",inspectorURL:l,waitForDebugger:!0,dynamicAttach:!0,pid:String(a.pid),openerId:e})).catch(l=>t.info("internal","Could not spawn WD for child process",{err:l,port:c,child:a})))}return(await Promise.all(i)).filter(a=>!!a)}async function D_(n,e){let t=new Map;t.set(0,{children:[],pid:0,ppid:0,command:"",args:""});try{await vs.lookup(({pid:o,ppid:i,command:s,args:a})=>(o!==i&&t.set(o,{pid:o,ppid:i,command:s,args:a,children:[]}),t),null)}catch(o){e.warn("internal","Error getting child process tree",o);return}let r=t.values();for(let o of r){let i=t.get(o.ppid);i&&i!==o&&i.children.push(o)}return!isNaN(n)&&n>0?t.get(n):t.get(0)}var eC=m(()=>{"use strict";Ke();O();yf();ps();Np()});var tC,Bo,vf,mw,If=m(()=>{"use strict";tC=require("inversify"),Bo=class{create(e){return e===!1?new mw:e===!0?new vf({maxAttempts:1/0,delay:1e3}):new vf({maxAttempts:e.maxAttempts??1/0,delay:e.delay??1e3})}};Bo=h([(0,tC.injectable)()],Bo);vf=class n{constructor(e,t=0){this.options=e;this.attempt=t}get delay(){return this.options.delay}next(){return this.attempt===this.options.maxAttempts?void 0:new n(this.options,this.attempt+1)}reset(){return this.attempt?new n(this.options):this}},mw=class{constructor(){this.delay=-1}next(){}reset(){return this}}});var rC,Is,gc,oC=m(()=>{"use strict";rC=y(require("@vscode/l10n")),Is=require("inversify");rn();Ke();W();O();$();V();ps();ms();Xa();pw();cw();eC();hs();ys();If();Np();gc=class extends ui{constructor(t,r,o,i,s=new Bo){super(t,r,i,o);this.restarters=s}resolveParams(t){return t.type==="pwa-node"&&t.request==="attach"?t:void 0}async launchProgram(t){let r=async(i,s)=>{let a=this.program,c;try{t.params.websocketAddress?c=t.params.websocketAddress:c=await Ya(`http://${t.params.address}:${t.params.port}`,s&&t.params.timeout>0?we.withTimeout(t.params.timeout).token:t.context.cancellationToken,this.logger,t.params.remoteHostHeader)}catch(u){if(a&&a===s)return o(i,a,{killed:!1,code:1});throw u}let l=await Oo.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:c,remoteHostHeader:t.params.remoteHostHeader,waitForDebugger:!0,dynamicAttach:!0}),p=this.program=new di(l);p.stopped.then(u=>o(i.reset(),p,u))},o=async(i,s,a)=>{if(this.program!==s)return;if(a.killed){this.onProgramTerminated(a);return}let c=i.next();if(!c){this.onProgramTerminated(a);return}t.context.dap.output({output:rC.t(`Lost connection to debugee, reconnecting in {0}ms\r
`,c.delay)});let l=new ws;this.program=l;let p=await Promise.race([x(c.delay),l.stopped]);this.program===l&&(p?this.onProgramTerminated(a):r(c,l))};return r(this.restarters.create(t.params.restart))}async terminate(t){await super.terminate(),t&&this.telemetry&&mr(this.telemetry.processId,this.logger)}createLifecycle(t,r,o){if(o.openerId)return{};let i;return{initialized:async()=>{i=this.onFirstInitialize(t,r,o),await i},close:()=>{this.targetList().length&&this.program?.stop(),i?.then(s=>s.dispose())}}}async onFirstInitialize(t,r,o){let i=new Vr;await i.startTouchLoop();let s=new _t("node",void 0);try{s=await this.resolveNodePath(r.params)}catch{}let[a]=await Promise.all([this.gatherTelemetryFromCdp(t,r),this.setEnvironmentVariables(t,r,i.path,o.targetId,s)]);return this.telemetry=a,a&&r.params.attachExistingChildren&&Zx({pid:a.processId,nodePath:s.path,hostname:r.params.address,ipcAddress:r.serverAddress},o.targetId,this.logger).catch(c=>this.logger.warn("internal","Error watching child processes",{err:c})),i}async setEnvironmentVariables(t,r,o,i,s){if(!r.params.autoAttachChildProcesses)return;if(!await Qs(r.params.address)){this.logger.warn("runtime.target","Cannot attach to children of remote process");return}let a=await this.resolveEnvironment(r,s,{requireLease:o,openerId:i});return this.appendEnvironmentVariables(t,a)}};gc=h([(0,Is.injectable)(),d(0,(0,Is.inject)(Mo)),d(1,(0,Is.inject)(L)),d(2,(0,Is.inject)(gr)),d(3,(0,Is.inject)(Dt))],gc)});function Sf(n){if(!n.runtimeArgs||n.attachSimplePort)return;let e=[];for(let t of n.runtimeArgs)/^--inspect-brk(=|$)/.test(t)?n.stopOnEntry=n.stopOnEntry||!0:e.push(t);n.runtimeArgs=e}var fw=m(()=>{"use strict"});var nC,hc,iC,sC,kf,aC=m(()=>{"use strict";nC=require("crypto"),hc=require("fs"),iC=require("os"),sC=y(require("path")),kf=class n{constructor(){this.path=sC.join((0,iC.tmpdir)(),`node-debug-callback-${(0,nC.randomBytes)(8).toString("hex")}`);this.disposed=!1}static{this.pollInterval=200}read(e=n.pollInterval){return this.readPromise?this.readPromise:(this.readPromise=new Promise((t,r)=>{let o=setInterval(()=>{if(this.disposed){clearInterval(o),t(void 0);return}if((0,hc.existsSync)(this.path)){try{t(JSON.parse((0,hc.readFileSync)(this.path,"utf-8")))}catch(i){r(i)}finally{this.dispose()}clearInterval(o)}},e)}),this.readPromise)}dispose(){if(!this.disposed){this.disposed=!0;try{(0,hc.unlinkSync)(this.path)}catch{}}}}});var Ss,jp,Pf,Up=m(()=>{"use strict";Ss=y(require("path"));xn();jp=Symbol("IProgramLauncher"),Pf=n=>{let e=n.program;if(e&&Ss.isAbsolute(e)){let t=Ss.relative(n.cwd,e);e=Ss.isAbsolute(t)?t:`.${Ss.sep}${t}`}return e?[...n.runtimeArgs,e,...Ll(n.args)]:[...n.runtimeArgs,...Ll(n.args)]}});var hr,wc,L_,bc,cC=m(()=>{"use strict";hr=require("inversify"),wc=require("path");md();rn();xn();W();de();O();le();$();V();fw();ps();ms();aC();hs();Mp();uf();Up();ys();If();Np();L_=async(n,e)=>{if(typeof e.stopOnEntry=="string")return(0,wc.resolve)(e.cwd,e.stopOnEntry);if(e.program)return(0,wc.resolve)(e.cwd,e.program);for(let t of Ll(e.args)){if(t.startsWith("-"))continue;let r=(0,wc.resolve)(e.cwd,t);if(await n.exists(r))return r}},bc=class extends Wr{constructor(t,r,o,i,s,a,c,l,p){super(t,r,p,l);this.bpPredictor=o;this.launchers=i;this.restarters=s;this.fsUtils=a;this.packageJson=c}resolveParams(t){let r;if(t.type==="pwa-node"&&t.request==="launch"?r={...t}:"server"in t&&t.server&&"program"in t.server&&(r={...t.server}),!!r)return Sf(r),r}async launchProgram(t){t.params.program&&(t.params.program=await this.tryGetCompiledFile(t.params.program)),this.attachSimplePort=await this.getSimpleAttachPortIfAny(t.params);let r=async o=>{this.program&&this.program.stop();let i=await this.resolveNodePath(t.params,t.params.runtimeExecutable||void 0),s=i.warning;s&&t.context.dap.output({category:"stderr",output:s.message});let a=new kf,c=await this.resolveEnvironment(t,i,{fileCallback:a.path});this.attachSimplePort?(t.params.attachSimplePort||t.context.dap.output({category:"stderr",output:"Using legacy attach mode for --inspect-brk in npm scripts. We recommend removing --inspect-brk, and using `stopOnEntry` in your launch.json if you need it."}),c=c.merge({NODE_OPTIONS:null})):c=df(i,c);let l={...t.params,env:c.value},p="--experimental-network-inspection";t.params.experimentalNetworking==="off"||(i.has(2)||t.params.experimentalNetworking==="on")&&(l.runtimeArgs=[p,...l.runtimeArgs]);let u=this.launchers.find(w=>w.canLaunch(l));if(!u)throw new Error("Cannot find an appropriate launcher for the given set of options");let g=await u.launchProgram(i.path,l,t.context);if(this.attachSimplePort){let w=await Oo.attach({ipcAddress:t.serverAddress,scriptName:"Remote Process",inspectorURL:await Ya(`http://127.0.0.1:${this.attachSimplePort}`,t.context.cancellationToken,this.logger),waitForDebugger:!0,dynamicAttach:!0});g=new ff(g,new di(w))}else a.read().then(w=>{w&&g.gotTelemetery(w)});this.program=g,g.stopped.then(async w=>{if(a.dispose(),this.program!==g)return;if(w.killed||w.code===0){this.onProgramTerminated(w);return}let I=o.next();if(!I){this.onProgramTerminated(w);return}await x(I.delay),this.program===g&&r(I)})};return r(this.restarters.create(t.params.restart))}async getSimpleAttachPortIfAny(t){if(t.attachSimplePort)return t.attachSimplePort;let r=Dx(t.runtimeExecutable,t.runtimeArgs);if(!(!r||!(await this.packageJson.getContents())?.scripts?.[r]?.includes("--inspect-brk")))return t.port??9229}createLifecycle(t,r,{targetId:o}){return{initialized:async()=>{if(this.attachSimplePort&&await this.gatherTelemetryFromCdp(t,r),!r.params.stopOnEntry)return;let i=await L_(this.fsUtils,r.params);if(!i){this.logger.warn("runtime","Could not resolve program entrypointfrom args");return}let s="(?:entryBreakpoint){0}",a=Q(i),c=at(a)+s,l=await t.Debugger.setBreakpointByUrl({urlRegex:c,lineNumber:0,columnNumber:0});return l?.breakpointId?{cdpId:l?.breakpointId,path:a}:void 0},close:()=>{let i=Number(o);if(i>0)try{process.kill(i)}catch{}}}}async tryGetCompiledFile(t){t=ee(t);let r=(0,wc.extname)(t);if(!r||r===".js")return t;let o=await this.bpPredictor.getPredictionForSource(t);if(!o||o.size===0)return t;let i=Pn(o.values());return i?(this.logger.info("runtime.launch","Updating entrypoint to compiled file",{from:t,to:i.compiledPath,candidates:o.size}),i.compiledPath):t}};bc=h([(0,hr.injectable)(),d(0,(0,hr.inject)(Mo)),d(1,(0,hr.inject)(L)),d(2,(0,hr.inject)($i)),d(3,(0,hr.multiInject)(jp)),d(4,(0,hr.inject)(Bo)),d(5,(0,hr.inject)(xt)),d(6,(0,hr.inject)(gs)),d(7,(0,hr.inject)(gr)),d(8,(0,hr.inject)(Dt))],bc)});function __(n){switch(n){case"32":case"x86":case"ia32":return"x86";case"64":case"x64":case"amd64":return"x64";case"arm":let e=process.config.variables.arm_version;return e?"armv"+e+"l":"arm";default:return n}}var yc,lC,xf,pC,rt,Cf,jt,E_,Tf=m(()=>{"use strict";yc=y(require("fs")),lC=require("fs"),xf=require("inversify"),pC=y(require("os")),rt=y(require("path"));de();$();Ie();ge();Cf=Symbol("INvmResolver"),jt=class{constructor(e=new ve(lC.promises),t=process.env,r=process.arch,o=process.platform,i=pC.homedir()){this.fsUtils=e;this.env=t;this.arch=r;this.platform=o;this.homedir=i}async resolveNvmVersionPath(e){let t,r=[],o=this.parseVersionString(e),i=this.env.NVS_HOME;if(!i){let s=this.platform==="win32"?rt.join(this.env.LOCALAPPDATA||"","nvs"):rt.join(this.env.HOME||"",".nvs");yc.existsSync(s)&&(i=s)}if(o.nvsFormat||i){if(t=await this.resolveNvs(i,o),!t&&o.nvsFormat)throw new k(ph(e,"nvs"));r.push("nvs")}if(!t)if(this.platform==="win32")this.env.NVM_HOME&&(t=await this.resolveWindowsNvm(e),r.push("nvm-windows"));else{let s=this.env.NVM_DIR||rt.join(this.homedir,".nvm");await this.fsUtils.exists(s)&&(t=await this.resolveUnixNvm(e),r.push("nvm"))}if(!t){let s=this.platform==="win32"?this.env.FNM_DIR||rt.join(this.env.APPDATA||"","fnm"):this.env.FNM_DIR||rt.join(this.homedir,".fnm");await this.fsUtils.exists(s)&&(t=await this.resolveFnm(e,s),r.push("fnm"))}if(!r.length)throw new k(lh());if(!t||!await this.fsUtils.exists(t))throw new k(ph(e,r.join("/")));return{directory:t,binary:await this.getBinaryInFolder(t)}}async getBinaryInFolder(e){return await go(["node64.exe","node64"].map(t=>this.fsUtils.exists(rt.join(e,t))))?"node64":"node"}async resolveNvs(e,{remoteName:t,semanticVersion:r,arch:o}){if(!e)throw new k(aI());let i=this.findBinFolderForVersion(rt.join(e,t),r,s=>yc.existsSync(rt.join(s,o)));if(i)return this.platform!=="win32"?rt.join(i,o,"bin"):rt.join(i,o)}async resolveUnixNvm(e){let t=this.env.NVM_DIR;if(!t){let o=rt.join(this.env.HOME||"",".nvm");await this.fsUtils.exists(o)&&(t=o)}if(!t)throw new k(lh());let r=this.findBinFolderForVersion(rt.join(t,"versions","node"),`v${e}`);return r?rt.join(r,"bin"):void 0}async resolveWindowsNvm(e){let t=this.env.NVM_HOME;if(!t)throw new k(cI());return this.findBinFolderForVersion(t,`v${e}`)}async resolveFnm(e,t){let r=this.findBinFolderForVersion(rt.join(t,"node-versions"),`v${e}`);if(r)return this.platform==="win32"?rt.join(r,"installation"):rt.join(r,"installation","bin")}findBinFolderForVersion(e,t,r){if(!yc.existsSync(e))return;let o=yc.readdirSync(e);if(o.includes(t))return rt.join(e,t);let i=o.filter(s=>s.startsWith(`${t}.`)).sort(E_).filter(s=>r?r(rt.join(e,s)):!0).pop();return i?rt.join(e,i):void 0}parseVersionString(e){let r=/^(([\w-]+)\/)?(v?(\d+(\.\d+(\.\d+)?)?))(\/((x86)|(32)|((x)?64)|(arm\w*)|(ppc\w*)))?$/i.exec(e);if(!r)throw new Error("Invalid version string: "+e);let o=!!(r[2]||r[8]),i=r[2]||"node",s=r[4]||"",a=__(r[8]||this.arch);return{nvsFormat:o,remoteName:i,semanticVersion:s,arch:a}}};jt=h([(0,xf.injectable)(),d(0,(0,xf.inject)(xt))],jt);E_=(n,e)=>{let t=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(n),r=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(e);if(!t||!r)return(r?-1:0)+(t?1:0);let[,o,i,s]=t,[,a,c,l]=r;return Number(o)-Number(a)||Number(i)-Number(c)||Number(s)-Number(l)}});var uC,Df,vc,Rf,dC=m(()=>{"use strict";uC=require("child_process"),Df=require("inversify");_o();O();Cp();Ka();J();Up();ys();vc=class{constructor(e){this.logger=e}canLaunch(e){return e.console==="internalConsole"}async launchProgram(e,t,r){let{executable:o,args:i,shell:s,cwd:a}=xp(e,Pf(t),t.cwd);r.dap.output({category:"console",output:[o,...i].join(" ")+`
`});let c=(0,uC.spawn)(o,i,{shell:s,cwd:a,env:xe.merge(xe.processEnv(),t.env).defined()});return t.outputCapture==="console"?this.discardStdio(r.dap,c):this.captureStdio(r.dap,c),new gf(c,this.logger,t.killBehavior)}captureStdio(e,t){t.stdout.pipe(new Rf).on("data",r=>e.output({category:"stdout",output:r.toString()})).resume(),t.stderr.pipe(new Rf).on("data",r=>e.output({category:"stderr",output:r.toString()})).resume()}discardStdio(e,t){let r=[],o=()=>{r&&e.output({category:"stderr",output:Buffer.concat(r).toString()})},i=Buffer.from("Debugger attached."),s=a=>{a.includes(i)?(r=void 0,t.stderr.removeListener("data",s)):r&&r.push(a)};t.stderr.on("data",s),t.on("error",a=>{o(),e.output({category:"stderr",output:a.stack||a.message})}),t.on("exit",a=>{a!==null&&a>0&&(o(),e.output({category:"stderr",output:`Process exited with code ${a}\r
`}))}),t.stdout.resume(),t.stderr.resume()}};vc=h([(0,Df.injectable)(),d(0,(0,Df.inject)(L))],vc);Rf=class extends Br{constructor(){super(3);this.etxSpotted=!1;this.splitSuffix=Buffer.from(`
`)}_transform(t,r,o){return!this.etxSpotted&&t.includes(3)&&(this.etxSpotted=!0),this.etxSpotted?super._transform(t,r,o):(this.push(t),o())}}});var Lf,fi,gw=m(()=>{"use strict";Lf=require("inversify");O();U();Ie();ge();Up();ys();fi=class{constructor(e){this.logger=e}canLaunch(e){return e.internalConsoleOptions,e.console!=="internalConsole"}async launchProgram(e,t,r){let o={kind:t.console==="integratedTerminal"?"integrated":"external",title:t.name,cwd:t.cwd,args:[e,...Pf(t)],env:Us(t.env),argsCanBeInterpretedByShell:!Array.isArray(t.args)},i;try{i=await this.sendLaunchRequest(o,r)}catch(s){throw new k(lI(s.message))}return new uc(i,this.logger,t.killBehavior)}sendLaunchRequest(e,t){return t.dap.runInTerminalRequest(e)}};fi=h([(0,Lf.injectable)(),d(0,(0,Lf.inject)(L))],fi)});var mC,Ic,fC=m(()=>{"use strict";mC=require("inversify"),Ic=class{getTreatment(e,t){return Promise.resolve(t)}};Ic=h([(0,mC.injectable)()],Ic)});var gC,ks,hC=m(()=>{"use strict";gC=require("inversify");H();ks=class{constructor(){this.flushEmitter=new S;this.onFlush=this.flushEmitter.event}report(){}reportOperation(){}attachDap(){}flush(){this.flushEmitter.fire()}dispose(){}};ks=h([(0,gC.injectable)()],ks)});var Ef,hw=m(()=>{"use strict";Ef=Symbol("ITerminalLinkProvider")});var bC,$r,wC,yC,kc,A_,F_,bw,Sc,vC=m(()=>{"use strict";bC=require("crypto"),$r=require("inversify"),wC=require("os"),yC=y(require("path")),kc=y(require("vscode"));rn();W();H();O();$();hw();Ie();ge();X();ms();hs();Mp();A_=1e3,F_=1e3,bw=class{constructor(e){this.terminal=e;this.stopped=new Promise(t=>{let r=kc.window.onDidCloseTerminal(o=>{o===e&&(t({code:0,killed:!0}),r.dispose())})})}gotTelemetery(){}stop(){return this.terminal.sendText(""),setTimeout(()=>this.terminal.dispose(),1),this.stopped}},Sc=class extends Wr{constructor(t,r,o,i,s,a,c){super(t,r,s,i);this.fs=o;this.optionsProviders=a;this.terminalLinkProvider=c;this.terminalCreatedEmitter=new S;this.callbackFile=yC.join((0,wC.tmpdir)(),`node-debug-callback-${(0,bC.randomBytes)(8).toString("hex")}`);this.onTerminalCreated=this.terminalCreatedEmitter.event}async getProcessTelemetry(){try{return JSON.parse(await this.fs.readFile(this.callbackFile,"utf-8"))}catch{return}}resolveParams(t){if(t.type==="node-terminal"&&t.request==="launch")return t;if(t.type==="pwa-chrome"&&t.server&&"command"in t.server)return t.server}async launchProgram(t){let r;try{r=await this.resolveNodePath(t.params)}catch(c){if(c instanceof k&&c.cause.id===9230)throw c;r=new _t("node",void 0)}let o=await this.resolveEnvironment(t,r,{fileCallback:this.callbackFile}),i={name:t.params.name,cwd:t.params.cwd,iconPath:new kc.ThemeIcon("debug"),env:df(r,o).defined(),isTransient:!0};for(let c of this.optionsProviders){let l=await c.provideTerminalOptions(i);l&&(i=l)}let s=await this.createTerminal(i);this.terminalLinkProvider?.enableHandlingInTerminal(s),this.terminalCreatedEmitter.fire(s),s.show();let a=this.program=new bw(s);t.params.command&&await this.writeCommand(s,t.params.command),a.stopped.then(c=>{a===this.program&&this.onProgramTerminated(c)})}async writeCommand(t,r){if(!t.shellIntegration){let o;await Promise.race([x(A_),new Promise(i=>{o=kc.window.onDidChangeTerminalShellIntegration(s=>{s.terminal===t&&s.shellIntegration&&i()})})]),o.dispose()}t.shellIntegration?t.shellIntegration.executeCommand(r):(await Promise.race([t.processId,x(F_)]),t.sendText(r,!0))}createTerminal(t){return Promise.resolve(kc.window.createTerminal(t))}dispose(){super.dispose(),this.fs.unlink(this.callbackFile).catch(()=>{})}};Sc=h([(0,$r.injectable)(),d(0,(0,$r.inject)(Mo)),d(1,(0,$r.inject)(L)),d(2,(0,$r.inject)(oe)),d(3,(0,$r.inject)(gr)),d(4,(0,$r.inject)(Dt)),d(5,(0,$r.inject)(pa)),d(6,(0,$r.optional)()),d(6,(0,$r.inject)(Ef))],Sc)});var Ps,Wp,Pc,IC=m(()=>{"use strict";Ps=require("inversify"),Wp=require("vscode-tas-client");J();X();Td();ua();Pc=class{constructor(e,t){t&&e instanceof Er&&(this.service=(0,Wp.getExperimentationService)("ms-vscode.js-debug",Mi,ed?Wp.TargetPopulation.Insiders:Wp.TargetPopulation.Public,{setSharedProperty(r,o){e.setGlobalMetric(r,o)},postEvent(r,o){e.pushOutput({category:"telemetry",output:r,data:o})}},t.globalState))}dispose(){this.service?.pollingService?.StopPolling()}async getTreatment(e,t){if(!this.service)return t;try{return await this.service.getTreatmentVariableAsync("vscode",e,!0)}catch{return t}}};Pc=h([(0,Ps.injectable)(),d(0,(0,Ps.inject)(lt)),d(1,(0,Ps.optional)()),d(1,(0,Ps.inject)(Oe))],Pc)});var SC,St,Re,jo=m(()=>{"use strict";SC=require("inversify"),St=y(require("vscode"));W();Re=class{constructor(){this._onSessionAddedEmitter=new St.EventEmitter;this._onSessionEndedEmitter=new St.EventEmitter;this._disposables=[];this.sessions=new Map;this.onSessionAdded=this._onSessionAddedEmitter.event;this.onSessionEnded=this._onSessionEndedEmitter.event}static isConcreteSession(e){return!!e.configuration.__pendingTargetId}static pickSession(e,t){if(e.length<2)return e[0];let r=St.window.createQuickPick();return r.title=t,r.items=e.map(o=>({label:o.name,id:o.id})),r.ignoreFocusOut=!0,new Promise(o=>{r.onDidAccept(()=>o(e.find(i=>i.id===r.selectedItems[0]?.id))),r.onDidHide(()=>o(void 0)),r.show()}).finally(()=>r.dispose())}get isDebugging(){return this.sessions.size>0}getById(e){return this.sessions.get(e)}isRunning(e){return[...this.sessions.values()].includes(e)}getByName(e){return[...this.sessions.values()].filter(t=>t.name===e)}getConcreteSessions(){return[...this.sessions.values()].filter(Re.isConcreteSession)}getChildren(e){return[...this.sessions.values()].filter(t=>t.configuration.__parentId===e.id)}attach(){St.debug.onDidStartDebugSession(e=>{_n(e.type)&&(this.sessions.set(e.id,e),this._onSessionAddedEmitter.fire(e))},void 0,this._disposables),St.debug.onDidTerminateDebugSession(e=>{_n(e.type)&&(this.sessions.delete(e.id),this._onSessionEndedEmitter.fire(e))},void 0,this._disposables),St.debug.onDidReceiveDebugSessionCustomEvent(e=>{if(_n(e.session.type)){if(e.event==="revealLocationRequested"){let t=e.body,r=St.debug.asDebugSourceUri(e.body.source),o={};if(t.line){let i=new St.Position((t.line||1)-1,(t.column||1)-1);o.selection=new St.Range(i,i)}St.window.showTextDocument(r,o)}else if(e.event==="copyRequested"){let t=e.body;St.env.clipboard.writeText(t.text)}}},void 0,this._disposables)}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[]}};Re=h([(0,SC.injectable)()],Re)});var _f,kC,xc,PC=m(()=>{"use strict";_f=require("inversify"),kC=y(require("vscode"));jo();xc=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(this.tracker.onSessionEnded(t=>{let r=t.configuration.cascadeTerminateToConfigurations;if(!(!r||!(r instanceof Array)))for(let o of r)for(let i of this.tracker.getByName(o))kC.debug.stopDebugging(i)}))}};xc=h([(0,_f.injectable)(),d(0,(0,_f.inject)(Re))],xc)});var xC,CC,TC=m(()=>{"use strict";xC=Symbol("IDebugConfigurationResolver"),CC=Symbol("IDebugConfigurationProvider")});var RC,DC,cn,ww=m(()=>{"use strict";RC=require("inversify"),DC=y(require("vscode"));W();cn=class{get type(){return this.getType()}get triggerKind(){return this.getTriggerKind()}async provideDebugConfigurations(e,t){try{let r=await this.provide(e,t);if(!r)return[];let o=r instanceof Array?r:[r],i=Zg.get(this.type);if(i)for(let s of o)s.type===this.type&&(s.type=i);return o}catch(r){return DC.window.showErrorMessage(r.message,{modal:!0}),[]}}};cn=h([(0,RC.injectable)()],cn)});var LC,Cc,yw=m(()=>{"use strict";LC=y(require("vscode")),Cc=class{constructor(e){this.key=e}set value(e){e!==this._value&&(this._value=e,LC.commands.executeCommand("setContext",this.key,e))}get value(){return this._value}}});var EC,Af,_C=m(()=>{"use strict";EC=Symbol("Uninitialized"),Af=class{constructor(e,t){this.key=e;this.defaultValue=t;this._value=EC}write(e,t){t!==this.read(e)&&(this._value=t,e.update(this.key,t))}read(e){return this._value===EC&&(this._value=e.get(this.key)??this.defaultValue),this._value}}});var Vp,vw,Ff,Tc,Iw=m(()=>{"use strict";Vp=require("inversify"),vw=y(require("vscode"));W();X();jo();yw();_C();Ff=new Af("sourceSteppingEnabled",!0),Tc=class{constructor(e,t){this.context=e;this.tracker=t}register(e){let t=new Cc("jsDebugIsMapSteppingDisabled");Ff.read(this.context.workspaceState)===!1&&(t.value=!0);let r=o=>{t.value=!o,Ff.write(this.context.workspaceState,o);for(let i of this.tracker.getConcreteSessions())i.customRequest("setSourceMapStepping",{enabled:o})};e.subscriptions.push(Ce(vw.commands,"extension.js-debug.enableSourceMapStepping",()=>{r(!0)}),Ce(vw.commands,"extension.js-debug.disableSourceMapStepping",()=>{r(!1)}))}};Tc=h([(0,Vp.injectable)(),d(0,(0,Vp.inject)(Oe)),d(1,(0,Vp.inject)(Re))],Tc)});var Nf,AC,ln,qr,$p=m(()=>{"use strict";Nf=require("inversify"),AC=require("path"),ln=y(require("vscode"));W();O();U();J();X();Iw();qr=class{constructor(e){this.extensionContext=e}get type(){return this.getType()}async resolveDebugConfiguration(e,t,r){if(t.type&&(t.type=this.getType()),"__pendingTargetId"in t)return t;let o=t;o.sourceMaps??=Ff.read(this.extensionContext.workspaceState);try{let i=await this.resolveDebugConfigurationAsync(e,o,r);return i&&this.commonResolution(i,e)}catch(i){ln.window.showErrorMessage(i.message,{modal:!0})}}applyDefaultRuntimeExecutable(e){if(e.runtimeExecutable)return;let t=Ht(ln.workspace,"debug.javascript.defaultRuntimeExecutable"),r=t?t[e.type]:void 0;r&&(e.runtimeExecutable=r)}commonResolution(e,t){return e.trace=Mg(e.trace,this.extensionContext.logPath),e.__workspaceCachePath=this.extensionContext.storagePath,e.__breakOnConditionalError=Ht(ln.workspace,"debug.javascript.breakOnConditionalError",t)??!1,t?e.__workspaceFolder=t.uri.fsPath:(e.__workspaceFolder||=this.getSuggestedWorkspaceFolders(e).filter(Me).filter(r=>!r.includes("${workspaceFolder}")).map(r=>(0,AC.isAbsolute)(r)?ln.workspace.getWorkspaceFolder(ln.Uri.file(r))?.uri.fsPath:r).find(Me)||ln.workspace.workspaceFolders?.[0]?.uri.fsPath||"",e.__workspaceFolder?e=sh(e):e=ih(e)),e}getSuggestedWorkspaceFolders(e){return[]}};qr=h([(0,Nf.injectable)(),d(0,(0,Nf.inject)(Oe))],qr)});function Of(n){FC.debug.activeDebugConsole.appendLine(n)}var FC,MC=m(()=>{"use strict";FC=y(require("vscode"))});async function Dc(n,e,t=!1){let r=e.processId?.trim(),o=r&&O_(r);if(!o||isNaN(o.pid))throw new Error(Sw.t("Attach to process: '{0}' doesn't look like a process id.",r||"<unknown>"));if(o.port||B_(o.pid),e.port=o.port||M_,delete e.processId,t){let i=await N_(n,o.pid);i&&(e.cwd=i)}}async function N_(n,e){let t=e&&await vs.getWorkingDirectory(e);if(!t)return xs.workspace.workspaceFolders?.[0].uri.fsPath;let r=await Ks(n,t,"package.json");if(!r)return t;let o=xs.workspace.getWorkspaceFolder(xs.Uri.file(t));return!o||Cu(o.uri.fsPath,r)?r:o.uri.fsPath}function B_(n){try{if(process.platform==="win32"){let e=`node -e process._debugProcess(${n})`;(0,NC.execSync)(e)}else process.kill(n,"SIGUSR1")}catch(e){throw new Error(Sw.t("Attach to process: cannot enable debug mode for process '{0}' ({1}).",n,e))}}var Sw,NC,xs,M_,O_,kw=m(()=>{"use strict";Sw=y(require("@vscode/l10n")),NC=require("child_process"),xs=y(require("vscode"));W();de();le();V();J();yf();M_=9229;O_=n=>{let[e,t]=n.split(":");return{pid:Number(e),port:t?Number(t):void 0}}});function Pw(n,e){if(e)return e.uri.fsPath;if(wr.workspace.workspaceFolders&&wr.workspace.workspaceFolders.length>0)return wr.workspace.workspaceFolders[0].uri.fsPath;if(n){if(n==="${file}")return"${fileDirname}";if(Ve.isAbsolute(n))return Ve.dirname(n)}return"${workspaceFolder}"}function OC(n,e){if(n&&(e=yo(e,"workspaceFolder",n.uri.fsPath)),wr.workspace.workspaceFolders?.length&&(e=yo(e,"workspaceRoot",wr.workspace.workspaceFolders[0].uri.fsPath)),Ve.isAbsolute(e))return e;if(n)return Ve.join(n.uri.fsPath,e)}async function j_(n,e,t){if(t.outFiles||!e)return;let r;if(t.program?(r=OC(e,t.program),r&&(r=Ve.dirname(r))):t.cwd&&(r=OC(e,t.cwd)),!r||qs(e.uri.fsPath,r))return;let o=await Ei(r,async i=>!i.includes("node_modules")&&await n.exists(Ve.join(i,"package.json"))?i:void 0);if(o){let i=G(Ve.relative(e.uri.fsPath,o));i.length&&(t.outFiles=[...Qu.outFiles,`\${workspaceFolder}/${i}/**/*.js`,`!\${workspaceFolder}/${i}/**/node_modules/**`])}}async function xw(n,e,t){let r={type:"pwa-node",request:"launch",name:gi.t("Launch Program"),skipFiles:[`${Qr}/**`]};t&&t.noDebug&&(r.noDebug=!0);let o=await BC(n,"package.json"),i,s=!1;if(o&&o.name==="mern-starter")return e&&Of(gi.t("Launch configuration for '{0}' project created.","Mern Starter")),V_(r),r;if(o&&(i=await q_(n,o,e),i&&e&&Of(gi.t("Launch configuration created based on 'package.json'."))),!i){let a=wr.window.activeTextEditor;a&&Yu.includes(a.document.languageId)&&(s=a.document.languageId!=="javascript",i=n?Ve.relative(n.uri.fsPath,a.document.uri.fsPath):a.document.uri.fsPath,Ve.isAbsolute(i)||(i="${workspaceFolder}"+Ve.sep+i))}if(!i&&n){let a=n.uri.fsPath;i=await go(U_.map(async c=>await Ft(Ec.promises,Ve.join(a,c))&&"${workspaceFolder}"+Ve.sep+c))}if(i||(i="${file}"),i&&(r.program=i,n||(r.__workspaceFolder=Ve.dirname(i))),s||wr.workspace.textDocuments.some(a=>$_(a.languageId))){e&&Of(gi.t("Adjust glob pattern(s) in the 'outFiles' attribute so that they cover the generated JavaScript."));let a="",c=await BC(n,"tsconfig.json");if(c?.compilerOptions?.outDir&&W_()){let l=c.compilerOptions.outDir;Ve.isAbsolute(l)||(a=l,a.indexOf("./")===0&&(a=a.substr(2)),a[a.length-1]!=="/"&&(a+="/")),r.preLaunchTask="tsc: build - tsconfig.json"}r.outFiles=["${workspaceFolder}/"+a+"**/*.js"]}return r}function W_(){let n=wr.workspace.getConfiguration().get("typescript.tsc.autoDetect");return n!=="off"&&n!=="watch"}function V_(n){n.request==="launch"&&(n.runtimeExecutable="nodemon",n.program="${workspaceFolder}/index.js",n.restart=!0,n.env={BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"},n.console="integratedTerminal",n.internalConsoleOptions="neverOpen")}function $_(n){return n==="typescript"||n==="coffeescript"}async function BC(n,e){if(n)try{let t=await Ec.promises.readFile(Ve.join(n.uri.fsPath,e),"utf8");return JSON.parse(t)}catch{}}async function q_(n,e,t){let r;try{if(e.main?r=e.main:e.scripts&&typeof e.scripts.start=="string"&&(r=e.scripts.start.split(" ").pop()),r){let o;if(Ve.isAbsolute(r)?o=r:(o=n?Ve.join(n.uri.fsPath,r):void 0,r=Ve.join("${workspaceFolder}",r)),t&&o&&!await Ft(Ec.promises,o)&&!await Ft(Ec.promises,o+".js"))return}}catch{}return r}var gi,Ec,Lc,Ve,wr,Uo,U_,_c=m(()=>{"use strict";gi=y(require("@vscode/l10n")),Ec=require("fs"),Lc=require("inversify"),Ve=y(require("path")),wr=y(require("vscode"));MC();W();_o();Vn();de();Ti();le();$();V();J();X();Tf();fw();kw();$p();Uo=class extends qr{constructor(t,r,o){super(t);this.nvmResolver=r;this.fsUtils=o}async resolveDebugConfigurationWithSubstitutedVariables(t,r){let o=r;if(o.type==="pwa-node"&&o.request==="attach"&&typeof o.processId=="string"&&await Dc(this.fsUtils,o),"port"in o&&typeof o.port=="string"&&(o.port=Number(o.port)),"attachSimplePort"in o&&typeof o.attachSimplePort=="string"&&(o.attachSimplePort=Number(o.attachSimplePort)),o.cwd){let i=await Ft(Ec.promises,o.cwd);if(!i){wr.window.showErrorMessage(gi.t("The configured `cwd` {0} does not exist.",o.cwd),{modal:!0});return}if(!i.isDirectory()){wr.window.showErrorMessage(gi.t("The configured `cwd` {0} is not a folder.",o.cwd),{modal:!0});return}}return o}async resolveDebugConfigurationAsync(t,r,o){if(!r.name&&!r.type&&!r.request&&(r=await xw(t,!0,r),r.request==="launch"&&!r.program)){wr.window.showErrorMessage(gi.t("Cannot find a program to debug"),{modal:!0});return}if(r.cwd||(r.cwd=r.localRoot||Pw(r.request==="launch"?r.program:void 0,t)),r.remoteRoot&&!r.localRoot&&(r.localRoot="${workspaceFolder}"),r.request==="launch"){if(this.applyDefaultRuntimeExecutable(r),r.runtimeExecutable&&Ml(r.runtimeExecutable)==="deno"&&!r.attachSimplePort){let s=await Qe();r.attachSimplePort=s,r.continueOnAttach??=!0;let a=[`--inspect-brk=127.0.0.1:${s}`,"--allow-all"];r.runtimeArgs?r.runtimeArgs.includes("run")?r.runtimeArgs=[...r.runtimeArgs,...a]:r.runtimeArgs=["run",...a,...r.runtimeArgs]:r.runtimeArgs=["run",...a]}let i=r.runtimeVersion;if(typeof i=="string"&&i!=="default"){let{directory:s,binary:a}=await this.nvmResolver.resolveNvmVersionPath(i);r.env=new xe(r.env).addToPath(s,"prepend",!0).value,r.runtimeExecutable=!r.runtimeExecutable||r.runtimeExecutable==="node"?a:r.runtimeExecutable}if(r.console==="integratedTerminal"&&!r.internalConsoleOptions&&(r.internalConsoleOptions="neverOpen"),r.attachSimplePort===null||r.attachSimplePort===void 0)Sf(r);else{if(r.attachSimplePort===0){r.attachSimplePort=await Qe(void 0,o);let s=`--inspect-brk=${r.attachSimplePort}`;r.runtimeArgs=r.runtimeArgs?[...r.runtimeArgs,s]:[s]}r.continueOnAttach=!r.stopOnEntry,r.stopOnEntry=!1}await j_(this.fsUtils,t,r)}return oh(r)}getType(){return"pwa-node"}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.cwd]}};Uo=h([(0,Lc.injectable)(),d(0,(0,Lc.inject)(Oe)),d(1,(0,Lc.inject)(Cf)),d(2,(0,Lc.inject)(xt))],Uo);U_=["index.js","main.js"]});var jC,Ac,Cw=m(()=>{"use strict";jC=y(require("vscode"));W();J();$p();_c();Ac=class extends qr{async resolveDebugConfigurationAsync(e,t){if(t.cwd||(t.cwd=Pw(void 0,e)),t.request==="launch"&&!t.command){await qt(jC.commands,"extension.js-debug.createDebuggerTerminal",void 0,e);return}return t.remoteRoot&&!t.localRoot&&(t.localRoot="${workspaceFolder}"),nh(t)}getType(){return"node-terminal"}}});var Fc,pn,UC,Mc,qp,H_,z_,hi,bi,Tw=m(()=>{"use strict";Fc=y(require("@vscode/l10n")),pn=require("inversify"),UC=require("os"),Mc=require("path"),qp=y(require("vscode"));W();Vn();de();$();X();ww();$p();_c();Cw();H_=n=>n.request==="launch",z_=n=>n.request==="attach",hi=class extends qr{constructor(t,r,o,i,s){super(t);this.nodeProvider=r;this.terminalProvider=o;this.location=i;this.fs=s}async resolveBrowserCommon(t,r){if(r.request,r.server&&"program"in r.server){let i={...r.server,type:"pwa-node",request:"launch",name:`${r.name}: Server`};r.server=await this.nodeProvider.resolveDebugConfiguration(t,i)}else r.server&&"command"in r.server&&(r.server=await this.terminalProvider.resolveDebugConfiguration(t,{...r.server,type:"node-terminal",request:"launch",name:`${r.name}: Server`}));let o=this.location==="remote"?"ui":"workspace";if(H_(r)&&!r.browserLaunchLocation&&(r.browserLaunchLocation=o),z_(r)&&!r.browserAttachLocation&&(r.browserAttachLocation=o),r.request==="launch"){let i=r;this.applyDefaultRuntimeExecutable(i)}}getSuggestedWorkspaceFolders(t){return[t.rootPath,t.webRoot]}async resolveDebugConfigurationWithSubstitutedVariables(t,r){if("__pendingTargetId"in r)return r;let o=r;if("port"in o&&typeof o.port=="string"&&(o.port=Number(o.port)),o.request==="launch"){let i=await this.ensureNoLockfile(o);if(i===void 0)return;o=i}return o}async ensureNoLockfile(t){if(t.request!=="launch")return t;let r=t;if(r.userDataDir===!1||r.port&&!await fS(r.port))return t;let o=typeof r.userDataDir=="string"?r.userDataDir:(0,Mc.join)(this.extensionContext.storagePath??(0,UC.tmpdir)(),r.runtimeArgs?.includes("--headless")?".headless-profile":".profile"),i=(0,Mc.join)(o,process.platform==="win32"?"lockfile":"SingletonLock");if(await go([tv(this.fs,i),this.isVsCodeLocked((0,Mc.join)(o,"code.lock"))])){let a=Fc.t("Debug Anyway");if(await qp.window.showErrorMessage(Fc.t("It looks like a browser is already running from {0}. Please close it before trying to debug, otherwise VS Code may not be able to connect to it.",r.userDataDir===!0?Fc.t("an old debug session"):Fc.t("the configured userDataDir")),{modal:!0},a)!==a)return}return{...t,userDataDir:o}}async isVsCodeLocked(t){try{let r=Number(await this.fs.readFile(t,"utf-8"));return process.kill(r,0),!0}catch{return!1}}};hi=h([(0,pn.injectable)(),d(0,(0,pn.inject)(Oe)),d(1,(0,pn.inject)(Uo)),d(2,(0,pn.inject)(Ac)),d(3,(0,pn.inject)(to)),d(4,(0,pn.inject)(oe))],hi);bi=class extends cn{provide(){return this.createLaunchConfigFromContext()||this.getDefaultLaunch()}getTriggerKind(){return qp.DebugConfigurationProviderTriggerKind.Initial}createLaunchConfigFromContext(){let e=qp.window.activeTextEditor;if(e&&e.document.languageId==="html")return{type:this.getType(),request:"launch",name:`Open ${(0,Mc.basename)(e.document.uri.fsPath)}`,file:e.document.uri.fsPath}}getDefaultLaunch(){return{type:this.getType(),request:"launch",name:Fc.t("Launch Chrome against localhost"),url:"http://localhost:8080",webRoot:"${workspaceFolder}"}}};bi=h([(0,pn.injectable)()],bi)});var Rw,Nc,Cs,WC=m(()=>{"use strict";Rw=require("inversify");W();J();Tw();Nc=class extends hi{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new Cs().createLaunchConfigFromContext();if(!r)return null;t=r}return await this.resolveBrowserCommon(e,t),t.request==="attach"?{...Wl,...t}:{...ea,...t}}getType(){return"pwa-chrome"}};Nc=h([(0,Rw.injectable)()],Nc);Cs=class extends bi{getType(){return"pwa-chrome"}};Cs=h([(0,Rw.injectable)()],Cs)});var VC,Dw,Oc,Ts,$C=m(()=>{"use strict";VC=y(require("@vscode/l10n")),Dw=require("inversify");W();J();Tw();Oc=class extends hi{async resolveDebugConfigurationAsync(e,t){if(!t.name&&!t.type&&!t.request){let r=new Ts().createLaunchConfigFromContext();if(!r)return;t=r}return await this.resolveBrowserCommon(e,t),t.useWebView&&(t.timeout=t.timeout??0),t.request==="attach"?{...th,...t}:{...rh,...t}}getType(){return"pwa-msedge"}};Oc=h([(0,Dw.injectable)()],Oc);Ts=class extends bi{getType(){return"pwa-msedge"}getDefaultLaunch(){return{...super.getDefaultLaunch(),name:VC.t("Launch Edge against localhost")}}};Ts=h([(0,Dw.injectable)()],Ts)});var Bf,qC,Lw,HC,ft,zC,G_,wi,J_,K_,Q_,X_,Ew=m(()=>{"use strict";Bf=y(require("@vscode/l10n")),qC=y(require("execa")),Lw=require("fs"),HC=require("inversify"),ft=y(require("path")),zC=y(require("vscode"));Ke();W();de();Ag();V();J();$p();G_=["workspace"],wi=class extends qr{async resolveDebugConfigurationAsync(e,t){let r=new Vs(t.args),o=await Q_(e,t,r);if(t.debugWebWorkerHost===void 0){let i=o?.value.extensionKind??G_;t={...t,debugWebWorkerHost:i.length===1&&i[0]==="web"}}if(t.debugWebWorkerHost&&(t.outFiles=[],t.resolveSourceMapLocations=jl.resolveSourceMapLocations),!t.outFiles&&o&&e){let i=await J_(e,o);i&&(t.outFiles=i,t.resolveSourceMapLocations??=jl.resolveSourceMapLocations)}return Xu(t),Promise.resolve({...jl,...t})}async resolveDebugConfigurationWithSubstitutedVariables(e,t){let r=t;try{let o=await X_(r);o&&(r.env={...r.env,...o.env},r.args=[...r.args||[],...o.config.launchArgs||[],`--extensionDevelopmentPath=${o.extensionDevelopmentPath}`,`--extensionTestsPath=${o.extensionTestsPath}`])}catch(o){if(o instanceof Rt)return;throw o}return r}getType(){return"pwa-extensionHost"}};wi=h([(0,HC.injectable)()],wi);J_=async(n,e)=>{if(!e.value.main)return;let t=ft.resolve(ft.dirname(e.path),e.value.main),r=ft.relative(n.uri.fsPath,ft.dirname(e.path)),i=ft.relative(ft.dirname(e.path),t).split(ft.sep)[0];return[ft.join("${workspaceFolder}",r,i,"**/*.js").replaceAll("\\","/")]},K_="--extensionDevelopmentPath",Q_=async(n,e,t)=>{let r=t.get(K_);if(!r)return;let o=yo(r,"workspaceFolder",n?.uri.fsPath??e.__workspaceFolder??"");try{let i=ft.join(o,"package.json"),s=await Lw.promises.readFile(i,"utf-8");return{value:JSON.parse(s),path:i}}catch{return}},X_=async n=>{let{testConfiguration:e}=n,{testConfigurationLabel:t}=n;if(!e)return;let r=ft.join("node_modules","@vscode","test-cli","out","bin.mjs"),o=await Ei(e,async c=>{let l=ft.join(c,r);return await wn(Lw.promises,l)?c:void 0});if(!o)throw new Error(Bf.t("Cannot find `{0}` installed in {1}","@vscode/test-cli",ft.dirname(e)));let i=await(0,qC.default)(process.execPath,[ft.join(o,r),"--config",e,"--list-configuration"],{env:{...process.env,ELECTRON_RUN_AS_NODE:"1"}}),s=JSON.parse(i.stdout);if(s.length===1)return s[0];if(s.length&&!t&&(t=await zC.window.showQuickPick(s.map((c,l)=>c.config.label||String(l)),{title:Bf.t("Select test configuration to run")}),!t))throw new Rt("cancelled");let a=s.find((c,l)=>c.config.label===t||String(l)===t);if(!a)throw new Error(Bf.t("Cannot find test configuration with label `{0}`, got: {1}",String(t),s.map((c,l)=>c.config.label||l).join(", ")));return a}});var _w,GC,Aw=m(()=>{"use strict";_w=require("vscode"),GC=async n=>{try{return await _w.commands.executeCommand("npm.scriptRunner",n?.uri)}catch{try{return await _w.commands.executeCommand("npm.packageManager",n?.uri)}catch{return"npm"}}}});async function QC(n,e=!1){let t=n??ze.workspace.workspaceFolders??[];if(!t||t.length===0){e||ze.window.showErrorMessage(Bc.t("You need to open a workspace folder to debug npm scripts."));return}let r=(await Promise.all(t.map(s=>ze.workspace.findFiles(new ze.RelativePattern(s,"**/package.json"),"**/{node_modules,.vscode-test}/**")))).flat();if(r.length===0){e||ze.window.showErrorMessage(Bc.t("No package.json files found in your workspace."));return}let o=[],i={path:r[0].fsPath,score:0};for(let{fsPath:s}of new Set(r)){i=Fw(i,{path:s,score:1});let a;try{a=JSON.parse(await xr(s))}catch(c){e||JC("showWarningMessage",Bc.t("Could not read {0}: {1}",s,c.message),s),i=Fw(i,{path:void 0,score:3});continue}if(i=Fw(i,{path:void 0,score:2}),!!a.scripts)for(let c of Object.keys(a.scripts))o.push({directory:Mw.dirname(s),name:c,command:a.scripts[c]})}if(o.length===0){i.path&&!e&&JC("showErrorMessage",Bc.t("No npm scripts found in your package.json"),i.path);return}return o.sort((s,a)=>(s.name==="start"?-1:0)+(a.name==="start"?1:0)),o}async function JC(n,e,t){let r=Bc.t("Edit package.json");if(await ze.window[n](e,r)!==r)return;if(KC.existsSync(t)){let a=await ze.workspace.openTextDocument(t);await ze.window.showTextDocument(a);return}let o=await ze.workspace.openTextDocument(ze.Uri.file(t).with({scheme:"untitled"})),i=await ze.window.showTextDocument(o);await i.edit(a=>a.insert(new ze.Position(0,0),Y_));let s=new ze.Position(2,5);i.selection=new ze.Selection(s,s)}var Bc,KC,Mw,ze,Fw,Y_,XC=m(()=>{"use strict";Bc=y(require("@vscode/l10n")),KC=y(require("fs")),Mw=y(require("path")),ze=y(require("vscode"));W();de();Aw();Fw=(n,e)=>n.score>e.score?n:e;Y_=`{
  "scripts": {
    
  }
}
`});var Hp,Nw,yi,zp,jc,Z_,Uc,YC=m(()=>{"use strict";Hp=y(require("@vscode/l10n")),Nw=require("inversify"),yi=y(require("path")),zp=y(require("vscode"));W();U();J();XC();Aw();ww();_c();jc=class extends cn{provide(e){return xw(e,!0)}getType(){return"pwa-node"}getTriggerKind(){return zp.DebugConfigurationProviderTriggerKind.Initial}};jc=h([(0,Nw.injectable)()],jc);Z_=["cwd","program"],Uc=class extends cn{async provide(e){let t=Go(await Promise.all([this.getFromNpmScripts(e),this.getFromActiveFile()]));if(e)for(let r of t){let o=r;for(let i of Z_){let s=o[i];s&&yi.isAbsolute(s)&&(o[i]=yi.join("${workspaceFolder}",yi.relative(e.uri.fsPath,s)))}}return t}getType(){return"pwa-node"}getTriggerKind(){return zp.DebugConfigurationProviderTriggerKind.Dynamic}async getFromNpmScripts(e){let t={type:En("node-terminal"),name:Hp.t("JavaScript Debug Terminal"),request:"launch",cwd:e?.uri.fsPath};if(!e)return[t];let r=await QC([e],!0);if(!r)return[t];let o=await GC(e),i=r.some(s=>s.directory!==r[0].directory);return r.map(s=>({type:En("node-terminal"),name:i?Hp.t("Run Script: {0} ({1})",s.name,yi.basename(s.directory)):Hp.t("Run Script: {0}",s.name),request:"launch",command:`${o} run ${s.name}`,cwd:s.directory})).concat(t)}getFromActiveFile(){let e=zp.window.activeTextEditor;return!e||!Yu.includes(e.document.languageId)||e.document.uri.scheme!=="file"?[]:[{type:En("pwa-node"),name:Hp.t("Run Current File"),request:"launch",program:e.document.uri.fsPath}]}};Uc=h([(0,Nw.injectable)()],Uc)});var ZC,eT,tT=m(()=>{"use strict";TC();WC();$C();Ew();YC();_c();Cw();ZC=[Nc,Oc,wi,Uo,Ac],eT=[Cs,Ts,jc,Uc]});async function rT(n,e=1e3){return Promise.race([nT.lookup(n),x(e)])}async function oT(n,e){if(n){try{let t=new jf.URL(n);if(t.hostname)return await rT(t.hostname),n}catch{}try{let t=`http://${n}`,r=new jf.URL(t);if(await rT(r.hostname),!e||r.port)return t}catch{}}}var Wc,nT,Gp,jf,or,Vc,iT=m(()=>{"use strict";Wc=y(require("@vscode/l10n")),nT=y(require("dns/promises")),Gp=require("inversify"),jf=require("url"),or=y(require("vscode"));W();Lm();$();X();Vc=class{constructor(e,t){this.defaultBrowser=e;this.context=t}register(e){e.subscriptions.push(or.commands.registerCommand("extension.js-debug.debugLink",t=>this.handle(t)))}async handle(e){if(e=e??await this.getLinkFromTextEditor()??await this.getLinkFromQuickInput(),!e)return;let t="pwa-chrome";try{await this.defaultBrowser.lookup()==="edge"&&(t="pwa-msedge")}catch{}let r=Ht(or.workspace,"debug.javascript.debugByLinkOptions")??{},o={...typeof r=="string"?{}:r,type:En(t),name:e,request:"launch",url:e};or.debug.startDebugging(or.workspace.workspaceFolders?.[0],o),this.persistConfig(o)}getLinkFromTextEditor(){let e=or.window.activeTextEditor;if(e)return oT(e.document.getText(e.selection),!0)}async getLinkFromQuickInput(){let e=await or.env.clipboard.readText(),t=await or.window.showInputBox({value:await oT(e,!1)||this.mostRecentLink,placeHolder:"https://localhost:8080",validateInput:r=>{if(r&&!jf.URL.canParse(r))return Wc.t("The URL provided is invalid")}});if(t)return this.mostRecentLink=t,t}async persistConfig(e){if(this.context.globalState.get("saveDebugLinks")===!1)return;let t=or.workspace.getConfiguration("launch"),r=t.get("configurations")??[];if(r.some(a=>a.url===e.url))return;let o=Wc.t("Yes"),i=Wc.t("Never"),s=await or.window.showInformationMessage(Wc.t("Would you like to save a configuration in your launch.json for easy access later?"),o,Wc.t("No"),i);s===i&&this.context.globalState.update("saveDebugLinks",!1),s===o&&await t.update("configurations",[...r,e])}};Vc=h([(0,Gp.injectable)(),d(0,(0,Gp.inject)(Ja)),d(1,(0,Gp.inject)(Oe))],Vc)});var $c,Hc,yr,sT,qc,aT=m(()=>{"use strict";$c=y(require("@vscode/l10n")),Hc=require("inversify"),yr=y(require("vscode"));W();X();jo();sT="neverRemind",qc=class{constructor(e,t,r){this.fs=e;this.context=t;this.tracker=r;this.dismissedForSession=!1;this.isPrompting=!1}register(e){e.subscriptions.push(Ce(yr.commands,"extension.js-debug.getDiagnosticLogs",async()=>{let t=await this.getTargetSession();if(!t)return;let r=await yr.window.showSaveDialog({filters:{JSON:["json"]}});r&&t.customRequest("saveDiagnosticLogs",{toFile:r.fsPath})}),Ce(yr.commands,"extension.js-debug.createDiagnostics",async()=>this.getDiagnosticInfo(await this.getTargetSession())),yr.debug.onDidReceiveDebugSessionCustomEvent(async t=>{if(t.event==="openDiagnosticTool")return this.openDiagnosticTool(t.body.file);if(t.event!=="suggestDiagnosticTool"||this.dismissedForSession||this.context.workspaceState.get(sT)||this.isPrompting)return;this.isPrompting=!0;let r=$c.t("Yes"),o=$c.t("Not Now"),i=$c.t("Never"),s=await yr.window.showInformationMessage("It looks like you might be having trouble with breakpoints. Would you like to open our diagnostic tool?",r,o,i);switch(this.isPrompting=!1,s){case r:this.getDiagnosticInfo(await this.getTargetSession(),!0);break;case i:e.workspaceState.update(sT,!0);break;case o:this.dismissedForSession=!0;break}}))}getTargetSession(){let e=yr.debug.activeDebugSession;if(!e||!_n(e?.type))return this.pickSession();if(Re.isConcreteSession(e))return e;let t=this.tracker.getChildren(e);return t.length===1?t[0]:this.pickSession()}pickSession(){return Re.pickSession(this.tracker.getConcreteSessions(),$c.t("Select the session you want to inspect:"))}async getDiagnosticInfo(e,t=!1){if(!e||!this.tracker.isRunning(e)){yr.window.showErrorMessage($c.t('It looks like your debug session has already ended. Try debugging again, then run the "Debug: Diagnose Breakpoint Problems" command.'));return}let{file:r}=await e.customRequest("createDiagnostics",{fromSuggestion:t});await this.openDiagnosticTool(r)}async openDiagnosticTool(e){let t=yr.window.createWebviewPanel("jsDebugDiagnostics","Debug Diagnostics",yr.ViewColumn.Active,{enableScripts:!0});t.webview.html=await this.fs.readFile(e,"utf-8")}};qc=h([(0,Hc.injectable)(),d(0,(0,Hc.inject)(oe)),d(1,(0,Hc.inject)(Oe)),d(2,(0,Hc.inject)(Re))],qc)});var zc,cT,Hr,Rs,lT=m(()=>{"use strict";zc=y(require("@vscode/l10n")),cT=require("inversify"),Hr=y(require("vscode"));W();Rs=class{register(e){e.subscriptions.push(Hr.debug.onDidReceiveDebugSessionCustomEvent(t=>{if(t.event!=="suggestDisableSourcemap"||!_n(t.session.type))return;let r=t.body;this.unmap(t.session,r.source).catch(o=>Hr.window.showErrorMessage(o.message))}))}async unmap(e,t){(Ht(Hr.workspace,"debug.javascript.unmapMissingSources")||await this.prompt())&&await e.customRequest("disableSourcemap",{source:t})}async prompt(){let e=zc.t("Always"),t=zc.t("Always in this Workspace"),r=zc.t("Yes");switch(await Hr.window.showInformationMessage(zc.t("This is a missing file path referenced by a sourcemap. Would you like to debug the compiled version instead?"),e,t,zc.t("No"),r)){case e:return eh(Hr.workspace,"debug.javascript.unmapMissingSources",!0,Hr.ConfigurationTarget.Global),!0;case t:return eh(Hr.workspace,"debug.javascript.unmapMissingSources",!0,Hr.ConfigurationTarget.Workspace),!0;case r:return!0;default:return!1}}};Rs=h([(0,cT.injectable)()],Rs)});var Ds,Uf,so,pT,uT,Gc,dT=m(()=>{"use strict";Ds=y(require("@vscode/l10n")),Uf=require("inversify"),so=y(require("vscode"));X();pT="ms-vscode.wasm-dwarf-debugging",uT="dwarf.neverRemind",Gc=class{constructor(e){this.context=e;this.didPromptForSession=this.context.workspaceState.get(uT,!1)}async load(){try{return await import("@vscode/dwarf-debugging")}catch{}let e=so.extensions.getExtension(pT);if(e)return e.isActive||await e.activate(),e.exports}async prompt(){if(this.didPromptForSession)return;this.didPromptForSession=!0;let e=Ds.t("Yes"),t=Ds.t("Never"),r=await so.window.showInformationMessage(Ds.t({message:'VS Code can provide better debugging experience for WebAssembly via "DWARF Debugging" extension. Would you like to install it?',comment:'"DWARF Debugging" is the extension name and should not be localized.'}),e,Ds.t("Not Now"),t);r===e?this.install():r===t&&this.context.workspaceState.update(uT,!0)}async install(){await so.window.withProgress({location:so.ProgressLocation.Notification,title:Ds.t("Installing the DWARF debugger...")},async()=>{try{await so.commands.executeCommand("workbench.extensions.installExtension",pT),so.window.showInformationMessage(Ds.t("Installation complete! The extension will be used after you restart your debug session."))}catch(e){so.window.showErrorMessage(e.message||String(e))}})}};Gc=h([(0,Uf.injectable)(),d(0,(0,Uf.inject)(Oe))],Gc)});function oA(n){let e=n;for(;e.parentSession;)e=e.parentSession;return e}var fT,Wf,vi,mT,tA,rA,Jc,gT=m(()=>{"use strict";fT=y(require("@vscode/l10n")),Wf=require("inversify"),vi=y(require("vscode"));W();kn();jo();mT=n=>{if(n?.type!=="pwa-msedge")return!1;let e=n.configuration.__browserTargetType;return e==="iframe"||e==="page"},tA="ms-edgedevtools.vscode-edge-devtools",rA="vscode-edge-devtools.attachToCurrentDebugTarget";Jc=class{constructor(e){this.tracker=e}register(e){e.subscriptions.push(Ce(vi.commands,"extension.js-debug.openEdgeDevTools",async()=>{let t=vi.debug.activeDebugSession&&mT(vi.debug.activeDebugSession)?vi.debug.activeDebugSession:await Re.pickSession(this.tracker.getConcreteSessions().filter(mT),fT.t("Select the page where you want to open the devtools"));if(!t)return;let r=oA(t);try{return await vi.commands.executeCommand(rA,t.id,r.configuration)}catch(o){if(o instanceof Error&&/command .+ not found/.test(o.message))return vi.commands.executeCommand("workbench.extensions.action.showExtensionsWithIds",[tA]);throw o}}))}};Jc=h([(0,Wf.injectable)(),d(0,(0,Wf.inject)(Re))],Jc)});var yT,Vf,vT,Ee,hT,bT,wT,Ow,Kc,IT=m(()=>{"use strict";yT=require("crypto"),Vf=require("inversify"),vT=require("path"),Ee=y(require("vscode"));W();jo();hT=({name:n,line:e,column:t,source:r})=>`${n} (${(0,vT.basename)(String(r.path))}:${e}:${t})`,bT=({name:n,line:e,column:t,source:r})=>`${n} (${r.path}:${e}:${t})`,wT=async({line:n,column:e,source:t})=>{if(t.sourceReference!==0||!t.path)return;let r=Ee.Uri.file(t.path),o=await Ee.workspace.openTextDocument(r),i=await Ee.window.showTextDocument(o),s=new Ee.Position(n-1,e-1);i.revealRange(new Ee.Range(s,s)),i.selection=new Ee.Selection(s,s)},Ow=class{constructor(e,t){this.caller=e;this.target=t;this.treeItem=new Ee.TreeItem(`${hT(e)} \u2192 ${hT(t)}`,Ee.TreeItemCollapsibleState.None),this.treeItem.tooltip=`Breaks at ${bT(t)} containing ${bT(e)} will be skipped`,this.id=this.treeItem.id=(0,yT.createHash)("sha256").update(JSON.stringify([e,t])).digest("base64")}toDap(){return{caller:this.caller,target:this.target}}},Kc=class{constructor(e){this.sessionTracker=e;this._onDidChangeTreeData=new Ee.EventEmitter;this.allCallers=new Map;this.lastHadCallers=!1;this.onDidChangeTreeData=this._onDidChangeTreeData.event}register(e){e.subscriptions.push(Ee.window.createTreeView("jsExcludedCallers",{treeDataProvider:this}),Ce(Ee.commands,"extension.js-debug.callers.add",async(t,r)=>{let o=await this.sessionTracker.getById(r.sessionId)?.customRequest("stackTrace",{threadId:0,startFrame:0,levels:1});if(!o?.stackFrames.length)return;let i=o.stackFrames[0],s=new Ow({name:r.frameName,column:r.frameLocation.range.startColumn,line:r.frameLocation.range.startLineNumber,source:r.frameLocation.source},{name:i.name,column:i.column,line:i.line,source:i.source});this.allCallers.set(s.id,s),this.triggerUpdate()}),Ce(Ee.commands,"extension.js-debug.callers.goToCaller",t=>wT(t.caller)),Ce(Ee.commands,"extension.js-debug.callers.gotToTarget",t=>wT(t.target)),Ce(Ee.commands,"extension.js-debug.callers.remove",async t=>{this.allCallers.delete(t.id),this.triggerUpdate()}),Ce(Ee.commands,"extension.js-debug.callers.removeAll",()=>{this.allCallers.clear(),this.triggerUpdate()}),this.sessionTracker.onSessionAdded(t=>{this.allCallers.size>0&&this.sendCallersToSession(t)}))}getTreeItem(e){return e.treeItem}getChildren(e){return e?[]:[...this.allCallers.values()]}sendCallersToSession(e){e.customRequest("setExcludedCallers",{callers:[...this.allCallers.values()].map(t=>t.toDap())})}triggerUpdate(){this._onDidChangeTreeData.fire(void 0);for(let t of this.sessionTracker.getConcreteSessions())this.sendCallersToSession(t);let e=this.allCallers.size>0;e!==this.lastHadCallers&&(An(Ee.commands,"jsDebugHasExcludedCallers",e),this.lastHadCallers=e)}};Kc=h([(0,Vf.injectable)(),d(0,(0,Vf.inject)(Re))],Kc)});var $f,Qc,ST=m(()=>{"use strict";$f=require("inversify");X();Qc=class{constructor(e){this.debugTerminalOptionsProviders=e}create(){return{registerDebugTerminalOptionsProvider:e=>(this.debugTerminalOptionsProviders.add(e),{dispose:()=>this.debugTerminalOptionsProviders.delete(e)})}}};Qc=h([(0,$f.injectable)(),d(0,(0,$f.inject)(pa))],Qc)});function Ls(n,e=!1){let t=n.length,r=0,o="",i=0,s=16,a=0,c=0,l=0,p=0,u=0;function g(R,Z){let M=0,N=0;for(;M<R||!Z;){let C=n.charCodeAt(r);if(C>=48&&C<=57)N=N*16+C-48;else if(C>=65&&C<=70)N=N*16+C-65+10;else if(C>=97&&C<=102)N=N*16+C-97+10;else break;r++,M++}return M<R&&(N=-1),N}function w(R){r=R,o="",i=0,s=16,u=0}function I(){let R=r;if(n.charCodeAt(r)===48)r++;else for(r++;r<n.length&&Xc(n.charCodeAt(r));)r++;if(r<n.length&&n.charCodeAt(r)===46)if(r++,r<n.length&&Xc(n.charCodeAt(r)))for(r++;r<n.length&&Xc(n.charCodeAt(r));)r++;else return u=3,n.substring(R,r);let Z=r;if(r<n.length&&(n.charCodeAt(r)===69||n.charCodeAt(r)===101))if(r++,(r<n.length&&n.charCodeAt(r)===43||n.charCodeAt(r)===45)&&r++,r<n.length&&Xc(n.charCodeAt(r))){for(r++;r<n.length&&Xc(n.charCodeAt(r));)r++;Z=r}else u=3;return n.substring(R,Z)}function v(){let R="",Z=r;for(;;){if(r>=t){R+=n.substring(Z,r),u=2;break}let M=n.charCodeAt(r);if(M===34){R+=n.substring(Z,r),r++;break}if(M===92){if(R+=n.substring(Z,r),r++,r>=t){u=2;break}switch(n.charCodeAt(r++)){case 34:R+='"';break;case 92:R+="\\";break;case 47:R+="/";break;case 98:R+="\b";break;case 102:R+="\f";break;case 110:R+=`
`;break;case 114:R+="\r";break;case 116:R+="	";break;case 117:let C=g(4,!0);C>=0?R+=String.fromCharCode(C):u=4;break;default:u=5}Z=r;continue}if(M>=0&&M<=31)if(Jp(M)){R+=n.substring(Z,r),u=2;break}else u=6;r++}return R}function A(){if(o="",u=0,i=r,c=a,p=l,r>=t)return i=t,s=17;let R=n.charCodeAt(r);if(Bw(R)){do r++,o+=String.fromCharCode(R),R=n.charCodeAt(r);while(Bw(R));return s=15}if(Jp(R))return r++,o+=String.fromCharCode(R),R===13&&n.charCodeAt(r)===10&&(r++,o+=`
`),a++,l=r,s=14;switch(R){case 123:return r++,s=1;case 125:return r++,s=2;case 91:return r++,s=3;case 93:return r++,s=4;case 58:return r++,s=6;case 44:return r++,s=5;case 34:return r++,o=v(),s=10;case 47:let Z=r-1;if(n.charCodeAt(r+1)===47){for(r+=2;r<t&&!Jp(n.charCodeAt(r));)r++;return o=n.substring(Z,r),s=12}if(n.charCodeAt(r+1)===42){r+=2;let M=t-1,N=!1;for(;r<M;){let C=n.charCodeAt(r);if(C===42&&n.charCodeAt(r+1)===47){r+=2,N=!0;break}r++,Jp(C)&&(C===13&&n.charCodeAt(r)===10&&r++,a++,l=r)}return N||(r++,u=1),o=n.substring(Z,r),s=13}return o+=String.fromCharCode(R),r++,s=16;case 45:if(o+=String.fromCharCode(R),r++,r===t||!Xc(n.charCodeAt(r)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return o+=I(),s=11;default:for(;r<t&&z(R);)r++,R=n.charCodeAt(r);if(i!==r){switch(o=n.substring(i,r),o){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return o+=String.fromCharCode(R),r++,s=16}}function z(R){if(Bw(R)||Jp(R))return!1;switch(R){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function De(){let R;do R=A();while(R>=12&&R<=15);return R}return{setPosition:w,getPosition:()=>r,scan:e?De:A,getToken:()=>s,getTokenValue:()=>o,getTokenOffset:()=>i,getTokenLength:()=>r-i,getTokenStartLine:()=>c,getTokenStartCharacter:()=>i-p,getTokenError:()=>u}}function Bw(n){return n===32||n===9}function Jp(n){return n===10||n===13}function Xc(n){return n>=48&&n<=57}var kT,qf=m(()=>{"use strict";(function(n){n[n.lineFeed=10]="lineFeed",n[n.carriageReturn=13]="carriageReturn",n[n.space=32]="space",n[n._0=48]="_0",n[n._1=49]="_1",n[n._2=50]="_2",n[n._3=51]="_3",n[n._4=52]="_4",n[n._5=53]="_5",n[n._6=54]="_6",n[n._7=55]="_7",n[n._8=56]="_8",n[n._9=57]="_9",n[n.a=97]="a",n[n.b=98]="b",n[n.c=99]="c",n[n.d=100]="d",n[n.e=101]="e",n[n.f=102]="f",n[n.g=103]="g",n[n.h=104]="h",n[n.i=105]="i",n[n.j=106]="j",n[n.k=107]="k",n[n.l=108]="l",n[n.m=109]="m",n[n.n=110]="n",n[n.o=111]="o",n[n.p=112]="p",n[n.q=113]="q",n[n.r=114]="r",n[n.s=115]="s",n[n.t=116]="t",n[n.u=117]="u",n[n.v=118]="v",n[n.w=119]="w",n[n.x=120]="x",n[n.y=121]="y",n[n.z=122]="z",n[n.A=65]="A",n[n.B=66]="B",n[n.C=67]="C",n[n.D=68]="D",n[n.E=69]="E",n[n.F=70]="F",n[n.G=71]="G",n[n.H=72]="H",n[n.I=73]="I",n[n.J=74]="J",n[n.K=75]="K",n[n.L=76]="L",n[n.M=77]="M",n[n.N=78]="N",n[n.O=79]="O",n[n.P=80]="P",n[n.Q=81]="Q",n[n.R=82]="R",n[n.S=83]="S",n[n.T=84]="T",n[n.U=85]="U",n[n.V=86]="V",n[n.W=87]="W",n[n.X=88]="X",n[n.Y=89]="Y",n[n.Z=90]="Z",n[n.asterisk=42]="asterisk",n[n.backslash=92]="backslash",n[n.closeBrace=125]="closeBrace",n[n.closeBracket=93]="closeBracket",n[n.colon=58]="colon",n[n.comma=44]="comma",n[n.dot=46]="dot",n[n.doubleQuote=34]="doubleQuote",n[n.minus=45]="minus",n[n.openBrace=123]="openBrace",n[n.openBracket=91]="openBracket",n[n.plus=43]="plus",n[n.slash=47]="slash",n[n.formFeed=12]="formFeed",n[n.tab=9]="tab"})(kT||(kT={}))});var vr,Yc,jw,PT,xT=m(()=>{vr=new Array(20).fill(0).map((n,e)=>" ".repeat(e)),Yc=200,jw={" ":{"\n":new Array(Yc).fill(0).map((n,e)=>`
`+" ".repeat(e)),"\r":new Array(Yc).fill(0).map((n,e)=>"\r"+" ".repeat(e)),"\r\n":new Array(Yc).fill(0).map((n,e)=>`\r
`+" ".repeat(e))},"	":{"\n":new Array(Yc).fill(0).map((n,e)=>`
`+"	".repeat(e)),"\r":new Array(Yc).fill(0).map((n,e)=>"\r"+"	".repeat(e)),"\r\n":new Array(Yc).fill(0).map((n,e)=>`\r
`+"	".repeat(e))}},PT=[`
`,"\r",`\r
`]});function Hf(n,e,t){let r,o,i,s,a;if(e){for(s=e.offset,a=s+e.length,i=s;i>0&&!Kp(n,i-1);)i--;let M=a;for(;M<n.length&&!Kp(n,M);)M++;o=n.substring(i,M),r=sA(o,t)}else o=n,r=0,i=0,s=0,a=n.length;let c=aA(t,n),l=PT.includes(c),p=0,u=0,g;t.insertSpaces?g=vr[t.tabSize||4]??Zc(vr[1],t.tabSize||4):g="	";let w=g==="	"?"	":" ",I=Ls(o,!1),v=!1;function A(){if(p>1)return Zc(c,p)+Zc(g,r+u);let M=g.length*(r+u);return!l||M>jw[w][c].length?c+Zc(g,r+u):M<=0?c:jw[w][c][M]}function z(){let M=I.scan();for(p=0;M===15||M===14;)M===14&&t.keepLines?p+=1:M===14&&(p=1),M=I.scan();return v=M===16||I.getTokenError()!==0,M}let De=[];function R(M,N,C){!v&&(!e||N<a&&C>s)&&n.substring(N,C)!==M&&De.push({offset:N,length:C-N,content:M})}let Z=z();if(t.keepLines&&p>0&&R(Zc(c,p),0,0),Z!==17){let M=I.getTokenOffset()+i,N=g.length*r<20&&t.insertSpaces?vr[g.length*r]:Zc(g,r);R(N,i,M)}for(;Z!==17;){let M=I.getTokenOffset()+I.getTokenLength()+i,N=z(),C="",ke=!1;for(;p===0&&(N===12||N===13);){let xi=I.getTokenOffset()+i;R(vr[1],M,xi),M=I.getTokenOffset()+I.getTokenLength()+i,ke=N===12,C=ke?A():"",N=z()}if(N===2)Z!==1&&u--,t.keepLines&&p>0||!t.keepLines&&Z!==1?C=A():t.keepLines&&(C=vr[1]);else if(N===4)Z!==3&&u--,t.keepLines&&p>0||!t.keepLines&&Z!==3?C=A():t.keepLines&&(C=vr[1]);else{switch(Z){case 3:case 1:u++,t.keepLines&&p>0||!t.keepLines?C=A():C=vr[1];break;case 5:t.keepLines&&p>0||!t.keepLines?C=A():C=vr[1];break;case 12:C=A();break;case 13:p>0?C=A():ke||(C=vr[1]);break;case 6:t.keepLines&&p>0?C=A():ke||(C=vr[1]);break;case 10:t.keepLines&&p>0?C=A():N===6&&!ke&&(C="");break;case 7:case 8:case 9:case 11:case 2:case 4:t.keepLines&&p>0?C=A():(N===12||N===13)&&!ke?C=vr[1]:N!==5&&N!==17&&(v=!0);break;case 16:v=!0;break}p>0&&(N===12||N===13)&&(C=A())}N===17&&(t.keepLines&&p>0?C=A():C=t.insertFinalNewline?c:"");let mo=I.getTokenOffset()+i;R(C,M,mo),Z=N}return De}function Zc(n,e){let t="";for(let r=0;r<e;r++)t+=n;return t}function sA(n,e){let t=0,r=0,o=e.tabSize||4;for(;t<n.length;){let i=n.charAt(t);if(i===vr[1])r++;else if(i==="	")r+=o;else break;t++}return Math.floor(r/o)}function aA(n,e){for(let t=0;t<e.length;t++){let r=e.charAt(t);if(r==="\r")return t+1<e.length&&e.charAt(t+1)===`
`?`\r
`:"\r";if(r===`
`)return`
`}return n&&n.eol||`
`}function Kp(n,e){return`\r
`.indexOf(n.charAt(e))!==-1}var Uw=m(()=>{"use strict";qf();xT()});function CT(n,e){let t=[],r=new Object,o,i={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(c,l,p,u){i.value=c,i.offset=l,i.length=p,i.type=u,i.colonOffset=void 0,o=i}try{Yp(n,{onObjectBegin:(c,l)=>{if(e<=c)throw r;o=void 0,s=e>c,t.push("")},onObjectProperty:(c,l,p)=>{if(e<l||(a(c,l,p,"property"),t[t.length-1]=c,e<=l+p))throw r},onObjectEnd:(c,l)=>{if(e<=c)throw r;o=void 0,t.pop()},onArrayBegin:(c,l)=>{if(e<=c)throw r;o=void 0,t.push(0)},onArrayEnd:(c,l)=>{if(e<=c)throw r;o=void 0,t.pop()},onLiteralValue:(c,l,p)=>{if(e<l||(a(c,l,p,DT(c)),e<=l+p))throw r},onSeparator:(c,l,p)=>{if(e<=l)throw r;if(c===":"&&o&&o.type==="property")o.colonOffset=l,s=!1,o=void 0;else if(c===","){let u=t[t.length-1];typeof u=="number"?t[t.length-1]=u+1:(s=!0,t[t.length-1]=""),o=void 0}}})}catch(c){if(c!==r)throw c}return{path:t,previousNode:o,isAtPropertyKey:s,matches:c=>{let l=0;for(let p=0;l<c.length&&p<t.length;p++)if(c[l]===t[p]||c[l]==="*")l++;else if(c[l]!=="**")return!1;return l===c.length}}}function TT(n,e=[],t=Qp.DEFAULT){let r=null,o=[],i=[];function s(c){Array.isArray(o)?o.push(c):r!==null&&(o[r]=c)}return Yp(n,{onObjectBegin:()=>{let c={};s(c),i.push(o),o=c,r=null},onObjectProperty:c=>{r=c},onObjectEnd:()=>{o=i.pop()},onArrayBegin:()=>{let c=[];s(c),i.push(o),o=c,r=null},onArrayEnd:()=>{o=i.pop()},onLiteralValue:s,onError:(c,l,p)=>{e.push({error:c,offset:l,length:p})}},t),o[0]}function Gf(n,e=[],t=Qp.DEFAULT){let r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function o(c){r.type==="property"&&(r.length=c-r.offset,r=r.parent)}function i(c){return r.children.push(c),c}Yp(n,{onObjectBegin:c=>{r=i({type:"object",offset:c,length:-1,parent:r,children:[]})},onObjectProperty:(c,l,p)=>{r=i({type:"property",offset:l,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:c,offset:l,length:p,parent:r})},onObjectEnd:(c,l)=>{o(c+l),r.length=c+l-r.offset,r=r.parent,o(c+l)},onArrayBegin:(c,l)=>{r=i({type:"array",offset:c,length:-1,parent:r,children:[]})},onArrayEnd:(c,l)=>{r.length=c+l-r.offset,r=r.parent,o(c+l)},onLiteralValue:(c,l,p)=>{i({type:DT(c),offset:l,length:p,parent:r,value:c}),o(l+p)},onSeparator:(c,l,p)=>{r.type==="property"&&(c===":"?r.colonOffset=l:c===","&&o(l))},onError:(c,l,p)=>{e.push({error:c,offset:l,length:p})}},t);let a=r.children[0];return a&&delete a.parent,a}function Xp(n,e){if(!n)return;let t=n;for(let r of e)if(typeof r=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;let o=!1;for(let i of t.children)if(Array.isArray(i.children)&&i.children[0].value===r&&i.children.length===2){t=i.children[1],o=!0;break}if(!o)return}else{let o=r;if(t.type!=="array"||o<0||!Array.isArray(t.children)||o>=t.children.length)return;t=t.children[o]}return t}function Ww(n){if(!n.parent||!n.parent.children)return[];let e=Ww(n.parent);if(n.parent.type==="property"){let t=n.parent.children[0].value;e.push(t)}else if(n.parent.type==="array"){let t=n.parent.children.indexOf(n);t!==-1&&e.push(t)}return e}function zf(n){switch(n.type){case"array":return n.children.map(zf);case"object":let e=Object.create(null);for(let t of n.children){let r=t.children[1];r&&(e[t.children[0].value]=zf(r))}return e;case"null":case"string":case"number":case"boolean":return n.value;default:return}}function lA(n,e,t=!1){return e>=n.offset&&e<n.offset+n.length||t&&e===n.offset+n.length}function Vw(n,e,t=!1){if(lA(n,e,t)){let r=n.children;if(Array.isArray(r))for(let o=0;o<r.length&&r[o].offset<=e;o++){let i=Vw(r[o],e,t);if(i)return i}return n}}function Yp(n,e,t=Qp.DEFAULT){let r=Ls(n,!1),o=[],i=0;function s(ue){return ue?()=>i===0&&ue(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter()):()=>!0}function a(ue){return ue?nt=>i===0&&ue(nt,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter()):()=>!0}function c(ue){return ue?nt=>i===0&&ue(nt,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter(),()=>o.slice()):()=>!0}function l(ue){return ue?()=>{i>0?i++:ue(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter(),()=>o.slice())===!1&&(i=1)}:()=>!0}function p(ue){return ue?()=>{i>0&&i--,i===0&&ue(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:()=>!0}let u=l(e.onObjectBegin),g=c(e.onObjectProperty),w=p(e.onObjectEnd),I=l(e.onArrayBegin),v=p(e.onArrayEnd),A=c(e.onLiteralValue),z=a(e.onSeparator),De=s(e.onComment),R=a(e.onError),Z=t&&t.disallowComments,M=t&&t.allowTrailingComma;function N(){for(;;){let ue=r.scan();switch(r.getTokenError()){case 4:C(14);break;case 5:C(15);break;case 3:C(13);break;case 1:Z||C(11);break;case 2:C(12);break;case 6:C(16);break}switch(ue){case 12:case 13:Z?C(10):De();break;case 16:C(1);break;case 15:case 14:break;default:return ue}}}function C(ue,nt=[],Ey=[]){if(R(ue),nt.length+Ey.length>0){let wu=r.getToken();for(;wu!==17;){if(nt.indexOf(wu)!==-1){N();break}else if(Ey.indexOf(wu)!==-1)break;wu=N()}}}function ke(ue){let nt=r.getTokenValue();return ue?A(nt):(g(nt),o.push(nt)),N(),!0}function mo(){switch(r.getToken()){case 11:let ue=r.getTokenValue(),nt=Number(ue);isNaN(nt)&&(C(2),nt=0),A(nt);break;case 7:A(null);break;case 8:A(!0);break;case 9:A(!1);break;default:return!1}return N(),!0}function xi(){return r.getToken()!==10?(C(3,[],[2,5]),!1):(ke(!1),r.getToken()===6?(z(":"),N(),Rg()||C(4,[],[2,5])):C(5,[],[2,5]),o.pop(),!0)}function Tg(){u(),N();let ue=!1;for(;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(ue||C(4,[],[]),z(","),N(),r.getToken()===2&&M)break}else ue&&C(6,[],[]);xi()||C(4,[],[2,5]),ue=!0}return w(),r.getToken()!==2?C(7,[2],[]):N(),!0}function ZD(){I(),N();let ue=!0,nt=!1;for(;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(nt||C(4,[],[]),z(","),N(),r.getToken()===4&&M)break}else nt&&C(6,[],[]);ue?(o.push(0),ue=!1):o[o.length-1]++,Rg()||C(4,[],[4,5]),nt=!0}return v(),ue||o.pop(),r.getToken()!==4?C(8,[4],[]):N(),!0}function Rg(){switch(r.getToken()){case 3:return ZD();case 1:return Tg();case 10:return ke(!0);default:return mo()}}return N(),r.getToken()===17?t.allowEmptyContent?!0:(C(4,[],[]),!1):Rg()?(r.getToken()!==17&&C(9,[],[]),!0):(C(4,[],[]),!1)}function RT(n,e){let t=Ls(n),r=[],o,i=0,s;do switch(s=t.getPosition(),o=t.scan(),o){case 12:case 13:case 17:i!==s&&r.push(n.substring(i,s)),e!==void 0&&r.push(t.getTokenValue().replace(/[^\r\n]/g,e)),i=t.getPosition();break}while(o!==17);return r.join("")}function DT(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var Qp,$w=m(()=>{"use strict";qf();(function(n){n.DEFAULT={allowTrailingComma:!1}})(Qp||(Qp={}))});function LT(n,e,t,r){let o=e.slice(),s=Gf(n,[]),a,c;for(;o.length>0&&(c=o.pop(),a=Xp(s,o),a===void 0&&t!==void 0);)typeof c=="string"?t={[c]:t}:t=[t];if(a)if(a.type==="object"&&typeof c=="string"&&Array.isArray(a.children)){let l=Xp(a,[c]);if(l!==void 0)if(t===void 0){if(!l.parent)throw new Error("Malformed AST");let p=a.children.indexOf(l.parent),u,g=l.parent.offset+l.parent.length;if(p>0){let w=a.children[p-1];u=w.offset+w.length}else u=a.offset+1,a.children.length>1&&(g=a.children[1].offset);return Es(n,{offset:u,length:g-u,content:""},r)}else return Es(n,{offset:l.offset,length:l.length,content:JSON.stringify(t)},r);else{if(t===void 0)return[];let p=`${JSON.stringify(c)}: ${JSON.stringify(t)}`,u=r.getInsertionIndex?r.getInsertionIndex(a.children.map(w=>w.children[0].value)):a.children.length,g;if(u>0){let w=a.children[u-1];g={offset:w.offset+w.length,length:0,content:","+p}}else a.children.length===0?g={offset:a.offset+1,length:0,content:p}:g={offset:a.offset+1,length:0,content:p+","};return Es(n,g,r)}}else if(a.type==="array"&&typeof c=="number"&&Array.isArray(a.children)){let l=c;if(l===-1){let p=`${JSON.stringify(t)}`,u;if(a.children.length===0)u={offset:a.offset+1,length:0,content:p};else{let g=a.children[a.children.length-1];u={offset:g.offset+g.length,length:0,content:","+p}}return Es(n,u,r)}else if(t===void 0&&a.children.length>=0){let p=c,u=a.children[p],g;if(a.children.length===1)g={offset:a.offset+1,length:a.length-2,content:""};else if(a.children.length-1===p){let w=a.children[p-1],I=w.offset+w.length,v=a.offset+a.length;g={offset:I,length:v-2-I,content:""}}else g={offset:u.offset,length:a.children[p+1].offset-u.offset,content:""};return Es(n,g,r)}else if(t!==void 0){let p,u=`${JSON.stringify(t)}`;if(!r.isArrayInsertion&&a.children.length>c){let g=a.children[c];p={offset:g.offset,length:g.length,content:u}}else if(a.children.length===0||c===0)p={offset:a.offset+1,length:0,content:a.children.length===0?u:u+","};else{let g=c>a.children.length?a.children.length:c,w=a.children[g-1];p={offset:w.offset+w.length,length:0,content:","+u}}return Es(n,p,r)}else throw new Error(`Can not ${t===void 0?"remove":r.isArrayInsertion?"insert":"modify"} Array index ${l} as length is not sufficient`)}else throw new Error(`Can not add ${typeof c!="number"?"index":"property"} to parent of type ${a.type}`);else{if(t===void 0)throw new Error("Can not delete in empty document");return Es(n,{offset:s?s.offset:0,length:s?s.length:0,content:JSON.stringify(t)},r)}}function Es(n,e,t){if(!t.formattingOptions)return[e];let r=Jf(n,e),o=e.offset,i=e.offset+e.content.length;if(e.length===0||e.content.length===0){for(;o>0&&!Kp(r,o-1);)o--;for(;i<r.length&&!Kp(r,i);)i++}let s=Hf(r,{offset:o,length:i-o},{...t.formattingOptions,keepLines:!1});for(let c=s.length-1;c>=0;c--){let l=s[c];r=Jf(r,l),o=Math.min(o,l.offset),i=Math.max(i,l.offset+l.length),i+=l.content.length-l.length}let a=n.length-(r.length-i)-o;return[{offset:o,length:a,content:r.substring(o,i)}]}function Jf(n,e){return n.substring(0,e.offset)+e.content+n.substring(e.offset+e.length)}var ET=m(()=>{"use strict";Uw();$w()});var Gw={};Lg(Gw,{ParseErrorCode:()=>zw,ScanError:()=>qw,SyntaxKind:()=>Hw,applyEdits:()=>xA,createScanner:()=>dA,findNodeAtLocation:()=>hA,findNodeAtOffset:()=>bA,format:()=>kA,getLocation:()=>mA,getNodePath:()=>wA,getNodeValue:()=>yA,modify:()=>PA,parse:()=>fA,parseTree:()=>gA,printParseErrorCode:()=>SA,stripComments:()=>IA,visit:()=>vA});function SA(n){switch(n){case 1:return"InvalidSymbol";case 2:return"InvalidNumberFormat";case 3:return"PropertyNameExpected";case 4:return"ValueExpected";case 5:return"ColonExpected";case 6:return"CommaExpected";case 7:return"CloseBraceExpected";case 8:return"CloseBracketExpected";case 9:return"EndOfFileExpected";case 10:return"InvalidCommentToken";case 11:return"UnexpectedEndOfComment";case 12:return"UnexpectedEndOfString";case 13:return"UnexpectedEndOfNumber";case 14:return"InvalidUnicode";case 15:return"InvalidEscapeCharacter";case 16:return"InvalidCharacter"}return"<unknown ParseErrorCode>"}function kA(n,e,t){return Hf(n,e,t)}function PA(n,e,t,r){return LT(n,e,t,r)}function xA(n,e){let t=e.slice(0).sort((o,i)=>{let s=o.offset-i.offset;return s===0?o.length-i.length:s}),r=n.length;for(let o=t.length-1;o>=0;o--){let i=t[o];if(i.offset+i.length<=r)n=Jf(n,i);else throw new Error("Overlapping edit");r=i.offset}return n}var dA,qw,Hw,mA,fA,gA,hA,bA,wA,yA,vA,IA,zw,Jw=m(()=>{"use strict";Uw();ET();qf();$w();dA=Ls;(function(n){n[n.None=0]="None",n[n.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",n[n.UnexpectedEndOfString=2]="UnexpectedEndOfString",n[n.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",n[n.InvalidUnicode=4]="InvalidUnicode",n[n.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",n[n.InvalidCharacter=6]="InvalidCharacter"})(qw||(qw={}));(function(n){n[n.OpenBraceToken=1]="OpenBraceToken",n[n.CloseBraceToken=2]="CloseBraceToken",n[n.OpenBracketToken=3]="OpenBracketToken",n[n.CloseBracketToken=4]="CloseBracketToken",n[n.CommaToken=5]="CommaToken",n[n.ColonToken=6]="ColonToken",n[n.NullKeyword=7]="NullKeyword",n[n.TrueKeyword=8]="TrueKeyword",n[n.FalseKeyword=9]="FalseKeyword",n[n.StringLiteral=10]="StringLiteral",n[n.NumericLiteral=11]="NumericLiteral",n[n.LineCommentTrivia=12]="LineCommentTrivia",n[n.BlockCommentTrivia=13]="BlockCommentTrivia",n[n.LineBreakTrivia=14]="LineBreakTrivia",n[n.Trivia=15]="Trivia",n[n.Unknown=16]="Unknown",n[n.EOF=17]="EOF"})(Hw||(Hw={}));mA=CT,fA=TT,gA=Gf,hA=Xp,bA=Vw,wA=Ww,yA=zf,vA=Yp,IA=RT;(function(n){n[n.InvalidSymbol=1]="InvalidSymbol",n[n.InvalidNumberFormat=2]="InvalidNumberFormat",n[n.PropertyNameExpected=3]="PropertyNameExpected",n[n.ValueExpected=4]="ValueExpected",n[n.ColonExpected=5]="ColonExpected",n[n.CommaExpected=6]="CommaExpected",n[n.CloseBraceExpected=7]="CloseBraceExpected",n[n.CloseBracketExpected=8]="CloseBracketExpected",n[n.EndOfFileExpected=9]="EndOfFileExpected",n[n.InvalidCommentToken=10]="InvalidCommentToken",n[n.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",n[n.UnexpectedEndOfString=12]="UnexpectedEndOfString",n[n.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",n[n.InvalidUnicode=14]="InvalidUnicode",n[n.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",n[n.InvalidCharacter=16]="InvalidCharacter"})(zw||(zw={}))});var ao,CA,TA,Kw,Kf,_T=m(()=>{"use strict";ao=y(require("vscode")),{createScanner:CA,parse:TA,SyntaxKind:Kw}=(Jw(),Eg(Gw)),Kf=class n{async selectAndInsertDebugConfig(e,t){let r=ao.window.activeTextEditor;if(r&&r.document===e){let o=ao.workspace.getWorkspaceFolder(e.uri),i=await this.getLaunchConfig(o);i&&await n.insertDebugConfiguration(e,t,i)}}static async insertDebugConfiguration(e,t,r){let o=n.getCursorPositionInConfigurationsArray(e,t);if(!o)return;let i=n.isCommaImmediatelyBeforeCursor(e,t)?"BeforeCursor":void 0,s=n.getTextForInsertion(r,o,i),a=new ao.WorkspaceEdit;a.insert(e.uri,t,s),await ao.workspace.applyEdit(a),Promise.resolve(ao.commands.executeCommand("editor.action.formatDocument")).then(()=>{})}static getTextForInsertion(e,t,r){let o=JSON.stringify(e);return t==="AfterItem"?r==="BeforeCursor"?o:`,${o}`:t==="BeforeItem"?`${o},`:o}static getCursorPositionInConfigurationsArray(e,t){if(n.isConfigurationArrayEmpty(e))return"InsideEmptyArray";let r=CA(e.getText(),!0);r.setPosition(e.offsetAt(t));let o=r.scan();if(o===Kw.CommaToken||o===Kw.CloseBracketToken)return"AfterItem";if(o===Kw.OpenBraceToken)return"BeforeItem"}static isConfigurationArrayEmpty(e){let t=TA(e.getText(),[],{allowTrailingComma:!0,disallowComments:!1});return!t||!Array.isArray(t.configurations)||t.configurations.length===0}static isCommaImmediatelyBeforeCursor(e,t){let r=e.lineAt(t.line),o=e.getText(new ao.Range(r.range.start,t));if(o.trim().endsWith(","))return!0;if(o.trim().length!==0)return!1;let i=t.line-1;for(;i>0;){let s=e.lineAt(i).text;if(s.trim().endsWith(","))return!0;if(s.trim().length!==0)return!1;i-=1}return!1}}});var tl,Xw,AT,zr,gt,RA,el,Qw,FT=m(()=>{"use strict";tl=y(require("@vscode/l10n")),Xw=y(require("fs/promises")),AT=require("inversify"),zr=y(require("path")),gt=y(require("vscode"));W();de();U();_T();({getLocation:RA}=(Jw(),Eg(Gw))),el=class{constructor(){this.hasNodeModules=new Map}register(e){e.subscriptions.push(gt.languages.registerCompletionItemProvider({language:"jsonc",pattern:"**/launch.json"},this),Ce(gt.commands,"extension.js-debug.completion.nodeTool",async(t,r)=>{await new Qw().selectAndInsertDebugConfig(t,r)}))}async provideCompletionItems(e,t,r){return await this.canProvideCompletions(e,t)?[{command:{command:"extension.js-debug.completion.nodeTool",title:tl.t("Run Node.js tool"),arguments:[e,t,r]},documentation:tl.t("Runs a Node.js command-line installed in the workspace node_modules."),sortText:"AAAA",preselect:!0,kind:gt.CompletionItemKind.Enum,label:tl.t("Run Node.js tool"),insertText:new gt.SnippetString}]:[]}async canProvideCompletions(e,t){if(zr.basename(e.uri.fsPath)!=="launch.json")return!1;let r=RA(e.getText(),e.offsetAt(t));if(!(r.path[0]==="configurations"&&r.path.length===2))return!1;let o=gt.workspace.getWorkspaceFolder(e.uri);if(!o)return!1;let i=this.hasNodeModules.get(o)??!!await Ft(Xw,zr.join(o.uri.fsPath,"node_modules",".bin"));return this.hasNodeModules.set(o,i),i}};el=h([(0,AT.injectable)()],el);Qw=class extends Kf{async getLaunchConfig(e){let t=gt.window.createQuickPick();t.title=tl.t("Select a tool to run"),t.busy=!0,t.show();let r=await this.getOptions(e);if(r.length===0){t.dispose(),gt.window.showWarningMessage(tl.t("No npm scripts found in the workspace folder."));return}let o=[];for(let{names:s,relativeDir:a}of r)a&&o.push({label:a,kind:gt.QuickPickItemKind.Separator,relativeDir:a}),o=o.concat(s.map(c=>({label:c,relativeDir:a})));t.busy=!1,t.items=o;let i=await new Promise(s=>{t.onDidAccept(()=>s(t.selectedItems[0])),t.onDidHide(()=>s(void 0))});if(t.dispose(),!!i)return{type:En("pwa-node"),request:"launch",name:`Run ${i.label}`,runtimeExecutable:i.label,cwd:zr.join("${workspaceFolder}",i.relativeDir).replaceAll("\\","/"),args:[]}}async getOptions(e){if(!e)return[];let t=await gt.workspace.findFiles(new gt.RelativePattern(e,"**/package.json"));return(await Promise.all(t.map(async o=>{try{let i=zr.dirname(o.fsPath),s=await Xw.readdir(zr.join(i,"node_modules",".bin")),a=new Set;for(let c of s){let l=zr.extname(c);a.add(l?c.slice(0,-l.length):c)}return{relativeDir:zr.relative(e.uri.fsPath,i),names:Array.from(a)}}catch{return}}))).filter(Me)}}});var Yw,Zp,MT,DA,rl,NT=m(()=>{"use strict";Yw=y(require("@vscode/l10n")),Zp=require("inversify");X();MT="linkBpWarnIgnored",DA="https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_can-i-debug-if-im-using-symlinks",rl=class{constructor(e,t){this.vscode=e;this.context=t;this.didWarn=this.context.workspaceState.get(MT,!1)}async warn(){if(this.didWarn)return;this.didWarn=!0;let e=Yw.t("Read More"),t=Yw.t("Ignore"),r=await this.vscode.window.showWarningMessage("It looks like you have symlinked files. You might need to update your configuration to make this work as expected.",t,e);r===t?this.context.workspaceState.update(MT,!0):r===e&&this.vscode.env.openExternal(this.vscode.Uri.parse(DA))}};rl=h([(0,Zp.injectable)(),d(0,(0,Zp.inject)(Kt)),d(1,(0,Zp.inject)(Oe))],rl)});var eu,Qf,BT,un,OT,ol,jT=m(()=>{"use strict";eu=y(require("@vscode/l10n")),Qf=require("inversify"),BT=require("path"),un=y(require("vscode"));X();OT="omitLongPredictions",ol=class{constructor(e){this.context=e}register(e){e.subscriptions.push(un.debug.onDidReceiveDebugSessionCustomEvent(t=>{t.event==="longPrediction"&&this.promptLongBreakpoint(t.session.workspaceFolder)}))}async promptLongBreakpoint(e){if(this.context.workspaceState.get(OT))return;let t=eu.t("It's taking a while to configure your breakpoints. You can speed this up by updating the 'outFiles' in your launch.json."),r=eu.t("Open launch.json"),o=eu.t("Don't show again"),i=await un.window.showWarningMessage(t,o,r);if(i===o){this.context.workspaceState.update(OT,!0);return}if(i!==r)return;if(e||(e=await un.window.showWorkspaceFolderPick()),!e){await un.window.showWarningMessage(eu.t("No workspace folder open."));return}let s=await un.workspace.openTextDocument((0,BT.join)(e.uri.fsPath,".vscode","launch.json"));await un.window.showTextDocument(s)}};ol=h([(0,Qf.injectable)(),d(0,(0,Qf.inject)(Oe))],ol)});var UT,WT=m(()=>{"use strict";UT=Object.keys({requestWillBeSent:0,responseReceived:0,responseReceivedExtraInfo:0,loadingFailed:0,loadingFinished:0})});var Zw,Xf,F,nl,ey,ty,ry,VT=m(()=>{"use strict";Zw=require("buffer"),Xf=require("inversify"),F=y(require("vscode"));W();st();WT();U();jo();nl=class{constructor(e){this.debugSessionTracker=e;this.disposables=new q;this.activeListeners=new q;this.treeDataChangeEmitter=new F.EventEmitter;this.models=new Map;this.onDidChangeTreeData=this.treeDataChangeEmitter.event;this.disposables.push(F.debug.onDidChangeActiveDebugSession(()=>{this.listenToActiveSession()}),this.debugSessionTracker.onSessionEnded(t=>{this.models.delete(t.id)}),F.debug.onDidReceiveDebugSessionCustomEvent(t=>{t.event==="networkEvent"&&this.models.get(t.session.id)?.append([t.body.event,t.body.data])}),this.debugSessionTracker.onSessionAdded(t=>{this.isEnabled()&&t.customRequest("enableNetworking",{mirrorEvents:UT}).then(()=>{this.models.set(t.id,new ty(t)),t===F.debug.activeDebugSession&&this.listenToActiveSession()},()=>{})}),Ce(F.commands,"extension.js-debug.network.viewRequest",async t=>{let r=await F.workspace.openTextDocument(t.fsUri);await F.window.showTextDocument(r)}),Ce(F.commands,"extension.js-debug.network.copyUri",async t=>{await F.env.clipboard.writeText(t.init.request.url)}),Ce(F.commands,"extension.js-debug.network.openBody",async t=>{let r=await F.workspace.openTextDocument(t.fsBodyUri);await F.window.showTextDocument(r)}),Ce(F.commands,"extension.js-debug.network.openBodyInHex",async t=>{await F.commands.executeCommand("vscode.openWith",t.fsBodyUri,"hexEditor.hexedit")}),Ce(F.commands,"extension.js-debug.network.replayXHR",async t=>{await t.session.customRequest("networkCall",{method:"replayXHR",params:{requestId:t.id}})}),Ce(F.commands,"extension.js-debug.network.clear",()=>{for(let t of this.models.values())t.clear();this.treeDataChangeEmitter.fire()}))}getTreeItem(e){return e.toTreeItem()}getChildren(e){return!e&&this.current?this.current.allRequests:[]}register(e){e.subscriptions.push(F.window.registerTreeDataProvider("jsDebugNetworkTree",this),F.workspace.registerFileSystemProvider(Ku,new ey(this.debugSessionTracker,this.models),{isCaseSensitive:!0,isReadonly:!0}))}isEnabled(){return Ht(F.workspace,"debug.javascript.enableNetworkView")}listenToActiveSession(){this.activeListeners.clear();let e=this.current=F.debug.activeDebugSession&&this.models.get(F.debug.activeDebugSession.id),t=!!e&&e.hasRequests;e&&this.activeListeners.push(e.onDidChange(r=>{this.treeDataChangeEmitter.fire(r.isNew?void 0:r.request),e.hasRequests&&!t&&(t=!0,An(F.commands,"jsDebugNetworkAvailable",!0))})),An(F.commands,"jsDebugNetworkAvailable",t),this.treeDataChangeEmitter.fire(void 0)}};nl=h([(0,Xf.injectable)(),d(0,(0,Xf.inject)(Re))],nl);ey=class{constructor(e,t){this.tracker=e;this.models=t;this.changeFileEmitter=new F.EventEmitter;this.onDidChangeFile=this.changeFileEmitter.event}watch(e){let[t,r]=e.path.split("/").slice(1),o=this.models.get(t);return o?o.onDidChange(({request:i,isNew:s})=>{let a=e.with({path:`${t}/${i.id}`});s&&!r?this.changeFileEmitter.fire([{type:F.FileChangeType.Created,uri:a}]):r===i.id&&this.changeFileEmitter.fire([{type:F.FileChangeType.Changed,uri:a}])}):bn}async stat(e){let[t,r]=e.path.split("/").slice(1),o=this.models.get(t);if(!o)throw F.FileSystemError.FileNotFound(e);if(!r)return{type:F.FileType.Directory,ctime:0,mtime:0,size:0};let i=o.getRequest(r);if(!i)throw F.FileSystemError.FileNotFound(e);return{type:F.FileType.File,ctime:i.ctime,mtime:i.mtime,size:i.isComplete?await i.body().then(s=>s?.length||0):0}}readDirectory(){return[]}createDirectory(){}async readFile(e){let[t,r,o]=e.path.split("/").slice(1),i=this.models.get(t)?.getRequest(r);if(!i)throw F.FileSystemError.FileNotFound(e);return o==="body"?i.isComplete?await i.body()||Buffer.from("Body not available"):Buffer.from("Response is still loading..."):Buffer.from(await i.toCurl(this.tracker.getById(t)))}writeFile(){}delete(){}rename(){}},ty=class{constructor(e){this.session=e;this.requests=new Map;this.didChangeEmitter=new F.EventEmitter;this.onDidChange=this.didChangeEmitter.event}get allRequests(){return[...this.requests.values()]}get hasRequests(){return this.requests.size>0}getRequest(e){return this.requests.get(e)}clear(){this.requests.clear()}append([e,t]){if(e==="requestWillBeSent"){let r=new ry(t,this.session);this.requests.set(t.requestId,r),this.didChangeEmitter.fire({request:r,isNew:!0})}else if(e==="responseReceived"||e==="loadingFailed"||e==="loadingFinished"||e==="responseReceivedExtraInfo"){let r=this.requests.get(t.requestId);if(!r)return;e==="responseReceived"?r.response=t.response||{}:e==="loadingFailed"?r.failed=t:e==="loadingFinished"?r.finished=t:e==="responseReceivedExtraInfo"&&(r.responseExtra=t),r.mtime=Date.now(),this.didChangeEmitter.fire({request:r,isNew:!1})}else Ws(e,"unexpected network event")}},ry=class{constructor(e,t){this.init=e;this.session=t;this.ctime=Date.now();this.mtime=Date.now();this.body=B(async()=>{try{let e=await this.session.customRequest("networkCall",{method:"getResponseBody",params:{requestId:this.init.requestId}});return e.body?e.base64Encoded?Buffer.from(e.body,"base64"):Buffer.from(e.body):this.session.type==="pwa-node"?Buffer.from("Response body inspection is not supported in Node.js yet."):void 0}catch{return}})}get isComplete(){return!!(this.finished||this.failed)}get id(){return this.init.requestId}get fsUri(){return F.Uri.from({scheme:Ku,path:`/${this.session.id}/${this.id}`})}get fsBodyUri(){return F.Uri.from({scheme:Ku,path:`/${this.session.id}/${this.id}/body`})}toTreeItem(){let e;this.isComplete?this.failed?e=new F.ThemeIcon("error",new F.ThemeColor("notebookStatusErrorIcon.foreground")):this.response&&this.response.status>=400?e=new F.ThemeIcon("warning"):e=new F.ThemeIcon("check",new F.ThemeColor("notebookStatusSuccessIcon.foreground")):e=new F.ThemeIcon("sync~spin",new F.ThemeColor("notebookStatusRunningIcon.foreground"));let t="";this.failed?t+=`[${this.failed.errorText}] `:this.response&&(t+=`[${this.response.status}] `);let r,o;try{let s=new URL(this.init.request.url);r=s.host,o=s.pathname}catch{o=this.init.request.url}t+=`${this.init.request.method.toUpperCase()} ${o}`;let i=new F.TreeItem(t,F.TreeItemCollapsibleState.Collapsed);return i.iconPath=e,i.description=r,i.tooltip=this.init.request.url,i.id=this.init.requestId,i.collapsibleState=F.TreeItemCollapsibleState.None,i}async toCurl(e){let t=this.toCurlCommand();if(!this.response)return t;let r=[t];r.push(`< HTTP ${this.responseExtra?.statusCode||this.response.status||"UNKOWN"}`);for(let i of Object.entries(this.responseExtra?.headers||this.response.headers||{}))r.push(`< ${i[0]}: ${i[1]}`);if(r.push("<"),this.failed&&(r.push("",`${this.failed.errorText}`),this.failed.blockedReason?r.push(`Blocked: ${this.failed.blockedReason}`):this.failed.corsErrorStatus&&r.push(`CORS error: ${this.failed.corsErrorStatus.corsError}`)),!this.isComplete||!e)return r.join(`
`);let o=await this.body()||Buffer.from("");if(!(0,Zw.isUtf8)(o))r.push(`[binary data as base64]: ${o.toString("base64")}`);else{let i=o.toString();try{let s=JSON.parse(i);r.push(JSON.stringify(s,null,2))}catch{r.push(i)}}return r.join(`
`)}toCurlCommand(){let e=["curl","-v"];this.init.request.method!=="GET"&&e.push(`-X ${this.init.request.method}`);for(let[t,r]of Object.entries(this.init.request.headers||{}))e.push(`-H '${t}: ${r}'`);if(this.init.request.postDataEntries?.length){let t=this.init.request.postDataEntries.map(o=>o.bytes||"").join(""),r=Buffer.from(t,"base64");e.push((0,Zw.isUtf8)(r)?`-d '${r.toString()}'`:"--data-binary '<data>'")}return e.push(`'${this.init.request.url}'`),e.join(" ")}}});var Yf,sl,il,$T=m(()=>{"use strict";Yf=require("inversify"),sl=require("vscode");rn();Vn();il=class{constructor(e){this.leaseTracker=e;this.cachedResolutions=new Array(16).fill("");this.cachedResolutionIndex=0}register(e){typeof sl.workspace.registerPortAttributesProvider=="function"&&e.subscriptions.push(sl.workspace.registerPortAttributesProvider({portRange:[53e3,54e3]},this))}async providePortAttributes({port:e,pid:t}){if(t&&this.cachedResolutions.includes(`${e}:${t}`))return{port:e,autoForwardAction:sl.PortAutoForwardAction.Ignore};if(await this.leaseTracker.isRegistered(e)){if(t){let r=this.cachedResolutionIndex++%this.cachedResolutions.length;this.cachedResolutions[r]=`${e}:${t}`}return{port:e,autoForwardAction:sl.PortAutoForwardAction.Ignore}}}};il=h([(0,Yf.injectable)(),d(0,(0,Yf.inject)(Dt))],il)});var Zf,HT,Ir,al,qT,LA,EA,zT=m(()=>{"use strict";Zf=require("inversify"),HT=y(require("querystring")),Ir=y(require("vscode"));W();jo();yw();al=class{constructor(e){this.tracker=e;this.canPrettyPrintKey=new Cc("jsDebugCanPrettyPrint")}register(e){e.subscriptions.push(Ce(Ir.commands,"extension.js-debug.prettyPrint",()=>this.prettifyActive()),Ir.window.onDidChangeActiveTextEditor(t=>this.updateEditorState(t)),this.tracker.onSessionAdded(()=>this.updateEditorState(Ir.window.activeTextEditor)),this.tracker.onSessionEnded(()=>this.updateEditorState(Ir.window.activeTextEditor)))}async prettifyActive(){let e=Ir.window.activeTextEditor;if(!e||!this.canPrettyPrint(e))return;let{sessionId:t,source:r}=LA(e.document.uri),o=t&&this.tracker.getById(t),i;if(o?i=[{session:o,result:await qT(o,r,e.selection.start)}]:i=await Promise.all(this.tracker.getConcreteSessions().map(async s=>{let a=await qT(s,r,e.selection.start);return{session:s,result:a}})),!i.some(s=>s.result.didReveal)){let s=i.find(a=>a.result.source);if(s){let a=await Ir.workspace.openTextDocument(EA(s.session,s.result.source));await Ir.window.showTextDocument(a)}}}canPrettyPrint(e){return this.tracker.isDebugging&&e.document.languageId==="javascript"&&!e.document.uri.path.endsWith("-pretty.js")}updateEditorState(e){if(!this.tracker.isDebugging){this.canPrettyPrintKey.value=void 0;return}e&&this.canPrettyPrint(e)&&e.document.uri.toString()!==this.canPrettyPrintKey.value?.[0]&&(this.canPrettyPrintKey.value=[e.document.uri.toString()])}};al=h([(0,Zf.injectable)(),d(0,(0,Zf.inject)(Re))],al);qT=(n,e,t)=>n.customRequest("prettyPrintSource",{source:e,line:t.line,column:t.character}),LA=n=>{let e=HT.parse(n.query),t=e.session,r={path:n.fsPath,sourceReference:Number(e.ref)||0};return{sessionId:t,source:r}},EA=(n,e)=>e.sourceReference?Ir.Uri.from({scheme:"debug",path:e.path?.replace(/^\/+/g,"/"),query:`session=${n.id}&ref=${e.sourceReference}`}):Ir.Uri.file(e.path||"")});var tu,ru,JT,co,GT,cl,eg,KT=m(()=>{"use strict";tu=y(require("@vscode/l10n")),ru=require("inversify"),JT=y(require("path")),co=y(require("vscode"));U();X();GT="breakpointTerminationWarnedSlow",cl=class{constructor(e,t){this.fs=e;this.context=t;this.sortOrder=2;this.id="breakpoint";this.label=tu.t("Pick Breakpoint");this.description=tu.t("Run until a specific breakpoint is hit")}async onPick(e,t){if(t)return new eg(t);let r=co.window.createQuickPick();r.canSelectMany=!0,r.matchOnDescription=!0,r.busy=!0;let o=await new Promise(i=>{r.onDidAccept(()=>i(r.selectedItems)),r.onDidHide(()=>i(void 0)),r.onDidChangeActive(async s=>{if(!s.length)return;let a=s[0].location,c=await co.workspace.openTextDocument(a.uri);co.window.showTextDocument(c,{selection:a.range,preview:!0,preserveFocus:!0})}),r.show(),(async()=>{let s=co.debug.breakpoints.filter(l=>l.enabled&&l instanceof co.SourceBreakpoint),a=await Promise.all(s.map(l=>e.getDebugProtocolBreakpoint(l))),c=await this.getCandidates(a,s);r.items=c,r.selectedItems=c,r.busy=!1})()});if(r.dispose(),!!o)return await this.warnSlowCode(),new eg(o.map(i=>Number(i.id)))}async warnSlowCode(){this.context.workspaceState.get(GT)||(co.window.showWarningMessage(tu.t('Profiling with breakpoints enabled can change the performance of your code. It can be useful to validate your findings with the "duration" or "manual" termination conditions.'),tu.t("Got it!")),await this.context.workspaceState.update(GT,!0))}async getCandidates(e,t){if(e.length!==t.length)throw new Error("Mismatched breakpoint array lengths");let r=zo(i=>this.getFileLines(i));return(await Promise.all(t.map(async(i,s)=>{let a=e[s];if(!a||!a.id)return;let c=i.location,l=co.workspace.getWorkspaceFolder(c.uri),p=l?JT.relative(l.uri.fsPath,c.uri.fsPath):c.uri.fsPath,u=await r(c.uri.fsPath);return{id:a.id,label:`${p}:${c.range.start.line}:${c.range.start.character}`,location:c,description:u?.[c.range.start.line]?.trim()}}))).filter(Me)}async getFileLines(e){try{return(await this.fs.readFile(e,"utf-8")).split(`
`)}catch{return}}};cl=h([(0,ru.injectable)(),d(0,(0,ru.inject)(oe)),d(1,(0,ru.inject)(Oe))],cl);eg=class{constructor(e){this.breakpointIds=e}get customData(){return{stopAtBreakpoint:this.breakpointIds.slice()}}dispose(){}}});var tg,Wo,ou,oy=m(()=>{"use strict";tg=y(require("@vscode/l10n")),Wo=y(require("vscode"));st();H();ou=class{constructor(e,t,r){this.session=e;this.impl=t;this.termination=r;this.statusChangeEmitter=new S;this.stopEmitter=new S;this._innerStatus=[];this.disposables=new q;this.state=0;this.onStatusChange=this.statusChangeEmitter.event;this.onStop=this.stopEmitter.event;this.disposables.push(Wo.debug.onDidReceiveDebugSessionCustomEvent(o=>{o.session===e&&o.event==="profilerStateUpdate"&&this.onStateUpdate(o.body)}),Wo.debug.onDidTerminateDebugSession(o=>{o===e&&this.stopEmitter.fire(void 0)})),r&&(this.disposables.push(r),r.attachTo?.(this))}get status(){return this._innerStatus.filter(e=>!!e).join(", ")||void 0}async start(){try{await Wo.window.withProgress({location:Wo.ProgressLocation.Window,title:tg.t("Starting profile...")},()=>this.session.customRequest("startProfile",{type:this.impl.type,...this.termination?.customData}))}catch(e){Wo.window.showErrorMessage(e.message),this.stopEmitter.fire(void 0)}}dispose(){this.state=2,this.disposables.dispose()}setFile(e){this.file=e}async stop(){this.state===0&&(this.setStatus(-1,tg.t("Saving")),this.state=1,await Wo.window.withProgress({location:Wo.ProgressLocation.Window,title:tg.t("Stopping profile...")},()=>this.session.customRequest("stopProfile",{})))}onStateUpdate(e){if(e.running){this.setStatus(0,e.label);return}this.state=2,this.stopEmitter.fire(this.file),this.dispose()}setStatus(e,t){this.state===0&&(e===-1?this._innerStatus=[t]:this._innerStatus[e]=t,this.statusChangeEmitter.fire(this.status))}}});var _s,QT,XT,ll,rg,YT=m(()=>{"use strict";_s=y(require("@vscode/l10n")),QT=require("inversify"),XT=y(require("vscode"));st();oy();ll=class{constructor(){this.sortOrder=1;this.id="duration";this.label=_s.t("Duration");this.description=_s.t("Run for a specific amount of time")}async onPick(e,t){if(t)return new rg(t*1e3);let r=XT.window.createInputBox();r.title=_s.t("Duration of Profile"),r.placeholder=_s.t('Profile duration in seconds, e.g "5"'),this.lastDuration&&(r.value=String(this.lastDuration)),r.onDidChangeValue(i=>{/^[0-9]+$/.test(i)?Number(i)<1?r.validationMessage=_s.t("Please enter a number greater than 1"):r.validationMessage=void 0:r.validationMessage=_s.t("Please enter a number")});let o=await new Promise(i=>{r.onDidAccept(()=>{if(r.validationMessage)return i(void 0);this.lastDuration=Number(r.value),i(new rg(this.lastDuration*1e3))}),r.onDidHide(()=>i(void 0)),r.show()});return r.dispose(),o}};ll=h([(0,QT.injectable)()],ll);rg=class{constructor(e){this.duration=e;this.disposable=new q}attachTo(e){let t=Date.now()+this.duration,r=()=>e.setStatus(1,`${Math.round((t-Date.now())/1e3)}s`),o=setTimeout(()=>e.stop(),this.duration),i=setInterval(r,1e3);r(),this.disposable.callback(()=>{clearTimeout(o),clearInterval(i)})}dispose(){this.disposable.dispose()}}});var ny,ZT,pl,nu,iy=m(()=>{"use strict";ny=y(require("@vscode/l10n")),ZT=require("inversify"),pl=class{constructor(){this.sortOrder=0;this.id="manual";this.label=ny.t("Manual");this.description=ny.t("Run until manually stopped")}async onPick(){return new nu}};pl=h([(0,ZT.injectable)()],pl);nu=class{dispose(){}}});var ul,sy=m(()=>{"use strict";ul=Symbol("ITerminationConditionFactory")});var Vo,Ii,eR,og,ht,_A,dl,tR=m(()=>{"use strict";Vo=y(require("@vscode/l10n")),Ii=require("inversify"),eR=require("os"),og=require("path"),ht=y(require("vscode"));Im();xn();W();st();de();X();jo();iy();sy();oy();_A=n=>"__pendingTargetId"in n.configuration,dl=class{constructor(e,t,r,o){this.tracker=e;this.fs=t;this.sessionStates=r;this.terminationConditions=o;this.activeSessions=new Map;this.disposables=new q;this.disposables.push(ht.debug.onDidReceiveDebugSessionCustomEvent(i=>{if(i.event!=="profileStarted")return;let s=i.body,a=this.activeSessions.get(i.session.id);a||(a=new ou(i.session,Zt.ctors.find(c=>c.type===s.type)||Zt.ctors[0],new nu),this.registerSession(a)),a.setFile(s.file)}))}async start(e){let t,r=[...this.tracker.getConcreteSessions()].filter(_A);if(e.sessionId?t=r.find(l=>l.id===e.sessionId):t=await this.pickSession(r),!t)return;let o=t,i=this.activeSessions.get(o.id);if(i&&!await this.alreadyRunningSession(i))return;let s=await this.pickType(o,e.type);if(!s)return;let a;if(!s.instant&&(a=await this.pickTermination(o,e.termination),!a))return;let c=new ou(o,s,a);c&&(this.registerSession(c,e.onCompleteCommand),await c.start(),s.instant&&await c.stop())}async stop(e){let t;if(e)t=this.activeSessions.get(e);else{let r=await this.pickSession([...this.activeSessions.values()].map(o=>o.session));t=r&&this.activeSessions.get(r.id)}t&&(this.sessionStates.remove(t.session.id),await t.stop())}dispose(){for(let e of this.activeSessions.values())e.dispose();this.activeSessions.clear(),this.disposables.dispose()}registerSession(e,t){this.activeSessions.set(e.session.id,e),this.sessionStates.add(e.session.id,Vo.t("Profiling")),e.onStatusChange(()=>this.updateStatusBar()),e.onStop(r=>{r&&this.openProfileFile(e,t,e.session,r),this.activeSessions.delete(e.session.id),e.dispose(),this.updateStatusBar()}),this.updateStatusBar()}async openProfileFile(e,t,r,o){if(t)return Promise.all([ht.commands.executeCommand(t,{contents:await this.fs.readFile(o,"utf-8"),basename:(0,og.basename)(o)+e.impl.extension}),this.fs.unlink(o)]);let i=r.workspaceFolder?.uri.fsPath??ht.workspace.workspaceFolders?.[0].uri.fsPath??(0,eR.homedir)(),s=vm()+e.impl.extension,a=ht.Uri.file((0,og.join)(i,s));await rv(this.fs,o,a.fsPath),await ht.commands.executeCommand(e.impl.editable?"vscode.open":"revealInExplorer",a)}updateStatusBar(){if(this.activeSessions.size===0){this.statusBarItem?.hide(),An(ht.commands,"jsDebugIsProfiling",!1);return}this.statusBarItem||(this.statusBarItem=ht.window.createStatusBarItem(ht.StatusBarAlignment.Right,500),this.statusBarItem.command="extension.js-debug.stopProfile"),An(ht.commands,"jsDebugIsProfiling",!0);let e=Pn(this.activeSessions.values());e&&this.activeSessions.size===1?this.statusBarItem.text=e.status?Vo.t("{0} Click to Stop Profiling ({1})","$(loading~spin)",e.status):Vo.t("{0} Click to Stop Profiling","$(loading~spin)"):this.statusBarItem.text=Vo.t("{0} Click to Stop Profiling ({1} sessions)","$(loading~spin)",this.activeSessions.size),this.statusBarItem.show()}async alreadyRunningSession(e){let t=Vo.t("Yes"),r=Vo.t("No");return await ht.window.showErrorMessage(Vo.t("A profiling session is already running, would you like to stop it and start a new session?"),t,r)!==t?!1:(await this.stop(e.session.id),!0)}async pickSession(e){if(e.length===0)return;if(e.length===1)return e[0];let t=await ht.window.showQuickPick(e.map(r=>({label:r.name,id:r.id})));return t&&e.find(r=>r.id===t.id)}async pickType(e,t){let r=e.configuration;if(t)return Zt.ctors.find(i=>i.type===t&&i.canApplyTo(r));let o=await this.pickWithLastDefault(Vo.t("Type of profile"),Zt.ctors.filter(i=>i.canApplyTo(r)),this.lastChosenType);return o&&(this.lastChosenType=o.label),o}async pickTermination(e,t){if(t){let o=typeof t=="string"?{type:t}:t;return this.terminationConditions.find(i=>i.id===o.type)?.onPick(e,...o.args??[])}let r=await this.pickWithLastDefault(Vo.t("How long to run the profile"),this.terminationConditions,this.lastChosenTermination);return r&&(this.lastChosenTermination=r.label),r?.onPick(e)}async pickWithLastDefault(e,t,r){if(t.length<=1)return t[0];let o=ht.window.createQuickPick();o.title=e,o.items=t.slice().sort((s,a)=>s.label===r||a.label===r?s.label===r?-1:1:(s.sortOrder??0)-(a.sortOrder??0)).map(s=>({label:s.label,description:s.description,alwaysShow:!0}));let i=await new Promise(s=>{o.onDidAccept(()=>s(o.selectedItems[0]?.label)),o.onDidHide(()=>s(void 0)),o.show()});if(o.dispose(),!!i)return t.find(s=>s.label===i)}};dl=h([(0,Ii.injectable)(),d(0,(0,Ii.inject)(Re)),d(1,(0,Ii.inject)(oe)),d(2,(0,Ii.inject)(ad)),d(3,(0,Ii.multiInject)(ul))],dl)});var rR,oR=m(()=>{"use strict";rR=(n,e)=>{let t=n;for(let[r,o]of Object.entries(e))typeof o=="object"&&o?t[r]=Object.assign(t[r]||{},o):t[r]=o}});var nR,iR,ml,sR=m(()=>{"use strict";nR=require("inversify"),iR=require("vscode");oR();W();U();ml=class{constructor(){this.read=B(()=>Ht(iR.workspace,"debug.javascript.resourceRequestOptions"))}provideOptions(e){rR(e,this.read()||{})}};ml=h([(0,nR.injectable)()],ml)});var aR,ay,fl,cR=m(()=>{"use strict";aR=require("inversify"),ay=require("vscode");W();fl=class{register(e){e.subscriptions.push(Ce(ay.commands,"extension.node-debug.startWithStopOnEntry",()=>ay.commands.executeCommand("workbench.action.debug.start",{config:{stopOnEntry:!0}})))}};fl=h([(0,aR.injectable)()],fl)});var cy,ng,lR,pR,ct,gl,uR=m(()=>{"use strict";cy=y(require("@vscode/l10n")),ng=require("inversify"),lR=require("linkifyjs"),pR=require("url"),ct=y(require("vscode"));W();Lm();st();U();V();gl=class{constructor(e){this.defaultBrowser=e;this.enabledTerminals=new WeakSet;this.disposable=new q;this.notifiedCantOpenOnWeb=!1;this.baseConfiguration=this.readConfig();this.disposable.push(ct.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("debug.javascript.debugByLinkOptions")&&(this.baseConfiguration=this.readConfig())}),ct.window.registerTerminalLinkProvider(this))}enableHandlingInTerminal(e){this.enabledTerminals.add(e)}dispose(){this.disposable.dispose()}provideTerminalLinks(e){switch(this.baseConfiguration.enabled){case"off":return[];case"always":break;case"on":default:if(!this.enabledTerminals.has(e.terminal))return[]}let t=[],r=B(()=>{if("cwd"in e.terminal.creationOptions&&e.terminal.creationOptions.cwd){let o=ct.workspace.getWorkspaceFolder(typeof e.terminal.creationOptions.cwd=="string"?ct.Uri.file(e.terminal.creationOptions.cwd):e.terminal.creationOptions.cwd);if(o)return o}return ct.workspace.workspaceFolders?.[0]});for(let o of(0,lR.find)(e.line,"url")){let i=-1;for(;(i=e.line.indexOf(o.value,i+1))!==-1;){let s;try{s=new pR.URL(o.href)}catch{continue}s.protocol==="http:"&&!o.value.startsWith("http:")&&!Ou(s.hostname)&&(s.protocol="https:"),!(s.protocol!=="http:"&&s.protocol!=="https:")&&t.push({startIndex:i,length:o.value.length,tooltip:cy.t("Debug URL"),target:s,workspaceFolder:r()?.index})}}return t}async handleTerminalLink(e){await this.handleTerminalLinkInner(e)||ct.env.openExternal(ct.Uri.parse(e.target.toString()))}async handleTerminalLinkInner(e){if(!e.target)return!1;let t=e.target;if(ct.env.uiKind===ct.UIKind.Web)return this.notifiedCantOpenOnWeb||(ct.window.showInformationMessage(cy.t("We can't launch a browser in debug mode from here. If you want to debug this webpage, open this workspace from VS Code on your desktop.")),this.notifiedCantOpenOnWeb=!0),!1;jv(t.hostname)&&(t.hostname="localhost");let r="pwa-chrome";try{await this.defaultBrowser.lookup()==="edge"&&(r="pwa-msedge")}catch{}let o=e.workspaceFolder!==void 0?ct.workspace.workspaceFolders?.[e.workspaceFolder]:void 0;return ct.debug.startDebugging(o,{...this.baseConfiguration,type:r,name:t.toString(),request:"launch",url:t.toString()}),!0}readConfig(){let e=Ht(ct.workspace,"debug.javascript.debugByLinkOptions");return typeof e=="boolean"&&(e=e?"on":"off"),typeof e=="string"?{enabled:e}:{enabled:"on",...e}}};gl=h([(0,ng.injectable)(),d(0,(0,ng.inject)(Ja))],gl)});var dR,mR,fR=m(()=>{"use strict";Dd();Tm();hw();X();vC();Kn();Pd();IC();PC();tT();iT();jo();aT();lT();dT();gT();IT();ST();FT();Qb();NT();jT();VT();$T();zT();KT();YT();iy();sy();tR();sR();Iw();cR();uR();dR=n=>{n.bind(Kt).toConstantValue(require("vscode")),ZC.forEach(e=>{n.bind(e).toSelf().inSingletonScope(),n.bind(xC).to(e)}),eT.forEach(e=>n.bind(CC).to(e).inSingletonScope()),n.bind(Qt).to(ol).inSingletonScope(),n.bind(Qt).to(Vc).inSingletonScope(),n.bind(Qt).to(xc).inSingletonScope(),n.bind(Qt).to(Rs).inSingletonScope(),n.bind(Qt).to(qc).inSingletonScope(),n.bind(Qt).to(fl).inSingletonScope(),n.bind(Qt).to(il).inSingletonScope(),n.bind(Qt).to(Jc).inSingletonScope(),n.bind(Qt).to(Kc).inSingletonScope(),n.bind(Qt).to(al).inSingletonScope(),n.bind(Qt).to(Tc).inSingletonScope(),n.bind(Qt).to(nl).inSingletonScope(),n.bind(Qt).to(el).inSingletonScope().onActivation(Se),n.bind(Dp).to(rl).inSingletonScope(),n.bind(Re).toSelf().inSingletonScope().onActivation(Se),n.bind(dl).toSelf().inSingletonScope().onActivation(Se),n.bind(Rs).toSelf().inSingletonScope(),n.bind(Gi).to(Gc).inSingletonScope(),n.bind(Ef).to(gl).inSingletonScope().onActivation(Se),n.bind(ul).to(ll).inSingletonScope(),n.bind(ul).to(pl).inSingletonScope(),n.bind(ul).to(cl).inSingletonScope(),n.bind(pa).toConstantValue(new Set),n.bind(Qc).toSelf().inSingletonScope()},mR=n=>{n.bind(It).to(Sc).onActivation(Se),n.bind(Ha).to(ml).inSingletonScope(),n.bind(ka).to(Pc).inSingletonScope().onActivation(Se)}});var sg,gR,ig,ag,mZ,hR,bR,wR,yR,ly=m(()=>{"use strict";sg=require("@vscode/js-debug-browsers"),gR=y(require("execa")),ig=require("fs"),ag=require("inversify"),mZ=require("reflect-metadata");md();Un();xh();Ph();Fh();Bd();jd();rm();Kk();wb();ep();Dd();Yk();rp();Hi();yb();vb();rn();Lb();Im();bp();Cb();Rb();Vl();tP();aP();op();zd();tn();Sp();tt();kp();Lm();ma();de();O();ro();_b();Gl();zl();Ql();jb();Gt();J();eo();X();Tp();UP();HP();GP();Km();JP();tx();rw();Ix();Wx();$x();oC();hs();cC();Tf();uf();Up();If();dC();gw();ms();cf();Kn();Td();Pd();fC();hC();ua();Jl();fR();hR=(n,e,t,r)=>{let o=new ag.Container;return o.parent=n,o.bind(re).toConstantValue(e.launchConfig),o.bind(la).toConstantValue(o),o.bind(zt).toConstantValue(t),o.bind(Be).toConstantValue(r),o.bind(Do).toConstantValue(e),o.bind(wx).toConstantValue(e.targetOrigin()),o.bind(Ni).to(ss).inSingletonScope(),o.bind(ip).to($n).inSingletonScope(),o.bind(Io).to(Oi).inSingletonScope(),o.bind(wd).to(va).inSingletonScope(),o.bind(jn).toSelf().inSingletonScope(),e.sourcePathResolver&&o.bind(Te).toConstantValue(e.sourcePathResolver),o.bind(ts).toSelf(),o.bind(gm).toDynamicValue(i=>i.container.get(ts).create()).inSingletonScope(),e.parent()&&(o.bind($i).to(Vi).inSingletonScope(),o.bind(Po).to(ha).inSingletonScope()),o.bind(lt).to(process.env.DA_TEST_DISABLE_TELEMETRY?ks:Er).inSingletonScope().onActivation(Se),o.bind(Ar).toSelf().inSingletonScope(),o.bind(ut).toSelf().inSingletonScope(),o.bind(Qn).toSelf().inSingletonScope(),o.bind(Wn).to(Lo).inSingletonScope().onActivation(Se),o.bind(Hn).toSelf().inSingletonScope(),o.bind(Ua).to(ja).inSingletonScope(),o.bind(Ud).to(Ea).inSingletonScope(),o.bind(Dr).to(ba).inSingletonScope(),o.bind(um).to($a).inSingletonScope(),o.bind(Bn).to(da).inSingletonScope(),o.bind(_d).to(Ca).inSingletonScope().onActivation(Se),o.bind(dt).toSelf(),o.bind(pr).toSelf(),o.bind(ur).toSelf(),o.bind(ym).to(Zt).inSingletonScope(),o.bind(Sm).to(Va).inSingletonScope(),o.bind(Od).to(Da).inSingletonScope().onActivation(Se),o},bR=n=>{let e=new ag.Container;e.parent=n,e.bind(la).toConstantValue(e),e.bind(L).to(j).inSingletonScope().onActivation(Se),e.bind(Ni).to(ss).inSingletonScope(),e.bind(lt).to(process.env.DA_TEST_DISABLE_TELEMETRY?ks:Er).inSingletonScope().onActivation(Se),e.bind(ko).to(ko).inSingletonScope(),e.bind(Zo).to(Zo).inSingletonScope(),e.bind(za).to(ei).inSingletonScope(),e.bind(fa).to(ri).inSingletonScope(),e.bind(Mo).to(pc),e.bind(Fo).toSelf().inSingletonScope().onActivation(Se),e.bind(Bo).toSelf(),e.bind(It).to(io).onActivation(Se),e.bind(It).to(dc).onActivation(Se),e.bind(It).to(mc).onActivation(Se),e.bind(It).to(bc).onActivation(Se),e.bind(jp).to(vc),e.bind(jp).to(fi),e.bind(gs).to(lc).inSingletonScope(),mR(e),e.bind(It).to(gc).onActivation(Se),e.bind(us).toSelf().inSingletonScope().onActivation(Se),e.bind(It).toService(us),e.bind(It).to(ec).inSingletonScope().onActivation(Se),e.bind(It).to(rc).inSingletonScope().onActivation(Se),e.bind(It).to(tc).inSingletonScope().onActivation(Se),e.bind(It).to(oc).inSingletonScope().onActivation(Se),e.bind(It).to(jr).onActivation(Se),e.bind(It).toDynamicValue(()=>n.get(fs).createLauncher(e.get(L))).inSingletonScope(),e.isBound(Gi)||e.bind(Gi).to(qa).inSingletonScope(),e.bind(Lh).to(xa).inSingletonScope().onActivation(Se);let t=r=>o=>new r(o.container.get(hh),o.container.get(oe),o.container.get(bh));return e.bind(ji).toDynamicValue(t(sg.ChromeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","chrome"),e.bind(ji).toDynamicValue(t(sg.EdgeBrowserFinder)).inSingletonScope().whenTargetTagged("browser","edge"),e},wR=n=>{let e=new ag.Container;return e.bind(la).toConstantValue(e),e.bind(fs).toSelf().inSingletonScope(),e.bind(sc).toSelf().inSingletonScope(),e.bind(ka).to(Ic).inSingletonScope(),e.bind(ad).toConstantValue(new Eo),e.bind(Ja).to(Ga).inSingletonScope(),e.bind(So).toConstantValue(n.storagePath),e.bind(Bi).toConstantValue(n.isVsCode),e.bind(Cf).to(jt),e.bind(Dt).to(Ra).inSingletonScope(),e.bind(hh).toConstantValue(process.env),e.bind(bh).toConstantValue(gR.default),e.bind(oe).toConstantValue(ig.promises),e.bind(xt).toConstantValue(new ve(ig.promises)),e.bind(to).toConstantValue(n.isRemote?"remote":"local"),n.context&&e.bind(Oe).toConstantValue(n.context),dR(e),e},yR=(n,e,t)=>{n.bind(wp).toConstantValue($k(e)),n.bind(re).toService(wp),n.bind(gr).to(ac).inSingletonScope(),n.bind(sa).toConstantValue(t),n.bind(Te).toDynamicValue(r=>r.container.get(gr).create(e,r.container.get(L))).inSingletonScope(),n.bind(xt).toConstantValue(xu.create(e.__remoteFilePrefix,ig.promises,t)),n.bind(gh).to(Nn).inSingletonScope().onActivation(Se),n.bind(On).to(aa).inSingletonScope(),n.bind(je).toSelf().inSingletonScope().onActivation(Se),n.bind(Io).to(Oi).inSingletonScope(),n.bind(Wi).toSelf().inSingletonScope(),n.bind($i).to(Vi).inSingletonScope(),n.bind(Po).to(ga).inSingletonScope()}});function IR(n,e,t){let r=vR(n,e,"uncaughtException",t),o=vR(n,e,"unhandledRejection",t);return process.addListener("uncaughtException",r),process.addListener("unhandledRejection",o),{dispose:()=>{process.removeListener("uncaughtException",r),process.removeListener("unhandledRejection",o)}}}function MA(n){return!SR||AA(n)&&!!n.stack?.includes(FA)}function kR(){SR=!0}var cg,vR,AA,FA,SR,PR=m(()=>{"use strict";cg=y(require("path"));O();vR=(n,e,t,r=!0)=>o=>{MA(o)&&(e.report("error",{"!error":o,error:r?void 0:o,exceptionType:t}),n.error("runtime.exception","Unhandled error in debug adapter",o))},AA=n=>typeof n=="object"&&!!n&&"stack"in n,FA=cg.dirname(cg.dirname(cg.dirname(__dirname)));SR=!1});function NA(n){ed&&n.output({category:"console",output:`Note: Using the "preview" debug extension
`})}var xR,pg,lg,CR,As,TR=m(()=>{"use strict";xR=y(require("@vscode/l10n")),pg=y(require("os"));jk();Eb();ep();Vk();Ke();st();H();O();_b();U();$();V();J();ly();X();Kn();ua();PR();lg=class{constructor(e,t,r,o){this._delegate=e;this._rootServices=r;this._disposables=new q;this._serviceTree=new WeakMap;this._root=new As(void 0);this.getLaunchers=B(()=>{let e=new Set(this._rootServices.getAll(It));for(let t of e)this._disposables.push(t.onTargetListChanged(()=>{let r=this.targetList();this._attachToNewTargets(r,t),this._terminateOrphanThreads(r)}));return e});this._dap=t.dap(),this._targetOrigin=o,this._disposables.callback(()=>cd(r)),this._disposables.push(IR(r.get(L),r.get(lt),r.get(Bi))),t.attachTelemetry(r.get(lt));let i=this._dap,s=0,a;i.on("initialize",async c=>{this._rootServices.bind(Jt).toConstantValue(c);let l=ns.capabilities();return c.clientID==="vscode"&&kR(),setTimeout(()=>i.initialized({}),0),l}),i.on("setExceptionBreakpoints",async()=>({})),i.on("setBreakpoints",async c=>(c.breakpoints?.length&&r.get(je).notifyHadBreakpoint(),{breakpoints:c.breakpoints?.map(()=>({id:++s,verified:!1,message:xR.t("Unbound breakpoint")}))??[]})),i.on("configurationDone",async()=>({})),i.on("threads",async()=>({threads:[]})),i.on("loadedSources",async()=>({sources:[]})),i.on("breakpointLocations",()=>Promise.resolve({breakpoints:[]})),i.on("attach",async c=>(await this.boot(c,i),{})),i.on("launch",async c=>(await this.boot(c,i),{})),i.on("pause",async()=>({})),i.on("terminate",()=>this._terminateRoot(!0)),i.on("disconnect",c=>this._disconnectRoot(c)),i.on("restart",async({arguments:c})=>(await this._restart(c),{})),i.on("startSelfProfile",async({file:c})=>(a?.dispose(),a=new km(c),await a.start(),{})),i.on("stopSelfProfile",async()=>(a&&(await a.stop(),a.dispose(),a=void 0),{})),i.on("enableNetworking",()=>Promise.resolve({}))}async _terminateRoot(e){return this._root.state=1,await Promise.all([...this.getLaunchers()].map(t=>t.terminate(e))),await this._root.waitUntilChildrenAre(2),this._root.state=2,{}}async _disconnectRoot(e){return this._root.state<1&&await this._terminateRoot(e.terminateDebuggee),this._rootServices.get(lt).flush(),await this._root.waitUntilChildrenAre(3),this._root.state=3,{}}async boot(e,t){return this._boot(ta(e,this._rootServices.get(to)),t)}async _boot(e,t){NA(t),this.reportBootTelemetry(e),yR(this._rootServices,e,t),this._rootServices.get(L).setup(Xy(t,e.trace));let r=e.timeout>0?we.withTimeout(e.timeout):new we;e.rootPath&&(e.rootPath=ar(e.rootPath)),this._launchParams=e;let o=await Promise.all([...this.getLaunchers()].map(i=>this._launch(i,e,r.token)));return Promise.all(o.map(i=>i.terminated)).then(i=>{let s=i.find(Me);this._markTargetAsTerminated(this._root,{restart:!!s?.restart})}),{}}reportBootTelemetry(e){let t=ta({type:e.type,request:e.request,name:"<string>",__workspaceFolder:"<workspace>"}),r=(o,i)=>typeof o=="string"?i&&t[i]===o?o:"<string>":o instanceof Array?o.map(s=>r(s)):o&&typeof o=="object"?Ho(o,s=>r(s)):o;this._rootServices.get(lt).report("launch",{type:e.type,request:e.request,os:`${pg.platform()} ${pg.arch()}`,nodeVersion:process.version,adapterVersion:Mi,parameters:Ho(e,r)})}async _restart(e){let t;if(e){let r=this._rootServices.get(wp);t=ta({__workspaceFolder:r.__workspaceFolder,...e},this._rootServices.get(to)),r.update(t)}await Promise.all([...this.getLaunchers()].map(r=>r.restart(t)))}async _launch(e,t,r){return(await this.captureLaunch(e,t,r)).blockSessionTermination?{terminated:new Promise(i=>{let s=this._disposables.push(e.onTerminated(a=>{s.dispose(),i(a)}))})}:{terminated:Promise.resolve(void 0)}}async captureLaunch(e,t,r){let o=e.constructor.name,i;try{i=await e.launch(t,{telemetryReporter:this._rootServices.get(lt),cancellationToken:r,targetOrigin:this._targetOrigin,dap:this._dap})}catch(s){throw this._rootServices.get(L).warn("runtime.launch","Launch returned error",{error:s,wasCancelled:r.isCancellationRequested,name:o}),s}return i.blockSessionTermination&&this._rootServices.get(L).info("runtime.launch","Launched successfully",{name:o}),i}dispose(){this._disposables.dispose(),this._terminateOrphanThreads([])}targetList(){let e=[];for(let t of this.getLaunchers())e.push(...t.targetList());return e}async attach(e,t){if(!this._launchParams)throw new Error("Cannot launch before params have been set");let r=e.value;if(!r.canAttach())return;let o=await r.attach();if(!o)return;let i=await this._delegate.acquireDap(r),s=i.dap(),a=this._launchParams;this._asyncStackPolicy||(this._asyncStackPolicy=Bk(a.showAsyncStacks));let c=r.parent(),l=c&&this._serviceTree.get(c)||this._rootServices,p=hR(l,r,s,o);i.attachTelemetry(p.get(lt)),this._serviceTree.set(r,l);let u=new ns(s,this._asyncStackPolicy,a,p),g=u.createThread(o,r);"inspectUri"in a&&!!a.inspectUri&&this.attachDotnetDebuggerEvent(o,this._rootServices.get(lt),this._rootServices.get(Bi));let I=async()=>(await u.launchBlocker(),r.runIfWaitingForDebugger(),e.threadData.resolve({thread:g,debugAdapter:u}),{});s.on("disconnect",v=>this._disconnectTarget(e,v)),s.on("terminate",()=>this._terminateTarget(e)),s.on("restart",async()=>(r.canRestart()?r.restart():await this._restart(),Promise.resolve({}))),await this._delegate.initAdapter(u,r,t)?I():(s.on("attach",I),s.on("launch",I)),await r.afterBind()}attachDotnetDebuggerEvent(e,t,r){e.DotnetDebugger.on("reportBlazorDebugException",o=>{t.report("blazorDebugException",{exceptionType:o.exceptionType,"!error":o.exception,error:r?void 0:o.exception})})}_attachToNewTargets(e,t){for(let r of e.values()){if(!r.waitingForDebugger()||As.targetNodes.has(r))continue;let o=r.parent(),i=o?As.targetNodes.get(o):this._root;if(!i)throw new Error(`Got target with unknown parent: ${r.name()}`);let s=new As(r);i.add(s),this.attach(s,t)}}async _terminateOrphanThreads(e,t){let r=[...this._root.all()].filter(o=>!e.includes(o.value));return Promise.all(r.map(o=>this._markTargetAsTerminated(o,t)))}async _markTargetAsTerminated(e,t={}){if(e.state>=1)return await e.waitUntil(2),{};if(e.state=1,CR(e)){let r=await e.threadData.promise;await r.thread.dispose(),r.debugAdapter.dap.terminated(t),r.debugAdapter.dispose()}else this._dap.terminated(t);return await e.waitUntilChildrenAre(2),e.state=2,{}}async _terminateTarget(e){return e.state>=3?{}:(e.value.canStop()?e.value.stop():this._terminateRoot(!0),await e.waitUntil(2),{})}async _disconnectTarget(e,t){if(e.state>=3)return{};e.state<1&&(t.terminateDebuggee!==!0&&e.value.canDetach()?await e.value.detach():e.value.canStop()?e.value.stop():this._terminateRoot(t.terminateDebuggee)),await e.waitUntil(2),await e.waitUntilChildrenAre(3),e.state=3,queueMicrotask(()=>this._delegate.releaseDap(e.value));let r=e.value.parent();return(r?As.targetNodes.get(r):this._root)?.remove(e),{}}};CR=n=>!!n.value,As=class n{constructor(e){this.value=e;this.threadData=ye();this._state=0;this._children=new Set;this._stateChangeEmitter=new S;e&&n.targetNodes.set(e,this)}static{this.targetNodes=new WeakMap}get state(){return this._state}set state(e){e>this._state&&(this._state=e,this._stateChangeEmitter.fire(e))}add(e){this._children.add(e)}remove(e){this._children.delete(e)}async waitUntil(e){return this._state>=e?Promise.resolve():new Promise(t=>{let r=this._stateChangeEmitter.event(o=>{o>=e&&(r.dispose(),t())})})}async waitUntilChildrenAre(e){await Promise.all([...this._children].map(t=>t.waitUntil(e)))}*all(){CR(this)&&(yield this);for(let e of this._children)yield*e.all()}}});var RR,OA,iu,DR=m(()=>{"use strict";H();Fa();O();RR=`\r
\r
`,OA=0,iu=class{constructor(e,t,r){this.inputStream=e;this.outputStream=t;this._contentLength=-1;this._connectionId=OA++;this.msgEmitter=new S;this.messageReceived=this.msgEmitter.event;this.endedEmitter=new S;this.closed=this.endedEmitter.event;this._handleData=e=>{let t=new Fr;for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let r=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,r.length>0)try{let o=JSON.parse(r);this.logger?.verbose("dap.receive",void 0,{connectionId:this._connectionId,message:o}),this.msgEmitter.fire({message:o,receivedTime:t})}catch(o){console.error("Error handling data: "+(o&&o.message))}continue}}else{let r=this._rawData.indexOf(RR);if(r!==-1){let i=this._rawData.toString("utf8",0,r).split(`\r
`);for(let s=0;s<i.length;s++){let a=i[s].split(/: +/);a[0]==="Content-Length"&&(this._contentLength=+a[1])}this._rawData=this._rawData.slice(r+RR.length);continue}}break}};this.logger=r,this._rawData=Buffer.alloc(0),e.on("end",()=>this.endedEmitter.fire()),e.on("data",this._handleData)}send(e,t=!0,r){let o=JSON.stringify(e);if(t){let s=e;e.type==="response"&&e.command==="source"&&(s={...e,body:{...e.body,content:"<script source>"}}),this.logger?.verbose("dap.send",void 0,{connectionId:this._connectionId,message:s})}let i=`Content-Length: ${Buffer.byteLength(o,"utf8")}\r
\r
${o}`;if(this.outputStream.destroyed){this.logger?.warn("dap.send","Message not sent. Connection was closed."),r?.();return}this.outputStream.write(i,"utf8",s=>{r?.(),s&&(console.log(e),this.logger?.error("dap.send","Error while writing to output stream",s),this.close())})}close(){this.inputStream.destroy(),this.outputStream.destroy()}setLogger(e){return this.logger=e,this}}});var BA,Fs,su,py=m(()=>{"use strict";BA=["[[ArrayBufferData]]"],Fs=async(n,e,t,r=0,o)=>{if(!await t(e,r)||e.variablesReference===void 0)return;if(typeof e.namedVariables=="number"||typeof e.indexedVariables=="number"){if(e.namedVariables){let s=await n.variables({variablesReference:e.variablesReference,filter:"named",format:o});for(let a of s.variables)await Fs(n,a,t,r+1,o)}if(e.indexedVariables){let s=await n.variables({variablesReference:e.variablesReference,filter:"indexed",start:0,count:e.indexedVariables,format:o});for(let a of s.variables)await Fs(n,a,t,r+1)}}else{let s=await n.variables({variablesReference:e.variablesReference,format:o});for(let a of s.variables)await Fs(n,a,t,r+1,o)}},su=class{constructor(e,t){this._dap=e,this._log=t}logAsConsole(e){e&&(e.endsWith(`
`)&&(e=e.substring(0,e.length-1)),this._log(e))}logVariable(e,t={},r=""){return Fs(this._dap,e,(o,i)=>{if(BA.includes(o.name)||t.omitProperties?.includes(o.name))return!1;let s=o.name?`${o.name}: `:"",a=(o.presentationHint?.lazy?"(...)":o.value)||"";a.endsWith(`
`)&&(a=a.substring(0,a.length-1));let c=o.type?`type=${o.type}`:"",l=o.namedVariables?` named=${o.namedVariables}`:"",p=o.indexedVariables?` indexed=${o.indexedVariables}`:"",u=r+"    ".repeat(i),g=o.variablesReference?"> ":"",w=t.logInternalInfo?`${c}${l}${p}`:"";w&&(w="  // "+w);let I=`${g}${s}${a}`;return I&&(I.includes(`
`)&&(I=`
`+I),this.logAsConsole(`${u}${I}${w}`)),i<(t.depth??1)},void 0,t.format)}async logOutput(e,t){e.group&&this.logAsConsole(`# group: ${e.group}`);let r=`${e.category}> `;if(e.output&&this.logAsConsole(`${r}${e.output}`),e.variablesReference){let o=await this._dap.variables({variablesReference:e.variablesReference});for(let i of o.variables)await this.logVariable(i,t,r)}}async logEvaluateResult(e,t){let r={...e,name:"result",value:e.result};return await this.logVariable(r,t),r}async logStackTrace(e,t=0){let r=await this._dap.stackTrace({threadId:e}),o=r.stackFrames,i=r.totalFrames||o.length;for(;o.length<i;){let a=await this._dap.stackTrace({threadId:e,startFrame:o.length,levels:Math.min(20,i-o.length)});o.push(...a.stackFrames),a.totalFrames&&(i=Math.min(i,a.totalFrames))}let s=t>0;for(let a of o){if(s&&this._log(""),a.presentationHint==="label"){this._log(`----${a.name}----`),s=!1;continue}let c=a.source&&a.source.presentationHint==="deemphasize"?` <hidden: ${a.source.origin||""}>`:"";if(this._log(`${a.name} @ ${a.source?a.source.path:"unknown"}:${a.line}:${a.column}${c}`),t--<=0)continue;let l=await this._dap.scopes({frameId:a.id});if(typeof l=="string")this._log(`  scope error: ${l}`);else for(let p=0;p<l.scopes.length;p++){let u=l.scopes[p];if(u.expensive){this._log(`  scope #${p}: ${u.name} [expensive]`);continue}await this.logVariable({name:"scope #"+p,value:u.name,variablesReference:u.variablesReference,namedVariables:u.namedVariables,indexedVariables:u.indexedVariables},{},"  ")}}return o}async evaluateAndLog(e,t={},r){if(typeof e=="string"){let o=await this._dap.evaluate({expression:e,context:r,...t.params,format:t.format});return typeof o=="string"?(this._log(`<error>: ${o}`),{name:"result",value:o,variablesReference:0}):await this.logEvaluateResult(o,t)}for(let o of e){this._log(`Evaluating: '${o}'`);let i=this._dap.evaluate({expression:o,context:r});await this.logOutput(await this._dap.once("output"),t),await i,this._log("")}}}});function Ms(n){return ER.default.join(LR.default.tmpdir(),`${n.replace(/[^a-z0-9]/gi,"-")}.json`)}var LR,ER,uy=m(()=>{"use strict";LR=y(require("os")),ER=y(require("path"))});var _R,mg,AR,_e,FR,Ns,_,Nte,fg,b,gg,ug,au,dy,my,dg,bt=m(()=>{"use strict";_R=require("fs"),mg=y(require("gulp")),AR=require("os"),_e=y(require("path")),FR=y(require("stream"));Eb();TR();W();H();O();U();le();V();J();eo();DR();ly();kn();cf();py();uy();Ns=_e.join("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test","..",".."),_=_e.join(Ns,"testWorkspace"),Nte=_e.join(Ns,"src"),fg=".dynamic-testWorkspace",b=_e.join(Ns,fg),gg=n=>process.platform==="darwin"?n.replace(/^\/private/,""):n,ug=class extends FR.Duplex{_write(e,t,r){Promise.resolve().then().then().then().then().then().then().then().then().then().then().then(()=>{this.push(e,t),r()})}_read(e){}},au=class{constructor(e){let t=new ug,r=new ug;this.adapterConnection=new ia(new iu(t,r,e),e);let o=new ia(new iu(r,t,e),e);this.dap=o.createTestApi()}async _init(){let[e]=await Promise.all([this.dap.initialize({clientID:"pwa-test",adapterID:"pwa",linesStartAt1:!0,columnsStartAt1:!0,pathFormat:"path",supportsVariablePaging:!0,supportsANSIStyling:!0}),this.dap.once("initialized")]);return e}},dy=class{constructor(e,t){this._evaluateCounter=0;this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new au(e.logger),this.dap=this._session.dap,this.logger=new su(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}async evaluate(e,t){return++this._evaluateCounter,this.log(`Evaluating#${this._evaluateCounter}: ${e}`),t===void 0?t=`//# sourceURL=eval${this._evaluateCounter}.js`:t&&(t=`//# sourceURL=${this.completeUrl(t)}`),this._cdp.Runtime.evaluate({expression:e+`
${t}`}).then(r=>{if(r){if(r.exceptionDetails){this.log(r.exceptionDetails,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}}else{this.log(e,"Error evaluating");debugger;throw new Error('Error evaluating "'+e+'"')}return r})}async addScriptTag(e){await this._cdp.Runtime.evaluate({expression:`
      new Promise(f => {
        var script = document.createElement('script');
        script.src = '${this._root.completeUrl(e)}';
        script.onload = () => f(undefined);
        document.head.appendChild(script);
      })
    `,awaitPromise:!0})}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||(t.source.path||"").indexOf(e)!==-1)}completeUrl(e){return this._root.completeUrl(e)}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t,r){e.breakpointManager.setPredictorDisabledForTest(!0),e.sourceContainer.setSourceMapTimeouts({load:0,resolveLocation:2e3,sourceMapMinPause:1e3,output:3e3,sourceMapCumulativePause:1e4}),this._adapter=e,this._root._browserLauncher=r,this._connection=this._root._browserLauncher?.connectionForTest();let o=await this._connection.rootSession().Target.attachToBrowserTarget({}),i=this._connection.createSession(o.sessionId),{sessionId:s}=await i.Target.attachToTarget({targetId:this._target instanceof Hs?this._target.targetId:this._target.id(),flatten:!0});return this._cdp=this._connection.createSession(s),await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!1}async load(){await this.dap.configurationDone({}),await this.dap.attach({}),this._cdp.Page.enable({}),this._cdp.Page.navigate({url:this._root._launchUrl}),await new Promise(e=>this._cdp.Page.on("frameStoppedLoading",e)),await this._cdp.Page.disable({})}},my=class{constructor(e,t){this._root=e,this._target=t,this.log=e.log,this.assertLog=e.assertLog,this._session=new au(e.logger),this.dap=this._session.dap,this.logger=new su(this.dap,this.log)}get cdp(){return this._cdp}get adapter(){return this._adapter}waitForSource(e){return this.dap.once("loadedSource",t=>e===void 0||G(t.source.path||"").includes(e))}workspacePath(e){return this._root.workspacePath(e)}async _init(e,t){return this._adapter=e,await this._session._init(),this._target.parent()&&(this.dap.configurationDone({}),this.dap.attach({})),!0}async load(){await this.dap.configurationDone({})}},dg=class{constructor(e,t){this._testTitlePath=t;this._targetToP=new Map;this._onSessionCreatedEmitter=new S;this.onSessionCreated=this._onSessionCreatedEmitter.event;this._args=["--headless"],this.log=e.log.bind(e),this.assertLog=e.assertLog.bind(e),this._workspaceRoot=ar(_),this._webRoot=_e.join(this._workspaceRoot,"web");let r=_e.join("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test","..",".."),o=new Map,i=bR(wR({storagePath:r,isVsCode:!0,context:hn({workspaceState:{keys:()=>[],get(a,c){return o.get(a)??c},update(a,c){return o.set(a,c),Promise.resolve()}}})}));this.logger=i.get(L),this._root=new au(this.logger);let s=this._root.adapterConnection.dap();s.on("initialize",async()=>(s.initialized({}),ns.capabilities())),s.on("configurationDone",async()=>({})),this.binder=new lg(this,this._root.adapterConnection,i,new sf("0")),this.initialize=this._root._init(),this._launchCallback=()=>{},this._workerCallback=()=>{},this._worker=new Promise(a=>this._workerCallback=a)}async acquireDap(e){let t=e.type()==="page"?new dy(this,e):new my(this,e);return this._targetToP.set(e,t),t._session.adapterConnection}async initAdapter(e,t,r){let o=this._targetToP.get(t);if(!o)return!0;let i=await o._init(e,t,r);return t.parent()?this._workerCallback(o):this._launchCallback(o),this._onSessionCreatedEmitter.fire(o),i}releaseDap(e){this._targetToP.delete(e)}setArgs(e){this._args=e}worker(){return this._worker}rootDap(){return this._root.dap}async waitForTopLevel(){return await new Promise(t=>this._launchCallback=t)}async _launch(e,t={}){await this.initialize,this._launchUrl=e;let r=require("playwright-core/lib/server").registry.findExecutable("chromium-headless-shell"),o=Ms(this._testTitlePath);return this._root.dap.launch({...ea,url:e,runtimeArgs:this._args,webRoot:this._webRoot,rootPath:this._workspaceRoot,skipNavigateForTest:!0,trace:{logFile:o},runtimeExecutable:r.executablePathOrDie(),outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,cleanUp:"wholeBrowser",...t}),await new Promise(s=>this._launchCallback=s)}async runScript(e,t={}){await this.initialize,this._launchUrl=_e.isAbsolute(e)?e:_e.join(b,e);let r=Ms(this._testTitlePath);return this._root.dap.launch({type:"pwa-node",request:"launch",name:"Test Case",cwd:_e.dirname(b),program:this._launchUrl,rootPath:this._workspaceRoot,trace:{logFile:r},runtimeVersion:process.env.JSDBG_USE_NODE_VERSION,outFiles:[`${this._workspaceRoot}/**/*.js`,"!**/node_modules/**"],resolveSourceMapLocations:["**","!**/node_modules/**"],__workspaceFolder:this._workspaceRoot,...t}),await new Promise(i=>this._launchCallback=i)}async runScriptAsRemote(e,t={}){await this.initialize,e=_e.isAbsolute(e)?e:_e.join(b,e);let r=_e.join((0,AR.tmpdir)(),"js-debug-test");return process.platform==="darwin"&&r.startsWith("/var/folders")&&(r=`/private/${r}`),after(async()=>{await _R.promises.rm(r,{recursive:!0,force:!0})}),await new Promise((i,s)=>mg.src("**/*.*",{cwd:_e.dirname(e)}).pipe(mg.dest(r)).on("end",i).on("error",s)),this._root.dap.launch({...Ul,cwd:_e.dirname(b),program:_e.join(r,_e.basename(e)),localRoot:_e.dirname(e),remoteRoot:r,trace:{logFile:Ms(this._testTitlePath)},outFiles:[],resolveSourceMapLocations:["**","!**/node_modules/**"],env:{NODE_PATH:[process.env.NODE_PATH,_e.resolve(_e.dirname(e),"node_modules"),_e.resolve(Ns,"node_modules")].filter(Boolean).join(process.platform==="win32"?";":":")},__workspaceFolder:this._workspaceRoot,...t}),await new Promise(i=>this._launchCallback=i)}async attachNode(e,t={}){await this.initialize,this._launchUrl=`process${e}`,this._root.dap.launch({...Fn,trace:{logFile:Ms(this._testTitlePath)},processId:`inspector${e}`,__workspaceFolder:this._workspaceRoot,...t});let r=await new Promise(o=>this._launchCallback=o);return await r.load(),r}async launch(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64");return this._launch(r,t)}async launchAndLoad(e,t={}){let r="data:text/html;base64,"+Buffer.from(e).toString("base64"),o=await this._launch(r,t);return await o.load(),o}buildUrl(e){return Xr("http://localhost:8001/",e)||e}async launchUrl(e,t={}){return await this._launch(this.buildUrl(e),t)}async launchUrlAndLoad(e,t={}){let r=await this._launch(this.buildUrl(e),t);return await r.load(),r}async disconnect(){return new Promise(e=>{this.initialize.then(()=>{let t=this._browserLauncher?.connectionForTest();if(t){let r=t.onDisconnected(()=>{e(),r.dispose()})}else e();this._root.dap.disconnect({}),this.binder.dispose()})})}completeUrl(e){return Xr(this._launchUrl,e)||""}workspacePath(e){return _e.join(this._workspaceRoot,e)}}});var fy,dn,bg,jA,UA,MR,NR,hg,gy=m(()=>{"use strict";fy=require("chai"),dn=y(require("fs")),bg=y(require("path"));le();Yr();V();bt();jA=["id","threadId","sourceReference","variablesReference"],UA=new Set(["hitBreakpointIds"]),MR=n=>n.split(`
`).map(e=>e.trimRight()).join(`
`).replace(/\\r\\n/g,"\\n"),NR=n=>n.replace(/^.*<node_internals>.*\r?\n/gm,"").replace(/^.*@ internal\/.*\r?\n/gm,""),hg=class{constructor(e,t,r){this.testFile=t;this._results=[],this._testName=e,this._hasNonAssertedLogs=!1,this._workspaceFolder=ar(r)}hasNonAssertedLogs(){return this._hasNonAssertedLogs}getOutput(){return MR(this._results.join(`
`)+`
`)}assertLog(e={}){let t=this.getOutput();if(this._hasNonAssertedLogs=!1,e.customAssert){e.customAssert(t);return}e.process&&(t=e.process(t));let r=this.findGoldenFilePath();if(!dn.existsSync(r))console.log("----- Missing expectations file, writing a new one"),dn.writeFileSync(r,t,{encoding:"utf-8"});else if(process.env.RESET_RESULTS)dn.writeFileSync(r,t,{encoding:"utf-8"});else{let o=MR(dn.readFileSync(r).toString("utf-8"));try{e.substring?(0,fy.expect)(t).to.contain(o):(0,fy.expect)(t).to.equal(o)}catch(i){throw dn.writeFileSync(r+".actual",t,{encoding:"utf-8"}),i}}}findGoldenFilePath(){let e=this.testFile;if(!e)throw new Error("GoldenText failed to get filename!");let t=this._testName.trim().toLowerCase().replace(/\s/g,"-").replace(/[^-0-9a-z-]/gi,""),r=bg.resolve(bg.dirname(e),t),o=r+`.${process.platform}.txt`;return dn.existsSync(o)?o:r+".txt"}_sanitize(e){let t=(r,o)=>{let i=yt(G(r),"/"),s=new RegExp(i.replace(/\//g,"[\\\\/]")+"(.*)","gi");e=e.replace(s,(a,c)=>o+G(c))};return e=String(e),t(this._workspaceFolder,"${workspaceFolder}"),t(this._workspaceFolder.replace(/\\/g,"\\\\"),"${workspaceFolder}"),t(b,"${fixturesDir}"),e=e.replace(/testWorkspace/g,"${workspaceFolder}"),e=e.replace("/private${fixturesDir}","${fixturesDir}"),e=e.split(`
`).filter(r=>!r.includes("hidden: blackboxed")).join(`
`),e.replace(/VM\d+/g,"VM<xx>").replace(/logpoint-.*?\.cdp/g,"logpoint-<hash>.cdp").replace(/\r\n/g,`
`).replace(/@\ .*vscode-pwa(\/|\\)/g,"@ ").replace(/data:text\/html;base64,[a-zA-Z0-9+/]*=?/g,"<data-url>")}log(e,t,r){return this._hasNonAssertedLogs=!0,typeof e=="object"?this._logObject(e,t,r):(this._results.push((t||"")+this._sanitize(e)),e)}_logObject(e,t,r){r=r||jA;let o=[],i=(c,l,p)=>{typeof c=="object"&&c!==null?c instanceof Array?a(c,l,p):s(c,l,p):o.push(p+this._sanitize(c).replace(/\n/g," "))};function s(c,l,p){l=l||"",p=p||l,o.push(p+"{");let u=Object.keys(c);u.sort();for(let g=0;g<u.length;++g){let w=u[g];if(!c.hasOwnProperty(w)||UA.has(w))continue;let I="    "+l+w+" : ",v=c[w];r&&r.includes(w)&&(v=`<${typeof v}>`),i(v,"    "+l,I)}o.push(l+"}")}function a(c,l,p){l=l||"",p=p||l,o.push(p+"[");for(let u=0;u<c.length;++u)i(c[u],"    "+l,"    "+l+"["+u+"] : ");o.push(l+"]")}return i(e,"",t||""),this._results.push(...o),e}}});var BR={};Lg(BR,{eventuallyOk:()=>ne,itIntegrates:()=>f,waitForPause:()=>P});async function P(n,e){let{threadId:t}=n.log(await n.dap.once("stopped"));return await n.logger.logStackTrace(t),await e?.(t),n.dap.continue({threadId:t})}var hy,OR,by,wg,cu,f,ne,$e=m(()=>{"use strict";hy=y(require("child_process")),OR=require("fs"),by=y(require("path"));$();gy();bt();process.env.DA_TEST_DISABLE_TELEMETRY="true";before(async()=>{wg=[hy.fork(by.join("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test","testServer.js"),["8001"],{stdio:"pipe"}),hy.fork(by.join("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test","testServer.js"),["8002"],{stdio:"pipe"})],await Promise.all(wg.map(n=>new Promise((e,t)=>{let r="";n.stderr?.on("data",o=>r+=o.toString()),n.stdout?.on("data",o=>r+=o.toString()),n.once("error",t),n.once("close",o=>t(new Error(`Exited with ${o}, stderr=${r}`))),n.once("message",e)})))});after(async()=>{wg.forEach(n=>n.kill()),wg=[]});cu=(n,e,t=it)=>t(n,async function(){if(!this.test?.file)throw new Error("Could not find file for test");let r=new hg(this.test.titlePath().join(" "),this.test?.file,_),o=new dg(r,this.test.fullTitle());await o.initialize;try{this.test.goldenText=r,await e({golden:r,r:o,context:this})}finally{try{await o.disconnect()}catch(i){console.warn("Error disconnecting test root:",i)}}if(r.hasNonAssertedLogs())throw new Error(`Whoa, test "${n}" has some logs that it did not assert!

${r.getOutput()}`)});cu.only=(n,e)=>cu(n,e,it.only);cu.skip=(n,e)=>cu(n,e,it.skip);f=cu,ne=async(n,e=1e3,t=10)=>{let r=Date.now()+e;for(;;)try{return await n()}catch(o){if(Date.now()+t>r)throw o;await x(t)}};afterEach(async()=>{for(let n=10;n>=0;n--)try{await OR.promises.rm(b,{recursive:!0,force:!0});return}catch(e){if(n===0)throw e;await x(100)}})});var WA={};var Sr,lu,jR,UR=m(()=>{"use strict";Sr=require("chai"),lu=require("fs"),jR=y(require("ws"));Su();bt();$e();describe("browser launch",()=>{f("environment variables",async({r:n})=>{if(process.platform==="win32")return;await(await n.launchUrlAndLoad("index.html",{env:{TZ:"GMT"}})).logger.evaluateAndLog("new Date().getTimezoneOffset()"),n.assertLog()}),f("runtime args",async({r:n})=>{await(await n.launchUrlAndLoad("index.html",{runtimeArgs:["--window-size=678,456"]})).logger.evaluateAndLog("[window.outerWidth, window.outerHeight]"),n.assertLog()}),f.skip("user data dir",async({r:n})=>{(0,lu.mkdirSync)(b,{recursive:!0}),(0,Sr.expect)((0,lu.readdirSync)(b)).to.be.empty,await n.launchUrlAndLoad("index.html",{userDataDir:b}),(0,Sr.expect)((0,lu.readdirSync)(b)).to.not.be.empty}),f("connects to rewritten websocket when using inspectUri parameter",async({r:n})=>{let t=new jR.default.WebSocketServer({port:5935,path:"/_framework/debug/ws-proxy"});try{let r=new Promise(o=>{t.on("connection",i=>{i.on("message",s=>{let a=JSON.parse(s.toString());i.send(JSON.stringify({id:a.id,error:{message:"Fake websocket"}})),o(s.toString()),i.close()})})});n.launchUrl("index.html",{inspectUri:"{wsProtocol}://{url.hostname}:5935/_framework/debug/ws-proxy?browser={browserInspectUri}"}),(0,Sr.expect)(await r).to.be.eq('{"id":1001,"method":"Target.attachToBrowserTarget","params":{}}')}finally{await new Promise(r=>t.close(r))}})});describe("constructInspectorWSUri",()=>{let n="{wsProtocol}://{url.hostname}:{url.port}/_framework/debug/ws-proxy?browser={browserInspectUri}",e="http://localhost:5001/",t="ws://127.0.0.1:36775/devtools/browser/a292f96c-7332-4ce8-82a9-7411f3bd280a",r=encodeURIComponent(t),o="https://localhost:5001/";it("interpolates arguments to construct inspectUri",()=>{(0,Sr.expect)(Vt(n,e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}`),(0,Sr.expect)(Vt(n,o,t)).to.be.eq(`wss://localhost:5001/_framework/debug/ws-proxy?browser=${r}`)}),it("does not do anything with arguments that does not exist",()=>{(0,Sr.expect)(Vt(n+"&{iDoNotExist}{meEither}",e,t)).to.be.eq(`ws://localhost:5001/_framework/debug/ws-proxy?browser=${r}&{iDoNotExist}{meEither}`)}),it("fails with an useful error for invalid urls",()=>{(0,Sr.expect)(()=>Vt(n,".not_an_url",t)).to.throw(/Invalid URL/),(0,Sr.expect)(()=>Vt(n,null,t)).to.throw("A valid url wasn't supplied: <null>"),(0,Sr.expect)(()=>Vt(n,void 0,t)).to.throw("A valid url wasn't supplied: <undefined>"),(0,Sr.expect)(()=>Vt(n,"",t)).to.throw("A valid url wasn't supplied: <>")});let i="ws://localhost:1234/_framework/debug/ws-proxy?browser={browserInspectUri}";it("does not fail for an invalid url if it isnt used",()=>{(0,Sr.expect)(Vt(i,".not_an_url",t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`),(0,Sr.expect)(Vt(i,void 0,t)).to.be.eq(`ws://localhost:1234/_framework/debug/ws-proxy?browser=${r}`)})})});var VA={};var wy,WR=m(()=>{"use strict";wy=require("chai");$e();describe("performance",()=>{f("gets performance information",async({r:n})=>{let t=await(await n.launchUrlAndLoad("index.html")).dap.getPerformance({});(0,wy.expect)(t.error).to.be.undefined,(0,wy.expect)(t.metrics).to.not.be.empty})})});var $A={};var hl,At,VR=m(()=>{"use strict";hl=y(require("assert")),At=require("chai");Ke();$();describe("CancellationToken",()=>{it("None",()=>{(0,At.expect)(Je.isCancellationRequested).to.equal(!1),(0,At.expect)(typeof Je.onCancellationRequested).to.equal("function")}),it("cancel before token",function(n){let e=new we;(0,At.expect)(e.token.isCancellationRequested).to.equal(!1),e.cancel(),(0,At.expect)(e.token.isCancellationRequested).to.equal(!0),e.token.onCancellationRequested(()=>{hl.ok(!0),n()})}),it("cancel happens only once",()=>{let n=new we;(0,At.expect)(n.token.isCancellationRequested).to.equal(!1);let e=0;function t(){e+=1}n.token.onCancellationRequested(t),n.cancel(),n.cancel(),(0,At.expect)(e).to.equal(1)}),it("cancel calls all listeners",()=>{let n=0,e=new we;e.token.onCancellationRequested(()=>{n+=1}),e.token.onCancellationRequested(()=>{n+=1}),e.token.onCancellationRequested(()=>{n+=1}),e.cancel(),(0,At.expect)(n).to.equal(3)}),it("token stays the same",()=>{let n=new we,e=n.token;hl.ok(e===n.token),n.cancel(),hl.ok(e===n.token),n.cancel(),hl.ok(e===n.token),n=new we,n.cancel(),e=n.token,hl.ok(e===n.token)}),it("dispose calls no listeners",()=>{let n=0,e=new we;e.token.onCancellationRequested(()=>{n+=1}),e.dispose(),e.cancel(),(0,At.expect)(n).to.equal(0)}),it("dispose calls no listeners (unless told to cancel)",()=>{let n=0,e=new we;e.token.onCancellationRequested(()=>{n+=1}),e.dispose(!0),(0,At.expect)(n).to.equal(1)}),it("parent cancels child",()=>{let n=new we,e=new we(n.token),t=0;e.token.onCancellationRequested(()=>t+=1),n.cancel(),(0,At.expect)(t).to.equal(1),(0,At.expect)(e.token.isCancellationRequested).to.equal(!0),(0,At.expect)(n.token.isCancellationRequested).to.equal(!0)}),describe("cancellableRace",()=>{it("returns the value when no cancellation is requested",async()=>{let n=await Xt(Promise.resolve(42),Je);(0,At.expect)(n).to.equal(42)}),it("throws if cancellation is requested",async()=>{try{throw await Xt(Promise.resolve(42),Eh),new Error("expected to throw")}catch(n){if(n instanceof Rt)(0,At.expect)(n.message).to.equal("Task cancelled");else throw n}}),it("throws if lazy cancellation is requested",async()=>{try{throw await Xt(x(1e3),we.withTimeout(3).token,"Could not do the thing"),new Error("expected to throw")}catch(n){if(n instanceof Rt)(0,At.expect)(n.message).to.equal("Could not do the thing");else throw n}})})})});var qA={};var yg,$R,yy,vy,qR,HR=m(()=>{"use strict";yg=require("chai"),$R=require("crypto"),yy=require("sinon"),vy=require("stream"),qR=require("ws");Qa();ni();Ke();ro();$e();describe("cdp transport",()=>{let n=[["raw pipe",async()=>{let e=new vy.PassThrough,t=new vy.PassThrough,r=new dr(j.null,e,t),o=new dr(j.null,t,e);return{a:r,b:o,dispose:()=>{}}}],["websocket",async()=>{let e=new qR.Server({host:"127.0.0.1",port:0});await new Promise((i,s)=>{e.on("listening",i),e.on("error",s)});let t=e.address(),r=mt.create(`ws://127.0.0.1:${t.port}`,Je),o=new Promise((i,s)=>{e.on("connection",a=>i(new mt(a))),e.on("error",s)});return{a:await r,b:await o,dispose:()=>e.close()}}]];for(let[e,t]of n)describe(e,()=>{it("round-trips",async()=>{let r=(0,$R.randomBytes)(100),{a:o,b:i,dispose:s}=await t(),a=[],c=[];i.onMessage(([l])=>a.push(l));for(let l=0;l<r.length;){let p=1+Math.floor(Math.random()*20),u=r.slice(l,l+p).toString("base64");c.push(u),o.send(u),l+=p}await ne(()=>(0,yg.expect)(a).to.deep.equal(c)),await o.dispose(),s()}),it("bubbles closure",async()=>{let{a:r,b:o,dispose:i}=await t(),s=(0,yy.stub)(),a=(0,yy.stub)();r.onEnd(s),o.onEnd(a),await r.dispose(),await ne(()=>(0,yg.expect)(s.called).to.be.true),await ne(()=>(0,yg.expect)(a.called).to.be.true),i()})})})});var HA={};var zR,vg,GR=m(()=>{"use strict";zR=require("chai"),vg=require("sinon");O();ro();describe("Logger",()=>{let n,e;beforeEach(()=>{n={write:(0,vg.stub)(),setup:(0,vg.stub)().resolves(),dispose:(0,vg.stub)()},e=new j}),it("buffers and logs messages once sinks are attached",async()=>{e.verbose("runtime","Hello world!"),await e.setup({sinks:[n],showWelcome:!1}),(0,zR.expect)(n.write.args[0][0]).to.containSubset({tag:"runtime",message:"Hello world!",level:0})})})});var zA={};var mn,JR=m(()=>{"use strict";mn=require("chai");zs();describe("mapUsingProjection",()=>{it("gets values",()=>{let n=new Ct(e=>e.toLowerCase());n.set("bar",1),(0,mn.expect)(n.get("foo")).to.be.undefined,(0,mn.expect)(n.get("bar")).to.equal(1),(0,mn.expect)(n.get("bAr")).to.equal(1)}),it("sets values",()=>{let n=new Ct(e=>e.toLowerCase());n.set("bar",1),(0,mn.expect)(n.get("bar")).to.equal(1),n.set("BAR",2),(0,mn.expect)(n.get("bar")).to.equal(2)}),it("deletes values",()=>{let n=new Ct(e=>e.toLowerCase());n.set("bar",1),n.delete("bAr"),(0,mn.expect)(n.get("bar")).to.be.undefined}),it("gets keys",()=>{let n=new Ct(e=>e.toLowerCase());n.set("FOO",1),n.set("bar",1),(0,mn.expect)([...n.keys()].sort()).to.deep.equal(["FOO","bar"])}),it("gets values",()=>{let n=new Ct(e=>e.toLowerCase());n.set("FOO",1),n.set("bar",2),(0,mn.expect)([...n.values()].sort()).to.deep.equal([1,2])})})});var GA={};var kt,KR=m(()=>{"use strict";kt=require("chai");le();describe("pathUtils",()=>{describe("forceForwardSlashes",()=>{it("works for c:/... cases",()=>{(0,kt.expect)(G("C:\\foo\\bar")).to.equal("C:/foo/bar"),(0,kt.expect)(G("C:\\")).to.equal("C:/"),(0,kt.expect)(G("C:/foo\\bar")).to.equal("C:/foo/bar")}),it("works for relative paths",()=>{(0,kt.expect)(G("foo\\bar")).to.equal("foo/bar"),(0,kt.expect)(G("foo\\bar/baz")).to.equal("foo/bar/baz")}),it("fixes escaped forward slashes",()=>{(0,kt.expect)(G("foo\\/bar")).to.equal("foo/bar")})}),describe("fixDriveLetterAndSlashes",()=>{it("works for c:/... cases",()=>{(0,kt.expect)(ee("C:/path/stuff")).to.equal("c:\\path\\stuff"),(0,kt.expect)(ee("c:/path\\stuff")).to.equal("c:\\path\\stuff"),(0,kt.expect)(ee("C:\\path")).to.equal("c:\\path"),(0,kt.expect)(ee("C:\\")).to.equal("c:\\")}),it("works for file:/// cases",()=>{(0,kt.expect)(ee("file:///C:/path/stuff")).to.equal("file:///c:\\path\\stuff"),(0,kt.expect)(ee("file:///c:/path\\stuff")).to.equal("file:///c:\\path\\stuff"),(0,kt.expect)(ee("file:///C:\\path")).to.equal("file:///c:\\path"),(0,kt.expect)(ee("file:///C:\\")).to.equal("file:///c:\\")}),it("does not impact posix cases",()=>{(0,kt.expect)(ee("file:///a/b")).to.equal("file:///a/b"),(0,kt.expect)(ee("/a/b")).to.equal("/a/b")})})})});var JA={};var lo,QR,XR=m(()=>{"use strict";lo=require("chai"),QR=y(require("path"));ro();le();Ym();describe("SourceMapOverrides",()=>{describe("getComputedSourceRoot()",()=>{let n=(...s)=>fe(QR.resolve(...s)),e=n("/project/webroot/code/script.js"),t="http://localhost:8080/code/script.js",r=n("/project/src"),o=n("/project/webroot"),i={"/":o};it("handles file:/// sourceRoot",async()=>{(0,lo.expect)(await Bt("file:///"+r,e,i,Et,j.null)).to.equal(r)}),it("handles /src style sourceRoot",async()=>{(0,lo.expect)(await Bt("/src",e,i,Et,j.null)).to.equal(n("/project/webroot/src"))}),it("handles /src style without matching pathMapping",async()=>{(0,lo.expect)(await Bt("/foo/bar",e,{},Et,j.null)).to.equal("/foo/bar")}),it("handles c:/src style without matching pathMapping",async()=>{(0,lo.expect)(await Bt("c:\\foo\\bar",e,{},Et,j.null)).to.equal("c:\\foo\\bar")}),it("handles ../../src style sourceRoot",async()=>{(0,lo.expect)(await Bt("../../src",e,i,Et,j.null)).to.equal(r)}),it("handles src style sourceRoot",async()=>{(0,lo.expect)(await Bt("src",e,i,Et,j.null)).to.equal(n("/project/webroot/code/src"))}),it("handles runtime script not on disk",async()=>{(0,lo.expect)(await Bt("../src",t,i,Et,j.null)).to.equal(n("/project/webroot/src"))}),it("when no sourceRoot specified and runtime script is on disk, uses the runtime script dirname",async()=>{(0,lo.expect)(await Bt("",e,i,Et,j.null)).to.equal(n("/project/webroot/code"))}),it("when no sourceRoot specified and runtime script is not on disk, uses the runtime script dirname",async()=>{(0,lo.expect)(await Bt("",t,i,Et,j.null)).to.equal(n("/project/webroot/code"))}),it("no crash on debugadapter:// urls",async()=>{(0,lo.expect)(await Bt("","eval://123",i,Et,j.null)).to.equal(n(o))})})})});function D(n,e){pu.mkdirSync(n,{recursive:!0});for(let t of Object.keys(e)){let r=e[t],o=Ig.join(n,t),i;if(typeof r=="string")i=Buffer.from(r);else if(r instanceof Buffer)i=r;else if(r instanceof Array)i=Buffer.from(r.join(Iy.EOL));else{D(o,r);continue}pu.mkdirSync(Ig.dirname(o),{recursive:!0}),pu.writeFileSync(o,i)}}var pu,Iy,Ig,Gr=m(()=>{"use strict";pu=y(require("fs")),Iy=require("os"),Ig=y(require("path"))});var KA={};var fn,ot,YR=m(()=>{"use strict";fn=require("chai"),ot=require("path");ma();ro();le();jb();V();Gr();bt();describe("ISourceMapRepository",()=>{[{name:"TurboSearchStrategy",create:()=>new ri(j.null)}].forEach(n=>describe(n.name,()=>{let e;beforeEach(()=>{e=n.create(),D(b,{"a.js":"//# sourceMappingURL=a.js.map","a.js.map":"content1","c.js":"no.sourcemap.here",nested:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},node_modules:{"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"},defaultSearchExcluded:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}})});let t=(s,a)=>new cr({rootPath:s,patterns:[`${a}/**/*.js`,"!**/node_modules/**"]}),r=async s=>(await e.streamChildrenWithSourcemaps({files:s,processMap:async c=>{let{cacheKey:l,...p}=c;return(0,fn.expect)(l).to.be.within(Date.now()-6e4,Date.now()+1e3),p.compiledPath=ee(p.compiledPath),p},onProcessedMap:c=>c})).values.sort((c,l)=>c.compiledPath.length-l.compiledPath.length),o=async s=>(await r(s)).map(c=>ee(c.compiledPath)),i=s=>e.streamAllChildren(s,a=>a).then(a=>a.sort());it("no-ops for non-existent directories",async()=>{(0,fn.expect)(await r(t("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/common","does-not-exist"))).to.be.empty}),it("discovers source maps and applies negated globs",async()=>{(0,fn.expect)(await r(t(Ns,fg))).to.deep.equal([{compiledPath:fe((0,ot.join)(b,"a.js")),sourceMapUrl:Q((0,ot.join)(b,"a.js.map"))},{compiledPath:fe((0,ot.join)(b,"nested","d.js")),sourceMapUrl:Q((0,ot.join)(b,"nested","d.js.map"))},{compiledPath:fe((0,ot.join)(b,"defaultSearchExcluded","f.js")),sourceMapUrl:Q((0,ot.join)(b,"defaultSearchExcluded","f.js.map"))}])}),it("applies second patterns (vscode#168635)",async()=>{D(b,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2"},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3"}}),(0,fn.expect)(await o(new cr({patterns:["rootPath/*.js","otherFolder/*.js"],rootPath:b}))).to.deep.equal([fe((0,ot.join)(b,"rootPath","d.js")),fe((0,ot.join)(b,"otherFolder","f.js"))])}),it("globs for a single file",async()=>{(0,fn.expect)(await o(new cr({patterns:["nested/d.js"],rootPath:b}))).to.deep.equal([fe((0,ot.join)(b,"nested","d.js"))])}),it("applies negated globs outside rootPath (#1479)",async()=>{let s={"e.js":"//# sourceMappingURL=e.js.map","e.js.map":"content3"};D(b,{rootPath:{"d.js":"//# sourceMappingURL=d.js.map","d.js.map":"content2",node_modules:s},otherFolder:{"f.js":"//# sourceMappingURL=f.js.map","f.js.map":"content3",node_modules:s}}),(0,fn.expect)(await o(new cr({patterns:["**/*.js","../otherFolder/**/*.js","!**/node_modules/**"],rootPath:(0,ot.join)(b,"rootPath")}))).to.deep.equal([fe((0,ot.join)(b,"rootPath","d.js")),fe((0,ot.join)(b,"otherFolder","f.js"))])}),it("streams all children",async()=>{(0,fn.expect)(await i(t(Ns,fg))).to.deep.equal([fe((0,ot.join)(b,"a.js")),fe((0,ot.join)(b,"c.js")),fe((0,ot.join)(b,"defaultSearchExcluded","f.js")),fe((0,ot.join)(b,"nested","d.js"))])}),it("greps inside node_modules explicitly",async()=>{(0,fn.expect)(await r(t((0,ot.join)(b,"node_modules"),"."))).to.deep.equal([{compiledPath:fe((0,ot.join)(b,"node_modules","e.js")),sourceMapUrl:Q((0,ot.join)(b,"node_modules","e.js.map"))}])})}))})});var QA={};var bl,ZR=m(()=>{"use strict";bl=require("chai");$e();describe("completion",()=>{let n=[["ar|",[{label:"arr",sortText:"~~arr",type:"variable",detail:"Array",start:0,length:2}]],["ar|.length",[{label:"arr",sortText:"~~arr",type:"variable",detail:"Array",start:0,length:2}]],["arr.|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:3},{label:"length",detail:"3",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr.len|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:3},{label:"length",detail:"3",sortText:"~~length",type:"property"}]],["arr[|",[]],["arr[0].|",[{label:"length",detail:"0",sortText:"~~length",type:"property"},{label:"anchor",detail:"fn(?)",sortText:"~~~anchor",type:"method"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["arr[2].|",[]],["obj.|",[{label:"bar",detail:"42",sortText:"~~bar",type:"property"},{label:"baz",detail:"fn()",sortText:"~~baz",type:"method"},{label:"foo",detail:"string",sortText:"~~foo",type:"property"}]],["ob|",[{label:"obj",sortText:"~~obj",type:"variable",detail:"Object",start:0,length:2}]],["arr[myStr|",[{label:"myString",sortText:"~~myString",type:"variable",detail:"string",start:4,length:5}]],["const replVar = 42; replV|",[{label:"replVar",sortText:"replVar",type:"variable",start:20,length:5}]],["MyCoolCl|",[{label:"MyCoolClass",sortText:"~~MyCoolClass",type:"class",detail:"fn()",start:0,length:8}]],["Strin|",[{label:"String",sortText:"~~String",type:"class",detail:"fn(?)",start:0,length:5}]],["myNeatFun|",[{label:"myNeatFunction",sortText:"~~myNeatFunction",type:"function",detail:"fn()",start:0,length:9}]],["new Array(42).|",[{label:"[index]",text:"[index]",type:"property",sortText:"~~[",length:1,selectionLength:5,selectionStart:1,start:13},{label:"length",detail:"42",sortText:"~~length",type:"property"},{label:"at",detail:"fn(?)",sortText:"~~~at",type:"method"}]],["poison.|",[{label:"bar",sortText:"~~bar",type:"property",detail:"true"},{label:"foo",sortText:"~~foo",type:"property"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"}]],["hasPrivate.|",[{label:"c",sortText:"~~c",type:"property",detail:"3"},{label:"_a",sortText:"~~{a",type:"property",detail:"1"},{label:"__b",sortText:"~~{{b",type:"property",detail:"2"}]],["complexProp.|",[{label:"complex prop",text:'["complex prop"]',start:11,length:1,type:"property",sortText:"~~complex prop",detail:"true"},{label:"constructor",sortText:"~~~constructor",type:"class",detail:"fn(?)"},{label:"hasOwnProperty",sortText:"~~~hasOwnProperty",type:"method",detail:"fn(?)"}]],["$returnV|",[]]];f("completion",async({r:e})=>{let t=await e.launchAndLoad(`
      <script>
        var arr = ['', {}, null];
        var obj = { foo: '', bar: 42, baz() {} };
        var myString = '';
        var MyCoolClass = class MyCoolClass {} // need to be hoisted manually
        function myNeatFunction() {}
        var hasPrivate = { _a: 1, __b: 2, c: 3 };
        var poison = { get foo() { throw new Error('oh no!') }, bar: true };
        var complexProp = { 'complex prop': true };
      </script>
    `);for(let[r,o]of n){let i=r.indexOf("|"),s=await t.dap.completions({text:r.slice(0,i)+r.slice(i+1),column:i+1});(0,bl.expect)(s.targets.slice(0,3)).to.deep.equal(o,`bad result evaluating ${r}`)}}),f("completes in scope (vscode#153651)",async({r:e})=>{let t=await e.launch(`
      <script>
        function foo() {
          const helloWorld = '';
          debugger;
        }

        foo();
      </script>
    `),r=t.dap.once("stopped");t.load();let o=(await t.dap.stackTrace({threadId:(await r).threadId})).stackFrames[0],i=await t.dap.completions({text:"helloW",column:7,frameId:o.id});(0,bl.expect)(i.targets).to.deep.equal([{label:"helloWorld",type:"property",start:0,length:6}])}),f("$returnValue",async({r:e})=>{let t=async()=>(await r.dap.stackTrace({threadId:o})).stackFrames[0].id,r=await e.launchAndLoad(`
      <script>
        function foo() {
          debugger;
          return { a: { b: 2 }};
        }
      </script>
    `);r.dap.evaluate({expression:"foo() "});let{threadId:o}=await r.dap.once("stopped");await r.dap.next({threadId:o}),await r.dap.once("stopped");let i=await r.dap.completions({text:"$returnValu",column:11,frameId:await t()});(0,bl.expect)(i.targets).to.not.containSubset([{sortText:"~$returnValue"}]),await r.dap.next({threadId:o}),await r.dap.once("stopped");let s=await t(),a=await r.dap.completions({text:"$returnValu",column:11,frameId:s});(0,bl.expect)(a.targets).to.containSubset([{label:"$returnValue",type:"variable",sortText:"~$returnValue"}]);let c=await r.dap.completions({text:"$returnValue.",column:14,frameId:s});(0,bl.expect)(c.targets).to.containSubset([{label:"a",sortText:"~~a",type:"property"}])})})});var wl,Sy=m(()=>{"use strict";wl=class{constructor(){this.data=new Map}keys(){return[...this.data.keys()]}get(e,t){return this.data.has(e)?this.data.get(e):t}update(e,t){return this.data.set(e,t),Promise.resolve()}}});var XA={};var Si,eD,tD,rD=m(()=>{"use strict";Si=require("chai"),eD=require("path"),tD=y(require("vscode"));W();_o();U();Ew();Gr();bt();Sy();describe("ExtensionHostConfigurationProvider",()=>{let n,e=r=>({uri:tD.Uri.file((0,eD.join)(b,r)),name:"test-dir",index:0}),t={type:"pwa-extensionHost",name:"",request:"",args:["--extensionDevelopmentPath=${workspaceFolder}"]};beforeEach(()=>{n=new wi(hn({logPath:b,workspaceState:new wl})),xe.platform="linux"}),describe("web worker debugging",()=>{beforeEach(()=>D(b,{"withWeb/package.json":JSON.stringify({extensionKind:["web"]}),"withoutWeb/package.json":JSON.stringify({}),"withEntrypoint1/package.json":JSON.stringify({main:"./foo/j/x.js"}),"withEntrypoint2/nested/package.json":JSON.stringify({main:"./bar/j/x.js"})})),it("does not enable if no args",async()=>{let r=await n.resolveDebugConfiguration(e("withWeb"),{...t,args:[]});(0,Si.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not enable if wrong type",async()=>{let r=await n.resolveDebugConfiguration(e("withoutWeb"),t);(0,Si.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not enable if enoent folder",async()=>{let r=await n.resolveDebugConfiguration(e("doesNotExist"),t);(0,Si.expect)(r?.debugWebWorkerHost).to.be.false}),it("does not override existing option",async()=>{let r=await n.resolveDebugConfiguration(e("doesNotExist"),{...t,debugWebWorkerHost:!0});(0,Si.expect)(r?.debugWebWorkerHost).to.be.true}),it("enables if all good",async()=>{let r=await n.resolveDebugConfiguration(e("withWeb"),t);(0,Si.expect)(r?.debugWebWorkerHost).to.be.true}),it("guesses outfiles 1",async()=>{let r=await n.resolveDebugConfiguration(e("withEntrypoint1"),t);(0,Si.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/foo/**/*.js"])}),it("guesses outfiles 2",async()=>{let r=await n.resolveDebugConfiguration(e("withEntrypoint2"),{type:"pwa-extensionHost",name:"",request:"",args:["--extensionDevelopmentPath=${workspaceFolder}/nested"]});(0,Si.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/nested/bar/**/*.js"])})})})});var YA={};var te,oD,po,nD,nr,iD=m(()=>{"use strict";te=require("chai"),oD=require("fs"),po=require("path"),nD=require("sinon"),nr=y(require("vscode"));W();_o();de();U();_c();Gr();bt();Sy();describe("NodeDebugConfigurationProvider",()=>{let n,e,t={uri:nr.Uri.file(b),name:"test-dir",index:0};beforeEach(()=>{e={resolveNvmVersionPath:(0,nD.stub)()},n=new Uo(hn({logPath:b,workspaceState:new wl}),e,new ve(oD.promises)),xe.platform="linux"}),afterEach(()=>{xe.platform=process.platform}),describe("logging resolution",()=>{let r={type:"node",name:"",request:""};beforeEach(()=>{D(b,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})})}),it("does not log by default",async()=>{let o=await n.resolveDebugConfiguration(t,r);(0,te.expect)(o.trace).to.deep.equal({stdio:!1,logFile:null})}),it("applies defaults with trace=true",async()=>{let o=await n.resolveDebugConfiguration(t,{...r,trace:!0});(0,te.expect)(o.trace).to.containSubset({stdio:!0})})}),describe("launch config from context",()=>{let r={type:"",name:"",request:""};it("loads the program from a package.json main if available",async()=>{D(b,{"hello.js":"","package.json":JSON.stringify({main:"hello.js"})});let o=await n.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,te.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,po.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("loads the program from a package.json start script if available",async()=>{D(b,{"hello.js":"","package.json":JSON.stringify({scripts:{start:"node hello.js"}})});let o=await n.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,te.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,po.join)("${workspaceFolder}","hello.js"),request:"launch"})}),it("configures mern starters",async()=>{D(b,{"hello.js":"","package.json":JSON.stringify({name:"mern-starter"})});let o=await n.resolveDebugConfiguration(t,r);(0,te.expect)(o).to.containSubset({runtimeExecutable:"nodemon",program:"${workspaceFolder}/index.js",restart:!0,env:{BABEL_DISABLE_CACHE:"1",NODE_ENV:"development"}})}),it("loads a common entrypoint if available",async()=>{D(b,{"main.js":""});let o=await n.resolveDebugConfiguration(t,r);o.cwd=o.cwd.toLowerCase(),(0,te.expect)(o).to.containSubset({type:"pwa-node",cwd:b.toLowerCase(),name:"Launch Program",program:(0,po.join)("${workspaceFolder}","main.js"),request:"launch"})}),it("attempts to load the active text editor",async()=>{D(b,{"hello.js":""});let o=await nr.workspace.openTextDocument((0,po.join)(b,"hello.js"));await nr.window.showTextDocument(o);try{let i=await n.resolveDebugConfiguration(t,r);(0,te.expect)(i).to.containSubset({program:(0,po.join)("${workspaceFolder}","hello.js")})}finally{await nr.commands.executeCommand("workbench.action.closeActiveEditor")}}),it("applies tsconfig settings automatically",async()=>{D(b,{out:{"hello.js":""},src:{"hello.ts":""},"package.json":JSON.stringify({main:"out/hello.js"}),"tsconfig.json":JSON.stringify({compilerOptions:{outDir:"out"}})});let o=await nr.workspace.openTextDocument((0,po.join)(b,"src","hello.ts"));await nr.window.showTextDocument(o);try{let i=await n.resolveDebugConfiguration(t,r);(0,te.expect)(i).to.containSubset({program:(0,po.join)("${workspaceFolder}","out","hello.js"),preLaunchTask:"tsc: build - tsconfig.json",outFiles:["${workspaceFolder}/out/**/*.js"]})}finally{await nr.commands.executeCommand("workbench.action.closeActiveEditor")}})}),it("attempts to resolve nvm",async()=>{D(b,{"my.env":`A=bar
B="quoted"
"C"="more quoted"

D=overridden
`,"hello.js":""}),e.resolveNvmVersionPath.resolves({directory:"/my/node/location",binary:"node64"});let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeVersion:"3.1.4",env:{hello:"world",PATH:"/usr/bin"}});(0,te.expect)(r).to.containSubset({runtimeExecutable:"node64",env:{hello:"world",PATH:"/my/node/location:/usr/bin"}})}),describe("inspect flags",()=>{it("demaps",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,te.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,te.expect)(r.stopOnEntry).to.be.true}),it("does not overwrite existing stop on entry",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",stopOnEntry:"hello.js",runtimeArgs:["-a","--inspect-brk","--b"]});(0,te.expect)(r.runtimeArgs).to.deep.equal(["-a","--b"]),(0,te.expect)(r.stopOnEntry).to.equal("hello.js")}),it("assigns a random simple attach port",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0});(0,te.expect)(r.continueOnAttach).to.be.true,(0,te.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,te.expect)(r.runtimeArgs).to.deep.equal([`--inspect-brk=${r.attachSimplePort}`]),(0,te.expect)(r.continueOnAttach).to.equal(!0)}),it("merged picked port with existing runtime args",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,runtimeArgs:["--nolazy"]});(0,te.expect)(r.runtimeArgs).to.deep.equal(["--nolazy",`--inspect-brk=${r.attachSimplePort}`])}),it("keeps a static attach port",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:9229,runtimeArgs:["--inspect-brk"]});(0,te.expect)(r.continueOnAttach).to.be.true,(0,te.expect)(r.attachSimplePort).to.be.greaterThan(0),(0,te.expect)(r.runtimeArgs).to.deep.equal(["--inspect-brk"]),(0,te.expect)(r.continueOnAttach).to.equal(!0)}),it("adjusts stopOnEntry to continueOnArray",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",attachSimplePort:0,stopOnEntry:!0});(0,te.expect)(r.continueOnAttach).to.be.false,(0,te.expect)(r.stopOnEntry).to.be.false})}),describe("outFiles",()=>{it("does not modify outfiles with no package.json",async()=>{D(b,{"hello.js":""});let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,te.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])}),it("preserves outFiles if package.json is in the same folder",async()=>{D(b,{"hello.js":"","package.json":"{}"});let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js"});(0,te.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])}),it("gets the nearest nested package.json",async()=>{D(b,{"a/b/c/hello.js":"","a/b/package.json":"{}","a/package.json":"{}"});let r=await n.resolveDebugConfiguration({uri:nr.Uri.file((0,po.join)(b,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/b/c/hello.js"});(0,te.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**","${workspaceFolder}/../a/b/**/*.js","!${workspaceFolder}/../a/b/**/node_modules/**"])}),it("does not resolve in node_modules",async()=>{D(b,{"a/node_modules/c/hello.js":"","a/node_modules/c/package.json":"{}","a/package.json":"{}"});let r=await n.resolveDebugConfiguration({uri:nr.Uri.file((0,po.join)(b,"b")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"../a/node_modules/c/hello.js"});(0,te.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**","${workspaceFolder}/../a/**/*.js","!${workspaceFolder}/../a/**/node_modules/**"])}),it("does not resolve outside the workspace folder",async()=>{D(b,{"a/b/c/hello.js":"","package.json":"{}"});let r=await n.resolveDebugConfiguration({uri:nr.Uri.file((0,po.join)(b,"a")),name:"test-dir",index:0},{type:"pwa-node",name:"",request:"launch",program:"b/c/hello.js"});(0,te.expect)(r?.outFiles).to.deep.equal(["${workspaceFolder}/**/*.(m|c|)js","!**/node_modules/**"])})}),describe("deno",()=>{it("fills in default deno options",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno"}),o=r.attachSimplePort;(0,te.expect)(o).to.be.a("number"),(0,te.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all"]),(0,te.expect)(r.continueOnAttach).to.be.true}),it("allows manual application",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["run","--inspect-brk=9229"],attachSimplePort:9229});(0,te.expect)(r.attachSimplePort).to.equal(9229),(0,te.expect)(r.runtimeArgs).to.deep.equal(["run","--inspect-brk=9229"])}),it("allows partial run args",async()=>{let r=await n.resolveDebugConfiguration(t,{type:"pwa-node",name:"",request:"launch",program:"hello.js",runtimeExecutable:"deno",runtimeArgs:["--some-arg"]}),o=r.attachSimplePort;(0,te.expect)(o).to.be.a("number"),(0,te.expect)(r.runtimeArgs).to.deep.equal(["run",`--inspect-brk=127.0.0.1:${o}`,"--allow-all","--some-arg"])})})})});var ZA={};var Os,uu,du,sD,yl,aD,uo,cD=m(()=>{"use strict";Os=require("chai"),uu=require("child_process"),du=require("fs"),sD=require("os"),yl=y(require("path")),aD=require("sinon"),uo=y(require("vscode"));W();Vn();de();$();Ka();J();kw();Gr();bt();$e();describe("pick and attach",()=>{let n=yl.join((0,sD.tmpdir)(),"js-debug-pick-and-attach"),e,t,r,o=!1;beforeEach(()=>t=(0,aD.createSandbox)()),afterEach(async()=>{t?.restore(),e?.kill(),after(async()=>{await du.promises.rm(n,{recursive:!0,force:!0})})}),process.platform!=="win32"&&(it("infers the working directory",async()=>{D(n,{"foo.js":"setInterval(() => {}, 1000)"}),e=(0,uu.spawn)("node",["foo.js"],{cwd:n});let i={...Fn,processId:`${e.pid}:1234`};await Dc(new ve(du.promises),i,!0),(0,Os.expect)(gg(i.cwd)).to.equal(n)}),it("adjusts to the package root",async()=>{D(n,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),e=(0,uu.spawn)("node",["foo.js"],{cwd:yl.join(n,"nested")});let i={...Fn,processId:`${e.pid}:1234`};await Dc(new ve(du.promises),i,!0),(0,Os.expect)(gg(i.cwd)).to.equal(n)}),it("limits inference to workspace root",async()=>{D(n,{"package.json":"{}","nested/foo.js":"setInterval(() => {}, 1000)"}),t.stub(uo.workspace,"getWorkspaceFolder").returns({name:"nested",index:1,uri:uo.Uri.file(yl.join(n,"nested"))}),e=(0,uu.spawn)("node",["foo.js"],{cwd:yl.join(n,"nested")});let s={...Fn,processId:`${e.pid}:1234`};await Dc(new ve(du.promises),s,!0),(0,Os.expect)(gg(s.cwd)).to.equal(yl.join(n,"nested"))})),describe("",()=>{beforeEach(async()=>{r=await Qe(),e=(0,uu.spawn)("node",["--inspect-brk",`--inspect-port=${r}`],{stdio:"pipe"}),e.on("error",console.error),e.stderr.pipe(new Br(`
`)).on("data",i=>o=o||i.toString().includes("Debugger attached"))}),it("end to end",async function(){this.timeout(30*1e3);let i=t.spy(uo.window,"createQuickPick");uo.commands.executeCommand("extension.pwa-node-debug.attachNodeProcess"),await x(2e3);let s=await ne(()=>((0,Os.expect)(i.called).to.be.true,i.getCall(0).returnValue),10*1e3);await x(2e3);let a=await ne(()=>{let c=s.items.find(l=>l.pidAndPort===`${e.pid}:${r}`);if(!c)throw new Error("expected quickpick to have item");return c},10*1e3);s.selectedItems=[a],await x(2e3),await uo.commands.executeCommand("workbench.action.acceptSelectedQuickOpenItem"),await x(2e3),await ne(()=>(0,Os.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)}),it("works without a defined workspace",async()=>{uo.debug.startDebugging(void 0,{type:"pwa-node",request:"attach",name:"attach",processId:`${e.pid}:${r}`}),await ne(()=>(0,Os.expect)(o).to.equal(!0,"expected to have attached"),10*1e3)})})})});var e0={};var Y,lD,Sg,gn,T,pD=m(()=>{"use strict";Y=require("chai"),lD=require("fs"),Sg=require("path"),gn=require("sinon"),T=y(require("vscode"));W();st();H();$();Gr();bt();$e();describe("profiling",()=>{let n=(0,Sg.join)(_,"simpleNode"),e=(0,Sg.join)(n,"profilePlayground.js"),t,r,o=async a=>{let c=await lD.promises.readFile(a,"utf-8");(0,Y.expect)(()=>JSON.parse(c)).to.not.throw(void 0,"expected to be valid JSON: "+c)},i=async(a,c)=>(await c.dap.stackTrace({threadId:a})).stackFrames[0].id;beforeEach(()=>{let a=T.window.createQuickPick;t=(0,gn.stub)(T.window,"createQuickPick").callsFake(()=>{let c=a();return r=new S,(0,gn.stub)(c,"onDidAccept").callsFake(r.event),c})}),afterEach(()=>{t.restore()}),describe("console",()=>{f("works",async({r:a})=>{D(b,{"test.js":['console.profile("some-profile");','console.profileEnd("some-profile");']});let c=await a.runScript("test.js",{__workspaceFolder:b});c.load(),await c.dap.once("terminated"),await ne(()=>o((0,Sg.join)(b,"some-profile.cpuprofile")))})});let s=async(a,c)=>{let l=await a.dap.setBreakpoints(c);return await Promise.all(l.breakpoints.map(async p=>p.verified?p:(await a.dap.once("breakpoint",u=>u.breakpoint.id===p.id&&u.breakpoint.verified)).breakpoint))};describe("cpu-profiling",()=>{f("cpu sanity test",async({r:a})=>{await a.initialize;let c=await a.runScript(e);c.load();let l=c.dap.once("profileStarted");await c.dap.startProfile({type:"cpu"}),await x(300),await c.dap.stopProfile({}),await o((await l).file)}),describe("breakpoints",()=>{f("continues if was paused on start",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load(),c.log(await s(c,{source:{path:e},breakpoints:[{line:21,column:1}]})),c.log(await c.dap.once("stopped"));let l=c.dap.once("continued"),p=c.dap.once("output");await c.dap.startProfile({type:"cpu"}),c.log(await l),c.log(await p),c.assertLog()}),f("continues if was paused on start with debugger domain",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load();let l=c.dap.once("stopped");c.log(await s(c,{source:{path:e},breakpoints:[{line:21,column:1}]})),c.log(await l);let p=c.dap.once("continued"),u=c.dap.once("output");await c.dap.startProfile({type:"cpu",stopAtBreakpoint:[-1]}),c.log(await p),c.log(await u),c.assertLog()}),f("unverifies and reverifies",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load(),c.log(await s(c,{source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await x(0);let l=(0,gn.stub)().callsFake(p=>c.log(p,void 0,[]));c.dap.on("breakpoint",l),await c.dap.startProfile({type:"cpu"}),await ne(()=>(0,Y.expect)(l.callCount).to.gte(1),2e3),await c.dap.stopProfile({}),await ne(()=>(0,Y.expect)(l.callCount).to.gte(2),2e3),c.assertLog()}),f("does not unverify target breakpoint",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load();let l=c.log(await s(c,{source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await x(0);let p=(0,gn.stub)().callsFake(u=>c.log(u,void 0,[]));c.dap.on("breakpoint",p),await c.dap.startProfile({type:"cpu",stopAtBreakpoint:[l[1].id]}),await ne(()=>(0,Y.expect)(p.callCount).to.gte(1)),await c.dap.stopProfile({}),await ne(()=>(0,Y.expect)(p.callCount).to.gte(2)),c.assertLog()}),f("runs until a breakpoint is hit",async({r:a})=>{await a.initialize;let c=await a.runScript(e),{breakpoints:l}=await c.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await c.load();let p=c.dap.once("profileStarted"),u=await c.dap.once("stopped");await c.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await i(u.threadId,c)}),await c.dap.startProfile({type:"cpu",stopAtBreakpoint:[l[1].id]});let g=c.dap.once("stopped"),w=c.dap.once("profilerStateUpdate"),I=c.dap.once("breakpoint",v=>v.breakpoint.id===l[0].id&&v.breakpoint.verified);c.log(await g,"paused event"),c.log(await w,"finished profile"),c.log(await I,"reenabled breakpoint",[]),await o((await p).file),c.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await T.debug.stopDebugging()});let a=async(c,l)=>{T.commands.executeCommand("extension.js-debug.startProfile",c.id);let p=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(1);let g=t.getCall(0).returnValue;return(0,Y.expect)(g.items).to.not.be.empty,g},2e3);p.selectedItems=p.items.filter(g=>/CPU/i.test(g.label)),r.fire();let u=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(2);let g=t.getCall(0).returnValue;return(0,Y.expect)(g.items).to.not.be.empty,g},2e3);u.selectedItems=u.items.filter(g=>l.test(g.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{T.debug.addBreakpoints([new T.SourceBreakpoint(new T.Location(T.Uri.file(e),new T.Position(19,0))),new T.SourceBreakpoint(new T.Location(T.Uri.file(e),new T.Position(5,0))),new T.SourceBreakpoint(new T.Location(T.Uri.file(e+".foo"),new T.Position(0,0)))]),after(()=>{T.debug.removeBreakpoints(T.debug.breakpoints)}),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(p=>T.debug.onDidStartDebugSession(u=>"__pendingTargetId"in u.configuration?p(u):void 0));await a(c,/breakpoint/i);let l=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(2);let p=t.getCall(1).returnValue;return(0,Y.expect)(p.items.length).to.be.greaterThan(0,"expected to have picker items"),p},5e3);(0,Y.expect)(l.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),l.dispose()}),it("sets substate correctly",async()=>{let c=new q;c.push(T.commands.registerCommand("js-debug.test.callback",()=>{})),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let l=await new Promise(p=>T.debug.onDidStartDebugSession(u=>"__pendingTargetId"in u.configuration?p(u):void 0));await qt(T.commands,"extension.js-debug.startProfile",{sessionId:l.id,type:"cpu",termination:{type:"manual"}}),await ne(()=>(0,Y.expect)(l.name).to.contain("Profiling"),2e3),await qt(T.commands,"extension.js-debug.stopProfile",l.id),await ne(()=>(0,Y.expect)(l.name).to.not.contain("Profiling"),2e3),c.dispose()}),it("works with pure command API",async()=>{let c=(0,gn.stub)(),l=new q;l.push(T.commands.registerCommand("js-debug.test.callback",c)),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let p=await new Promise(g=>T.debug.onDidStartDebugSession(w=>"__pendingTargetId"in w.configuration?g(w):void 0));await qt(T.commands,"extension.js-debug.startProfile",{sessionId:p.id,type:"cpu",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await x(1e3),await qt(T.commands,"extension.js-debug.stopProfile",p.id);let u=await ne(()=>((0,Y.expect)(c.called).to.be.true,c.getCall(0).args[0]),2e3);(0,Y.expect)(()=>JSON.parse(u.contents)).to.not.throw,(0,Y.expect)(u.basename).to.match(/\.cpuprofile$/),l.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let c=await new Promise(l=>T.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await ne(()=>(0,Y.expect)(c.name).to.contain("Profiling"),2e3),await qt(T.commands,"extension.js-debug.stopProfile",c.id),await ne(()=>(0,Y.expect)(c.name).to.not.contain("Profiling"),2e3)})})}),describe("heap-profiling",()=>{f("heap sanity test",async({r:a})=>{await a.initialize;let c=await a.runScript(e);c.load();let l=c.dap.once("profileStarted");await c.dap.startProfile({type:"heap"}),await x(300),await c.dap.stopProfile({}),await o((await l).file)}),describe("breakpoints",()=>{f("continues if was paused on start",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load();let l=c.dap.once("stopped");c.log(await s(c,{source:{path:e},breakpoints:[{line:21,column:1}]})),c.log(await l);let p=c.dap.once("continued"),u=c.dap.once("output");await c.dap.startProfile({type:"heap"}),c.log(await p),c.log(await u),c.assertLog()}),f("continues if was paused on start with debugger domain",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load();let l=c.dap.once("stopped");c.log(await s(c,{source:{path:e},breakpoints:[{line:21,column:1}]})),c.log(await l);let p=c.dap.once("continued"),u=c.dap.once("output");await c.dap.startProfile({type:"heap",stopAtBreakpoint:[-1]}),c.log(await p),c.log(await u),c.assertLog()}),f("unverifies and reverifies",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load(),c.log(await s(c,{source:{path:e},breakpoints:[{line:6,column:1}]}),void 0,[]),await x(0);let l=(0,gn.stub)().callsFake(p=>c.log(p,void 0,[]));c.dap.on("breakpoint",l),await c.dap.startProfile({type:"heap"}),await ne(()=>(0,Y.expect)(l.callCount).to.gte(1),2e3),await c.dap.stopProfile({}),await ne(()=>(0,Y.expect)(l.callCount).to.gte(2),2e3),c.assertLog()}),f("does not unverify target breakpoint",async({r:a})=>{await a.initialize;let c=await a.runScript(e);await c.load();let l=c.log(await s(c,{source:{path:e},breakpoints:[{line:6,column:1},{line:17,column:1}]}),void 0,[]);await x(0);let p=(0,gn.stub)().callsFake(u=>c.log(u,void 0,[]));c.dap.on("breakpoint",p),await c.dap.startProfile({type:"heap",stopAtBreakpoint:[l[1].id]}),await ne(()=>(0,Y.expect)(p.callCount).to.gte(1)),await c.dap.stopProfile({}),await ne(()=>(0,Y.expect)(p.callCount).to.gte(2)),c.assertLog()}),f("runs until a breakpoint is hit",async({r:a})=>{await a.initialize;let c=await a.runScript(e),{breakpoints:l}=await c.dap.setBreakpoints({source:{path:e},breakpoints:[{line:20,column:1},{line:17,column:1}]});await c.load();let p=c.dap.once("profileStarted"),u=await c.dap.once("stopped");await c.dap.evaluate({expression:"setTimeout(noop, 1000)",context:"repl",frameId:await i(u.threadId,c)}),await c.dap.startProfile({type:"heap",stopAtBreakpoint:[l[1].id]});let g=c.dap.once("stopped"),w=c.dap.once("profilerStateUpdate"),I=c.dap.once("breakpoint",v=>v.breakpoint.id===l[0].id&&v.breakpoint.verified);c.log(await g,"paused event"),c.log(await w,"finished profile"),c.log(await I,"reenabled breakpoint",[]),await o((await p).file),c.assertLog()})}),describe("ui",()=>{afterEach(async()=>{await T.debug.stopDebugging()});let a=async(c,l)=>{T.commands.executeCommand("extension.js-debug.startProfile",c.id);let p=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(1);let g=t.getCall(0).returnValue;return(0,Y.expect)(g.items).to.not.be.empty,g},2e3);p.selectedItems=p.items.filter(g=>/heap/i.test(g.label)),r.fire();let u=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(2);let g=t.getCall(0).returnValue;return(0,Y.expect)(g.items).to.not.be.empty,g},2e3);u.selectedItems=u.items.filter(g=>l.test(g.label)),r.fire()};it.skip("allows picking breakpoints",async()=>{T.debug.addBreakpoints([new T.SourceBreakpoint(new T.Location(T.Uri.file(e),new T.Position(19,0))),new T.SourceBreakpoint(new T.Location(T.Uri.file(e),new T.Position(5,0))),new T.SourceBreakpoint(new T.Location(T.Uri.file(e+".foo"),new T.Position(0,0)))]),after(()=>{T.debug.removeBreakpoints(T.debug.breakpoints)}),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let c=await new Promise(p=>T.debug.onDidStartDebugSession(u=>"__pendingTargetId"in u.configuration?p(u):void 0));await a(c,/breakpoint/i);let l=await ne(()=>{(0,Y.expect)(t.callCount).to.equal(2);let p=t.getCall(1).returnValue;return(0,Y.expect)(p.items.length).to.be.greaterThan(0,"expected to have picker items"),p},5e3);(0,Y.expect)(l.items).to.containSubset([{description:"for (let i = 0; i < 10; i++) {",label:"testWorkspace/simpleNode/profilePlayground.js:6:16"},{description:"setInterval(() => {",label:"testWorkspace/simpleNode/profilePlayground.js:20:1"}]),l.dispose()}),it("sets substate correctly",async()=>{let c=new q;c.push(T.commands.registerCommand("js-debug.test.callback",()=>{})),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let l=await new Promise(p=>T.debug.onDidStartDebugSession(u=>"__pendingTargetId"in u.configuration?p(u):void 0));await qt(T.commands,"extension.js-debug.startProfile",{sessionId:l.id,type:"cpu",termination:{type:"manual"}}),await ne(()=>(0,Y.expect)(l.name).to.contain("Profiling"),2e3),await qt(T.commands,"extension.js-debug.stopProfile",l.id),await ne(()=>(0,Y.expect)(l.name).to.not.contain("Profiling"),2e3),c.dispose()}),it("works with pure command API",async()=>{let c=(0,gn.stub)(),l=new q;l.push(T.commands.registerCommand("js-debug.test.callback",c)),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e});let p=await new Promise(g=>T.debug.onDidStartDebugSession(w=>"__pendingTargetId"in w.configuration?g(w):void 0));await qt(T.commands,"extension.js-debug.startProfile",{sessionId:p.id,type:"heap",termination:{type:"manual"},onCompleteCommand:"js-debug.test.callback"}),await x(1e3),await qt(T.commands,"extension.js-debug.stopProfile",p.id);let u=await ne(()=>((0,Y.expect)(c.called).to.be.true,c.getCall(0).args[0]),2e3);(0,Y.expect)(()=>JSON.parse(u.contents)).to.not.throw,(0,Y.expect)(u.basename).to.match(/\.heapprofile$/),l.dispose()}),it("profiles from launch",async function(){this.timeout(20*1e3),T.debug.startDebugging(void 0,{type:"pwa-node",request:"launch",name:"test",program:e,profileStartup:!0});let c=await new Promise(l=>T.debug.onDidStartDebugSession(p=>"__pendingTargetId"in p.configuration?l(p):void 0));await ne(()=>(0,Y.expect)(c.name).to.contain("Profiling"),2e3),await qt(T.commands,"extension.js-debug.stopProfile",c.id),await ne(()=>(0,Y.expect)(c.name).to.not.contain("Profiling"),2e3)})})})})});var t0={};var Bs,uD=m(()=>{"use strict";Bs=require("chai");$();pw();describe("node lease file",()=>{let n;beforeEach(()=>n=new Vr),afterEach(()=>n.dispose()),it("says the lease is not valid for missing files",async()=>{(0,Bs.expect)(Vr.isValid("does-not-exist.txt")).to.be.false}),it("says the lease is not valid if too far in the past",async()=>{await n.touch(()=>Date.now()-5e3),(0,Bs.expect)(Vr.isValid(n.path)).to.be.false}),it("says the lease is valid if recent",async()=>{await n.touch(()=>Date.now()),(0,Bs.expect)(Vr.isValid(n.path)).to.be.true}),it("truncates and updates on touches",async()=>{await n.touch(()=>Date.now()-5e3),await n.touch(()=>Date.now()),(0,Bs.expect)(Vr.isValid(n.path)).to.be.true}),it("disposes the file",async()=>{await n.touch(()=>Date.now()),await n.dispose(),(0,Bs.expect)(Vr.isValid(n.path)).to.be.false}),it("disposes the touch loop",async()=>{await n.startTouchLoop(),await n.dispose(),await x(1200),(0,Bs.expect)(Vr.isValid(n.path)).to.be.false})})});var r0={};var kr,$o,dD,ie,mD,fD=m(()=>{"use strict";kr=require("chai"),$o=require("child_process"),dD=require("fs"),ie=require("path"),mD=require("sinon");_o();Vn();U();le();$();Ka();J();gw();Gr();bt();$e();describe("node runtime",()=>{async function n(r){let{threadId:o}=r.log(await r.dap.once("stopped"));return await r.logger.logStackTrace(o),r.dap.continue({threadId:o})}async function e(r,o){r.load();let{threadId:i}=r.log(await r.dap.once("stopped")),s=await r.dap.stackTrace({threadId:i});await r.logger.evaluateAndLog(o,{params:{frameId:s.stackFrames[0].id}}),r.assertLog()}function t(r){let o=r.trim().split(`
`);(0,kr.expect)(o.length).to.be.greaterThan(0),(0,kr.expect)(o[0]).to.not.contain("<hidden: Skipped by skipFiles>");for(let i=1;i<o.length;i++)(0,kr.expect)(o[i]).to.contain("<hidden: Skipped by skipFiles>")}describe("skipFiles",()=>{f("skipFiles skip node internals",async({r})=>{await r.initialize;let o=(0,ie.join)(_,"simpleNode"),i=await r.runScript((0,ie.join)(o,"index.js"),{skipFiles:["<node_internals>/**"]});await i.dap.setBreakpoints({source:{path:(0,ie.join)(o,"index.js")},breakpoints:[{line:1,column:1}]}),i.load();let s=await i.dap.once("stopped");await x(200),await i.logger.logStackTrace(s.threadId),i.assertLog({customAssert:t})});for(let[r,o]of[["with delay",!0],["without delay",!1]])describe(r,()=>{for(let i of["caughtInUserCode","uncaught","caught","rethrown"])f(i,async({r:s})=>{await s.initialize;let a=(0,ie.join)(_,"simpleNode"),c=await s.runScript((0,ie.join)(a,"skipFiles.js"),{args:[o?"1000":"0",i],skipFiles:["**/skippedScript.js"]});await c.dap.setExceptionBreakpoints({filters:["all","uncaught"]}),c.dap.on("output",l=>c.logger.logOutput(l)),c.dap.on("stopped",async l=>{await c.logger.logStackTrace(l.threadId),await c.dap.continue({threadId:l.threadId})}),c.load(),await c.dap.once("terminated"),c.assertLog({substring:!0})})})}),f("simple script",async({r})=>{D(b,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js");o.load(),await n(o),o.assertLog({substring:!0})}),f("chakracore string value",async({r})=>{if(process.platform!=="win32")return;D(b,{"test.js":['const message = "hello world!";',"console.log(message);","debugger;"]});let o=(0,ie.join)(_,"chakracore","ChakraCore.Debugger.Sample.exe"),i=await Qe(),s=await r.runScript("test.js",{runtimeExecutable:o,runtimeArgs:["--inspect-brk","--port",`${i}`],attachSimplePort:i,continueOnAttach:!0});s.load();let{threadId:a}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:a}),await s.dap.once("stopped");let c=await s.dap.stackTrace({threadId:a});await s.logger.evaluateAndLog("message",{params:{frameId:c.stackFrames[0].id}}),s.assertLog({substring:!0})}),f("exits with child process launcher",async({r})=>{D(b,{"test.js":""});let o=await r.runScript("test.js",{console:"internalConsole"});o.load(),await o.dap.once("terminated")}),process.env.ONLY_MINSPEC!=="true"&&f("debugs worker threads",async({r})=>{D(b,{"test.js":['const { Worker, isMainThread, workerData } = require("worker_threads");',"if (isMainThread) {",'  new Worker(__filename, { workerData: { greet: "world" } });',"} else {","  setInterval(() => {",'    console.log("hello " + workerData.greet);',"   }, 100);","}"]});let o=await r.runScript("test.js");o.load();let i=await r.worker();await i.dap.setBreakpoints({source:{path:(0,ie.join)(b,"test.js")},breakpoints:[{line:6,column:1}]}),i.load(),await n(i),o.assertLog({substring:!0})}),f("exits with integrated terminal launcher",async({r})=>{let o=(0,mD.stub)(fi.prototype,"sendLaunchRequest");after(()=>o.restore());let i;o.callsFake(a=>(i=a,(0,$o.spawn)(a.args[0],a.args.slice(1),{cwd:a.cwd,env:{...process.env,...a.env}}),Promise.resolve({}))),D(b,{"test.js":""});let s=await r.runScript("test.js",{console:"integratedTerminal",cwd:b,env:{myEnv:"foo"}});s.load(),await s.dap.once("terminated"),(0,kr.expect)(i).to.containSubset({title:"Test Case",kind:"integrated",cwd:b,env:{myEnv:"foo"}})}),f("adjusts to compiles file if it exists",async({r})=>{await r.initialize;let o=await r.runScript((0,ie.join)(_,"web/basic.ts"));await o.dap.setBreakpoints({source:{path:o.workspacePath("web/basic.ts")},breakpoints:[{line:21,column:0}]}),o.load(),await n(o),o.assertLog({substring:!0})}),describe("inspect flag handling",()=>{f("does not break with inspect flag",async({r})=>{D(b,{"test.js":['console.log("hello world");',"debugger;"]});let o=await r.runScript("test.js",{runtimeArgs:["--inspect"]});o.load(),await n(o),o.assertLog({substring:!0})}),f("treats inspect-brk as stopOnEntry",async({r})=>{D(b,{"test.js":['console.log("hello world");']});let o=await r.runScript("test.js",{cwd:b,runtimeArgs:["--inspect-brk"]});o.load(),await n(o),o.assertLog({substring:!0})})}),describe("stopOnEntry",()=>{beforeEach(()=>D(b,{"test.js":["let i = 0;","i++;","i++;"],"bar.js":'require("./test")'})),f("stops with a breakpoint elsewhere (#515)",async({r})=>{let o=await r.runScript("test.js",{cwd:b,stopOnEntry:!0});await o.dap.setBreakpoints({source:{path:(0,ie.join)(b,"test.js")},breakpoints:[{line:3,column:1}]}),o.load(),await n(o),r.assertLog({substring:!0})}),f("stops with a program provided",async({r})=>{let o=await r.runScript("test.js",{cwd:b,stopOnEntry:!0});o.load(),await n(o),r.assertLog({substring:!0})}),f("launches and infers entry from args",async({r})=>{let o=await r.runScript("test.js",{cwd:b,args:["--max-old-space-size=1024","test.js","--not-a-file"],program:void 0,stopOnEntry:!0});o.load(),await n(o),r.assertLog({substring:!0})}),f("sets an explicit stop on entry point",async({r})=>{let o=await r.runScript("bar.js",{cwd:b,stopOnEntry:(0,ie.join)(b,"test.js")});o.load(),await n(o),r.assertLog({substring:!0})})}),describe("attaching",()=>{let r;afterEach(()=>{r&&r.kill()}),f("attaches to existing processes",async({r:o})=>{D(b,{"test.js":["setInterval(() => { debugger; }, 500)"]});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]),await x(500);let s=await o.attachNode(r.pid,{port:i});await n(s),s.assertLog({substring:!0})}),f.skip("continueOnAttach",async({r:o})=>{D(b,{"test.js":['console.log("");',"debugger;"]});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect-brk=${i}`,(0,ie.join)(b,"test")]);let s=await o.attachNode(r.pid,{continueOnAttach:!0,port:i});await n(s),s.assertLog({substring:!0})}),f("retries attachment",async({r:o})=>{D(b,{"test.js":["setInterval(() => { debugger; }, 500)"]});let i=await Qe(),s=o.attachNode(0,{port:i});await x(500),r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]);let a=await s;await n(a),a.assertLog({substring:!0})}),f("attaches children of child processes",async({r:o})=>{D(b,{"test.js":`
          const { spawn } = require('child_process');
          setInterval(() => spawn('node', ['child'], { cwd: __dirname }), 500);
        `,"child.js":"(function foo() { debugger; })();"});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]),await x(500),(await o.attachNode(r.pid,{port:i})).load();let a=await o.worker();a.load(),await n(a),a.assertLog({substring:!0})}),f("attaches to cluster processes",async({r:o})=>{D(b,{"test.js":`
          const cluster = require('cluster');
          if (cluster.isMaster) {
            cluster.fork();
          } else {
            setInterval(() => { debugger; }, 500);
          }
        `});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]),await x(500),(await o.attachNode(r.pid,{port:i})).load();let a=await o.worker();a.load(),await n(a),a.assertLog({substring:!0})}),f("restarts if requested",async({r:o})=>{D(b,{"test.js":["setInterval(() => { debugger; }, 100)"]});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]);let s=await o.attachNode(0,{port:i,restart:!0});s.log(await s.dap.once("stopped")),await s.dap.evaluate({expression:"process.exit(0)"}),r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")]);let a=await o.waitForTopLevel();a.load(),await n(a),s.assertLog({substring:!0})}),f("does not restart if killed",async({r:o})=>{D(b,{"test.js":["setInterval(() => { debugger; }, 100)"]});let i=await Qe();r=(0,$o.spawn)("node",[`--inspect=${i}`,(0,ie.join)(b,"test")],{stdio:"pipe"});let s=[];r.stderr?.pipe(new Br(`
`)).on("data",c=>s.push(c.toString()));let a=await o.attachNode(0,{port:i,restart:!0});await a.dap.once("stopped"),await a.dap.disconnect({}),await o.rootDap().disconnect({}),await x(1e3),(0,kr.expect)(s.filter(c=>c.includes("Debugger attached"))).to.have.lengthOf(1)})}),describe("child processes",()=>{beforeEach(()=>D(b,{"test.js":`
        const cp = require('child_process');
        const path = require('path');
        cp.fork(path.join(__dirname, 'child.js'));
      `,"child.js":`
        const foo = 'It works!';
        debugger;
      `})),f("debugs",async({r})=>{(await r.runScript("test.js")).load();let i=await r.worker();i.load();let{threadId:s}=i.log(await i.dap.once("stopped")),a=await i.dap.stackTrace({threadId:s});await i.logger.evaluateAndLog("foo",{params:{frameId:a.stackFrames[0].id}}),i.assertLog()}),f("does not debug if auto attach off",async({r})=>{(await r.runScript("test.js",{autoAttachChildProcesses:!1})).load();let i=await Promise.race([r.worker(),new Promise(s=>setTimeout(()=>s("ok"),1e3))]);(0,kr.expect)(i).to.equal("ok")})}),f("sets arguments",async({r})=>{D(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{args:["--some","very fancy","--arguments"]});await e(o,"process.argv.slice(2)")}),f("sets the cwd",async({r})=>{D(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{cwd:_});await e(o,"process.cwd()")}),f("sets sourceMapOverrides from the cwd",async({r})=>{let o=await r.runScript((0,ie.join)(_,"simpleNode","simpleWebpack.js"),{cwd:(0,ie.join)(_,"simpleNode")});o.load(),await n(o),o.assertLog({substring:!0})}),f("sets environment variables",async({r})=>{D(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),f("sets environment variables",async({r})=>{D(b,{"test.js":"debugger"});let o=await r.runScript("test.js",{env:{HELLO:"world"}});await e(o,"process.env.HELLO")}),f("reads the envfile",async({r})=>{D(b,{"test.js":"debugger;",vars:["A=foo","B=bar"]}),xe.processEnv.forget();let o=process.env.C;process.env.C="inherited";let i=await r.runScript("test.js",{envFile:(0,ie.join)(b,"vars"),env:{B:"overwritten"}});await e(i,"JSON.stringify({ a: process.env.A, b: process.env.B, c: process.env.C })"),process.env.C=o,xe.processEnv.forget()}),f("writes errors if runtime executable not found",async({r})=>{await r.initialize;let o=await r.rootDap().launch({...Ul,cwd:(0,ie.dirname)(b),program:(0,ie.join)(b,"test.js"),rootPath:_,runtimeExecutable:"does-not-exist",__workspaceFolder:b});(0,kr.expect)(o).to.include(`Can't find Node.js binary "does-not-exist"`)}),f("scripts with http urls",async({r})=>{await r.initialize;let o=(0,ie.join)(_,"web","urlSourcemap"),i=await r.runScript((0,ie.join)(o,"index.js"),{cwd:_,skipFiles:["<node_internals>/**"],sourceMapPathOverrides:{"http://localhost:8001/*":`${_}/web/*`}});i.load(),await n(i),i.assertLog({substring:!0})}),f("gets performance information",async({r})=>{D(b,{"test.js":"setInterval(() => {}, 1000)"});let o=await r.runScript("test.js");await o.load();let i=await o.dap.getPerformance({});(0,kr.expect)(i.error).to.be.undefined,(0,kr.expect)(i.metrics).to.not.be.empty}),describe("simplePortAttach",()=>{let r=B(async()=>{let o=await $s(dD.promises,"npm",process.env);if(!o)throw new Error("npm not on path");return o});f("allows inspect-brk in npm scripts",async({r:o})=>{await o.initialize;let i=(0,ie.join)(_,"simpleNode"),s=await o.runScript("",{program:void 0,cwd:i,runtimeExecutable:await r(),runtimeArgs:["run","startWithBrk"],port:29204}),a=s.dap.once("output",l=>l.output.includes("NODE_OPTIONS"));s.load();let{threadId:c}=s.log(await s.dap.once("stopped"));s.dap.continue({threadId:c}),s.logger.logOutput(await a),s.assertLog({substring:!0})}),f("uses bootloader for normal npm scripts",async({r:o})=>{await o.initialize;let i=(0,ie.join)(_,"simpleNode");o.onSessionCreated(l=>l.load());let s=await o.runScript("",{program:void 0,cwd:i,runtimeExecutable:await r(),runtimeArgs:["run","startWithoutBrk"],port:29204});s.load();let c=(await o.worker()).dap.once("output",l=>l.output.includes("NODE_OPTIONS"));s.logger.logOutput(await c),s.assertLog({customAssert:l=>(0,kr.expect)(l).to.contain("NODE_OPTIONS=  --require")})}),f("allows simple port attachment",async({r:o})=>{await o.initialize;let i=(0,ie.join)(_,"simpleNode"),s=await Qe(),a=await o.runScript((0,ie.join)(i,"logNodeOptions"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let c=a.dap.once("output",p=>p.output.includes("NODE_OPTIONS")),{threadId:l}=a.log(await a.dap.once("stopped"));a.dap.continue({threadId:l}),a.logger.logOutput(await c),a.assertLog({substring:!0})}),f("terminates when inspector closed",async({r:o})=>{await o.initialize;let i=(0,ie.join)(_,"simpleNode"),s=await Qe(),a=await o.runScript((0,ie.join)(i,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load();let{threadId:c}=a.log(await a.dap.once("stopped")),l=await a.dap.stackTrace({threadId:c});a.dap.evaluate({expression:'require("inspector").close()',frameId:l.stackFrames[0].id}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})}),f("terminates when process killed",async({r:o})=>{await o.initialize;let i=(0,ie.join)(_,"simpleNode"),s=await Qe(),a=await o.runScript((0,ie.join)(i,"debuggerStmt"),{runtimeArgs:[`--inspect-brk=${s}`],attachSimplePort:s});a.load(),a.log(await a.dap.once("stopped")),a.dap.evaluate({expression:"process.exit(1)"}),a.log(await a.dap.once("terminated")),a.assertLog({substring:!0})})}),describe("etx",()=>{f("stdio without etx",async({r})=>{await r.initialize,D(b,{"test.js":['process.stdout.write("hello world!");',"debugger;"]});let o=await r.runScript("test.js",{outputCapture:"std"});o.load();let i="";r.rootDap().on("output",s=>i+=s.output),await o.dap.once("stopped"),(0,kr.expect)(i).to.deep.equal("hello world!")}),f("stdio with etx",async({r})=>{await r.initialize,D(b,{"test.js":['process.stdout.write("etxstart");','process.stdout.write("well defined");','process.stdout.write("chunksnow!");']});let o=await r.runScript("test.js",{outputCapture:"std"});o.load();let i=[];r.rootDap().on("output",s=>i.push(s.output)),await o.dap.once("terminated"),(0,kr.expect)(i.slice(0,5)).to.deep.equal([`etx
`,`startwell defined
`,`chunks
`,`
`,`now!
`])})})})});var o0={};var Ut,gD,ki,Jr,hD=m(()=>{"use strict";Ut=require("chai"),gD=require("fs"),ki=require("path");de();ro();le();V();tw();Jr=new ve(gD.promises);describe("node source path resolver",()=>{describe("url to path",()=>{let n={workspaceFolder:"file:///",resolveSourceMapLocations:null,basePath:"/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node",remoteRoot:null,localRoot:null,sourceMapOverrides:{"webpack:///*":"/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node/*"}};it("resolves absolute",async()=>{let e=new He(Jr,void 0,n,j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"file:///src/index.js"})).to.equal(fe((0,ki.resolve)("/src/index.js")))}),it("escapes regex parts segments",async()=>{if(process.platform==="win32"){let e=new He(Jr,void 0,{...n,workspaceFolder:"C:\\some\\workspa*ce\\folder",basePath:"C:\\some\\workspa*ce\\folder",resolveSourceMapLocations:["C:\\some\\workspa*ce\\folder/**","C:\\some\\workspa*ce\\folder/../**","C:\\some\\workspa*ce\\folder/../foo/**"]},j.null);(0,Ut.expect)(e.resolvePatterns).to.deep.equal(["C:/some/workspa\\*ce/folder/**","C:/some/workspa\\*ce/**","C:/some/workspa\\*ce/foo/**"])}}),it("fixes regex escape issue #1554",async()=>{if(process.platform==="win32"){let e=new He(Jr,void 0,{...n,workspaceFolder:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",basePath:"C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode",resolveSourceMapLocations:["C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/shared/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/swimmagic/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../../packages/editor/dist/**","C:\\Users\\Segev\\prj\\swimm\\ide\\extensions\\vscode/../../server/dist/**","!**/node_modules/**"]},j.null);(0,Ut.expect)(e.shouldResolveSourceMap({compiledPath:"c:\\Users\\Segev\\prj\\swimm\\ide\\server\\dist\\app.js",sourceMapUrl:"file:///c:/Users/Segev/prj/swimm/ide/server/dist/app.js.map"})).to.be.true}}),it("avoids bad matches in relative rebasd #2091",async()=>{let e=new He(Jr,void 0,{...n,workspaceFolder:"C:\\some\\workspa*ce\\folder",basePath:"C:\\some\\workspa*ce\\folder",resolveSourceMapLocations:["**/*o*/**"]},j.null);(0,Ut.expect)(e.shouldResolveSourceMap({compiledPath:"external:///app.js",sourceMapUrl:"external:///app.js.map"})).to.be.false}),it("resolves unc paths",async()=>{if(process.platform!=="win32")return;let e=new He(Jr,void 0,n,j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"file:////mac/Home/Github/js-debug-demos/node/main.js"})).to.equal((0,ki.resolve)("\\\\mac\\Home\\Github\\js-debug-demos\\node\\main.js"))}),it("normalizes roots (win -> posix) ",async()=>{let e=new He(Jr,void 0,{...n,remoteRoot:"C:\\Source",localRoot:"/dev/src"},j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"file:///c:/source/foo/bar.js"})).to.equal("/dev/src/foo/bar.js")}),it("normalizes roots (posix -> win) ",async()=>{let e=new He(Jr,void 0,{...n,remoteRoot:"/dev/src",localRoot:"C:\\Source"},j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"file:///dev/src/foo/bar.js"})).to.equal("c:\\Source\\foo\\bar.js")}),it("places relative paths in node_internals",async()=>{let e=new He(Jr,void 0,n,j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"internal.js"})).to.equal("<node_internals>/internal.js")}),it("applies source map overrides",async()=>{let e=new He(Jr,void 0,n,j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"webpack:///hello.js",map:{sourceRoot:"",metadata:{compiledPath:"hello.js"}}})).to.equal(fe((0,ki.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node","hello.js")))}),it("loads local node internals (#823)",async()=>{let e=new He(Jr,void 0,n,j.null);(0,Ut.expect)(await e.urlToAbsolutePath({url:"node:url"})).to.equal((0,ki.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node","lib/url.js")),(0,Ut.expect)(await e.urlToAbsolutePath({url:"node:internal/url.js"})).to.equal((0,ki.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node","lib/internal/url.js"))}),it("applies rebase to file URIs (#2122)",async()=>{let t=await new He(Jr,void 0,{...n,localRoot:"/biz",remoteRoot:"/foo"},j.null).urlToAbsolutePath({url:"file:///foo/bar/baz.ts",map:{metadata:{sourceMapUrl:"file:///foo/bar/baz/my.map.js",compiledPath:"file:///foo/bar/baz/my.map.js"},sourceRoot:""}});(0,Ut.expect)(t).to.equal("/biz/bar/baz.ts")}),describe("source map filtering",()=>{let e={"matches paths":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/baz/my.map.js",ok:!0},"is case sensitive on unix":{locs:["/foo/BAR/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1,caseSensitive:!0},"does not match paths outside of locations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:////bar/my.map.js",ok:!1},"applies negations":{locs:["/foo/bar/**","!**/node_modules/**"],map:"file:///foo/bar/node_modules/my.map.js",ok:!1},"matches win32 paths, case insensitive":{locs:["c:\\foo\\BAR\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/BAZ/my.map.js",ok:!0,caseSensitive:!1},"applies win32 negations":{locs:["c:\\foo\\bar\\**","!**\\node_modules\\**"],map:"file:///c:/foo/bar/node_modules/my.map.js",ok:!1},"works for http urls, case insensitive":{locs:["https://EXAMPLE.com/**"],map:"https://example.COM/my.map.js",ok:!0}};afterEach(()=>Bu());for(let t of Object.keys(e)){let r=e[t],{locs:o,map:i,ok:s}=r,a="caseSensitive"in r&&r.caseSensitive;it(t,async()=>{ju(a);let l=await new He(Jr,void 0,{...n,resolveSourceMapLocations:o},j.null).urlToAbsolutePath({url:"webpack:///hello.js",map:{metadata:{sourceMapUrl:i,compiledPath:i},sourceRoot:""}});s?(0,Ut.expect)(l&&fe(l)).to.equal(fe((0,ki.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test/node","hello.js"))):(0,Ut.expect)(l).to.be.undefined})}})})})});var i0={};var js,wD,ky,yD,Py,n0,bD,vD=m(()=>{"use strict";js=require("chai"),wD=require("events"),ky=require("fs"),yD=require("sinon"),Py=require("stream-buffers");de();bf();uw();yf();n0=n=>{let e=new wD.EventEmitter;return e.stderr=new Py.ReadableStreamBuffer,e.stderr.stop(),e.stdout=new Py.ReadableStreamBuffer({frequency:2,chunkSize:32}),e.stdout.put(n),e.stdout.stop(),e.stdout.once("end",()=>setTimeout(()=>e.emit("close",0),1)),e},bD=async(n,e,t)=>{let r=(0,yD.stub)(n,"createProcess").returns(n0(e));try{let o=await n.lookup((i,s)=>[...s,i],[]);(0,js.expect)(o).to.deep.equal(t)}finally{r.restore()}};describe("process tree",()=>{it("gives some output for the current platform",async()=>{let n=await vs.lookup((e,t)=>[...t,e],[]);(0,js.expect)(n.length).to.be.greaterThan(0),(0,js.expect)(n[0].pid).to.be.a("number"),(0,js.expect)(n[0].ppid).to.be.a("number"),(0,js.expect)(n[0].command).to.match(/./)}),process.platform!=="win32"&&it("gets the working directory",async()=>{let n=await vs.getWorkingDirectory(process.pid);(0,js.expect)(n).to.equal(process.cwd())}),it("works for darwin",async()=>{await bD(new mi(new ve(ky.promises)),`  PID  PPID BINARY           COMMAND
  380     1 /usr/sbin/cfpref /usr/sbin/cfprefsd agent
  381     1 /usr/libexec/Use /usr/libexec/UserEventAgent (Aqua)
  383     1 /usr/sbin/distno /usr/sbin/distnoted agent
  384     1 /usr/libexec/USB /usr/libexec/USBAgent
  387     1 /System/Library/ /System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L
  389     1 /usr/libexec/lsd /usr/libexec/lsd
  390     1 /usr/libexec/tru /usr/libexec/trustd --agent
  391     1 /usr/libexec/sec /usr/libexec/secd
  392     2 /System/Library/ /System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd`,[{pid:380,ppid:1,command:"usr/sbin/cfpref",args:"/usr/sbin/cfprefsd agent"},{pid:381,ppid:1,command:"usr/libexec/Use",args:"/usr/libexec/UserEventAgent (Aqua)"},{pid:383,ppid:1,command:"usr/sbin/distno",args:"/usr/sbin/distnoted agent"},{pid:384,ppid:1,command:"usr/libexec/USB",args:"/usr/libexec/USBAgent"},{pid:387,ppid:1,command:"System/Library/",args:"/System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter -L"},{pid:389,ppid:1,command:"usr/libexec/lsd",args:"/usr/libexec/lsd"},{pid:390,ppid:1,command:"usr/libexec/tru",args:"/usr/libexec/trustd --agent"},{pid:391,ppid:1,command:"usr/libexec/sec",args:"/usr/libexec/secd"},{pid:392,ppid:2,command:"System/Library/",args:"/System/Library/PrivateFrameworks/CloudKitDaemon.framework/Support/cloudd"}])}),it("works for posix",async()=>{await bD(new fc(new ve(ky.promises)),`   PID   PPID BINARY          COMMAND
   351      1 systemd         /lib/systemd/systemd --user
   352    351 (sd-pam)        (sd-pam)
   540      1 sh              sh /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
   548    540 node            /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node /home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0
  6557   6434 sshd            sshd: connor@notty
  6558   6557 bash            bash
  7281   7199 sshd            sshd: connor@pts/0
  7282   7281 bash            -bash
  9880  99219 bash            /bin/bash`,[{pid:351,ppid:1,command:"/lib/systemd/systemd",args:"--user"},{pid:352,ppid:351,command:"(sd-pam)",args:""},{pid:540,ppid:1,command:"sh",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/server.sh --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:548,ppid:540,command:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/node",args:"/home/connor/.vscode-server-insiders/bin/bbf00d8ea6aa7e825ca3393364d746fe401d3299/out/vs/server/main.js --host=127.0.0.1 --enable-remote-auto-shutdown --port=0"},{pid:6557,ppid:6434,command:"sshd:",args:"connor@notty"},{pid:6558,ppid:6557,command:"bash",args:""},{pid:7281,ppid:7199,command:"sshd:",args:"connor@pts/0"},{pid:7282,ppid:7281,command:"-bash",args:""},{pid:9880,ppid:99219,command:"/bin/bash",args:""}])})})});var s0={};var ae,ID,Xe,Pi,SD=m(()=>{"use strict";ae=require("chai"),ID=require("fs"),Xe=y(require("path"));de();ge();Tf();Gr();bt();Pi=new ve(ID.promises);describe("runtimeVersion",()=>{let n;it("fails if no nvm/s present",async()=>{n=new jt(Pi,{},"x64","linux",_),await(0,ae.expect)(n.resolveNvmVersionPath("13")).to.eventually.be.rejectedWith(k,/requires Node.js version manager/)}),describe("fall throughs",()=>{beforeEach(()=>{D(b,{"nvs/node/13.12.0/x64/bin/node":"","nvs/node/13.11.0/x86/bin/node":"","nvm/versions/node/v13.11.0/bin/node":"","fnm/node-versions/v13.10.0/installation/bin/node":""}),n=new jt(Pi,{NVS_HOME:Xe.join(b,"nvs"),NVM_DIR:Xe.join(b,"nvm"),FNM_DIR:Xe.join(b,"fnm")},"x64","linux",_)}),it("attempts multiple lookup to get the right version",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13.12");(0,ae.expect)(e).to.equal(Xe.join(b,"nvs/node/13.12.0/x64/bin"));let{directory:t}=await n.resolveNvmVersionPath("13.11");(0,ae.expect)(t).to.equal(Xe.join(b,"nvm/versions/node/v13.11.0/bin"));let{directory:r}=await n.resolveNvmVersionPath("13.10");(0,ae.expect)(r).to.equal(Xe.join(b,"fnm/node-versions/v13.10.0/installation/bin")),await(0,ae.expect)(n.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(k,/not installed using version manager nvs\/nvm\/fnm/)}),it("requires nvs for a specific architecture",async()=>{n=new jt(Pi,{NVM_DIR:Xe.join(b,"nvm")},"x64","linux",_),await(0,ae.expect)(n.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(k,/architecture requires 'nvs' to be installed/)}),it("does not fall through if requesting a specific nvs architecture",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("13.11/x64")).to.eventually.be.rejectedWith(k,/not installed/)})}),describe("nvs support",()=>{beforeEach(()=>{D(b,{"node/13.12.0/x64/bin/node":"","node/13.4.0/x86/bin/node":"","node/13.3.0/x64/bin/node":"","node/13.3.1/x64/bin/node64.exe":"","node/13.invalid/x64/bin/node":""}),n=new jt(Pi,{NVS_HOME:b},"x64","linux",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.0");(0,ae.expect)(e).to.equal(Xe.join(b,"node/13.3.0/x64/bin")),(0,ae.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.1");(0,ae.expect)(e).to.equal(Xe.join(b,"node/13.3.1/x64/bin")),(0,ae.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13");(0,ae.expect)(e).to.equal(Xe.join(b,"node/13.12.0/x64/bin"))}),it("throws if no version match",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(k,/not installed/)}),it("throws on none for specific architecture",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("13.4.0")).to.eventually.be.rejectedWith(k,/not installed/)}),it("gets a specific architecture",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13/x86");(0,ae.expect)(e).to.equal(Xe.join(b,"node/13.4.0/x86/bin"))}),it("omits the bin directory on windows",async()=>{n=new jt(Pi,{NVS_HOME:b},"x64","win32",_);let{directory:e}=await n.resolveNvmVersionPath("13.3.0");(0,ae.expect)(e).to.equal(Xe.join(b,"node/13.3.0/x64"))})}),describe("nvm windows",()=>{beforeEach(()=>{D(b,{"v13.12.0/node.exe":"","v13.3.0/node.exe":"","v13.3.1/node64.exe":"","v13.invalid/node.exe":""}),n=new jt(Pi,{NVM_HOME:b},"x64","win32",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.0");(0,ae.expect)(e).to.equal(Xe.join(b,"v13.3.0")),(0,ae.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.1");(0,ae.expect)(e).to.equal(Xe.join(b,"v13.3.1")),(0,ae.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13");(0,ae.expect)(e).to.equal(Xe.join(b,"v13.12.0"))}),it("throws if no version match",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(k,/not installed/)})}),describe("nvm osx",()=>{beforeEach(()=>{D(b,{"versions/node/v13.12.0/bin/node":"","versions/node/v13.3.0/bin/node":"","versions/node/v13.3.1/bin/node64":"","versions/node/v13.invalid/bin/node":""}),n=new jt(Pi,{NVM_DIR:b},"x64","linux",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.0");(0,ae.expect)(e).to.equal(Xe.join(b,"versions/node/v13.3.0/bin")),(0,ae.expect)(t).to.equal("node")}),it("resolves node64",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.1");(0,ae.expect)(e).to.equal(Xe.join(b,"versions/node/v13.3.1/bin")),(0,ae.expect)(t).to.equal("node64")}),it("gets the best matching version",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13");(0,ae.expect)(e).to.equal(Xe.join(b,"versions/node/v13.12.0/bin"))}),it("throws if no version match",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(k,/not installed/)})}),describe("fnm",()=>{beforeEach(()=>{D(b,{"node-versions/v13.12.0/installation/bin/node":"","node-versions/v13.3.0/installation/bin/node":"","node-versions/v13.invalid/installation/bin/node":""}),n=new jt(Pi,{FNM_DIR:b},"x64","linux",_)}),it("gets an exact match",async()=>{let{directory:e,binary:t}=await n.resolveNvmVersionPath("13.3.0");(0,ae.expect)(e).to.equal(Xe.join(b,"node-versions/v13.3.0/installation/bin")),(0,ae.expect)(t).to.equal("node")}),it("gets the best matching version",async()=>{let{directory:e}=await n.resolveNvmVersionPath("13");(0,ae.expect)(e).to.equal(Xe.join(b,"node-versions/v13.12.0/installation/bin"))}),it("throws if no version match",async()=>{await(0,ae.expect)(n.resolveNvmVersionPath("14")).to.eventually.be.rejectedWith(k,/not installed/)})})})});var a0={};var vl,Il,kD=m(()=>{"use strict";vl=require("chai"),Il=require("fs");Dm();$e();describe("resourceProvider",()=>{async function n(e,t){let{threadId:r}=e.log(await e.dap.once("stopped"));return await e.logger.logStackTrace(r),t&&await t(r),e.dap.continue({threadId:r})}f("applies cookies",async({r:e})=>{let t=await e.launchUrl("cookies/home");t.load(),await n(t),t.assertLog()}),f("follows redirects",async({r:e})=>{let t=await e.launchUrl("redirect-test/home");t.load(),t.log(await t.waitForSource("module1.ts")),t.assertLog()}),it("decodes base64 data uris",async()=>{let e=new er(Il.promises);(0,vl.expect)(await e.fetch("data:text/plain;base64,SGVsbG8gd29ybGQh")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;base64,SGVsbG8gd29ybGQh"})}),it("decodes utf8 data uris (#662)",async()=>{let e=new er(Il.promises);(0,vl.expect)(await e.fetch("data:text/plain;utf-8,Hello%20world!")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"data:text/plain;utf-8,Hello%20world!"})}),it("fetches remote url",async()=>{let e=new er(Il.promises);(0,vl.expect)(await e.fetch("http://localhost:8001/greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/greet"})}),it("follows redirects (unit)",async()=>{let e=new er(Il.promises);(0,vl.expect)(await e.fetch("http://localhost:8001/redirect-to-greet")).to.deep.equal({ok:!0,statusCode:200,body:"Hello world!",url:"http://localhost:8001/redirect-to-greet"})}),it("applies request options",async()=>{let t=await new er(Il.promises,{provideOptions:r=>{r.headers={cool:"true"}}}).fetch("http://localhost:8001/view-headers");(0,vl.expect)(JSON.parse(t.body||"no content")).to.containSubset({cool:"true"})})})});var c0={};var PD=m(()=>{"use strict";$e();describe("pretty print sources",()=>{async function n(t){let{threadId:r}=t.log(await t.dap.once("stopped"));return await t.logger.logStackTrace(r),()=>t.dap.continue({threadId:r})}let e=async(t,r)=>{let o=t.dap.prettyPrintSource({source:r}),i=t.dap.once("loadedSource"),s=t.dap.once("continued"),a=await n(t);t.log(await s),t.log(await i),await o,a()};f("base",async function({r:t}){let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await n(r),await e(r,o),r.assertLog()}),f("steps in pretty",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1}]}),r.load(),await r.dap.once("stopped"),r.dap.prettyPrintSource({source:o});let{threadId:i}=r.log(await r.dap.once("stopped"));for(let s=0;s<4;s++)r.log(`
step`),r.dap.next({threadId:i}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(i);r.assertLog()}),f("bps",async({r:t})=>{let r=await t.launchUrl("pretty/pretty.html"),o={path:r.workspacePath("web/pretty/ugly.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:5,column:1},{line:9,column:1}]}),r.load();let i=r.dap.once("stopped");for(let p=0;p<2;p++)r.log(await r.dap.once("breakpoint"));let{threadId:s}=r.log(await i);r.dap.prettyPrintSource({source:o});let a=r.dap.once("loadedSource"),c=r.log(await r.dap.once("breakpoint")).breakpoint,l=r.log(await r.dap.once("breakpoint")).breakpoint;r.log(await r.dap.setBreakpoints({source:(await a).source,breakpoints:[{line:17,column:1},{line:c.line,column:c.column},{line:l.line,column:l.column}]}));for(let p=0;p<2;p++)r.log(`
continue`),r.dap.continue({threadId:s}),r.log(await Promise.all([r.dap.once("continued"),r.dap.once("stopped")])),await r.logger.logStackTrace(s);r.assertLog()}),f("eval sources (#929)",async function({r:t}){let r=await t.launchUrlAndLoad("index.html");await r.load();let o=r.waitForSource(),i=r.evaluate('let n=1;for(let l=0;l<n;l++){console.log("hi");debugger}',"");await n(r),await e(r,(await o).source),await i,r.assertLog()})})});var l0={};var xD=m(()=>{"use strict";$e();describe("webassembly",()=>{f("basic stepping and breakpoints",async({r:n})=>{let e=await n.launchUrl("wasm/hello.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/wasm/hello.html")},breakpoints:[{line:14}]}),e.load();{let{threadId:t}=e.log(await e.dap.once("stopped"));await e.dap.stepIn({threadId:t})}{let{threadId:t}=e.log(await e.dap.once("stopped"),"stopped event"),r=await e.logger.logStackTrace(t),o=await e.dap.source({sourceReference:r[0].source.sourceReference,source:r[0].source});e.log(o.mimeType,"source mime type"),e.log(o.content,"source content"),await e.dap.setBreakpoints({source:r[0].source,breakpoints:[{line:10}]}),await e.dap.continue({threadId:t})}{let{threadId:t}=e.log(await e.dap.once("stopped"),"breakpoint stopped event");await e.logger.logStackTrace(t)}e.assertLog()}),describe("dwarf",()=>{let n=async(e,t,r,o)=>{let i=await e.launchUrlAndLoad(`dwarf/${r}.html`);return o.source.path=i.workspacePath(o.source.path),await i.dap.setBreakpoints(o),await i.dap.once("breakpoint",s=>s.breakpoint.verified),i.cdp.Page.reload({}),await i.dap.once("loadedSource",s=>s.reason==="removed"),i};f("can break immediately",async({r:e})=>{let t=await e.launchUrl("dwarf/fibonacci.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/dwarf/fibonacci.html")},breakpoints:[{line:1221}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/dwarf/fibonacci.c")},breakpoints:[{line:6}]}),t.load();let r=await t.dap.once("stopped");await t.dap.continue({threadId:r.threadId});let{threadId:o}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(o,2),e.assertLog()}),f("scopes and variables",async({r:e,context:t})=>{let r=await n(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]}),{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o,2),e.assertLog()}),f("basic stepping",async({r:e,context:t})=>{let r=await n(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.dap.setBreakpoints({source:{path:r.workspacePath("web/dwarf/fibonacci.c")},breakpoints:[]}),r.dap.next({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.stepOut({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o)}e.assertLog()}),f("inline breakpoints set at all call sites",async({r:e,context:t})=>{let r=await n(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining.h"},breakpoints:[{line:2}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.continue({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o,2),r.dap.continue({threadId:o})}e.assertLog()}),f("inline function stepping 1",async({r:e,context:t})=>{let r=await n(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining-main.c"},breakpoints:[{line:7}]}),o=["stepIn","stepOut","next","stepIn","stepIn","stepIn"];for(let s of o){let{threadId:a}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(a),r.dap[s]({threadId:a}),r.log(`---- ${s} ----`)}let{threadId:i}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(i),e.assertLog()}),f("inline function stepping 2",async({r:e,context:t})=>{let r=await n(e,t,"diverse-inlining",{source:{path:"web/dwarf/diverse-inlining-extern.c"},breakpoints:[{line:5}]});{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o),r.dap.next({threadId:o})}{let{threadId:o}=r.log(await r.dap.once("stopped"));await r.logger.logStackTrace(o)}e.assertLog()}),f("does lldb evaluation",async({r:e,context:t})=>{let r=await n(e,t,"fibonacci",{source:{path:"web/dwarf/fibonacci.c"},breakpoints:[{line:6}]}),{threadId:o}=r.log(await r.dap.once("stopped")),{id:i}=(await r.dap.stackTrace({threadId:o})).stackFrames[0];await r.logger.evaluateAndLog("n",{params:{frameId:i}}),await r.logger.evaluateAndLog("a",{params:{frameId:i}}),await r.logger.evaluateAndLog("a + n * 2",{params:{frameId:i}}),e.assertLog()}),f("does lldb evaluation for structs",async({r:e,context:t})=>{let r=await n(e,t,"c-with-struct",{source:{path:"web/dwarf/c-with-struct.c"},breakpoints:[{line:11}]}),{threadId:o}=r.log(await r.dap.once("stopped")),{id:i}=(await r.dap.stackTrace({threadId:o})).stackFrames[0];await r.logger.evaluateAndLog("(data_t*)data",{params:{frameId:i},depth:3}),e.assertLog()})})})});var RD=Dg((Goe,TD)=>{"use strict";var kg=y(require("mocha"));uy();var xy=class n extends kg.reporters.Spec{static{this.alwaysDumpLogs=process.env.DUMP_LOGS}constructor(e){super(e),e.on("pass",t=>{if(n.alwaysDumpLogs)return this.dumpLogs(t)}),e.on("fail",t=>this.dumpLogs(t))}async dumpLogs(e){if(!(e instanceof kg.Test))return;let t=Ms(e.fullTitle());console.log(`##vso[build.uploadlog]${t}`)}};TD.exports=xy});var u0={};async function DD(n,e,t=[]){console.log("Setting up CRA in "+e),ED.mkdirSync(e,{recursive:!0});let r=Ty.spawn("npx",["create-react-app",...t,n],{cwd:e,stdio:"pipe",env:process.env});r.stdout.on("data",i=>console.log(i.toString().replace(/\r?\n$/,""))),r.stderr.on("data",i=>console.error(i.toString().replace(/\r?\n$/,"")));let o=ye();r.once("exit",()=>{o.resolve(void 0)}),await o.promise}async function LD(n){let e=ye(),t=Ty.spawn("npm",["run-script","start"],{env:{...process.env,BROWSER:"none",SKIP_PREFLIGHT_CHECK:"true"},cwd:n,stdio:"pipe"}),r=setTimeout(()=>{console.log("Did not get recognized dev server output, continuing"),e.resolve(void 0)},1e4);return t.stdout.on("data",o=>{o=o.toString(),o.includes("You can now view")?(console.log("Detected CRA dev server started"),e.resolve(void 0)):o.includes("Something is already")&&e.reject(new Error("Failed to start the dev server: "+o)),console.log(o.toString().replace(/\r?\n$/,""))}),t.stderr.on("data",o=>console.error(o.toString().replace(/\r?\n$/,""))),await e.promise,clearTimeout(r),t}var Ty,ED,mu,_D=m(()=>{"use strict";Ty=y(require("child_process")),ED=y(require("fs")),mu=require("path");ro();$();Xa();bt();$e();describe("react",()=>{async function n(o,i){let{threadId:s}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(s),i&&await i(s),o.dap.continue({threadId:s})}let e="react-test",t,r;afterEach(()=>{r&&(console.log("Killing "+r.pid),mr(r.pid,j.null))}),describe("TS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,mu.join)(b,e),await DD(e,b,["--template","cra-template-typescript"]),r=await LD(t)}),f("hit breakpoint",async({r:o})=>{let i=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,mu.join)(t,"src/App.tsx")};await i.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),i.load(),await n(i),i.assertLog({substring:!0})})}),describe("JS",()=>{beforeEach(async function(){this.timeout(6e4*4),t=(0,mu.join)(b,e),await DD(e,b),r=await LD(t)}),f("hit breakpoint",async({r:o})=>{let i=await o._launch("http://localhost:3000",{webRoot:t,__workspaceFolder:t,rootPath:t}),s={path:(0,mu.join)(t,"src/App.js")};await i.dap.setBreakpoints({source:s,breakpoints:[{line:6,column:0}]}),i.load(),await n(i),i.assertLog({substring:!0})})})})});var d0={};var AD=m(()=>{"use strict";$e();describe("infra",()=>{f("initialize",async({r:n})=>{n.log(await n.initialize),n.assertLog()}),it("imports win32 app container tokens",async()=>{process.platform==="win32"&&await import("@vscode/win32-app-container-tokens")})})});var m0={};var Ry,Dy,E,FD=m(()=>{"use strict";Ry=require("chai"),Dy=require("fs"),E=require("path");de();le();V();Gr();gy();bt();$e();describe("breakpoints",()=>{describe("configure",()=>{f("inline",async({r:n})=>{let e=await n.launchUrl("inlinescript.html"),t={path:e.workspacePath("web/inlinescript.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3,column:2}]}),e.load(),await P(e),e.assertLog()}),f("script",async({r:n})=>{let e=await n.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),f("query params",async({r:n})=>{let e=await n.launchUrl("script-with-query-param.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:9,column:0}]}),e.load(),await P(e),await P(e),e.assertLog()}),f("remove",async({r:n})=>{let e=await n.launchUrl("script.html"),t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:0}]}),e.load();let r;await P(e,async()=>{e.dap.once("breakpoint").then(o=>r=o),await e.dap.setBreakpoints({source:t})}),await P(e),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),(0,Ry.expect)(r).to.be.undefined,e.assertLog()}),f("source map",async({r:n})=>{let e=await n.launchUrl("browserify/pause.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),f("absolute paths in source maps",async({r:n})=>{let e=n.workspacePath("web/tmp");after(async()=>{await Dy.promises.rm(e,{recursive:!0,force:!0})}),D(e,{"pause.js":await xr(n.workspacePath("web/browserify/pause.js")),"pause.html":await xr(n.workspacePath("web/browserify/pause.html")),"pause.js.map":(await xr(n.workspacePath("web/browserify/pause.js.map"))).replace(/"([a-z0-9]+.ts)"/g,`"${G(n.workspacePath("web/browserify"))}/$1"`)});let t=await n.launchUrl("tmp/pause.html"),r={path:t.workspacePath("web/browserify/module2.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:3}]}),t.load(),await P(t),await P(t),t.assertLog()}),f("source map predicted",async({r:n})=>{let e=await n.launchUrl("browserify/pause.html");e.adapter.breakpointManager.setPredictorDisabledForTest(!1);let t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.load(),await P(e),await P(e),e.assertLog()}),f("source map that's path mapped",async({r:n})=>{let e=n.workspacePath("web/tmp");after(async()=>{await Dy.promises.rm(e,{recursive:!0,force:!0})}),D(e,{"app.ts":await xr(n.workspacePath("web/pathMapped/app.ts")),"app.js":(await xr(n.workspacePath("web/pathMapped/app.js"))).replace("app.js.map","mappedPath/app.js.map"),"index.html":await xr(n.workspacePath("web/pathMapped/index.html")),mappedDir:{"app.js.map":await xr(n.workspacePath("web/pathMapped/app.js.map"))}});let t=await n.launchUrl("tmp/index.html",{pathMapping:{"/mappedPath/":"${workspaceFolder}/web/tmp/mappedDir/"}}),r={path:t.workspacePath("web/tmp/app.ts")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2}]}),t.load(),await P(t),t.assertLog()})}),describe("launched",()=>{f("inline",async({r:n})=>{let e=await n.launchUrl("inlinescriptpause.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/inlinescriptpause.html")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),f("script",async({r:n})=>{let e=await n.launchUrl("script.html");e.load(),await P(e,async()=>{let t={path:e.workspacePath("web/script.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:6}]})}),await P(e),e.assertLog()}),f("ref",async({r:n})=>{let e=await n.launchUrlAndLoad("index.html");e.evaluate(`
      function foo() {
        return 2;
      }
    `);let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]});let r=e.evaluate("foo();");await P(e),await r,e.assertLog()}),f("remove",async({r:n})=>{let e=await n.launchUrlAndLoad("index.html");e.evaluate(`
        function foo() {
          return 2;
        }
      `);let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),e.assertLog()}),f("overwrite",async({r:n})=>{let e=await n.launchUrlAndLoad("index.html");e.evaluate(`
        function foo() {
          var x = 3;
          return 2;
        }
      `);let{source:t}=await e.waitForSource("eval");t.path=void 0,await e.dap.setBreakpoints({source:t,breakpoints:[{line:4}]}),await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),e.cdp.Runtime.evaluate({expression:`foo();
debugger;
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),f("source map",async({r:n})=>{let e=await n.launchUrl("browserify/browserify.html"),t=e.waitForSource("module2.ts");await e.load(),await t;let r={path:e.workspacePath("web/browserify/module2.ts")},o=await e.dap.setBreakpoints({source:r,breakpoints:[{line:3}]});(0,Ry.expect)(o.breakpoints[0].verified).to.be.true,e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),f("source map remove",async({r:n})=>{let e=await n.launchUrlAndLoad("browserify/browserify.html"),t={path:e.workspacePath("web/browserify/module2.ts")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await e.dap.setBreakpoints({source:t,breakpoints:[]}),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),e.assertLog()}),f("source map set compiled",async({r:n})=>{let e=await n.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`});let{threadId:r}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r),e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),f("source map set compiled 2",async({r:n})=>{let e=await n.launchUrl("browserify/browserify.html");e.load(),await e.waitForSource("bundle.js");let t=await e.dap.setBreakpoints({source:{path:e.workspacePath("web/browserify/bundle.js")},breakpoints:[{line:36}]});delete t.breakpoints[0].source.sources,e.log(t.breakpoints[0],"Breakpoint resolved: "),e.cdp.Runtime.evaluate({expression:`window.callBack(window.pause);
//# sourceURL=test.js`}),await P(e),await P(e),e.assertLog()}),f("sets breakpoints in sourcemapped node_modules",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"nodeModuleBreakpoint"),t=await n.runScript((0,E.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/foo"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"node_modules","@c4312","foo","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("sets breakpoints in sourcemapped node_modules with absolute root",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"nodeModuleBreakpoint"),t=await n.runScript((0,E.join)(e,"index.js"),{outFiles:[`${e}/**/*.js`],env:{MODULE:"@c4312/absolute-sourceroot"},resolveSourceMapLocations:null});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"node_modules","@c4312","absolute-sourceroot","src","index.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("absolute path in nested module",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"nestedAbsRoot"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"test.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("logpoints",()=>{f("basic",async({r:n})=>{let e=await n.launchUrl("logging.html"),t={path:e.workspacePath("web/logging.js")},r=[{line:6,column:0,logMessage:"123"},{line:7,column:0,logMessage:"{({foo: 'bar'})}"},{line:8,column:0,logMessage:"{foo}"},{line:9,column:0,logMessage:"foo {foo} bar"},{line:10,column:0,logMessage:"foo {bar + baz}"},{line:11,column:0,logMessage:"{const a = bar + baz; a}"},{line:12,column:0,logMessage:"{(x=>x+baz)(bar)}"},{line:13,column:0,logMessage:'{throw new Error("oof")}'},{line:14,column:0,logMessage:"{'hi'}"},{line:15,column:0,logMessage:"{{foo: 'bar'}}"},{line:16,column:0,logMessage:"{{f}}"}];await e.dap.setBreakpoints({source:t,breakpoints:r}),e.load();let o=[];for(let i=0;i<r.length;i++)o.push(await e.dap.once("output"));for(let i of o)await e.logger.logOutput(i);e.assertLog()}),f("callstack",async({r:n})=>{let e=await n.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:6,column:0,logMessage:"123"}]}),e.load(),e.log(await e.dap.once("output")),e.assertLog()}),f("returnValue",async({r:n})=>{let e=await n.launchUrl("logging.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/logging.js")},breakpoints:[{line:32,column:100,logMessage:"doubled: {$returnValue * 2}"}]}),e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),f("no double log",async({r:n})=>{let e=await n.launchUrlAndLoad("logging.html"),t={path:e.workspacePath("web/logging.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:28,column:0,logMessage:"{'LOG' + (window.logValue = (window.logValue || 0) + 1)}"}]}),e.cdp.Runtime.evaluate({expression:"g(); console.log('DONE' + window.logValue)"});let r=[];for(let o=0;o<2;o++)r.push(await e.dap.once("output"));for(let o of r)await e.logger.logOutput(o);e.assertLog()})}),describe("hit condition",()=>{async function n(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}f("exact",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"==2"}]}),t.load(),await n(t),await P(t),t.assertLog()}),f("less than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"<3"}]}),t.load(),await n(t),await n(t),await P(t),t.assertLog()}),f("greater than",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:">3"}]}),t.load(),await n(t),await n(t),t.assertLog()}),f("invalid",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};t.dap.on("output",o=>{o.category==="stderr"&&t.logger.logOutput(o)}),await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,hitCondition:"abc"}]}),t.load(),await P(t),t.assertLog()})}),describe("condition",()=>{async function n(e){await P(e,async()=>{await e.logger.evaluateAndLog("i")})}f("basic",async({r:e})=>{let t=await e.launchUrl("condition.html"),r={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:2,column:0,condition:"i==2"}]}),t.load(),await n(t),await P(t),t.assertLog()}),f("ignores error by default",async({r:e})=>{let t=await e.launchUrl("condition.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]});let r=t.dap.once("output");t.load(),await P(t),await e.log(await r),t.assertLog()}),f("pauses on error",async({r:e})=>{let t=await e.launchUrl("condition.html",{__breakOnConditionalError:!0});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/condition.js")},breakpoints:[{line:2,column:0,condition:'(() => { throw "oh no" })()'}]}),t.load();let r=t.dap.once("output");await P(t),t.logger.logOutput(await r),t.assertLog()}),f("ignores bp with invalid condition",async({r:e})=>{let t=await e.launchUrl("condition.html"),r=t.dap.once("output"),o={path:t.workspacePath("web/condition.js")};await t.dap.setBreakpoints({source:o,breakpoints:[{line:2,column:0,condition:")(}{][.&"}]}),t.load(),await e.log(await r),await P(t),t.assertLog()})}),describe("custom",()=>{f("inner html",async({r:n})=>{let e=await n.launchAndLoad("<div>text</div>");e.log("Not pausing on innerHTML"),await e.evaluate("document.querySelector('div').innerHTML = 'foo';"),e.log("Pausing on innerHTML"),await e.dap.setCustomBreakpoints({ids:["instrumentation:Element.setInnerHTML"],xhr:[]}),e.evaluate("document.querySelector('div').innerHTML = 'bar';");let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.continue({threadId:t.threadId})),e.assertLog()})}),describe("first line",()=>{f("breaks if requested",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"simpleNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"index.js")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("does not break if not requested",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"simpleNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"index.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("hot-transpiled",()=>{f("breaks on first line",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"double.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("user defined bp on first line",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"log.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("adjusts breakpoints",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("adjusts breakpoints after already running (#524)",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load();let{threadId:r}=await t.dap.once("stopped");t.log(await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"double.ts")},breakpoints:[{line:17,column:1}]})),t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),f("works in remote workspaces",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScriptAsRemote((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"double.ts")},breakpoints:[{line:7,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("avoids double pathmapping (#1617)",async({r:n})=>{D(b,{src:{"double.js":"console.log('hello world');"},"double.js":["/*'Object.<anonymous>':function(module,exports,require,__dzrname,__fzlename,jest*/console.log('hello world');","//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,names:["console","log"],sources:["double.js"],sourcesContent:[`console.log('hello world');
`],mappings:"AAAAA,OAAO,CAACC,GAAG,CAAC,aAAa,CAAC"})).toString("base64")]});let e=await n.runScript("double.js",{localRoot:(0,E.join)(b,"src"),remoteRoot:b});await e.dap.setBreakpoints({source:{path:(0,E.join)(b,"src","double.js")},breakpoints:[{line:1,column:1}]}),e.load(),await P(e),n.assertLog({substring:!0})}),f("does not adjust already correct",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNode"),t=await n.runScript((0,E.join)(e,"index.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"matching-line.ts")},breakpoints:[{line:3,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})})}),describe("lazy async stack",()=>{f("sets stack on pause",async({r:n})=>{let e=await n.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}});e.load(),await P(e),await P(e),e.assertLog()}),f("sets eagerly on bp",async({r:n})=>{let e=await n.launchUrl("asyncStack.html",{showAsyncStacks:{onceBreakpointResolved:32}}),t={path:e.workspacePath("web/asyncStack.js")};await e.dap.setBreakpoints({source:t,breakpoints:[{line:5,column:1}]}),e.load(),await P(e),await P(e),e.assertLog()})}),f("gets correct line number with babel code (#407)",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"babelLineNumbers"),t=await n.runScript((0,E.join)(e,"compiled.js"));await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"compiled.js")},breakpoints:[{line:1}]}),await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"app.tsx")},breakpoints:[{line:2}]}),t.load();let{threadId:r}=t.log(await t.dap.once("stopped"));await t.dap.continue({threadId:r}),await P(t),t.assertLog({substring:!0})}),f("vue projects",async({r:n})=>{let e=await n.launchUrl("vue/index.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/src/App.vue")},breakpoints:[{line:9,column:1}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog()}),describe("breakpoint placement",()=>{let n=(0,E.join)(_,"sourceMapLocations");describe("first function stmt",()=>{["tsc","babel"].forEach(e=>f(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,E.join)(n,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,E.join)(n,"test.ts")},breakpoints:[{line:4,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))}),describe("end function stmt",()=>{["tsc","babel"].forEach(e=>f(e,async({r:t})=>{await t.initialize;let r=await t.runScript((0,E.join)(n,`${e}.js`));await r.dap.setBreakpoints({source:{path:(0,E.join)(n,"test.ts")},breakpoints:[{line:6,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}))})}),describe("hit count",()=>{let n=async(t,r)=>{let o=await t.launchUrlAndLoad("index.html");o.evaluate(`
        function foo() {
          for (let i = 0; i < 10; i++) {
            console.log(i);
            console.log(i);
            console.log(i);
          }
        }
      `);let{source:i}=await o.waitForSource("eval");i.path=void 0,await r(o,i),o.assertLog()},e=async t=>{let{threadId:r}=await t.dap.once("stopped"),{id:o}=(await t.dap.stackTrace({threadId:r})).stackFrames[0];return await t.logger.logEvaluateResult(await t.dap.evaluate({expression:"i",frameId:o})),t.dap.continue({threadId:r})};f("works for valid",async({r:t})=>{await n(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]}));let i=r.evaluate("foo();");await e(r),await i})}),f("implies equal (#1698)",async({r:t})=>{await n(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"5"}]}));let i=r.evaluate("foo();");await e(r),await i})}),f("can change after set",async({r:t})=>{await n(t,async(r,o)=>{t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=5"}]})),t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"=8"}]}));let i=r.evaluate("foo();");await e(r),await i})}),f("does not validate or hit invalid breakpoint",async({r:t})=>{await n(t,async(r,o)=>{let i=r.dap.once("output");t.log(await r.dap.setBreakpoints({source:o,breakpoints:[{line:4,hitCondition:"potato"}]})),await t.log(await i),await r.evaluate("foo();")})})}),f("user defined bp on first line with stop on entry on .ts file reports as breakpoint",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNodeApp"),t=await n.runScript((0,E.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"app.ts")},breakpoints:[{line:1,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("stop on entry on .ts file reports as entry",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"tsNodeApp"),t=await n.runScript((0,E.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"app.tsx")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("resolves sourcemaps in paths containing glob patterns (vscode#166400)",async({r:n})=>{await n.initialize;let e=(0,E.join)(_,"glob(chars)"),t=await n.runScript((0,E.join)(e,"app.ts"),{stopOnEntry:!0,smartStep:!1,outFiles:[`${e}/**/*.js`],resolveSourceMapLocations:[`${e}/**/*.js`]});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"app.ts")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("reevaluates breakpoints when new sources come in (#600)",async({r:n})=>{let e=await n.launchUrl("unique-refresh?v=1");e.load();let{source:t}=await e.waitForSource("hello.js");e.dap.setBreakpoints({source:t,breakpoints:[{line:2,column:1}]}),await P(e),e.cdp.Page.navigate({url:n.buildUrl("unique-refresh?v=2")}),await P(e),e.assertLog()}),f("can step in when first line of code is function",async({r:n})=>{D(b,{"test.js":["function double(x) {","  x *= 2;","  return x;","}","double(2)"]});let e=await n.runScript("test.js");await e.dap.setBreakpoints({source:{path:(0,E.join)(b,"test.js")},breakpoints:[{line:5,column:0}]}),e.load();let{threadId:t}=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(t),e.dap.stepIn({threadId:t}),await P(e),e.assertLog({process:NR})}),f("normalizes webpack nul byte (#1080)",async({r:n})=>{let e=(0,E.join)(_,"webpackNulByte"),t=await n.runScript((0,E.join)(e,"build/greeter.js"),{cwd:e});await t.dap.setBreakpoints({source:{path:(0,E.join)(e,"src/#hello/world.ts")},breakpoints:[{line:1,column:0}]}),t.load(),await P(t),t.assertLog({substring:!0})}),f("excludes callers",async({r:n})=>{let e=await n.launchAndLoad("blank");e.dap.evaluate({expression:`
        function foo() {
          bar();
        }

        function baz() {
          bar();
        }

        function bar() {
          debugger;
        }

        foo();
        baz();
        foo();
        baz();
      `}),await P(e,async t=>{let{stackFrames:[r,o]}=await e.dap.stackTrace({threadId:t});await e.dap.setExcludedCallers({callers:[{caller:{line:o.line,column:o.column,source:o.source},target:{line:r.line,column:r.column,source:r.source}}]})}),await P(e),await P(e),e.assertLog()}),f("ignores source url query string (#1225)",async({r:n})=>{let e=(0,E.join)(_,"sourceQueryString"),t=await n.runScript((0,E.join)(e,"output.js"),{cwd:e});t.load(),await P(t),t.assertLog({substring:!0})}),f("toggles source map stepping",async({r:n})=>{let e=await n.launchUrl("basic.html");await e.dap.setBreakpoints({source:{path:e.workspacePath("web/basic.ts")},breakpoints:[{line:12}]}),e.load();{let o=e.dap.once("breakpoint"),{threadId:i}=e.log(await e.dap.once("stopped"));await n.log(await o,"Initial breakpoint resolution"),await e.logger.logStackTrace(i)}e.dap.setSourceMapStepping({enabled:!1});let t=e.dap.once("breakpoint"),{threadId:r}=e.log(await e.dap.once("stopped"));await n.log(await t,"Demapped breakpoint"),await e.logger.logStackTrace(r),await e.dap.stepIn({threadId:r}),await P(e),e.assertLog()}),f("prefers file uris to url (#1598)",async({r:n})=>{let e=(0,E.join)(_,"web/script.html"),t=await n.launchUrl("script.html",{file:e});n._launchUrl=Qo(e);let r={path:t.workspacePath("web/script.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:9,column:0}]}),t.load(),await P(t),await P(t),t.assertLog()}),f("stepInTargets",async({r:n})=>{let e=await n.launchUrl("stepInTargets.html"),t=e.waitForSource("stepInTargets.js");await e.load(),await e.dap.setBreakpoints({source:(await t).source,breakpoints:[{line:4,column:1},{line:5,column:1}]});let r=e.dap.evaluate({expression:"doTest()"});{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:i}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:i[0].id}),"stepInTargets line 3");e.log(await e.dap.stepIn({threadId:o,targetId:s[0].id}),"step in new Foo()"),await P(e)}{let{threadId:o}=e.log(await e.dap.once("stopped")),{stackFrames:i}=await e.dap.stackTrace({threadId:o}),{targets:s}=e.log(await e.dap.stepInTargets({frameId:i[0].id}),"stepInTargets line 4");e.log(await e.dap.stepIn({threadId:o,targetId:s[2].id}),"step in new Foo().bar()"),await P(e)}await r,e.assertLog()}),f("does not interrupt stepOver with instrumentation breakpoint (#1556)",async({r:n})=>{async function e(o){let{threadId:i}=o.log(await o.dap.once("stopped"));return await o.logger.logStackTrace(i),o.dap.next({threadId:i})}let t=await n.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),r=t.evaluate("test()");await e(t),await e(t),await P(t),await r,t.assertLog()}),f("does not interrupt stepIn with instrumentation breakpoint (#1665)",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          function test() {
            debugger;
            f=eval(\`
              (function (a, b) {
                c = a + b;
                return c;
              });
              //# sourceURL=foo.js
              //# sourceMappingURL=foo.js.map
            \`);
            f(1, 2);
          }
        </script>`),t=e.evaluate("test()"),r=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(r.threadId),await e.dap.stepIn({threadId:r.threadId});let o=e.log(await e.dap.once("stopped"));await e.logger.logStackTrace(o.threadId),await e.dap.stepIn({threadId:o.threadId}),await P(e),await t,e.assertLog()}),f("deals with removed execution contexts (#1582)",async({r:n})=>{let e=await n.launchUrlAndLoad("iframe-1582/index.html"),t={path:e.workspacePath("web/iframe-1582/inner.js")};e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e,async()=>{await e.dap.setBreakpoints({source:t,breakpoints:[]}),e.dap.evaluate({expression:'document.getElementsByTagName("IFRAME")[0].src += "?cool=true"',context:"repl"})}),await e.dap.once("loadedSource",r=>r.reason==="new"&&!!r.source.name?.includes("inner.js")),e.dap.setBreakpoints({source:t,breakpoints:[{line:3}]}),await P(e),e.assertLog()}),f("sets file uri breakpoints predictably (#1748)",async({r:n})=>{D(b,{"pages/main.html":'<script src="../scripts/hello.js"></script>',"scripts/hello.js":"console.log(42)"});let e=(0,E.join)(b,"pages/main.html"),t=await n.launchUrl(Qo(e),{url:void 0,file:e}),r={path:(0,E.join)(b,"scripts/hello.js")};await t.dap.setBreakpoints({source:r,breakpoints:[{line:1}]}),t.load(),await P(t),t.assertLog()}),f("disables entrypoint breakpoint when in file (vscode#230201)",async({r:n})=>{D(b,{"test.js":`function firstfunc(arg){
  return arg * arg
}
const a = firstfunc(2);
console.log('Finished awesome program');`});let e=await n.runScript("test.js",{cwd:b});await e.dap.setBreakpoints({source:{path:(0,E.join)(b,"test.js")},breakpoints:[{line:4,column:1}]}),e.load();let{threadId:t}=await e.dap.once("stopped");await e.dap.next({threadId:t}),await P(e),n.assertLog({substring:!0})})})});var f0={};var MD=m(()=>{"use strict";$e();describe("frames",()=>{f("hierarchy",async({r:n})=>{n.setArgs(["--site-per-process"]);let e=await n.launchUrl("frames.html");e.load();let t=(r,o)=>{let i=" ".repeat(o);e.log(`${i}${r.type()} "${r.name()}" [thread "${r.scriptUrlToUrl("")}"]${r.fileName()?" @ "+r.fileName():""}`);let s=r.children();s.sort((a,c)=>a.name().localeCompare(c.name())),s.forEach(a=>t(a,o+2))};await new Promise(r=>{n.onSessionCreated(()=>{n.binder.targetList().length===11&&r()})}),n.binder.targetList().filter(r=>!r.parent()).forEach(r=>t(r,0)),e.assertLog()})})});var Wt,ND,qe,OD,fu,BD=m(()=>{"use strict";Wt=require("chai"),ND=require("fs"),qe=y(require("path")),OD=require("sinon");Sp();ma();de();ro();U();le();V();J();rf();bt();fu={lookup:async n=>qe.join(b,"web","looked up",n),getVueHandling:n=>n.includes("lookup.vue")?1:n.includes("omit.vue")?2:0};describe("BrowserPathResolver",()=>{let n;before(()=>ju(!1)),beforeEach(()=>{n=new ve(ND.promises),(0,OD.stub)(n,"exists").callsFake(t=>{switch(t){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:return Promise.resolve(!1)}})}),after(()=>Bu()),describe("vue",()=>{let t=new Ur(fu,n,{workspaceFolder:b,pathMapping:{"/":qe.join(b,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:Yo(qe.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},j.null),r={metadata:{compiledPath:qe.join(b,"web","bundle.js"),sourceMapUrl:qe.join(b,"web","bundle.map.js")}};it("looks up vue paths",async()=>{(0,Wt.expect)(await t.urlToAbsolutePath({url:"lookup.vue",map:r})).to.equal(fe(qe.join(b,"web","looked up","lookup.vue")))}),it("omits vue paths",async()=>{(0,Wt.expect)(await t.urlToAbsolutePath({url:"omit.vue",map:r})).to.be.undefined}),it("uses default handling",async()=>{(0,Wt.expect)(await t.urlToAbsolutePath({url:"whatever.vue",map:r})).to.equal(fe(qe.join(b,"web","whatever.vue")))}),describe("VueFileMapper",()=>{let o=new ei(new cr({rootPath:b,patterns:["**/*.vue"]}),{streamChildrenWithSourcemaps(){return Promise.resolve({values:[],state:void 0})},streamAllChildren(i,s){return Promise.all([s(qe.join(b,"web","a.vue")),s(qe.join(b,"web","b.vue"))])}});it("has correct vue handling",()=>{let i=new Map([["webpack:///hello.vue?f00d",1],["webpack:///./components/hello.vue?f00d",2],["webpack:///unrelated.js",0]]);for(let[s,a]of i.entries())(0,Wt.expect)(o.getVueHandling(s)).to.equal(a)}),it("maps basenames to disk",async()=>{(0,Wt.expect)(await o.lookup("webpack:///a.vue?f00d")).to.equal(qe.join(b,"web","a.vue")),(0,Wt.expect)(await o.lookup("webpack:///q.vue?f00d")).to.be.undefined,(0,Wt.expect)(await o.lookup("webpack:///unrelated.js")).to.be.undefined})})});class e{exists(r){switch(r){case"c:\\Users\\user\\Source\\Repos\\Angular Project\\ClientApp\\src\\app\\app.component.html":return Promise.resolve(!0);case"c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot\\src\\app\\app.component.html":return Promise.resolve(!1);default:throw Error(`Unknown path ${r}`)}}}describe("absolutePathToUrl",()=>{let t=(r={})=>new Ur(fu,n,{workspaceFolder:b,pathMapping:{"/":qe.join(b,"web"),"/sibling":qe.join(b,"sibling-dir"),"https://example.com/abs":qe.join(b,"abs")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:Yo(qe.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0,...r},j.null);it("selects webRoot correctly",()=>{let r="http://localhost:1234/foo/bar(\\.html)?";(0,Wt.expect)(t().absolutePathToUrlRegexp(qe.join(b,"web","foo","bar.html"))).to.equal(at(r,[0,r.length-9]));let o="http://localhost:1234/sibling/foo/bar(\\.html)?";(0,Wt.expect)(t().absolutePathToUrlRegexp(qe.join(b,"sibling-dir","foo","bar.html"))).to.equal(at(o,[0,o.length-9]))}),it("falls back if not in any webroot",()=>{let r="http://localhost:1234/../foo/bar(\\.html)?";(0,Wt.expect)(t().absolutePathToUrlRegexp(qe.join(b,"foo","bar.html"))).to.equal(at(r,[0,r.length-9]))}),it("matches any path if no baseUrl is present",()=>{let r=qe.join(b,"web","foo.js");(0,Wt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(r)).to.equal(at(Q(r))+"|[hH][tT][tT][pP][sS]?:\\/\\/[^\\/]+\\/[fF][oO][oO]\\.[jJ][sS]($|\\?)")}),it("does not mangle absolute pathmapping",()=>{(0,Wt.expect)(t({baseUrl:void 0}).absolutePathToUrlRegexp(qe.join(b,"abs","x.js"))).to.equal(at("https://example.com/abs/x.js"))}),it("allows overriding resolution of workspaceFolder (for #1308)",()=>{(0,Wt.expect)(t({pathMapping:{"/":qe.join(b,"web"),"/override":qe.join(b,"web")}}).absolutePathToUrlRegexp(qe.join(b,"web","x.js"))).to.equal(at("http://localhost:1234/override/x.js"))})}),[["visualstudio","ClientApp"],["vscode","wwwroot"]].forEach(([t,r])=>{it(`returns ${r} for ${t} if the webroot path doesn't exist and the modified path does`,async()=>{let o="c:\\Users\\user\\Source\\Repos\\Angular Project\\wwwroot",a=await new Ur(fu,new e,{workspaceFolder:b,pathMapping:{"/":o},clientID:t,baseUrl:"http://localhost:60318/",sourceMapOverrides:Yo(o),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:void 0},await j.test()).urlToAbsolutePath({url:"webpack:///src/app/app.component.html",map:hn({metadata:{sourceMapUrl:"",compiledPath:"x"}})});(0,Wt.expect)(a).to.equal(`c:\\Users\\user\\Source\\Repos\\Angular Project\\${r}\\src\\app\\app.component.html`)})})})});var g0={};function jD(n){return new ic(fu,new ve(WD.promises),{workspaceFolder:b,pathMapping:{"/":gu.default.join(b,"web")},clientID:"vscode",baseUrl:"http://localhost:1234/",sourceMapOverrides:Yo(gu.default.join(b,"web")),localRoot:null,remoteRoot:null,resolveSourceMapLocations:null,remoteFilePrefix:n},j.null)}var Pg,WD,gu,VD,UD,$D=m(()=>{"use strict";Pg=require("chai"),WD=require("fs"),gu=y(require("path"));de();ro();V();J();ew();BD();bt();VD=process.platform==="win32",UD=VD?"C:":"/c";describe("BlazorSourcePathResolver.absolutePathToUrlRegexp",()=>{it("generates the correct regexp in local scenarios",async()=>{let n=gu.default.join(UD,"Users","digeff","source","repos","MyBlazorApp","MyBlazorApp","Pages","Counter.razor"),e=await jD(void 0).absolutePathToUrlRegexp(n);Fl()?(0,Pg.expect)(e).to.equal("file:\\/\\/\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)|http:\\/\\/localhost:1234\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/\\.\\.\\/c\\/Users\\/digeff\\/source\\/repos\\/MyBlazorApp\\/MyBlazorApp\\/Pages\\/Counter\\.razor($|\\?)"):(0,Pg.expect)(e).to.contain("[fF][iI][lL][eE]:\\/\\/\\/[cC]:\\/[uU][sS][eE][rR][sS]\\/[dD][iI][gG][eE][fF][fF]\\/[sS][oO][uU][rR][cC][eE]\\/[rR][eE][pP][oO][sS]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)|[cC]:\\\\[uU][sS][eE][rR][sS]\\\\[dD][iI][gG][eE][fF][fF]\\\\[sS][oO][uU][rR][cC][eE]\\\\[rR][eE][pP][oO][sS]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[mM][yY][bB][lL][aA][zZ][oO][rR][aA][pP][pP]\\\\[pP][aA][gG][eE][sS]\\\\[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")}),VD&&it("generates the correct regexp in codespace scenarios",async()=>{let n=gu.default.join(UD,"Users","digeff","AppData","Local","Temp","2689D069D40B1EFF4B570B2DB12506073980","5~~"),e=`${n}\\C$\\workspace\\NewBlazorWASM\\NewBlazorWASM\\Pages\\Counter.razor`,t=await jD(n).absolutePathToUrlRegexp(e);(0,Pg.expect)(t).to.equal("dotnet://.*\\.dll/[cC]\\/[wW][oO][rR][kK][sS][pP][aA][cC][eE]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[nN][eE][wW][bB][lL][aA][zZ][oO][rR][wW][aA][sS][mM]\\/[pP][aA][gG][eE][sS]\\/[cC][oO][uU][nN][tT][eE][rR]\\.[rR][aA][zZ][oO][rR]($|\\?)")})})});var h0={};var hu,qD=m(()=>{"use strict";hu=require("chai");$();$e();describe("evaluate",()=>{f("default",async({r:t})=>{let r=await t.launchUrlAndLoad("index.html");await r.logger.evaluateAndLog("42"),r.log(""),await r.logger.evaluateAndLog("'foo'"),r.log(""),await r.logger.evaluateAndLog("1234567890n"),r.log(""),await r.logger.evaluateAndLog("throw new Error('foo')"),r.log(""),await r.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};"),r.log(""),await r.logger.evaluateAndLog("throw 42;"),r.log(""),await r.logger.evaluateAndLog("{foo: 3}"),r.log(""),await r.logger.evaluateAndLog("baz();"),r.log(""),await r.logger.evaluateAndLog("'\\x1b[2m'"),r.log(""),await r.logger.evaluateAndLog("new Uint8Array([1, 2, 3]);"),r.log(""),await r.logger.evaluateAndLog("new Uint8Array([1, 2, 3]).buffer;"),r.log(""),await r.logger.evaluateAndLog("new Proxy({ a: 1 }, { get: () => 2 });"),r.log(""),await r.logger.evaluateAndLog("Object.create({ set foo(x) {} })",{depth:2}),r.log(""),await r.logger.evaluateAndLog("Object.create({ get foo() { return 42 } })",{depth:2}),r.log(""),await r.logger.evaluateAndLog("Object.create({ get foo() { throw 'wat'; } })",{depth:2}),r.log(""),await r.logger.evaluateAndLog("Object.create({ get [Symbol.toStringTag]() { return 42 } })",{depth:2}),r.log(""),r.evaluate("setTimeout(() => { throw new Error('bar')}, 0)"),await r.logger.logOutput(await r.dap.once("output")),r.log(""),r.dap.evaluate({expression:"setTimeout(() => { throw new Error('baz')}, 0)"}),await r.logger.logOutput(await r.dap.once("output")),r.log(""),await r.addScriptTag("browserify/bundle.js"),await r.logger.evaluateAndLog("window.throwError('error1')"),r.log(""),await r.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})"),r.log(""),r.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await r.logger.logOutput(await r.dap.once("output")),r.log(""),r.assertLog()}),f("supports location lookup",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html"),o=await r.logger.evaluateAndLog("printArr");(0,hu.expect)(o.valueLocationReference).to.be.greaterThan(0);let i=await r.dap.locations({locationReference:o.valueLocationReference});r.log(i),r.assertLog()}),f("repl",async({r:t})=>{let r=await t.launchUrlAndLoad("index.html");await r.logger.evaluateAndLog("42",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("'foo'",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("1234567890n",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("throw new Error('foo')",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("throw {foo: 3, bar: 'baz'};",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("throw 42;",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("{foo: 3}",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("baz();",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("new Map([['hello', function() { return 'world' }]])",void 0,"repl"),r.log("");let[,o]=await Promise.all([r.logger.evaluateAndLog("setTimeout(() => { throw new Error('bar')}, 0); 42",void 0,"repl"),r.dap.once("output")]);await r.logger.logOutput(o),r.log("");let[,i]=await Promise.all([r.logger.evaluateAndLog("setTimeout(() => { throw new Error('baz')}, 0); 42",void 0,"repl"),r.dap.once("output")]);await r.logger.logOutput(i),r.log(""),await r.addScriptTag("browserify/bundle.js"),await r.logger.evaluateAndLog("window.throwError('error1')",void 0,"repl"),r.log(""),await r.logger.evaluateAndLog("window.throwValue({foo: 3, bar: 'baz'})",void 0,"repl"),r.log("");let[,s]=await Promise.all([r.logger.evaluateAndLog("setTimeout(() => { window.throwError('error2')}, 0); 42",void 0,"repl"),r.dap.once("output")]);await r.logger.logOutput(s),r.log(""),await r.logger.evaluateAndLog("new Uint8Array(100_000).fill(0)",{logInternalInfo:!0,depth:0},"repl"),r.log(""),r.assertLog()}),f("valueFormatter",async({r:t})=>{let r={hex:!0},o=await t.launchUrlAndLoad("index.html");await o.logger.evaluateAndLog("42",{format:r}),o.log(""),await o.logger.evaluateAndLog("123567891235678912356789123567891235678912356789n",{format:r}),o.log(""),await o.logger.evaluateAndLog("'hello world'",{format:r}),o.log(""),await o.logger.evaluateAndLog("({ a: 'hello', b: 42, c: true })",{format:r}),o.log(""),o.assertLog()});let n={"123n":"123n",NaN:"NaN",'{foo: "bar", baz: { a: [1, 2, 3, 4, 5, 6, 7, 8, 9], b: 123n, "complex key": true }}':`{
  foo: "bar",
  baz: {
    a: [
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9,
    ],
    b: 123n,
    "complex key": true,
  },
}`,"{\n  double(x) {\n    return x * 2;\n  },\n  triple: x => {\n    return x * 3\n  }\n}":`{
  double: function(x) {
    return x * 2;
  },
  triple: x => {
    return x * 3
  },
}`,'function hello() { return "world" }':'function hello() { return "world" }',"(() => { const n = { foo: true }; n.recurse = n; return n })()":`{
  foo: true,
  recurse: [Circular],
}`,"new Uint8Array([1, 2, 3])":"new Uint8Array([1, 2, 3])","new Uint8Array([1, 2, 3]).buffer":"new Uint8Array([1, 2, 3]).buffer","new Float32Array([1.5, 2.5, 3.5])":"new Float32Array([1.5, 2.5, 3.5])","1n << 100n":"1267650600228229401496703205376n","new Date(1665007127286)":'"2022-10-05T21:58:47.286Z"','(() => { const node = document.createElement("div"); node.innerText = "hi"; return node })()':"<div>hi</div>",'"hello\\nmu`lti${line}"':"`hello\nmu\\`lti\\${line}`"},e={'"hello"':"hello",'"hello\\nmu`lti${line}"':"hello\nmu`lti${line}"};f("copy via function",async({r:t})=>{let r=await t.launchAndLoad("blank"),o={...n,...e};for(let[i,s]of Object.entries(o)){r.dap.evaluate({expression:`copy(${i})`});let a=await r.dap.once("copyRequested");(0,hu.expect)(a.text).to.equal(s,i)}}),f("copy via evaluate context",async({r:t})=>{let r=await t.launchAndLoad("blank");for(let[o,i]of Object.entries(n)){let s=await r.dap.evaluate({expression:o,context:"clipboard"});(0,hu.expect)(s.result).to.equal(i,o)}}),f("inspect",async({r:t})=>{let r=await t.launchAndLoad("blank");r.dap.evaluate({expression:`function foo() {}; inspect(foo)
//# sourceURL=test.js`}),r.log(await r.dap.once("revealLocationRequested")),r.assertLog()}),f("queryObjects",async({r:t})=>{let r=await t.launchAndLoad("blank");await r.dap.evaluate({expression:`
      class Foo {
        constructor(value) {
          this.value = value;
        }
      }
      var foo1 = new Foo(1);
      var foo2 = new Foo(2);
    `}),r.dap.evaluate({expression:"queryObjects(Foo)"}),await r.logger.logOutput(await r.dap.once("output")),r.assertLog()}),f("topLevelAwait",async({r:t})=>{let r=await t.launchAndLoad(`
      <script>
        function foo(x) {
          return x;
        }

        function koo() {
          return Promise.resolve(4);
        }
      </script>
    `),o=["await Promise.resolve(1)","{a:await Promise.resolve(1)}","4","$_","let {a,b} = await Promise.resolve({a: 1, b:2}), f = 5;","a","b","let c = await Promise.resolve(2)","c","let d;","d","let [i,{abc:{k}}] = [0,{abc:{k:1}}];","i","k","var l = await Promise.resolve(2);","l","foo(await koo());","$_","const m = foo(await koo());","m",`const n = foo(await
koo());`,"n","`status: ${(await Promise.resolve({status:200})).status}`","for (let i = 0; i < 2; ++i) await i","for (let i = 0; i < 2; ++i) { await i }","await 0","await 0;function foo(){}","foo","class Foo{}; await 1;","Foo","await 0;function* gen(){}","for (var i = 0; i < 10; ++i) { await i; }","i","for (let j = 0; j < 5; ++j) { await j; }","j","gen","await 5; return 42;","let o = await 1, p","p","let q = 1, s = await 2","s","await {...{foo: 42}}"];for(let i of o)r.log(`Evaluating: '${i}'`),r.logger.logEvaluateResult(await r.dap.evaluate({expression:i,context:"repl"}),{depth:0});r.assertLog()}),f("escapes strings",async({r:t})=>{let r=await t.launchAndLoad("blank");for(let o of["watch","hover","repl"])r.log(`context=${o}`),await r.logger.evaluateAndLog(JSON.stringify(`1
2\r3	\\4`),{depth:0},o);r.assertLog({customAssert:o=>(0,hu.expect)(o).to.equal(["context=watch","result: '1\\n2\\r3\\t\\\\4'","context=hover","result: '1\\n2\\r3\\t\\\\4'","context=repl",`
result: '1
2\r3	\\\\4'`,""].join(`
`))})}),f.skip("output slots",async({r:t})=>{let r=await t.launchAndLoad("blank"),o=await r.dap.evaluate({expression:"let i = 0; console.log(++i); ++i",context:"repl"}),i=await r.dap.once("output"),s=await r.dap.once("output");await r.logger.logEvaluateResult(o),await r.logger.logOutput(i),await r.logger.logOutput(s),r.assertLog()}),f.skip("output slots 2",async({r:t})=>{let r=await t.launchAndLoad("blank"),o=await r.dap.evaluate({expression:`
      let i = 0;
      setTimeout(() => {
        console.log(++i);
        throw {foo: ++i};
      }, 0);
      ++i
    `,context:"repl"}),i=await r.dap.once("output"),s=await r.dap.once("output"),a=await r.dap.once("output");await r.logger.logEvaluateResult(o),await r.logger.logOutput(i),await r.logger.logOutput(s),await r.logger.logOutput(a),r.assertLog()}),f("selected context",async({r:t})=>{let r=await t.launchUrlAndLoad("worker.html");r.log("--- Evaluating in page"),r.log("Pausing..."),r.dap.evaluate({expression:"window.w.postMessage('pause');",context:"repl"});let{threadId:o}=await r.dap.once("stopped");r.log("Paused");let{id:i}=(await r.dap.stackTrace({threadId:o})).stackFrames[0];await r.logger.logEvaluateResult(await r.dap.evaluate({expression:"isWorker",frameId:i}),{depth:0}),r.dap.continue({threadId:o}),await r.dap.once("continued"),r.log("Resumed"),r.log("--- Evaluating in worker"),r.dap.evaluate({expression:"window.w.postMessage('pauseWorker');",context:"repl"});let s=await t.worker(),{threadId:a}=await s.dap.once("stopped");r.log("Paused");let{id:c}=(await s.dap.stackTrace({threadId:a})).stackFrames[0];await s.logger.logEvaluateResult(await s.dap.evaluate({expression:"isWorker",frameId:c}),{depth:0}),s.dap.continue({threadId:a}),await s.dap.once("continued"),r.log("Resumed"),r.assertLog()}),f("cd",async({r:t})=>{let r=await t.launchUrlAndLoad("index.html");async function o(i){let s=await r.dap.completions(i),a=i.text.substring(0,i.column-1)+"|"+i.text.substring(i.column-1);r.log(s.targets.filter(c=>c.label.startsWith("cd")),`"${a}": `)}await x(50),await o({line:1,column:1,text:""}),await o({line:1,column:3,text:"cd"}),await o({line:1,column:4,text:"cd "}),await o({line:1,column:5,text:"cd t"}),await o({line:1,column:5,text:"cd h"}),await o({line:1,column:2,text:"cd"}),await o({line:1,column:3,text:"co"}),r.assertLog()}),f("returnValue",async({r:t})=>{let r=await t.launchAndLoad("blank"),o=async(i,s="$returnValue")=>{r.dap.evaluate({expression:`(function () {
          debugger;
          return ${i};
        })();`});let{threadId:a}=await r.dap.once("stopped");await r.dap.next({threadId:a}),await r.dap.once("stopped"),await r.dap.next({threadId:a}),await r.dap.once("stopped");let c=(await r.dap.stackTrace({threadId:a})).stackFrames[0].id;r.log(`return ${i}:
`),await r.logger.evaluateAndLog(s,{params:{frameId:c}}),await r.dap.continue({threadId:a})};await o("42"),await o("{ a: { b: true } }"),await o("undefined"),t.assertLog()}),f("shadowed variables",async({r:t})=>{let r=await t.launchAndLoad("blank");r.dap.evaluate({expression:`(function () {
          let foo = 1;
          if (true) {
              let foo = 2;
              if (true) {
                  let foo = 3;
                  debugger;
                  console.log(foo);
              }
          }
        })();`});let o=r.dap.once("loadedSource"),{threadId:i}=await r.dap.once("stopped"),s=(await r.dap.stackTrace({threadId:i})).stackFrames[0].id,{source:a}=await o;await r.logger.evaluateAndLog("foo",{params:{frameId:s}});for(let c=1;c<=7;c++)r.log(`line ${c}:`),await r.logger.evaluateAndLog("foo",{params:{frameId:s,line:c,column:1,source:a}});t.assertLog()}),f("supports bigint map keys (#1277)",async({r:t})=>{await(await t.launchUrlAndLoad("index.html")).logger.evaluateAndLog("new Map([[1n, 'one'], [2n, 'two']])"),t.assertLog()})})});var b0={};var xg,qo,HD=m(()=>{"use strict";xg=require("chai"),qo=require("path");Gr();bt();$e();describe("sources",()=>{async function n(e,t,r){e.log(`
Source event for `+r),e.log(t);let o=await e.dap.source({sourceReference:t.source.sourceReference,source:{path:t.source.path,sourceReference:t.source.sourceReference}});e.log(o.content),e.log("---------")}f("basic sources",async({r:e})=>{let t=await e.launchUrl("inlinescript.html");t.load(),await n(t,await t.waitForSource("inline"),"inline"),t.addScriptTag("empty.js"),await n(t,await t.waitForSource("empty.js"),"empty.js"),t.evaluate("17","doesnotexist.js"),await n(t,await t.waitForSource("doesnotexist"),"does not exist"),t.addScriptTag("dir/helloworld.js"),await n(t,await t.waitForSource("helloworld"),"dir/helloworld"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),f("lazily announces eval",async({r:e})=>{let t=await e.launchUrlAndLoad("inlinescript.html"),r=t.waitForSource("eval");t.evaluate("42",""),t.evaluate("window.hello = m => console.log(m)",""),t.evaluate("hello()"),await n(t,await r,"eval"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),f("updated content",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:"content1//# sourceURL=test.js"}),await n(t,await t.waitForSource("test"),"test.js"),t.cdp.Runtime.evaluate({expression:"content2//# sourceURL=test.js"}),await n(t,await t.waitForSource("test"),"test.js updated"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),f("basic source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/bundle.js");let r=await Promise.all([t.waitForSource("index.ts"),t.waitForSource("module1.ts"),t.waitForSource("module2.ts")]);for(let o of r)await n(t,o,"");t.assertLog()}),f("waiting for source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),f.skip("waiting for source map failure",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.adapter.sourceContainer.setSourceMapTimeouts({load:2e3,resolveLocation:0,output:0,sourceMapMinPause:0,sourceMapCumulativePause:0}),await t.addScriptTag("browserify/bundle.js"),t.dap.evaluate({expression:"setTimeout(() => { window.throwError('error2')}, 0)"}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),f("supports nested sourcemaps (#1390)",async({r:e})=>{await e.initialize;let t=(0,qo.join)(_,"nestedSourceMaps"),r=await e.runScript((0,qo.join)(t,"a/main.bundle.js"),{cwd:t});await r.dap.setBreakpoints({source:{path:(0,qo.join)(_,"nestedSourceMaps","b","lib.js")},breakpoints:[{line:2,column:1}]}),r.load(),await P(r),r.assertLog({substring:!0})}),f("works with relative webpack sourcemaps (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),f("allows overrides for relative webpack paths (#479)",async({r:e})=>{let t=await e.launchUrl("webpack/relative-paths.html",{sourceMapPathOverrides:{"webpack:///./*":"${webRoot}/*","webpack:///../*":"${webRoot}/was-nested/*"}});await t.dap.setBreakpoints({source:{path:t.workspacePath("web/was-nested/greet.js")},breakpoints:[{line:2,column:1}]}),await t.dap.setBreakpoints({source:{path:t.workspacePath("web/webpack/farewell.js")},breakpoints:[{line:2,column:1}]}),t.load(),await P(t),await P(t),t.assertLog()}),f("url and hash",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await n(t,await t.waitForSource("foo.js"),"foo.js"),t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),await n(t,await t.waitForSource("foo.js"),"foo.js"),await t.cdp.Runtime.evaluate({expression:`a
//# sourceURL=foo.js`}),await t.cdp.Runtime.evaluate({expression:`b
//# sourceURL=foo.js`}),t.addScriptTag("empty.js"),await n(t,await t.waitForSource("empty.js"),"empty.js");let r=t.workspacePath("web/empty2.js");t.adapter.sourceContainer.setFileContentOverrideForTest(r,"123"),t.addScriptTag("empty2.js"),await n(t,await t.waitForSource("empty2.js"),"empty2.js"),t.log(await t.dap.loadedSources({}),`
Loaded sources: `),t.assertLog()}),f("allows module wrapper in node code",async({r:e})=>{let t=await e.runScript((0,qo.join)(_,"moduleWrapper","index.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,xg.expect)(r.source.sourceReference).to.equal(0)}),f("verifies content when enableContentValidation=true",async({r:e})=>{let t=await e.runScript((0,qo.join)(_,"moduleWrapper","customWrapper.js"));t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,xg.expect)(r.source.sourceReference).to.be.greaterThan(0)}),f("does not verify content when enableContentValidation=false",async({r:e})=>{let t=await e.runScript((0,qo.join)(_,"moduleWrapper","customWrapper.js"),{enableContentValidation:!1});t.load();let r=await t.waitForSource("moduleWrapper/test.js");(0,xg.expect)(r.source.sourceReference).to.equal(0)}),f("allows shebang in node code",async({r:e})=>{D(b,{index:'require("./shebang-lf"); require("./shebang-crlf"); debugger;',"shebang-lf":`#!/bin/node
console.log("hello world")`,"shebang-crlf":`#!/bin/node\r
console.log("hello world")`});let t=await e.runScript((0,qo.join)(b,"index"));t.load();let r=t.waitForSource("shebang-lf"),o=t.waitForSource("shebang-crlf");t.log(await r,void 0,[]),t.log(await o,void 0,[]),t.assertLog()}),f("applies sourcemap path mappings to sourceURLs (vscode#204784)",async({r:e})=>{let t=await e.launchUrl("vscode-204784/index.html",{sourceMapPathOverrides:{"mapped://*":"${workspaceFolder}/web/vscode-204784/*"},resolveSourceMapLocations:["${workspaceFolder}/web/vscode-204784/**"]});t.load();let r=await t.waitForSource("original");t.log(r,void 0,[]),t.assertLog()}),f("removes any query from node paths (#529)",async({r:e})=>{let t=await e.runScript((0,qo.join)(_,"simpleNode","simpleWebpackWithQuery.js"),{cwd:(0,qo.join)(_,"simpleNode")});t.load(),t.log(await t.waitForSource("simpleWebpackWithQuery.ts"),void 0,[]),t.assertLog()}),describe("sourcemap error handling",()=>{f("logs initial parse errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=data:application/json;charset=utf-8;base64,ZGV2cw==
`),await t.logger.logOutput(await r),t.assertLog()}),f("logs not found errors",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html"),r=t.dap.once("output",o=>o.category==="stderr");await t.evaluate(`//# sourceMappingURL=does-not-exist.js.map
`),await t.logger.logOutput(await r),t.assertLog()})})})});var w0={};var Ly,zD=m(()=>{"use strict";Ly=require("chai");$();Gr();bt();$e();describe("stacks",()=>{async function n(e,t){let r=await e.dap.once("stopped");await e.logger.logStackTrace(r.threadId,t?1/0:0),await e.dap.continue({threadId:r.threadId})}f("eval in anonymous",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`

debugger;
//# sourceURL=eval.js`}),await n(t,!1),t.assertLog()}),f("anonymous initial script",async({r:e})=>{let t=await e.launch("<script>debugger;</script>");t.load(),await n(t,!1),t.assertLog()}),f("anonymous scopes",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function paused() {
        let y = 'paused';
        debugger;
      }
      function chain(n) {
        if (!n)
          return paused;
        return function chained() {
          let x = 'x' + n;
          chain(n - 1)();
        };
      }
      chain(3)();
    `}),await n(t,!0),t.assertLog()}),f("async",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await n(t,!0),t.assertLog()}),f("async disables",async({r:e})=>{let t=await e.launchAndLoad("blank",{showAsyncStacks:!1});t.cdp.Runtime.evaluate({expression:`
      function foo(n) {
        if (!n) {
          debugger;
          return;
        }
        setTimeout(() => {
          bar(n - 1);
        }, 0);
      }
      async function bar(n) {
        await Promise.resolve(15);
        await foo(n);
      }
      bar(1);
    `}),await n(t,!0),t.assertLog()}),f("cross target",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:"window.w.postMessage('pause')"}),await n(t,!0),t.assertLog()}),f("source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.addScriptTag("browserify/pause.js"),await n(t,!0),t.assertLog()}),describe("smartStep",()=>{let t="//# sourceMappingURL=data:application/json;charset=utf-8;base64,"+Buffer.from(JSON.stringify({version:3,file:"source.js",sourceRoot:"",sources:["source.ts"],mappings:""})).toString("base64");f("simple stepping",async({r})=>{let o=await r.launchUrlAndLoad("index.html");o.addScriptTag("smartStep/async.js");let{threadId:i}=await o.dap.once("stopped");await o.dap.next({threadId:i}),await o.dap.once("stopped"),await o.logger.logStackTrace(i),o.log(`
# step in 1x`),o.dap.stepIn({threadId:i}),await o.dap.once("stopped"),await o.logger.logStackTrace(i),o.log(`
# step in 2x`),o.dap.stepIn({threadId:i}),await n(o,!1),o.assertLog()}),f("remembers step direction out",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let i=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s),await o.dap.stepOut({threadId:s}),o.logger.logAsConsole(`
# stepping out
`),await o.dap.once("stopped"),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await i,o.assertLog()}),f("remembers step direction in",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/directional.js"),await o.waitForSource("directional.ts"),await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/directional.ts")},breakpoints:[{line:2,column:0}]});let i=o.evaluate(`doCall(() => { mapped1(); mapped2(); })
${t}`),{threadId:s}=await o.dap.once("stopped");await o.logger.logStackTrace(s);for(let a=0;a<2;a++)await o.dap.stepIn({threadId:s}),await o.dap.once("stopped");o.logger.logAsConsole(`
# stepping in
`),await o.logger.logStackTrace(s),await o.dap.continue({threadId:s}),await i,o.assertLog()}),f("does not smart step on exception breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setExceptionBreakpoints({filters:["uncaught","all"]}),o.addScriptTag("smartStep/exceptionBp.js"),await n(o,!1),o.assertLog()}),f("does not smart step manual breakpoints",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.dap.setBreakpoints({source:{path:o.workspacePath("web/smartStep/exceptionBp.js")},breakpoints:[{line:9,column:0}]}),o.addScriptTag("smartStep/exceptionBp.js"),await n(o,!1),o.assertLog()}),f("does not step in sources missing maps",async({r})=>{let o=await r.launchUrlAndLoad("index.html");await o.addScriptTag("smartStep/missingMap.js");let i=o.evaluate(`debugger; doCallback(() => {
        console.log("hi");
      });`),s=(await o.dap.once("stopped")).threadId;await o.dap.stepIn({threadId:s}),s=(await o.dap.once("stopped")).threadId,await o.dap.stepIn({threadId:s}),await P(o),await i,o.assertLog()})}),f("return value",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
      function foo() {
        debugger;
        return 42;
      }
      foo();
    `});let{threadId:r}=await t.dap.once("stopped");t.dap.next({threadId:r}),await t.dap.once("stopped"),t.dap.next({threadId:r}),await n(t,!0),t.assertLog()}),describe("skipFiles",()=>{async function e(t,r){let o=await t.dap.once("stopped");return await x(200),await t.logger.logStackTrace(o.threadId,r?1/0:0),o}f("single authored js",async({r:t})=>{let r=await t.launchUrl("script.html",{skipFiles:["**/script.js"]}),o={path:r.workspacePath("web/script.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:6,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),f("single compiled js",async({r:t})=>{let r=await t.launchUrlAndLoad("basic.html",{skipFiles:["**/basic.js"]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),f("multiple authored ts to js",async({r:t})=>{let r=await t.launchUrlAndLoad("browserify/browserify.html",{skipFiles:["**/module*.ts"]}),o=r.dap.evaluate({expression:`window.callBack(() => { debugger });
console.log("out");`});await P(r),await o,r.assertLog()}),f("works with absolute paths (#470)",async({r:t})=>{let r=await t.launchUrl("basic.html",{skipFiles:[`${_}/web/basic.js`]}),o={path:r.workspacePath("web/basic.js")};await r.dap.setBreakpoints({source:o,breakpoints:[{line:3,column:0}]}),r.load(),await e(r,!1),r.assertLog()}),f("toggle authored ts",async({r:t})=>{let r=await t.launchUrl("basic.html"),o=r.workspacePath("web/basic.ts"),i={path:o};await r.dap.setBreakpoints({source:i,breakpoints:[{line:21,column:0}]}),r.load();let s=await r.dap.once("stopped");await x(500),await r.logger.logStackTrace(s.threadId),r.log("----send toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId),r.log("----send (un)toggle skipfile status request----"),await r.dap.toggleSkipFileStatus({resource:o}),await r.logger.logStackTrace(s.threadId),r.assertLog()}),f("handles special chars in stack (#203408)",async({r:t})=>{D(b,{"nested/a.js":"exports.foo = (fn) => fn()","@nested/a.js":"exports.foo = (fn) => fn()","test.js":['require("./@nested/a.js").foo(() => require("./nested/a.js").foo(() => { debugger }))']});let r=await t.runScript("test.js",{skipFiles:["**/a.js","!**/@nested/**"]});r.load(),await P(r),r.assertLog({substring:!0})})}),f("uses custom descriptions in frame names",async({r:e})=>{let t=await e.launchAndLoad("blank");t.cdp.Runtime.evaluate({expression:`
        class Bar {
          method2() {
            debugger;
          }

          toString() {
            return 'Custom';
          }
        }

        class Foo {
          method1() {
            return new Bar().method2();
          }
        }

        new Foo().method1();
      `}),await n(t,!1),t.assertLog()}),f("shows sourcemapped stack during shutdown",async({r:e})=>{D(b,{"input.js":["console.log(new Error('asdf'));","throw new Error('asdf');","//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyJ9"],"input.ts":["console.log(new Error('asdf'));","throw new Error('asdf');"]});let t=await e.runScript("input.js");t.load();let r=(await t.dap.once("output"))?.output;(0,Ly.expect)(r).to.contain("input.ts");let o=(await t.dap.once("output"))?.output;(0,Ly.expect)(o).to.contain("input.ts")})})});var y0={};var GD=m(()=>{"use strict";$();$e();describe("threads",()=>{f("paused",async({r:n})=>{let e=await n.launchUrlAndLoad("index.html");e.cdp.Runtime.evaluate({expression:"debugger;"}),await e.dap.once("stopped"),e.log(await e.dap.threads({})),e.assertLog()}),f("not paused",async({r:n})=>{let e=await n.launchUrlAndLoad("index.html");e.log(await e.dap.threads({})),e.assertLog()}),describe("stepping",()=>{f("basic",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.evaluate(`
        function bar() {
          return 2;
        }
        function foo() {
          debugger;
          bar();
          bar();
        }
        foo();
      `);let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step out`),t.dap.stepOut({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
resume`),t.dap.continue({threadId:r}),t.log(await t.dap.once("continued")),t.assertLog()}),f("cross thread",async({r:e})=>{let t=await e.launchUrlAndLoad("worker.html");t.cdp.Runtime.evaluate({expression:`debugger;
window.w.postMessage('message')
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:i}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(i),t.log(`
resume`),o.dap.continue({threadId:i}),t.log(await o.dap.once("continued")),t.assertLog()}),f("cross thread constructor",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        debugger;
        window.w = new Worker('worker.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:i}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(i),t.log(`
resume`),o.dap.continue({threadId:i}),t.log(await o.dap.once("continued")),t.assertLog()}),f("cross thread skip over tasks",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.p = new Promise(f => window.cb = f);
        debugger;
        p.then(() => {
          var a = 1; // should stop here
        });
        window.w = new Worker('worker.js');
        window.w.postMessage('hey');
        window.w.addEventListener('message', () => window.cb());
        
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let{threadId:o}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(o),t.log(`
resume`),t.dap.continue({threadId:o}),t.log(await t.dap.once("continued")),t.assertLog()});let n=async(e,t)=>{t.cdp.Runtime.evaluate({expression:`debugger;
window.w = new Worker('workerSourceMap.js');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:i}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(i),t.log(`
resume`),o.dap.continue({threadId:i}),t.log(await o.dap.once("continued")),t.assertLog()};f("cross thread constructor source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await n(e,t)}),f("cross thread constructor source map predicted",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");await t.dap.setBreakpoints({source:{path:t.workspacePath("web/does-not-exist.html")},breakpoints:[{line:1,column:1}]}),await n(e,t)}),f("cross thread source map",async({r:e})=>{let t=await e.launchUrlAndLoad("index.html");t.cdp.Runtime.evaluate({expression:`
        window.w = new Worker('workerSourceMap.js');
        debugger;
        window.w.postMessage('hey');
//# sourceURL=test.js`});let{threadId:r}=t.log(await t.dap.once("stopped"));await t.logger.logStackTrace(r),t.log(`
step over`),t.dap.next({threadId:r}),t.log(await Promise.all([t.dap.once("continued"),t.dap.once("stopped")])),await t.logger.logStackTrace(r),t.log(`
step in`),t.dap.stepIn({threadId:r}),t.log(await t.dap.once("continued"));let o=await e.worker(),{threadId:i}=t.log(await o.dap.once("stopped"));await o.logger.logStackTrace(i),t.log(`
resume`),o.dap.continue({threadId:i}),t.log(await o.dap.once("continued")),t.assertLog()})}),describe("pause on exceptions",()=>{async function n(e){let t=e.log(await e.dap.once("stopped"));e.log(await e.dap.exceptionInfo({threadId:t.threadId})),e.log(await e.dap.continue({threadId:t.threadId}))}f("cases",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Not pausing on exceptions"),await t.dap.setExceptionBreakpoints({filters:[]}),await t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),await t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await n(t),t.log("Pausing on uncaught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!')))"),await n(t),t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),await n(t),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {}})"),await n(t),t.log("Pausing on caught rejections"),t.evaluate("new Promise((res, rej) => rej(new Error('oh no!'))).catch(err => {})"),await n(t),t.assertLog()}),f("does not pause on exceptions in internals",async({r:e})=>{let t=await e.launchAndLoad("blank");await t.dap.setExceptionBreakpoints({filters:["all"]});let r=t.evaluate("console.log({ [Symbol.for('debug.description')]() { throw 'oops'; } })");await Promise.race([t.dap.once("stopped").then(()=>{throw new Error("should not stop")}),x(1e3)]),await r,t.assertLog()}),f("pauses on conditional exceptions",async({r:e})=>{let t=await e.launchAndLoad("blank");t.log("Pausing on caught exceptions"),await t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { try { throw new Error('hello'); } catch (e) {} })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye'); } catch (e) {} })"),await n(t),t.log("Pausing on uncaught exceptions"),await t.dap.setExceptionBreakpoints({filters:["uncaught"],filterOptions:[{filterId:"uncaught",condition:'error.message.includes("bye")'}]}),t.evaluate("setTimeout(() => { throw new Error('hello'); })"),t.evaluate("setTimeout(() => { try { throw new Error('goodbye1'); } catch (e) {} })"),t.evaluate("setTimeout(() => { throw new Error('goodbye2'); })"),await n(t),t.assertLog()}),f("deals with syntax errors in conditional exception bps",async({r:e})=>{let t=await e.launchAndLoad("blank");t.dap.setExceptionBreakpoints({filters:["all"],filterOptions:[{filterId:"all",condition:'error.message.includes("bye'}]}),await t.logger.logOutput(await t.dap.once("output")),t.assertLog()}),f("configuration",async({r:e})=>{let t=await e.launch(`
        <script>
          try {
            throw new Error('this error is caught');
          } catch (e) {
          }
          throw new Error('this error is uncaught');
        </script>
      `);await t.dap.setExceptionBreakpoints({filters:["uncaught"]}),t.load(),await n(t),t.assertLog()})})})});var v0={};var JD,KD=m(()=>{"use strict";JD=require("chai");py();$e();describe("variables",()=>{describe("basic",()=>{f("basic object",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog("({a: 1})"),e.assertLog()}),f("simple log",async({r:n})=>{let e=await n.launch(`
        <script>
          console.log('Hello world');
        </script>`);e.load(),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),f("clear console",async({r:n})=>{let e,t=new Promise(i=>e=i),r=Promise.resolve(),o=await n.launch(`
        <script>
        console.clear();
        console.log('Hello world');
        console.clear();
        console.clear();
        console.log('Hello world');
        console.clear();
        console.error('DONE');
        </script>`);o.load(),o.dap.on("output",async i=>{r=r.then(async()=>{i.category==="stderr"?e():await o.logger.logOutput(i)})}),await t,o.assertLog()})}),describe("object",()=>{f("simple array",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = [1, 2, 3]; a.foo = 1; a",{logInternalInfo:!0}),e.assertLog()}),f.skip("large array",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog("var a = new Array(110); a.fill(1); a",{logInternalInfo:!0}),e.assertLog()}),f("get set",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        const a = {};
        Object.defineProperty(a, 'getter', { get: () => {} });
        Object.defineProperty(a, 'setter', { set: () => {} });
        Object.defineProperty(a, 'accessor', { get: () => {}, set: () => {} });
        a;`),e.assertLog()}),f("private props",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class A { #foo = 'bar' }
        new A();`),e.assertLog()}),f("deep accessor",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo { }
        new Bar();`),e.assertLog()}),describe("customDescriptionGenerator",()=>{f("using function declaration",async({r:n})=>{let e=await n.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) return "using function: " + this.customDescription(); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),f("shows errors",async({r:n})=>{let e=await n.launchAndLoad("blank",{customDescriptionGenerator:'function (def) { if (this.customDescription) throw new Error("oh no!"); else return def }'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),f("using statement syntax",async({r:n})=>{let e=await n.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; "using statement: " + (hasCustomDescription ? this.customDescription() : defaultValue)'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),f("using statement with return syntax",async({r:n})=>{let e=await n.launchAndLoad("blank",{customDescriptionGenerator:'const hasCustomDescription = this.customDescription; if (hasCustomDescription) { return "using statement return: " + this.customDescription() } else return defaultValue'});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          new Bar();`),e.assertLog()}),f("with arrays",async({r:n})=>{let e=await n.launchAndLoad("blank",{customDescriptionGenerator:`function (def) {
              return this.customDescription
                ? this.customDescription()
                : (Array.isArray(this)
                  ? "I'm an array"
                  : def); }`});await e.logger.evaluateAndLog(`
          class Foo { get getter() {} }
          class Bar extends Foo { customDescription() { return 'Instance of bar'} }
          [new Bar(), new Foo(), 5, "test"];`),e.assertLog()})}),describe("customPropertiesGenerator",()=>{f("works with customPropertiesGenerator method ",async({r:n})=>{let e=await n.launchAndLoad("blank",{customPropertiesGenerator:"function () { if (this.customPropertiesGenerator) return this.customPropertiesGenerator(); else return this; }"});await e.logger.evaluateAndLog(`
        class Foo { get getter() {} }
        class Bar extends Foo {
          constructor() {
            super();
            this.realProp = 'cc3';
          }

          customPropertiesGenerator() {
            const properties = Object.create(this.__proto__);
            return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
          }
        }
        new Bar();`),e.assertLog()})}),f("shows errors while generating properties",async({r:n})=>{let e=await n.launchAndLoad("blank",{customPropertiesGenerator:'function () { if (this.customPropertiesGenerator) throw new Error("Some error while generating properties"); else return this; }'});await e.logger.evaluateAndLog(`
      class Foo { get getter() {} }
      class Bar extends Foo {
        constructor() {
          super();
          this.realProp = 'cc3';
        }

        customPropertiesGenerator() {
          const properties = Object.create(this.__proto__);
          return Object.assign(properties, this, { customProp1: 'aa1', customProp2: 'bb2' });
        }
      }
      new Bar();`),e.assertLog()})}),describe("web",()=>{f("tags",async({r:n})=>{let e=await n.launchAndLoad(`<head>
        <meta name='foo' content='bar'></meta>
        <title>Title</title>
      </head>`);await e.logger.evaluateAndLog("document.head.children"),e.assertLog()})}),describe("multiple threads",()=>{f("worker",async({r:n})=>{let e=await n.launchUrlAndLoad("worker.html"),t=[];await Promise.all([(async()=>t.push({output:await e.dap.once("output"),logger:e.logger}))(),(async()=>{let r=await n.worker();t.push({output:await r.dap.once("output"),logger:r.logger}),t.push({output:await r.dap.once("output"),logger:r.logger})})()]),t.sort((r,o)=>{let i=r?.output?.source?.name,s=o?.output?.source?.name;return i&&s?i.localeCompare(s):0});for(let{output:r,logger:o}of t)await o.logOutput(r);e.assertLog()})}),describe("setVariable",()=>{f("basic",async({r:n})=>{let e=await n.launchAndLoad("blank"),t=await e.logger.evaluateAndLog("window.x = ({foo: 42}); x");e.log(`
Setting "foo" to "{bar: 17}"`);let r=await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"{bar: 17}"}),o={...r,variablesReference:r.variablesReference||0,name:"<result>"};await e.logger.logVariable(o),e.log(`
Original`),await e.logger.logVariable(t),e.log(await e.dap.setVariable({variablesReference:t.variablesReference,name:"foo",value:"baz"}),`
setVariable failure: `),e.assertLog()}),f("setExpression",async({r:n})=>{let e=await n.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = { b: 1 }
          let c = 'e';
          debugger;
          console.log(a.b, c);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId});e.log(await e.dap.setExpression({expression:"a.b",value:"42",frameId:r.stackFrames[0].id}),`
setExpression a: `),e.log(await e.dap.setExpression({expression:"c",value:'"hello " + "world"',frameId:r.stackFrames[0].id}),`
setExpression a: `),e.dap.continue({threadId:t.threadId}),e.log(`
 Vars:`),await e.logger.logOutput(await e.dap.once("output")),e.assertLog()}),f("scope",async({r:n})=>{let e=await n.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let y = 'value of y';
          let z = 'value of z';
          debugger;
        })()
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),i=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:i.name,variablesReference:i.variablesReference,namedVariables:i.namedVariables,indexedVariables:i.indexedVariables};await e.logger.logVariable(s),e.log(`
Setting "y" to "z"`);let a=await e.dap.setVariable({variablesReference:s.variablesReference,name:"y",value:"z"}),c={...a,variablesReference:a.variablesReference||0,name:"<result>"};await e.logger.logVariable(c),e.log(`
Original`),await e.logger.logVariable(s),e.assertLog()}),f("name mapping",async({r:n})=>{let e=await n.launchUrlAndLoad("minified/index.html");e.cdp.Runtime.evaluate({expression:"test()"});let t=await e.dap.once("stopped"),r=await e.logger.logStackTrace(t.threadId,1/0);e.log(`
Preserves eval sourceURL (#1259):`),e.log(await e.dap.evaluate({expression:"arg1; thenSomethingInvalid()",context:"repl",frameId:r[0].id})),await e.dap.continue({threadId:t.threadId}),e.assertLog()}),f("evaluateName",async({r:n})=>{let e=await n.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let a = 'some string';
          let b = [1, 2, 3, 4];
          b.prop = '';
          let c = { $a: 1, _b: 2, c: 3, 'd d': 4, [42]: 5,
            e: { nested: [{ obj: true }]}, [Symbol('wut')]: 'wut' };
          debugger;
        })();
      `});let t=e.log(await e.dap.once("stopped"),"stopped: "),r=await e.dap.stackTrace({threadId:t.threadId}),i=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:i.name,variablesReference:i.variablesReference,namedVariables:i.namedVariables,indexedVariables:i.indexedVariables};await Fs(e.dap,s,(a,c)=>(e.log("  ".repeat(c)+a.evaluateName),!a.name.startsWith("__")&&!a.name.startsWith("[[")&&a.name!=="this")),e.assertLog()})}),f("map variable without preview (#1824)",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      class A { #bar = new Map([[1, 2]]) }
      new A();`),e.assertLog()}),f("readMemory/writeMemory",async({r:n})=>{let e=await n.launchAndLoad("blank");e.cdp.Runtime.evaluate({expression:`
        (function foo() {
          let $memA = new WebAssembly.Memory({ initial: 1, maximum: 1 });
          let $memB = $memA.buffer.slice(0, 12);
          let $memC = new Uint8Array($memB);
          let $memD = new DataView($memB);
          let $memE = new Uint8Array($memB, 3, 8);

          for (let i = 0; i < $memC.length; i++) {
            $memC[i] = i;
          }

          debugger;
          console.log($memA, $memB, $memC, $memD);
        })()
      `});let t=await e.dap.once("stopped"),r=await e.dap.stackTrace({threadId:t.threadId}),i=(await e.dap.scopes({frameId:r.stackFrames[0].id})).scopes[0],s={name:"scope",value:i.name,variablesReference:i.variablesReference,namedVariables:i.namedVariables,indexedVariables:i.indexedVariables},a,c;await Fs(e.dap,s,async(w,I)=>{if(!w.name.startsWith("$mem"))return I<2;w.name==="$memB"?a=w:w.name==="$memE"&&(c=w),(0,JD.expect)(w).to.have.property("memoryReference");let v=await e.dap.readMemory({count:20,memoryReference:w.memoryReference,offset:0});e.log(v,`${w.name} [0, 20]`);let A=await e.dap.readMemory({count:10,memoryReference:w.memoryReference,offset:5});return e.log(A,`${w.name} [5, 10]`),!1});let l=await e.dap.writeMemory({memoryReference:a.memoryReference,data:Buffer.from("hello").toString("base64"),offset:1});e.log(l,"write");let p=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(p,"read outcome");let u=await e.dap.writeMemory({memoryReference:c.memoryReference,data:Buffer.from("helloworld").toString("base64"),offset:1});e.log(u,"write with offset");let g=await e.dap.readMemory({count:10,memoryReference:a.memoryReference});e.log(g,"read outcome"),e.assertLog()})})});var I0={};var QD=m(()=>{"use strict";J();Gr();bt();$e();describe("console format",()=>{f("string",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var array = ["test", "test2"];array.length = 10;
          array.foo = {};
          array[4] = "test4";
        </script>`);await e.logger.evaluateAndLog(["console.log(array)",'console.log("hello world".repeat(10000))','console.log("%o", array)','console.log("%O", array)','console.log("Test for zero \\"%f\\" in formatter", 0)','console.log("%% self-escape1", "dummy")','console.log("%%s self-escape2", "dummy")','console.log("%%ss self-escape3", "dummy")','console.log("%%s%s%%s self-escape4", "dummy")','console.log("%%%%% self-escape5", "dummy")','console.log("%%%s self-escape6", "dummy");']),e.assertLog()}),f("string format",async({r:n})=>{let e=await n.launchUrl("stringFormats.html");e.load();let t=await e.dap.once("output");for(let r=0;r<4;r++)await e.logger.logOutput(await e.dap.once("output"));await e.logger.logOutput(t);for(let r of["hover","repl"])await e.logger.evaluateAndLog("obj",{depth:1},r),await e.logger.evaluateAndLog("xa",{depth:1},r),await e.logger.evaluateAndLog("xb",{depth:1},r),await e.logger.evaluateAndLog("xc",{depth:1},r),await e.logger.evaluateAndLog("xd",{depth:1},r);e.assertLog()}),f("popular types",async({r:n})=>{let e=await n.launchAndLoad(`
        <p id="p"></p>
        <script>
          // Populate Globals
          var regex1 = /^url\\(\\s*(?:(?:"(?:[^\\\\\\"]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*"|'(?:[^\\\\\\']|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*')|(?:[!#$%&*-~\\w]|(?:\\\\[\\da-f]{1,6}\\s?|\\.))*)\\s*\\)/i;
          var regex2 = new RegExp("foo\\\\\\\\bar\\\\sbaz", "i");
          var str = "test";
          var str2 = "test named \\"test\\"";
          var error = new Error;
          var errorWithMessage = new Error("my error message");
          var errorWithMultilineMessage = new Error("my multiline\\nerror message");
          var node = document.getElementById("p");
          var func = function() { return 1; };
          var multilinefunc = function() {
              return 2;
          };
          var num = 1.2e-1;
          var throwingLengthGetter = {get length() { throw "Length called"; }};
          var objectWithNonEnumerables = Object.create({ foo: 1 }, {
              __underscoreNonEnumerableProp: { value: 2, enumerable: false },
              abc: { value: 3, enumerable: false },
              getFoo: { value: function() { return this.foo; } },
              bar: { get: function() { return this.bar; }, set: function(x) { this.bar = x; } }
          });
          objectWithNonEnumerables.enumerableProp = 4;
          objectWithNonEnumerables.__underscoreEnumerableProp__ = 5;
          var negZero = 1 / Number.NEGATIVE_INFINITY;
          var arrayLikeFunction = function( /**/ foo/**/, /*/**/bar,
          /**/baz) {};
          arrayLikeFunction.splice = function() {};
          var tinyTypedArray = new Uint8Array([3]);
          var smallTypedArray = new Uint8Array(new ArrayBuffer(400));
          smallTypedArray["foo"] = "bar";
          var bigTypedArray = new Uint8Array(new ArrayBuffer(400 * 1000 * 1000));
          bigTypedArray["FAIL"] = "FAIL: Object.getOwnPropertyNames() should not have been run";
          var bigArray = [];
          bigArray.length = 200;
          bigArray.fill(1);
          var boxedNumberWithProps = new Number(42);
          boxedNumberWithProps[1] = "foo";
          boxedNumberWithProps["a"] = "bar";
          var boxedStringWithProps = new String("abc");
          boxedStringWithProps["01"] = "foo";
          boxedStringWithProps[3] = "foo";
          boxedStringWithProps["a"] = "bar";
          function domException()
          {
              var result = "FAIL";
              try {
                  var a = document.createElement("div");
                  var b = document.createElement("div");
                  a.removeChild(b);
              } catch(e) {
                  e.stack = "";
                  result = e;
              }
              return result;
          }
          //# sourceURL=console-format
        </script>`),r=["regex1","regex2","str","str2","error","errorWithMessage","errorWithMultilineMessage","func","multilinefunc","num","null","undefined","NaN","Number.POSITIVE_INFINITY","Number.NEGATIVE_INFINITY","{}","[function() {}]","objectWithNonEnumerables","negZero","Object.create(null)","Object","Object.prototype","new Number(42)",'new String("abc")',"arrayLikeFunction",'new Uint16Array(["1", "2", "3"])',"tinyTypedArray","smallTypedArray","bigTypedArray","throwingLengthGetter","domException()","bigArray","boxedNumberWithProps","boxedStringWithProps","false","true","node","new Boolean(true)","new Set([1, 2, 3, 4])","new Set([1, 2, 3, 4, 5, 6, 7, 8])",'new class { toString() { return "custom to string" } }','new class { toString() { return "long custom to string".repeat(500) } }','new class { [Symbol.for("debug.description")]() { return "some custom repr" } }','new class { [Symbol.for("nodejs.util.inspect.custom")](depth) { return "some node repr, depth: " + depth } }'].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),f("custom toString",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      new class A {
        prop = new class B {
          toString() { return "hello b" }
        }
        toString() { return "hello a" }
      }
    `),e.assertLog()}),f("custom symbol",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(`
      new class A {
        prop = new class B {
          [Symbol.for("debug.description")]() { return "hello b" }
        };
        [Symbol.for("debug.description")]() { return "hello a" }
      }
    `),e.assertLog()}),f("collections",async({r:n})=>{let e=await n.launchAndLoad(`
        <div style="display:none" class="c1 c2 c3">
          <form id="f">
              <select id="sel" name="sel">
                  <option value="1">one</option>
                  <option value="2">two</option>
              </select>
              <input type="radio" name="x" value="x1"> x1
              <input type="radio" name="x" value="x2"> x2
          </form>
        </div>
        <script>
          var formElement = document.getElementById("f");
          var selectElement = document.getElementById("sel");
          var spanElement = document.getElementById("span");

          // NodeList
          var nodelist = document.getElementsByTagName("select");
          var htmlcollection = document.head.children;
          var options = selectElement.options;
          var all = document.all;
          var formControls = formElement.elements;
          var radioNodeList = formElement.x;

          var arrayX = [1];
          var arrayY = [2, arrayX];
          arrayX.push(arrayY);

          var nonArray = new NonArrayWithLength();
          // Arguments
          function generateArguments(foo, bar)
          {
              return arguments;
          }

          var div = document.getElementsByTagName("div")[0];

          function NonArrayWithLength() {
              this.keys = [];
          }

          NonArrayWithLength.prototype.__defineGetter__("length", function() {
              console.log("FAIL: 'length' should not be called");
              return this.keys.length;
          });
        </script>`),r=["nodelist","htmlcollection","options","all","formControls","radioNodeList","arrayX","nonArray",'generateArguments(1, "2")',"div.classList"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),f("es6",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var p = Promise.reject(-0);
          p.catch(function() {});

          var p2 = Promise.resolve(1);
          var p3 = new Promise(() => {});

          var smb1 = Symbol();
          var smb2 = Symbol("a");
          var obj = {
              get getter() {}
          };
          obj["a"] = smb1;
          obj[smb2] = 2;

          var map = new Map();
          var weakMap = new WeakMap();
          map.set(obj, {foo: 1});
          weakMap.set(obj, {foo: 1});

          var set = new Set();
          var weakSet = new WeakSet();
          set.add(obj);
          weakSet.add(obj);

          var mapMap0 = new Map();
          mapMap0.set(new Map(), new WeakMap());
          var mapMap = new Map();
          mapMap.set(map, weakMap);

          var setSet0 = new Set();
          setSet0.add(new WeakSet());
          var setSet = new Set();
          setSet.add(weakSet);

          var bigmap = new Map();
          bigmap.set(" from str ", " to str ");
          bigmap.set(undefined, undefined);
          bigmap.set(null, null);
          bigmap.set(42, 42);
          bigmap.set({foo:"from"}, {foo:"to"});
          bigmap.set(["from"], ["to"]);

          var genFunction = function *() {
              yield 1;
              yield 2;
          }
          var generator = genFunction();
        </script>`),r=["p","p2","p3","smb1","smb2","obj","map","weakMap","set","weakSet","mapMap0","mapMap","setSet0","setSet","bigmap","generator"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),f("es6-2",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var map2 = new Map();
          map2.set(41, 42);
          map2.set({foo: 1}, {foo: 2});

          var iter1 = map2.values();
          iter1.next();

          var set2 = new Set();
          set2.add(41);
          set2.add({foo: 1});

          var iter2 = set2.keys();
          iter2.next();
        </script>`),r=["map2.keys()","map2.values()","map2.entries()","set2.keys()","set2.values()","set2.entries()","iter1","iter2"].map(o=>[`console.log(${o})`,`console.log([${o}])`]);await e.logger.evaluateAndLog([].concat(...r),{depth:0}),e.assertLog()}),f("array",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),f("class",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var a0 = [];
          var a1 = []; a1.length = 1;
          var a2 = []; a2.length = 5;
          var a3 = [,2,3];
          var a4 = []; a4.length = 15;
          var a5 = []; a5.length = 15; a5[8] = 8;
          var a6 = []; a6.length = 15; a6[0] = 0; a6[10] = 10;
          var a7 = [,,,4]; a7.length = 15;
          for (var i = 0; i < 6; ++i)
              a7["index" + i] = i;
          var a8 = [];
          for (var i = 0; i < 10; ++i)
              a8[i] = i;
          var a9 = [];
          for (var i = 1; i < 5; ++i) {
              a9[i] = i;
              a9[i + 5] = i + 5;
          }
          a9.length = 11;
          a9.foo = "bar";
          a10 = Object.create([1,2]);
        </script>`),t=new Array(11).fill(0).map((r,o)=>`console.log(a${o})`);await e.logger.evaluateAndLog(t,{depth:0}),e.assertLog()}),f("groups",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('outer')","console.group()","console.log('in anonymous')","console.groupCollapsed('named')","console.log('in named')","console.group({ complex: true })","console.log('in complex')","console.groupEnd()","console.groupEnd()","console.log('back in anonymous')","console.groupEnd()"]),e.assertLog()}),f("colors",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('%cColors are awesome.', 'color: blue;')","console.log('%cColors are awesome.', 'background-color: red;')","console.log('%cColors are awesome.', 'background-color: red;', 'Do not apply to trailing params')","console.log('%cColors %care %cawesome.', 'color: red', 'color:green', 'color:blue')","console.log('%cBold text.', 'font-weight: bold')","console.log('%cItalic text.', 'font-style: italic')","console.log('%cUnderline text.', 'text-decoration: underline')"],{depth:0}),e.assertLog()}),f("nodes",async({r:n})=>{let e=await n.launchAndLoad(`
      <div id="main">
        Content
        <p>Paragaph</p>
        More content
        <div></div>
      </div>
    `);await e.logger.evaluateAndLog('document.getElementById("main")',{depth:3,omitProperties:["Node Attributes","[[Prototype]]"]}),e.assertLog()}),f("error traces in source maps",async({r:n})=>{let e=await n.launchUrlAndLoad("browserify/browserify.html");await e.logger.evaluateAndLog(["try { throwError() } catch (e) { console.error(e) }"]),e.assertLog()}),f("adds error traces if they do not exist",async({r:n})=>{let e=await n.launchUrlAndLoad("browserify/browserify.html"),t=e.dap.once("output");await e.logger.evaluateAndLog(['setTimeout(() => { throw "asdf" }, 0) ']),e.log(await t),e.assertLog()}),f("applies skipfiles to logged stacks",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
        function doLog() { console.log.apply(console, arguments); }
        //# sourceURL=ignore-me.js
        </script>
      `,{skipFiles:["**/ignore-me.js"]}),t=e.dap.evaluate({expression:`doLog("hello world");
//# sourceURL=dont-ignore-me.js`,context:"watch"}),r=await e.dap.once("output");await t,e.log(`logged ${r.output} at ${r.source?.name}:${r.line}:${r.column}`),e.assertLog()}),f("EXT handling",async({r:n})=>{D(b,{"test.js":[`
          process.stdout.write('hello');
          debugger;
          process.stdout.write('world');
          debugger;
          process.stdout.write('new line\\r\\nasdf');
          debugger;
          process.stdout.write('now ext\\u0003this should be bulked');
          debugger;
          process.stdout.write('with this!\\u0003trailing');
        `]});let e=await n.runScript("test.js",{outputCapture:"std"}),t="";n.rootDap().on("output",r=>{t+=r.output}),e.dap.on("stopped",r=>{e.dap.continue({threadId:r.threadId})}),await e.load(),await n.rootDap().once("terminated"),n.log(JSON.stringify(t)),e.assertLog()}),f("ANSI colorization",async({r:n})=>{let e=await n.launchAndLoad(`
        <script>
          var array = ["test", "test2"];array.length = 10;
          array.foo = {};
          array[4] = "test4";
        </script>`);e.dap.evaluate({expression:'console.log("\\x1b[31mThis is a red message\\x1b[0m")'}),e.logger.logOutput(await e.dap.once("output"));for(let t of["watch","variables"])e.log(`In context ${t}:`),await e.logger.logEvaluateResult(await e.dap.evaluate({expression:'"\\x1b[31mThis is a red message\\x1b[0m"',context:t})),await e.logger.logEvaluateResult(await e.dap.evaluate({expression:'({x:"\\x1b[31mThis is a red message\\x1b[0m"})',context:t}));e.assertLog()})})});var S0={};var XD=m(()=>{"use strict";$e();describe("console api",()=>{describe("format",()=>{f("format string",async({r:n})=>{let e=await n.launchAndLoad("blank");await e.logger.evaluateAndLog(["console.log('Log')","console.info('Info')","console.warn('Warn')","console.error('Error')","console.assert(false, 'Assert')","console.assert(false)","console.trace('Trace')","console.count('Counter')","console.count('Counter')"]),e.assertLog()})}),f("format string",async({r:n})=>{let e=await n.launchAndLoad(`<script>
    var peopleObject = {
      one: ["John", "Smith"],
      two: ["Jane", "Doe"],
      three: ["Emily", "Jones"]
    };
    var peopleObject2 = {
      one: { name: "John", last: "Smith"},
      two: { name: "Jane", last: "Doe"},
      three: { name: "Emily", last: "Jones"}
    };
    var peopleLongHeader = {
      one: { "first name": "John", "last name": "Smith"},
      two: { "first name": "Jane", "last name": "Doe"},
      three: { "first name": "Emily", "last name": "Jones"}
    };
    var peopleArray= [
      ["John", "Smith"],
      ["Jane", "Doe"],
      ["Emily", "Jones"]
    ];
    var trimEmptyColumn = [
      ["John", "Smith", ""],
      ["Jane", "Doe", ""],
      ["Emily", "Jones", ""]
    ];
    var cellOverflow = {
      one: ["John", "Smith"],
      two: ["Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane Jane ",
       "Doe Doe Doe Doe Doe Doe Doe DoeDoe DoeDoe Doe Doe DoeDoe DoeDoe DoeDoe Doe"],
      three: ["Emily", "Jones"]
    };
    var longTableOverflow = [
      new Array(1000).fill(0),
      new Array(1000).fill(1)
    ];
    </script>`);await e.logger.evaluateAndLog(["console.table(peopleObject)","console.table(peopleObject2)","console.table(peopleLongHeader)","console.table(peopleArray)","console.table(trimEmptyColumn)","console.table(cellOverflow)","console.table(longTableOverflow)"],{depth:0}),e.assertLog()})})});var x0={};Lg(x0,{run:()=>P0});module.exports=Eg(x0);var p0=new Map([["browser/browser-args.test.ts",()=>Promise.resolve().then(()=>(Hy(),iL))],["browser/browser-launch.test.ts",()=>Promise.resolve().then(()=>(UR(),WA))],["browser/performance.test.ts",()=>Promise.resolve().then(()=>(WR(),VA))],["common/cancellation.test.ts",()=>Promise.resolve().then(()=>(VR(),$A))],["common/cdpTransport.test.ts",()=>Promise.resolve().then(()=>(HR(),qA))],["common/logging.test.ts",()=>Promise.resolve().then(()=>(GR(),HA))],["common/mapUsingProjection.test.ts",()=>Promise.resolve().then(()=>(JR(),zA))],["common/pathUtils.test.ts",()=>Promise.resolve().then(()=>(KR(),GA))],["common/sourceMapOverrides.test.ts",()=>Promise.resolve().then(()=>(XR(),JA))],["common/sourceMapRepository.test.ts",()=>Promise.resolve().then(()=>(YR(),KA))],["completion/completion.test.ts",()=>Promise.resolve().then(()=>(ZR(),QA))],["extension/extensionHostConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(rD(),XA))],["extension/nodeConfigurationProvider.test.ts",()=>Promise.resolve().then(()=>(iD(),YA))],["extension/pickAttach.test.ts",()=>Promise.resolve().then(()=>(cD(),ZA))],["extension/profiling.test.ts",()=>Promise.resolve().then(()=>(pD(),e0))],["node/lease-file.test.ts",()=>Promise.resolve().then(()=>(uD(),t0))],["node/node-runtime.test.ts",()=>Promise.resolve().then(()=>(fD(),r0))],["node/node-source-path-resolver.test.ts",()=>Promise.resolve().then(()=>(hD(),o0))],["node/process-tree.test.ts",()=>Promise.resolve().then(()=>(vD(),i0))],["node/runtimeVersion.test.ts",()=>Promise.resolve().then(()=>(SD(),s0))],["resourceProvider/resourceProvider.test.ts",()=>Promise.resolve().then(()=>(kD(),a0))],["sources/pretty-print.test.ts",()=>Promise.resolve().then(()=>(PD(),c0))],["wasm/wasm.test.ts",()=>Promise.resolve().then(()=>(xD(),l0))]]),CD=p0;var bu=y(require("mocha")),Cg=require("path"),YD=y(RD());var Joe=require("reflect-metadata"),Cy=require("chai");(0,Cy.use)(require("chai-subset"));(0,Cy.use)(require("chai-as-promised"));function k0(){let n=require("nyc"),e=new n({cwd:(0,Cg.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test","..","..",".."),exclude:["**/test/**",".vscode-test/**"],reporter:["text","html"],all:!0,instrument:!0,hookRequire:!0,hookRunInContext:!0,hookRunInThisContext:!0});return e.reset(),e.wrap(),e}async function P0(){let n=process.env.COVERAGE?k0():null,e={timeout:10*1e3,color:!0,...JSON.parse(process.env.PWA_TEST_OPTIONS||"{}")};process.env.ONLY_MINSPEC==="true"&&(e.grep="node runtime");let t=e.grep||e.g;t&&(e.grep=new RegExp(String(t),"i")),e.reporter=YD.default,process.env.BUILD_ARTIFACTSTAGINGDIRECTORY&&(e.reporterOptions={reporterEnabled:"mocha-junit-reporter",mochaJunitReporterReporterOptions:{testsuitesTitle:`tests ${process.platform}`,mochaFile:(0,Cg.join)(process.env.BUILD_ARTIFACTSTAGINGDIRECTORY,`test-results/TEST-${process.platform}-test-results.xml`)}});let r=new bu.default(e),o=async(s,a)=>{r.suite.emit(bu.default.Suite.constants.EVENT_FILE_PRE_REQUIRE,globalThis,s,r);let c=await a();r.suite.emit(bu.default.Suite.constants.EVENT_FILE_REQUIRE,c,s,r),r.suite.emit(bu.default.Suite.constants.EVENT_FILE_POST_REQUIRE,globalThis,s,r)};process.env.RETRY_TESTS&&r.retries(Number(process.env.RETRY_TESTS));let i=s=>(0,Cg.join)("/Users/lucas.silva/.config/nvim/vscode-js-debug/src/test",`${s}.ts`);if(process.env.FRAMEWORK_TESTS)await o(i("framework/reactTest"),()=>Promise.resolve().then(()=>(_D(),u0)));else{await o(i("testIntegrationUtils"),()=>Promise.resolve().then(()=>($e(),BR))),await o(i("infra/infra"),()=>Promise.resolve().then(()=>(AD(),d0))),await o(i("breakpoints/breakpointsTest"),()=>Promise.resolve().then(()=>(FD(),m0))),await o(i("browser/framesTest"),()=>Promise.resolve().then(()=>(MD(),f0))),await o(i("browser/blazorSourcePathResolverTest"),()=>Promise.resolve().then(()=>($D(),g0))),await o(i("evaluate/evaluate"),()=>Promise.resolve().then(()=>(qD(),h0))),await o(i("sources/sourcesTest"),()=>Promise.resolve().then(()=>(HD(),b0))),await o(i("stacks/stacksTest"),()=>Promise.resolve().then(()=>(zD(),w0))),await o(i("threads/threadsTest"),()=>Promise.resolve().then(()=>(GD(),y0))),await o(i("variables/variablesTest"),()=>Promise.resolve().then(()=>(KD(),v0))),await o(i("console/consoleFormatTest"),()=>Promise.resolve().then(()=>(QD(),I0))),await o(i("console/consoleAPITest"),()=>Promise.resolve().then(()=>(XD(),S0)));for(let[s,a]of CD)await o(i(s),a)}try{await new Promise((s,a)=>r.run(c=>c?a(new Error(`${c} tests failed`)):s(void 0)))}finally{n&&(n.writeCoverageFile(),await n.report())}}0&&(module.exports={run});
//# sourceMappingURL=testRunner.js.map
